<!doctype html><html lang=en><head><title>To Be a Terraform Expert &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>To Be a Terraform Expert</h1></header><div class=content__body><p>I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.</p><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Use <code class=verbatim>-target</code> with <code class=verbatim>plan</code> command to collaborate</h3><div id=outline-text-headline-1 class=outline-text-3><p>When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the <code class=verbatim>-target</code> to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources.</p></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Use remote state to collaborate with others</h3><div id=outline-text-headline-2 class=outline-text-3><p>If you need to work on the same project with your colleagues, you need to set up a remote state. We use <code class=verbatim>s3</code> as our state backend, it will use s3 bucket to store the state file, and a DynamoDB table to store the lock. If you encounter some problems, you maybe need to check these resources manually to confirm it's all working properly.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Use <code class=verbatim>state rm</code> command to put resources outside terraform</h3><div id=outline-text-headline-3 class=outline-text-3><p>You know, the state file includes the states terraform known about your resources, but what will happen if you delete some resources through other tools (e.g., make changes through AWS console)? Terraform didn't know those changes. We can use <code class=verbatim>state rm</code> command to tell terraform not to manage these states in the feature. Beware that, the <code class=verbatim>destroy</code> command will remove remote resources, and the <code class=verbatim>state rm</code> will only remove from the state, if you haven't removed the remote resources through other tools, the resources will still there.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Use <code class=verbatim>state mv</code> command after you rename resources</h3><div id=outline-text-headline-4 class=outline-text-3><p>We may need to change the resource name in our codes, for example rename or put the resource under another module. After the rename the Terraform usually will create a plan that include destroy and create. We can use <code class=verbatim>mv</code> to rename the resource names in the state file, so that Terraform will know the changes and create a correct plan.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Use <code class=verbatim>import</code> command to import resources inside terraform</h3><div id=outline-text-headline-5 class=outline-text-3><p>Sometimes, it's easy to create some resources through web UI. With <code class=verbatim>import</code> command, we can create resources through the web UI, and then import them to terraform state.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Use fake modules to solve dependency</h3><div id=outline-text-headline-6 class=outline-text-3><p>If you have use providers in your module when you delete that module, terraform will report an error, that it can't find providers. It's annoying when you use modules in modules. You can simply create some fake module, these modules only have the same names as the original modules, but didn't have any resources. After apply, you can safely remove these fake modules.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Use temporary workspace and <code class=verbatim>console</code> to test terraform expressions</h3><div id=outline-text-headline-7 class=outline-text-3><p>HCL for terraform was not a programming language, but we can't stop to do programming in terraform. When we write some expressions, we need to test it. I suggest creating a temporary project to test it. Think about that you have a big project with 20+ resources, you need to refresh the states every time you want to run terraform plan.</p><p>Simply put the expressions in a <code class=verbatim>locals</code> block, and output the results in <code class=verbatim>output</code> blocks, you will see the terraform plan command run very fast.</p></div></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2020-06-30</p><hr>On this page:<nav id=TableOfContents><ul><li><a href=#headline-1>Use <code class=verbatim>-target</code> with <code class=verbatim>plan</code> command to collaborate</a></li><li><a href=#headline-2>Use remote state to collaborate with others</a></li><li><a href=#headline-3>Use <code class=verbatim>state rm</code> command to put resources outside terraform</a></li><li><a href=#headline-4>Use <code class=verbatim>state mv</code> command after you rename resources</a></li><li><a href=#headline-5>Use <code class=verbatim>import</code> command to import resources inside terraform</a></li><li><a href=#headline-6>Use fake modules to solve dependency</a></li><li><a href=#headline-7>Use temporary workspace and <code class=verbatim>console</code> to test terraform expressions</a></li></ul></nav></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd Â© 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>