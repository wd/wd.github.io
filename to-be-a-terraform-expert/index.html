<!doctype html><html lang=en><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://wdicc.com/favicon.ico><title>To Be a Terraform Expert | wd and cc</title><meta name=title content="To Be a Terraform Expert"><meta name=description content="
I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.


Use -target with plan command to collaborate



When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the -target to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources."><meta name=keywords content="terraform,"><meta property="og:url" content="https://wdicc.com/to-be-a-terraform-expert/"><meta property="og:site_name" content="wd and cc"><meta property="og:title" content="To Be a Terraform Expert"><meta property="og:description" content="I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.
Use -target with plan command to collaborate When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the -target to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-30T17:17:34+08:00"><meta property="article:modified_time" content="2020-06-30T17:17:34+08:00"><meta property="article:tag" content="Terraform"><meta name=twitter:card content="summary"><meta name=twitter:title content="To Be a Terraform Expert"><meta name=twitter:description content="I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.
Use -target with plan command to collaborate When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the -target to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources."><meta itemprop=name content="To Be a Terraform Expert"><meta itemprop=description content="I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.
Use -target with plan command to collaborate When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the -target to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources."><meta itemprop=datePublished content="2020-06-30T17:17:34+08:00"><meta itemprop=dateModified content="2020-06-30T17:17:34+08:00"><meta itemprop=wordCount content="556"><meta itemprop=keywords content="Terraform"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--code-background-color:#f2f2f2;--code-color:#222;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--code-background-color:#000;--code-color:#ddd;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px}blockquote{border-left:1px solid #999;color:var(--code-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{padding:1px 15px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>wd and cc</h2></a><p>-- Good good study, day day up!</p><nav><a href=/>Home</a>
<a href=/posts/>Posts</a>
<a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a>
<a href=/tags/>Tags</a>
<a href=/atom.xml>subscribe</a></nav></header><main><h1>To Be a Terraform Expert</h1><p><i><time datetime=2020-06-30>30 Jun, 2020
</time></i><a href=https://wdicc.com/tags/terraform/>#Terraform</a></p><content><p>I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.</p><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Use <code class=verbatim>-target</code> with <code class=verbatim>plan</code> command to collaborate</h3><div id=outline-text-headline-1 class=outline-text-3><p>When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the <code class=verbatim>-target</code> to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources.</p></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Use remote state to collaborate with others</h3><div id=outline-text-headline-2 class=outline-text-3><p>If you need to work on the same project with your colleagues, you need to set up a remote state. We use <code class=verbatim>s3</code> as our state backend, it will use s3 bucket to store the state file, and a DynamoDB table to store the lock. If you encounter some problems, you maybe need to check these resources manually to confirm it's all working properly.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Use <code class=verbatim>state rm</code> command to put resources outside terraform</h3><div id=outline-text-headline-3 class=outline-text-3><p>You know, the state file includes the states terraform known about your resources, but what will happen if you delete some resources through other tools (e.g., make changes through AWS console)? Terraform didn't know those changes. We can use <code class=verbatim>state rm</code> command to tell terraform not to manage these states in the feature. Beware that, the <code class=verbatim>destroy</code> command will remove remote resources, and the <code class=verbatim>state rm</code> will only remove from the state, if you haven't removed the remote resources through other tools, the resources will still there.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Use <code class=verbatim>state mv</code> command after you rename resources</h3><div id=outline-text-headline-4 class=outline-text-3><p>We may need to change the resource name in our codes, for example rename or put the resource under another module. After the rename the Terraform usually will create a plan that include destroy and create. We can use <code class=verbatim>mv</code> to rename the resource names in the state file, so that Terraform will know the changes and create a correct plan.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Use <code class=verbatim>import</code> command to import resources inside terraform</h3><div id=outline-text-headline-5 class=outline-text-3><p>Sometimes, it's easy to create some resources through web UI. With <code class=verbatim>import</code> command, we can create resources through the web UI, and then import them to terraform state.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Use fake modules to solve dependency</h3><div id=outline-text-headline-6 class=outline-text-3><p>If you have use providers in your module when you delete that module, terraform will report an error, that it can't find providers. It's annoying when you use modules in modules. You can simply create some fake module, these modules only have the same names as the original modules, but didn't have any resources. After apply, you can safely remove these fake modules.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Use temporary workspace and <code class=verbatim>console</code> to test terraform expressions</h3><div id=outline-text-headline-7 class=outline-text-3><p>HCL for terraform was not a programming language, but we can't stop to do programming in terraform. When we write some expressions, we need to test it. I suggest creating a temporary project to test it. Think about that you have a big project with 20+ resources, you need to refresh the states every time you want to run terraform plan.</p><p>Simply put the expressions in a <code class=verbatim>locals</code> block, and output the results in <code class=verbatim>output</code> blocks, you will see the terraform plan command run very fast.</p></div></div></content><div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wdicc.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>