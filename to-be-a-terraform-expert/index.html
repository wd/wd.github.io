<!doctype html><html lang=zh-cn><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>To Be a Terraform Expert | wd and cc</title><link rel=canonical href=https://wdicc.com/to-be-a-terraform-expert/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="To Be a Terraform Expert"><meta property="og:description" content="I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.
Use -target with plan command to collaborate When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources."><meta property="og:type" content="article"><meta property="og:url" content="https://wdicc.com/to-be-a-terraform-expert/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-30T17:17:34+08:00"><meta property="article:modified_time" content="2020-06-30T17:17:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="To Be a Terraform Expert"><meta name=twitter:description content="I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.
Use -target with plan command to collaborate When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources."><link rel=stylesheet href=https://wdicc.com/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://wdicc.com/wdicc.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://wdicc.com/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/tags>Tags</a></li><li><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a></li><li><a href=/atom.xml>Subscribe</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://wdicc.com/transparent-proxys/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://wdicc.com/use-certbot-docker-to-manage-certs/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&text=To%20Be%20a%20Terraform%20Expert" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&is_video=false&description=To%20Be%20a%20Terraform%20Expert" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=To%20Be%20a%20Terraform%20Expert&body=Check out this article: https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&name=To%20Be%20a%20Terraform%20Expert&description=I%20was%20using%20AWS%20before%20I%20join%20the%20current%20company%2c%20but%20I%20don%26%2339%3bt%20even%20know%20terraform%20before%20I%20interview%20with%20the%20current%20company.%20I%20got%20hit%20by%20Terraform%20at%20first%2c%20it%26%2339%3bs%20really%20hard%20to%20deal%20with%20states.%0aUse%20-target%20with%20plan%20command%20to%20collaborate%20When%20you%20work%20with%20your%20colleagues%20with%20same%20terraform%20project%2c%20sometimes%20they%20maybe%20need%20to%20apply%20some%20changes%20that%20haven%26%2339%3bt%20merged%20yet%20for%20testing%2c%20when%20you%20run%20the%20plan%20command%2c%20you%20will%20find%20that%20terraform%20want%20to%20destroy%20his%20resources." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&t=To%20Be%20a%20Terraform%20Expert" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">To Be a Terraform Expert</h1><div class=meta><span class=author itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name>wd</span></span><div class=postdate><time datetime="2020-06-30 17:17:34 +0800 +0800" itemprop=datePublished>2020-06-30</time></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/terraform rel=tag>terraform</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#headline-1>Use <code class=verbatim>-target</code> with <code class=verbatim>plan</code> command to collaborate</a></li><li><a href=#headline-2>Use remote state to collaborate with others</a></li><li><a href=#headline-3>Use <code class=verbatim>state rm</code> command to put resources outside terraform</a></li><li><a href=#headline-4>Use <code class=verbatim>state mv</code> command after you rename resources</a></li><li><a href=#headline-5>Use <code class=verbatim>import</code> command to import resources inside terraform</a></li><li><a href=#headline-6>Use fake modules to solve dependency</a></li><li><a href=#headline-7>Use temporary workspace and <code class=verbatim>console</code> to test terraform expressions</a></li></ul></nav></div><div class=content itemprop=articleBody><p>I was using AWS before I join the current company, but I don't even know terraform before I interview with the current company. I got hit by Terraform at first, it's really hard to deal with states.</p><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Use <code class=verbatim>-target</code> with <code class=verbatim>plan</code> command to collaborate</h3><div id=outline-text-headline-1 class=outline-text-3><p>When you work with your colleagues with same terraform project, sometimes they maybe need to apply some changes that haven't merged yet for testing, when you run the plan command, you will find that terraform want to destroy his resources. You can wait until his changes have merged. But actually, you can use the <code class=verbatim>-target</code> to limit your resources for the plan command. So, you can run the plan command happily without destroying other people's resources.</p></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Use remote state to collaborate with others</h3><div id=outline-text-headline-2 class=outline-text-3><p>If you need to work on the same project with your colleagues, you need to set up a remote state. We use <code class=verbatim>s3</code> as our state backend, it will use s3 bucket to store the state file, and a DynamoDB table to store the lock. If you encounter some problems, you maybe need to check these resources manually to confirm it's all working properly.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Use <code class=verbatim>state rm</code> command to put resources outside terraform</h3><div id=outline-text-headline-3 class=outline-text-3><p>You know, the state file includes the states terraform known about your resources, but what will happen if you delete some resources through other tools (e.g., make changes through AWS console)? Terraform didn't know those changes. We can use <code class=verbatim>state rm</code> command to tell terraform not to manage these states in the feature. Beware that, the <code class=verbatim>destroy</code> command will remove remote resources, and the <code class=verbatim>state rm</code> will only remove from the state, if you haven't removed the remote resources through other tools, the resources will still there.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Use <code class=verbatim>state mv</code> command after you rename resources</h3><div id=outline-text-headline-4 class=outline-text-3><p>We may need to change the resource name in our codes, for example rename or put the resource under another module. After the rename the Terraform usually will create a plan that include destroy and create. We can use <code class=verbatim>mv</code> to rename the resource names in the state file, so that Terraform will know the changes and create a correct plan.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Use <code class=verbatim>import</code> command to import resources inside terraform</h3><div id=outline-text-headline-5 class=outline-text-3><p>Sometimes, it's easy to create some resources through web UI. With <code class=verbatim>import</code> command, we can create resources through the web UI, and then import them to terraform state.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Use fake modules to solve dependency</h3><div id=outline-text-headline-6 class=outline-text-3><p>If you have use providers in your module when you delete that module, terraform will report an error, that it can't find providers. It's annoying when you use modules in modules. You can simply create some fake module, these modules only have the same names as the original modules, but didn't have any resources. After apply, you can safely remove these fake modules.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Use temporary workspace and <code class=verbatim>console</code> to test terraform expressions</h3><div id=outline-text-headline-7 class=outline-text-3><p>HCL for terraform was not a programming language, but we can't stop to do programming in terraform. When we write some expressions, we need to test it. I suggest creating a temporary project to test it. Think about that you have a big project with 20+ resources, you need to refresh the states every time you want to run terraform plan.</p><p>Simply put the expressions in a <code class=verbatim>locals</code> block, and output the results in <code class=verbatim>output</code> blocks, you will see the terraform plan command run very fast.</p></div></div></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/tags>Tags</a></li><li><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a></li><li><a href=/atom.xml>Subscribe</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&text=To%20Be%20a%20Terraform%20Expert" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&is_video=false&description=To%20Be%20a%20Terraform%20Expert" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=To%20Be%20a%20Terraform%20Expert&body=Check out this article: https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&title=To%20Be%20a%20Terraform%20Expert" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&name=To%20Be%20a%20Terraform%20Expert&description=I%20was%20using%20AWS%20before%20I%20join%20the%20current%20company%2c%20but%20I%20don%26%2339%3bt%20even%20know%20terraform%20before%20I%20interview%20with%20the%20current%20company.%20I%20got%20hit%20by%20Terraform%20at%20first%2c%20it%26%2339%3bs%20really%20hard%20to%20deal%20with%20states.%0aUse%20-target%20with%20plan%20command%20to%20collaborate%20When%20you%20work%20with%20your%20colleagues%20with%20same%20terraform%20project%2c%20sometimes%20they%20maybe%20need%20to%20apply%20some%20changes%20that%20haven%26%2339%3bt%20merged%20yet%20for%20testing%2c%20when%20you%20run%20the%20plan%20command%2c%20you%20will%20find%20that%20terraform%20want%20to%20destroy%20his%20resources." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fwdicc.com%2fto-be-a-terraform-expert%2f&t=To%20Be%20a%20Terraform%20Expert" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 wd and cc</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/tags>Tags</a></li><li><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a></li><li><a href=/atom.xml>Subscribe</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>