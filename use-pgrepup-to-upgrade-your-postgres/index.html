<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>使用 pgrepup 跨版本升级 pg - wd and cc</title>
    <meta name="author" content="wd">
    
	<meta name="description" content="&lt;p&gt;&lt;a href=&quot;http://gasparin.net/2016/11/pgrepup-upgrade-postgresql-using-logical-replication/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;pgrepup&lt;/a&gt; 其实是一个支持 pg 跨版本复制的工具。而 pg 大版本升级需要停机是个比较郁闷的事情，如果能通过这个解决就实在太好了。下面测试了一下。&lt;/p&gt;
&lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h2&gt;&lt;p&gt;需要安装 &lt;code&gt;pgrepup&lt;/code&gt; 和 &lt;code&gt;pglogical&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;安装-pgrepup&quot;&gt;&lt;a href=&quot;#安装-pgrepup&quot; class=&quot;headerlink&quot; title=&quot;安装 pgrepup&quot;&gt;&lt;/a&gt;安装 pgrepup&lt;/h3&gt;&lt;p&gt;pgrepup 官方说是支持 python &amp;gt;= 2.7 的版本，我自己测试的结果，python 3.5 里面执行有点问题，需要修改几个地方。但是在 python 2.7 里面，不需要做任何修改，所以建议使用 python 2.7。安装很简单，执行 &lt;code&gt;pip install pgprepup&lt;/code&gt; 就可以了。&lt;/p&gt;
&lt;h3 id=&quot;安装-pglogical&quot;&gt;&lt;a href=&quot;#安装-pglogical&quot; class=&quot;headerlink&quot; title=&quot;安装 pglogical&quot;&gt;&lt;/a&gt;安装 pglogical&lt;/h3&gt;&lt;p&gt;需要给你的 pg 安装这个扩展。高版本的和低版本的都需要安装。&lt;/p&gt;
&lt;p&gt;安装也很简单，下载源码，执行 &lt;code&gt;PATH=/opt/pg96/bin:$PATH make USE_PGXS=1 install&lt;/code&gt; 就好了。如果是给 pg95 装，那就把路径改成 pg95。&lt;/p&gt;
&lt;p&gt;可以参考&lt;a href=&quot;https://2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;。&lt;/p&gt;
&lt;h2 id=&quot;配置&quot;&gt;&lt;a href=&quot;#配置&quot; class=&quot;headerlink&quot; title=&quot;配置&quot;&gt;&lt;/a&gt;配置&lt;/h2&gt;&lt;h3 id=&quot;配置-db&quot;&gt;&lt;a href=&quot;#配置-db&quot; class=&quot;headerlink&quot; title=&quot;配置 db&quot;&gt;&lt;/a&gt;配置 db&lt;/h3&gt;&lt;p&gt;先给几个 db 定义一下角色。db1 假设为 9.5 版本，db2 假设为 9.6 版本。&lt;/p&gt;
&lt;p&gt;pgrepup 允许 db1, db2 和执行 pgrepup 所在的机器分别在不同的机器，也可以在相同的机器，看机器情况。&lt;/p&gt;
&lt;p&gt;对于 db，最小配置的 postgres.conf 修改如下，我测试的时候两个 db 在一台机器上面，只需要修改 port 不一样就可以了。&lt;br&gt;&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;listen_addresses&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;*&#39;&lt;/span&gt;          # what IP address(es) to listen &lt;span class=&quot;literal&quot;&gt;on&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;port&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;5495&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;wal_level&lt;/span&gt; = logical # minimal, archive, hot_standby, or logical&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;max_wal_senders&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;             # max number of walsender processes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;max_replication_slots&lt;/span&gt; = &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;       # max number of replication slots&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;shared_preload_libraries&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;pglogical&#39;&lt;/span&gt;          # (change requires restart)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;## 下面几个参数不是必须设置的&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;logging_collector&lt;/span&gt; = &lt;span class=&quot;literal&quot;&gt;on&lt;/span&gt;          # Enable capturing of stderr and csvlog&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;attr&quot;&gt;log_filename&lt;/span&gt; = &lt;span class=&quot;string&quot;&gt;&#39;postgresql-%Y-%m-%d.log&#39;&lt;/span&gt;        # log file name pattern,&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;pg_hba.conf 如下，修改其中的 client_ip 和 db_ip 为对应的真实 ip。&lt;br&gt;&lt;figure class=&quot;highlight q&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;host &lt;span class=&quot;built_in&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;all&lt;/span&gt; client_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;md5&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;host replication pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;md5&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;host &lt;span class=&quot;built_in&quot;&gt;all&lt;/span&gt; pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;md5&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;配置好之后，启动 db1 和 db2 看看是不是可以正常连接。&lt;/p&gt;
&lt;p&gt;还需要建立用户。如果已经存在一个 super 的用户，那也可以直接用那个用户，没有的话，就建一个。db1 和 db2 都需要建立，可以是不同的用户。&lt;/p&gt;
&lt;h4 id=&quot;hint&quot;&gt;&lt;a href=&quot;#hint&quot; class=&quot;headerlink&quot; title=&quot;hint&quot;&gt;&lt;/a&gt;hint&lt;/h4&gt;&lt;p&gt;当然，如果我们在生产环境里面做这个事情，那肯定会是 db1 已经是一个存在的 db，只需要增加原来没有的配置就好了。db2 会是一个全新的 db，使用 initdb 初始化，之后配置上面的配置项（当然，如果是将来要给生产用，那应该是复制 db1 的配置文件过来，修改端口就可以了，其他都一样）。&lt;/p&gt;
&lt;h3 id=&quot;配置-pgrepup&quot;&gt;&lt;a href=&quot;#配置-pgrepup&quot; class=&quot;headerlink&quot; title=&quot;配置 pgrepup&quot;&gt;&lt;/a&gt;配置 pgrepup&lt;/h3&gt;&lt;p&gt;执行一下 &lt;code&gt;pgrepup config&lt;/code&gt;&lt;br&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup 0.3.7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Create&lt;/span&gt; a &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; pgrepup config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuration filename [~/.pgrepup] ./pgrepup.config&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Security&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Do&lt;/span&gt; you want &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;encrypt&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;database&lt;/span&gt; credentials &lt;span class=&quot;keyword&quot;&gt;using&lt;/span&gt; a &lt;span class=&quot;keyword&quot;&gt;password&lt;/span&gt;? [Y/n] n&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Folder &lt;span class=&quot;keyword&quot;&gt;where&lt;/span&gt; pgrepup &lt;span class=&quot;keyword&quot;&gt;store&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;temporary&lt;/span&gt; dumps &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; pgpass &lt;span class=&quot;keyword&quot;&gt;file&lt;/span&gt; [/tmp] ./tmp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Source&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;Database&lt;/span&gt; configuration&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ip address &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; Dns &lt;span class=&quot;keyword&quot;&gt;name&lt;/span&gt;: db_ip&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Port: &lt;span class=&quot;number&quot;&gt;5495&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Connect&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;Database&lt;/span&gt;: [template1]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Username: wd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Password&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Destination &lt;span class=&quot;keyword&quot;&gt;Database&lt;/span&gt; configuration&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Ip address &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; Dns &lt;span class=&quot;keyword&quot;&gt;name&lt;/span&gt;: db_ip&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Port: &lt;span class=&quot;number&quot;&gt;5496&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Connect&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;Database&lt;/span&gt;: [template1]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Username: wd&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;Password&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuration saved &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; ./pgrepup.config.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;You can &lt;span class=&quot;keyword&quot;&gt;now&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;use&lt;/span&gt; the &lt;span class=&quot;keyword&quot;&gt;check&lt;/span&gt; command &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;verify&lt;/span&gt; setup &lt;span class=&quot;keyword&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; destination &lt;span class=&quot;keyword&quot;&gt;databases&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;之后会产生一个配置文件 pgrepup.config，有修改的话，可以打开再次编辑。&lt;/p&gt;
&lt;p&gt;之后，可以执行一下 &lt;code&gt;pgrepup check&lt;/code&gt; 来检查一下&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config check&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Global&lt;/span&gt; checkings&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Folder ./tmp exists &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; is writable &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking Source&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Connection PostgreSQL connection &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; db_ip:&lt;span class=&quot;number&quot;&gt;5495&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; user wd OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pglogical installation &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: Install docs at https:&lt;span class=&quot;comment&quot;&gt;//2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed wal_level setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_worker_processes setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_replication_slots setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_wal_senders setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pg_hba.conf settings &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: Add the following lines &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; /home/wd/data95/pg_hba.conf:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host replication pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; md5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; md5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    After adding the lines, remember &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; reload postgreSQL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  &lt;span class=&quot;built_in&quot;&gt;Local&lt;/span&gt; pg_dumpall version &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Source cluster tables without primary keys&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking Destination&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Connection PostgreSQL connection &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; db_ip:&lt;span class=&quot;number&quot;&gt;5496&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; user wd OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pglogical installation &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: Install docs at https:&lt;span class=&quot;comment&quot;&gt;//2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed wal_level setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: &lt;span class=&quot;built_in&quot;&gt;Set&lt;/span&gt; wal_level &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; logical&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_worker_processes setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_replication_slots setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: Increase max_replication_slots &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_wal_senders setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pg_hba.conf settings &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    Hint: Add the following lines &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; /home/wd/data96/pg_hba.conf:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host replication pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; md5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        host &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; pgrepup_replication db_ip/&lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; md5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    After adding the lines, remember &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; reload postgreSQL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  &lt;span class=&quot;built_in&quot;&gt;Local&lt;/span&gt; pg_dumpall version &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面是我第一次执行 check 的结果，可以看到很多红色的 &lt;code&gt;KO&lt;/code&gt;，有些下面还有 hint 提示告诉你怎么修复，针对红色的信息进行修复就好了。&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config check&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Global&lt;/span&gt; checkings&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Folder ./tmp exists &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; is writable &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking Source&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Connection PostgreSQL connection &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; db_ip:&lt;span class=&quot;number&quot;&gt;5495&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; user wd &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pglogical installation &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed wal_level setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_worker_processes setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_replication_slots setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_wal_senders setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pg_hba.conf settings &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  &lt;span class=&quot;built_in&quot;&gt;Local&lt;/span&gt; pg_dumpall version &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Source cluster tables without primary keys&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Checking Destination&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Connection PostgreSQL connection &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; db_ip:&lt;span class=&quot;number&quot;&gt;5496&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; user wd &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pglogical installation &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed wal_level setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_worker_processes setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_replication_slots setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Needed max_wal_senders setting &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  pg_hba.conf settings &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  &lt;span class=&quot;built_in&quot;&gt;Local&lt;/span&gt; pg_dumpall version &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面是我修复之后执行的结果。其中会提示会被同步的 db（上面是 template1, testdb, postgres）。之后执行 setup&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config setup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Check &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; there are active subscriptions &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; Destination nodes &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;Global&lt;/span&gt; tasks&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Remove nodes from Destination cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Create temp pgpass file &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Drop pg_logical extension &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; databases of Source cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Drop pg_logical extension &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; databases of Destination cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Setup Source&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Create user for replication &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Dump globals &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; schema of &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; databases &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Setup pglogical replication sets &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; Source node name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Setup Destination&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Create &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; source globals &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; schema &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Setup pglogical Destination node name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Cleaning up&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Remove temporary pgpass file &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Remove other temporary files &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后执行 start&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config start&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Start replication &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; upgrade&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以通过 status 看同步状态&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config status&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Configuration&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Source database cluster &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Destination database cluster &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pglogical setup&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Source database cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Destination database cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Replication status&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database postgres&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.replicating&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.replicating&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database template1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.replicating&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Xlog difference (&lt;span class=&quot;built_in&quot;&gt;bytes&lt;/span&gt;) &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;57816&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到三个 db 都在同步。这个时候在 db1 上面插入数据，能在 db2 上面看到会同步过去。&lt;/p&gt;
&lt;p&gt;状态有三种情况&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;initializing: pglogical 正在 copy 数据&lt;/li&gt;
&lt;li&gt;replication: 同步状态&lt;/li&gt;
&lt;li&gt;down: 同步断开了，需要检查日志修复&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;需要注意的问题&quot;&gt;&lt;a href=&quot;#需要注意的问题&quot; class=&quot;headerlink&quot; title=&quot;需要注意的问题&quot;&gt;&lt;/a&gt;需要注意的问题&lt;/h2&gt;&lt;h3 id=&quot;db-里面的表都需要有主键&quot;&gt;&lt;a href=&quot;#db-里面的表都需要有主键&quot; class=&quot;headerlink&quot; title=&quot;db 里面的表都需要有主键&quot;&gt;&lt;/a&gt;db 里面的表都需要有主键&lt;/h3&gt;&lt;p&gt;如果存在没有主键的表，执行 check 的时候会看到下面的信息&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;  Source cluster tables without primary keys&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;      testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;          &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t2 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;KO&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   Hint: Add a primary key &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; unique index &lt;span class=&quot;keyword&quot;&gt;or&lt;/span&gt; use the pgrepup fix command&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;          &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果不解决就执行 setup，会提示下面的信息&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Setup Source &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.Skipped, configuration problems&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Setup Destination&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Create &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; source globals &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; schema &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..Skipped&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Setup pglogical Destination node name&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以自己创建一个主键重新 check，也可以执行 fix 来修复，然后再次执行 setup。&lt;/p&gt;
&lt;figure class=&quot;highlight lsl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt; ❯❯❯ pgrepup -c pgrepup.config fix&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Find Source cluster&#39;s databases with tables without primary &lt;span class=&quot;type&quot;&gt;key&lt;/span&gt;/unique index...&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  template1 ....................................................................OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  postgres .....................................................................OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Found public.t2 without primary &lt;span class=&quot;type&quot;&gt;key&lt;/span&gt; ................Added __pgrepup_id field&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;通过 fix 加的主键，在 uninstall 的时候会被删除。&lt;/p&gt;
&lt;h3 id=&quot;Replication-status-down&quot;&gt;&lt;a href=&quot;#Replication-status-down&quot; class=&quot;headerlink&quot; title=&quot;Replication status .. down&quot;&gt;&lt;/a&gt;Replication status .. down&lt;/h3&gt;&lt;p&gt;有时候会遇到有的 db 的状态是好的，有的 db 是 down 的情况&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Replication status&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database postgres&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.replicating&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..down&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Database template1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Replication status &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.replicating&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Xlog difference (&lt;span class=&quot;built_in&quot;&gt;bytes&lt;/span&gt;) &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..&lt;span class=&quot;number&quot;&gt;614096&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在同步状态下面，如果给某个 db 加一个没有主键的表，就会导致同步断掉。修复方法是先 stop，然后执行 check，按照提示修复，然后执行 setup，然后 start 就可以了。&lt;/p&gt;
&lt;h3 id=&quot;官方列出来的几个问题&quot;&gt;&lt;a href=&quot;#官方列出来的几个问题&quot; class=&quot;headerlink&quot; title=&quot;官方列出来的几个问题&quot;&gt;&lt;/a&gt;官方列出来的几个问题&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;DDL 命令。不会同步 DDL 命令，可以在 db1 试试看 &lt;code&gt;pglogical.replicate_ddl_command&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;seq 序列。执行 stop 命令的时候，会在目标 db 的 seq 上面加 1000。&lt;/li&gt;
&lt;li&gt;有大量的 db。执行 start 命令之后，pglogical 会每个 db 启动一个 worker 来同步数据，要是 db 比较多会导致比较高的负载。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;因为这个是基于 pglogical 的，所以还需要关注 pglogical 列出来的一些&lt;a href=&quot;https://2ndquadrant.com/it/resources/pglogical/pglogical-docs/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;限制&lt;/a&gt; 第 4 部分 Limitations and Restrictions。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;4.1 Superuser is required&lt;/li&gt;
&lt;li&gt;4.2 UNLOGGED and TEMPORARY not replicated&lt;/li&gt;
&lt;li&gt;4.3 One database at a time&lt;/li&gt;
&lt;li&gt;4.4 PRIMARY KEY or REPLICA IDENTITY required&lt;/li&gt;
&lt;li&gt;4.5 Only one unique index/constraint/PK&lt;/li&gt;
&lt;li&gt;4.6 DDL&lt;/li&gt;
&lt;li&gt;4.7 No replication queue flush&lt;/li&gt;
&lt;li&gt;4.8 FOREIGN KEYS&lt;/li&gt;
&lt;li&gt;4.9 TRUNCATE&lt;/li&gt;
&lt;li&gt;4.10 Sequences&lt;/li&gt;
&lt;li&gt;4.11 Triggers&lt;/li&gt;
&lt;li&gt;4.12 PostgreSQL Version differences&lt;/li&gt;
&lt;li&gt;4.13 Doesn’t replicate DDL&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pgrepup-uninstall&quot;&gt;&lt;a href=&quot;#pgrepup-uninstall&quot; class=&quot;headerlink&quot; title=&quot;pgrepup uninstall&quot;&gt;&lt;/a&gt;pgrepup uninstall&lt;/h3&gt;&lt;p&gt;uninstall 会清理 pgrepup 创建的一些信息，比如安装的 pglogical 扩展，创建用来同步的用户，和通过 fix 命令添加的 seq。&lt;/p&gt;
&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;❯❯❯ pgrepup &lt;span class=&quot;attr&quot;&gt;-c&lt;/span&gt; pgrepup.config uninstall&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Pgrepup &lt;span class=&quot;number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.7&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Check active subscriptions &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; Destination nodes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;Stopped&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;Stopped&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.Stopped&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Uninstall operations&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Remove nodes from Destination cluster&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Drop pg_logical extension &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;all&lt;/span&gt; databases&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Source&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;      Destination&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          postgres &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          testdb &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          template1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Drop user for replication &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;.OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;  Drop unique fields added &lt;span class=&quot;keyword&quot;&gt;by&lt;/span&gt; fix command&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          template1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          postgres&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;          testdb&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;              &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t1 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;gt;              &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt;.t2 &lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;attr&quot;&gt;...&lt;/span&gt;..OK&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;升级&quot;&gt;&lt;a href=&quot;#升级&quot; class=&quot;headerlink&quot; title=&quot;升级&quot;&gt;&lt;/a&gt;升级&lt;/h2&gt;&lt;p&gt;如果前面配置好了同步状态，那剩下的事情就简单了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;停止应用链接 db1&lt;/li&gt;
&lt;li&gt;确保 db1 已经没有任何链接&lt;/li&gt;
&lt;li&gt;使用 &lt;code&gt;pgrepup stop&lt;/code&gt; 停止 replication&lt;/li&gt;
&lt;li&gt;修改应用链接到 db2&lt;/li&gt;
&lt;li&gt;启动应用&lt;/li&gt;
&lt;li&gt;剩下的就是处理掉停止的 db1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;参考文档&quot;&gt;&lt;a href=&quot;#参考文档&quot; class=&quot;headerlink&quot; title=&quot;参考文档&quot;&gt;&lt;/a&gt;参考文档&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://qiita.com/yteraoka/items/e82e4d28f6a23915d190&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://qiita.com/yteraoka/items/e82e4d28f6a23915d190&lt;/a&gt;&lt;/p&gt;
"> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>
<span class="subtitle">happy everyday</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/wd" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        <article class="post">
	<h2 class="title">使用 pgrepup 跨版本升级 pg</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2016-12-08T03:55:33.000Z" itemprop="datePublished">Dec 8, 2016</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/postgres/">postgres</a>
</div>
    </div>
	<div class="entry-content"><p><a href="http://gasparin.net/2016/11/pgrepup-upgrade-postgresql-using-logical-replication/" target="_blank" rel="external">pgrepup</a> 其实是一个支持 pg 跨版本复制的工具。而 pg 大版本升级需要停机是个比较郁闷的事情，如果能通过这个解决就实在太好了。下面测试了一下。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>需要安装 <code>pgrepup</code> 和 <code>pglogical</code>。</p>
<h3 id="安装-pgrepup"><a href="#安装-pgrepup" class="headerlink" title="安装 pgrepup"></a>安装 pgrepup</h3><p>pgrepup 官方说是支持 python &gt;= 2.7 的版本，我自己测试的结果，python 3.5 里面执行有点问题，需要修改几个地方。但是在 python 2.7 里面，不需要做任何修改，所以建议使用 python 2.7。安装很简单，执行 <code>pip install pgprepup</code> 就可以了。</p>
<h3 id="安装-pglogical"><a href="#安装-pglogical" class="headerlink" title="安装 pglogical"></a>安装 pglogical</h3><p>需要给你的 pg 安装这个扩展。高版本的和低版本的都需要安装。</p>
<p>安装也很简单，下载源码，执行 <code>PATH=/opt/pg96/bin:$PATH make USE_PGXS=1 install</code> 就好了。如果是给 pg95 装，那就把路径改成 pg95。</p>
<p>可以参考<a href="https://2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/" target="_blank" rel="external">这里</a>。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置-db"><a href="#配置-db" class="headerlink" title="配置 db"></a>配置 db</h3><p>先给几个 db 定义一下角色。db1 假设为 9.5 版本，db2 假设为 9.6 版本。</p>
<p>pgrepup 允许 db1, db2 和执行 pgrepup 所在的机器分别在不同的机器，也可以在相同的机器，看机器情况。</p>
<p>对于 db，最小配置的 postgres.conf 修改如下，我测试的时候两个 db 在一台机器上面，只需要修改 port 不一样就可以了。<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="attr">listen_addresses</span> = <span class="string">'*'</span>          # what IP address(es) to listen <span class="literal">on</span>;</div><div class="line"><span class="attr">port</span> = <span class="number">5495</span></div><div class="line"><span class="attr">wal_level</span> = logical # minimal, archive, hot_standby, or logical</div><div class="line"><span class="attr">max_wal_senders</span> = <span class="number">3</span>             # max number of walsender processes</div><div class="line"><span class="attr">max_replication_slots</span> = <span class="number">3</span>       # max number of replication slots</div><div class="line"><span class="attr">shared_preload_libraries</span> = <span class="string">'pglogical'</span>          # (change requires restart)</div><div class="line"></div><div class="line"><span class="comment">## 下面几个参数不是必须设置的</span></div><div class="line"><span class="attr">logging_collector</span> = <span class="literal">on</span>          # Enable capturing of stderr and csvlog</div><div class="line"><span class="attr">log_filename</span> = <span class="string">'postgresql-%Y-%m-%d.log'</span>        # log file name pattern,</div></pre></td></tr></table></figure></p>
<p>pg_hba.conf 如下，修改其中的 client_ip 和 db_ip 为对应的真实 ip。<br><figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">host <span class="built_in">all</span> <span class="built_in">all</span> client_ip/<span class="number">32</span> <span class="built_in">md5</span></div><div class="line">host replication pgrepup_replication db_ip/<span class="number">32</span> <span class="built_in">md5</span></div><div class="line">host <span class="built_in">all</span> pgrepup_replication db_ip/<span class="number">32</span> <span class="built_in">md5</span></div></pre></td></tr></table></figure></p>
<p>配置好之后，启动 db1 和 db2 看看是不是可以正常连接。</p>
<p>还需要建立用户。如果已经存在一个 super 的用户，那也可以直接用那个用户，没有的话，就建一个。db1 和 db2 都需要建立，可以是不同的用户。</p>
<h4 id="hint"><a href="#hint" class="headerlink" title="hint"></a>hint</h4><p>当然，如果我们在生产环境里面做这个事情，那肯定会是 db1 已经是一个存在的 db，只需要增加原来没有的配置就好了。db2 会是一个全新的 db，使用 initdb 初始化，之后配置上面的配置项（当然，如果是将来要给生产用，那应该是复制 db1 的配置文件过来，修改端口就可以了，其他都一样）。</p>
<h3 id="配置-pgrepup"><a href="#配置-pgrepup" class="headerlink" title="配置 pgrepup"></a>配置 pgrepup</h3><p>执行一下 <code>pgrepup config</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup config</div><div class="line">Pgrepup 0.3.7</div><div class="line"><span class="keyword">Create</span> a <span class="keyword">new</span> pgrepup config</div><div class="line">Configuration filename [~/.pgrepup] ./pgrepup.config</div><div class="line"><span class="keyword">Security</span></div><div class="line"><span class="keyword">Do</span> you want <span class="keyword">to</span> <span class="keyword">encrypt</span> <span class="keyword">database</span> credentials <span class="keyword">using</span> a <span class="keyword">password</span>? [Y/n] n</div><div class="line">Folder <span class="keyword">where</span> pgrepup <span class="keyword">store</span> <span class="keyword">temporary</span> dumps <span class="keyword">and</span> pgpass <span class="keyword">file</span> [/tmp] ./tmp</div><div class="line"><span class="keyword">Source</span> <span class="keyword">Database</span> configuration</div><div class="line">Ip address <span class="keyword">or</span> Dns <span class="keyword">name</span>: db_ip</div><div class="line">Port: <span class="number">5495</span></div><div class="line"><span class="keyword">Connect</span> <span class="keyword">Database</span>: [template1]</div><div class="line">Username: wd</div><div class="line"><span class="keyword">Password</span>:</div><div class="line">Destination <span class="keyword">Database</span> configuration</div><div class="line">Ip address <span class="keyword">or</span> Dns <span class="keyword">name</span>: db_ip</div><div class="line">Port: <span class="number">5496</span></div><div class="line"><span class="keyword">Connect</span> <span class="keyword">Database</span>: [template1]</div><div class="line">Username: wd</div><div class="line"><span class="keyword">Password</span>:</div><div class="line">Configuration saved <span class="keyword">to</span> ./pgrepup.config.</div><div class="line">You can <span class="keyword">now</span> <span class="keyword">use</span> the <span class="keyword">check</span> command <span class="keyword">to</span> <span class="keyword">verify</span> setup <span class="keyword">of</span> <span class="keyword">source</span> <span class="keyword">and</span> destination <span class="keyword">databases</span></div></pre></td></tr></table></figure></p>
<p>之后会产生一个配置文件 pgrepup.config，有修改的话，可以打开再次编辑。</p>
<p>之后，可以执行一下 <code>pgrepup check</code> 来检查一下</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config check</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line"><span class="built_in">Global</span> checkings<span class="attr">...</span></div><div class="line"> &gt;  Folder ./tmp exists <span class="keyword">and</span> is writable <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line">Checking Source<span class="attr">...</span></div><div class="line"> &gt;  Connection PostgreSQL connection <span class="keyword">to</span> db_ip:<span class="number">5495</span> <span class="keyword">with</span> user wd OK</div><div class="line"> &gt;  pglogical installation <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.KO</div><div class="line"></div><div class="line">    Hint: Install docs at https:<span class="comment">//2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/</span></div><div class="line"></div><div class="line"> &gt;  Needed wal_level setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_worker_processes setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Needed max_replication_slots setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_wal_senders setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  pg_hba.conf settings <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>KO</div><div class="line">    Hint: Add the following lines <span class="keyword">to</span> /home/wd/data95/pg_hba.conf:</div><div class="line">        host replication pgrepup_replication db_ip/<span class="number">32</span> md5</div><div class="line">        host <span class="literal">all</span> pgrepup_replication db_ip/<span class="number">32</span> md5</div><div class="line">    After adding the lines, remember <span class="keyword">to</span> reload postgreSQL</div><div class="line"> &gt;  <span class="built_in">Local</span> pg_dumpall version <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Source cluster tables without primary keys</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      testdb</div><div class="line"> &gt;          <span class="keyword">public</span>.t1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line">Checking Destination<span class="attr">...</span></div><div class="line"> &gt;  Connection PostgreSQL connection <span class="keyword">to</span> db_ip:<span class="number">5496</span> <span class="keyword">with</span> user wd OK</div><div class="line"> &gt;  pglogical installation <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.KO</div><div class="line"></div><div class="line">    Hint: Install docs at https:<span class="comment">//2ndquadrant.com/it/resources/pglogical/pglogical-installation-instructions/</span></div><div class="line"></div><div class="line"> &gt;  Needed wal_level setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..KO</div><div class="line">    Hint: <span class="built_in">Set</span> wal_level <span class="keyword">to</span> logical</div><div class="line"> &gt;  Needed max_worker_processes setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Needed max_replication_slots setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..KO</div><div class="line">    Hint: Increase max_replication_slots <span class="keyword">to</span> <span class="number">3</span></div><div class="line"> &gt;  Needed max_wal_senders setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  pg_hba.conf settings <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>KO</div><div class="line">    Hint: Add the following lines <span class="keyword">to</span> /home/wd/data96/pg_hba.conf:</div><div class="line">        host replication pgrepup_replication db_ip/<span class="number">32</span> md5</div><div class="line">        host <span class="literal">all</span> pgrepup_replication db_ip/<span class="number">32</span> md5</div><div class="line">    After adding the lines, remember <span class="keyword">to</span> reload postgreSQL</div><div class="line"> &gt;  <span class="built_in">Local</span> pg_dumpall version <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div></pre></td></tr></table></figure>
<p>上面是我第一次执行 check 的结果，可以看到很多红色的 <code>KO</code>，有些下面还有 hint 提示告诉你怎么修复，针对红色的信息进行修复就好了。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config check</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line"><span class="built_in">Global</span> checkings<span class="attr">...</span></div><div class="line"> &gt;  Folder ./tmp exists <span class="keyword">and</span> is writable <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line">Checking Source<span class="attr">...</span></div><div class="line"> &gt;  Connection PostgreSQL connection <span class="keyword">to</span> db_ip:<span class="number">5495</span> <span class="keyword">with</span> user wd <span class="attr">...</span>OK</div><div class="line"> &gt;  pglogical installation <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Needed wal_level setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_worker_processes setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Needed max_replication_slots setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_wal_senders setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  pg_hba.conf settings <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  <span class="built_in">Local</span> pg_dumpall version <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Source cluster tables without primary keys</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      testdb</div><div class="line"> &gt;          <span class="keyword">public</span>.t1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line">Checking Destination<span class="attr">...</span></div><div class="line"> &gt;  Connection PostgreSQL connection <span class="keyword">to</span> db_ip:<span class="number">5496</span> <span class="keyword">with</span> user wd <span class="attr">...</span>OK</div><div class="line"> &gt;  pglogical installation <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Needed wal_level setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_worker_processes setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Needed max_replication_slots setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Needed max_wal_senders setting <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  pg_hba.conf settings <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  <span class="built_in">Local</span> pg_dumpall version <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div></pre></td></tr></table></figure>
<p>上面是我修复之后执行的结果。其中会提示会被同步的 db（上面是 template1, testdb, postgres）。之后执行 setup</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config setup</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line">Check <span class="keyword">if</span> there are active subscriptions <span class="keyword">in</span> Destination nodes <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"><span class="built_in">Global</span> tasks</div><div class="line"> &gt;  Remove nodes from Destination cluster</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Create temp pgpass file <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Drop pg_logical extension <span class="keyword">in</span> <span class="literal">all</span> databases of Source cluster</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Drop pg_logical extension <span class="keyword">in</span> <span class="literal">all</span> databases of Destination cluster</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">Setup Source</div><div class="line"> &gt;  Create user for replication <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  Dump globals <span class="keyword">and</span> schema of <span class="literal">all</span> databases <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Setup pglogical replication sets <span class="keyword">on</span> Source node name</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">Setup Destination</div><div class="line"> &gt;  Create <span class="keyword">and</span> <span class="keyword">import</span> source globals <span class="keyword">and</span> schema <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Setup pglogical Destination node name</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">Cleaning up</div><div class="line"> &gt;  Remove temporary pgpass file <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Remove other temporary files <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div></pre></td></tr></table></figure>
<p>然后执行 start</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config start</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line">Start replication <span class="keyword">and</span> upgrade</div><div class="line"> &gt;  postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;  template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div></pre></td></tr></table></figure>
<p>可以通过 status 看同步状态</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config status</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line">Configuration</div><div class="line"> &gt;  Source database cluster <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Destination database cluster <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">Pglogical setup</div><div class="line"> &gt;  Source database cluster</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Destination database cluster</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">Replication status</div><div class="line"> &gt;  Database postgres</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.replicating</div><div class="line"> &gt;  Database testdb</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.replicating</div><div class="line"> &gt;  Database template1</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.replicating</div><div class="line"> &gt;  Xlog difference (<span class="built_in">bytes</span>) <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="number">57816</span></div></pre></td></tr></table></figure>
<p>可以看到三个 db 都在同步。这个时候在 db1 上面插入数据，能在 db2 上面看到会同步过去。</p>
<p>状态有三种情况</p>
<ul>
<li>initializing: pglogical 正在 copy 数据</li>
<li>replication: 同步状态</li>
<li>down: 同步断开了，需要检查日志修复</li>
</ul>
<h2 id="需要注意的问题"><a href="#需要注意的问题" class="headerlink" title="需要注意的问题"></a>需要注意的问题</h2><h3 id="db-里面的表都需要有主键"><a href="#db-里面的表都需要有主键" class="headerlink" title="db 里面的表都需要有主键"></a>db 里面的表都需要有主键</h3><p>如果存在没有主键的表，执行 check 的时候会看到下面的信息</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;  Source cluster tables without primary keys</div><div class="line">&gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line">&gt;      testdb</div><div class="line">&gt;          <span class="keyword">public</span>.t2 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>KO</div><div class="line">   Hint: Add a primary key <span class="keyword">or</span> unique index <span class="keyword">or</span> use the pgrepup fix command</div><div class="line">&gt;          <span class="keyword">public</span>.t1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line">&gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div></pre></td></tr></table></figure>
<p>如果不解决就执行 setup，会提示下面的信息</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Setup Source <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.Skipped, configuration problems</div><div class="line">Setup Destination</div><div class="line"> &gt;  Create <span class="keyword">and</span> <span class="keyword">import</span> source globals <span class="keyword">and</span> schema <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..Skipped</div><div class="line"> &gt;  Setup pglogical Destination node name</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div></pre></td></tr></table></figure>
<p>可以自己创建一个主键重新 check，也可以执行 fix 来修复，然后再次执行 setup。</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> ❯❯❯ pgrepup -c pgrepup.config fix</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line">Find Source cluster's databases with tables without primary <span class="type">key</span>/unique index...</div><div class="line"> &gt;  template1 ....................................................................OK</div><div class="line"> &gt;  postgres .....................................................................OK</div><div class="line"> &gt;  testdb</div><div class="line"> &gt;      Found public.t2 without primary <span class="type">key</span> ................Added __pgrepup_id field</div></pre></td></tr></table></figure>
<p>通过 fix 加的主键，在 uninstall 的时候会被删除。</p>
<h3 id="Replication-status-down"><a href="#Replication-status-down" class="headerlink" title="Replication status .. down"></a>Replication status .. down</h3><p>有时候会遇到有的 db 的状态是好的，有的 db 是 down 的情况</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Replication status</div><div class="line"> &gt;  Database postgres</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.replicating</div><div class="line"> &gt;  Database testdb</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..down</div><div class="line"> &gt;  Database template1</div><div class="line"> &gt;      Replication status <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.replicating</div><div class="line"> &gt;  Xlog difference (<span class="built_in">bytes</span>) <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..<span class="number">614096</span></div></pre></td></tr></table></figure>
<p>在同步状态下面，如果给某个 db 加一个没有主键的表，就会导致同步断掉。修复方法是先 stop，然后执行 check，按照提示修复，然后执行 setup，然后 start 就可以了。</p>
<h3 id="官方列出来的几个问题"><a href="#官方列出来的几个问题" class="headerlink" title="官方列出来的几个问题"></a>官方列出来的几个问题</h3><ul>
<li>DDL 命令。不会同步 DDL 命令，可以在 db1 试试看 <code>pglogical.replicate_ddl_command</code>。</li>
<li>seq 序列。执行 stop 命令的时候，会在目标 db 的 seq 上面加 1000。</li>
<li>有大量的 db。执行 start 命令之后，pglogical 会每个 db 启动一个 worker 来同步数据，要是 db 比较多会导致比较高的负载。</li>
</ul>
<p>因为这个是基于 pglogical 的，所以还需要关注 pglogical 列出来的一些<a href="https://2ndquadrant.com/it/resources/pglogical/pglogical-docs/" target="_blank" rel="external">限制</a> 第 4 部分 Limitations and Restrictions。</p>
<ul>
<li>4.1 Superuser is required</li>
<li>4.2 UNLOGGED and TEMPORARY not replicated</li>
<li>4.3 One database at a time</li>
<li>4.4 PRIMARY KEY or REPLICA IDENTITY required</li>
<li>4.5 Only one unique index/constraint/PK</li>
<li>4.6 DDL</li>
<li>4.7 No replication queue flush</li>
<li>4.8 FOREIGN KEYS</li>
<li>4.9 TRUNCATE</li>
<li>4.10 Sequences</li>
<li>4.11 Triggers</li>
<li>4.12 PostgreSQL Version differences</li>
<li>4.13 Doesn’t replicate DDL</li>
</ul>
<h3 id="pgrepup-uninstall"><a href="#pgrepup-uninstall" class="headerlink" title="pgrepup uninstall"></a>pgrepup uninstall</h3><p>uninstall 会清理 pgrepup 创建的一些信息，比如安装的 pglogical 扩展，创建用来同步的用户，和通过 fix 命令添加的 seq。</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">❯❯❯ pgrepup <span class="attr">-c</span> pgrepup.config uninstall</div><div class="line">Pgrepup <span class="number">0.3</span><span class="number">.7</span></div><div class="line">Check active subscriptions <span class="keyword">in</span> Destination nodes</div><div class="line"> &gt;  template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>Stopped</div><div class="line"> &gt;  testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>Stopped</div><div class="line"> &gt;  postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.Stopped</div><div class="line">Uninstall operations</div><div class="line"> &gt;  Remove nodes from Destination cluster</div><div class="line"> &gt;      postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;      testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;      template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Drop pg_logical extension <span class="keyword">in</span> <span class="literal">all</span> databases</div><div class="line"> &gt;      Source</div><div class="line"> &gt;          template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;          postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;          testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;      Destination</div><div class="line"> &gt;          postgres <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;          testdb <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;          template1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>OK</div><div class="line"> &gt;  Drop user for replication <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>.OK</div><div class="line"> &gt;  Drop unique fields added <span class="keyword">by</span> fix command</div><div class="line"> &gt;          template1</div><div class="line"> &gt;          postgres</div><div class="line"> &gt;          testdb</div><div class="line"> &gt;              <span class="keyword">public</span>.t1 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div><div class="line"> &gt;              <span class="keyword">public</span>.t2 <span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span><span class="attr">...</span>..OK</div></pre></td></tr></table></figure>
<h2 id="升级"><a href="#升级" class="headerlink" title="升级"></a>升级</h2><p>如果前面配置好了同步状态，那剩下的事情就简单了。</p>
<ul>
<li>停止应用链接 db1</li>
<li>确保 db1 已经没有任何链接</li>
<li>使用 <code>pgrepup stop</code> 停止 replication</li>
<li>修改应用链接到 db2</li>
<li>启动应用</li>
<li>剩下的就是处理掉停止的 db1</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="http://qiita.com/yteraoka/items/e82e4d28f6a23915d190" target="_blank" rel="external">http://qiita.com/yteraoka/items/e82e4d28f6a23915d190</a></p>
</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/use-pgrepup-to-upgrade-your-postgres/#disqus_thread">Comments</a></span>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=null"></script>
</div>





    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'http://wdicc.com/use-pgrepup-to-upgrade-your-postgres/';
            this.page.identifier = 'http://wdicc.com/use-pgrepup-to-upgrade-your-postgres/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//wdicc.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    


<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2016

    wd
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
