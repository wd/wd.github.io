<!doctype html><html lang=en><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://wdicc.com/favicon.ico><title>Oracle数据库日常维护手册 | wd and cc</title><meta name=title content="Oracle数据库日常维护手册"><meta name=description content="Oracle数据库日常维护手册
在Oracle数据库运行期间，DBA应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。 
一、Oracle警告日志文件监控 
Oracle在运行过程中，会在警告日志文件(alert_SID.log)中记录数据库的一些运行情况: 
●数据库的启动、关闭，启动时的非缺省参数; 
●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点(checkpoint)操作没有执行完成造成不能切换，会记录不能切换的原因; 
●对数据库进行的某些操作，如创建或删除表空间、增加数据文件; 
●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误(ORA-600) 
DBA应该定期检查日志文件，根据日志中发现的问题及时进行处理 
问题处理 
启动参数不对检查初始化参数文件 
因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组;想办法提高检查点或归档操作的效率; 
有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单;如有必要，撤消某些用户的系统权限 
出现坏块检查是否是硬件问题(如磁盘本生有坏块)，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建 
表空间不够增加数据文件到相应的表空间 
出现ORA-600根据日志文件的内容查看相应的TRC文件，如果是Oracle的bug，要及时打上相应的补丁

"><meta name=keywords content="oracle,other,监控,"><meta property="og:url" content="https://wdicc.com/oracle-handbook/"><meta property="og:site_name" content="wd and cc"><meta property="og:title" content="Oracle数据库日常维护手册"><meta property="og:description" content="Oracle数据库日常维护手册
在Oracle数据库运行期间，DBA应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。 一、Oracle警告日志文件监控 Oracle在运行过程中，会在警告日志文件(alert_SID.log)中记录数据库的一些运行情况: ●数据库的启动、关闭，启动时的非缺省参数; ●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点(checkpoint)操作没有执行完成造成不能切换，会记录不能切换的原因; ●对数据库进行的某些操作，如创建或删除表空间、增加数据文件; ●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误(ORA-600) DBA应该定期检查日志文件，根据日志中发现的问题及时进行处理 问题处理 启动参数不对检查初始化参数文件 因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组;想办法提高检查点或归档操作的效率; 有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单;如有必要，撤消某些用户的系统权限 出现坏块检查是否是硬件问题(如磁盘本生有坏块)，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建 表空间不够增加数据文件到相应的表空间 出现ORA-600根据日志文件的内容查看相应的TRC文件，如果是Oracle的bug，要及时打上相应的补丁"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2006-08-05T00:00:00+00:00"><meta property="article:modified_time" content="2006-08-05T00:00:00+00:00"><meta property="article:tag" content="Oracle"><meta property="article:tag" content="Other"><meta property="article:tag" content="监控"><meta name=twitter:card content="summary"><meta name=twitter:title content="Oracle数据库日常维护手册"><meta name=twitter:description content="Oracle数据库日常维护手册
在Oracle数据库运行期间，DBA应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。 一、Oracle警告日志文件监控 Oracle在运行过程中，会在警告日志文件(alert_SID.log)中记录数据库的一些运行情况: ●数据库的启动、关闭，启动时的非缺省参数; ●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点(checkpoint)操作没有执行完成造成不能切换，会记录不能切换的原因; ●对数据库进行的某些操作，如创建或删除表空间、增加数据文件; ●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误(ORA-600) DBA应该定期检查日志文件，根据日志中发现的问题及时进行处理 问题处理 启动参数不对检查初始化参数文件 因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组;想办法提高检查点或归档操作的效率; 有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单;如有必要，撤消某些用户的系统权限 出现坏块检查是否是硬件问题(如磁盘本生有坏块)，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建 表空间不够增加数据文件到相应的表空间 出现ORA-600根据日志文件的内容查看相应的TRC文件，如果是Oracle的bug，要及时打上相应的补丁"><meta itemprop=name content="Oracle数据库日常维护手册"><meta itemprop=description content="Oracle数据库日常维护手册
在Oracle数据库运行期间，DBA应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。 一、Oracle警告日志文件监控 Oracle在运行过程中，会在警告日志文件(alert_SID.log)中记录数据库的一些运行情况: ●数据库的启动、关闭，启动时的非缺省参数; ●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点(checkpoint)操作没有执行完成造成不能切换，会记录不能切换的原因; ●对数据库进行的某些操作，如创建或删除表空间、增加数据文件; ●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误(ORA-600) DBA应该定期检查日志文件，根据日志中发现的问题及时进行处理 问题处理 启动参数不对检查初始化参数文件 因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组;想办法提高检查点或归档操作的效率; 有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单;如有必要，撤消某些用户的系统权限 出现坏块检查是否是硬件问题(如磁盘本生有坏块)，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建 表空间不够增加数据文件到相应的表空间 出现ORA-600根据日志文件的内容查看相应的TRC文件，如果是Oracle的bug，要及时打上相应的补丁"><meta itemprop=datePublished content="2006-08-05T00:00:00+00:00"><meta itemprop=dateModified content="2006-08-05T00:00:00+00:00"><meta itemprop=wordCount content="2796"><meta itemprop=keywords content="Oracle,Other,监控"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--code-background-color:#f2f2f2;--code-color:#222;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--code-background-color:#000;--code-color:#ddd;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px}blockquote{border-left:1px solid #999;color:var(--code-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{padding:1px 15px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>wd and cc</h2></a><p>-- Good good study, day day up!</p><nav><a href=/>Home</a>
<a href=/posts/>Posts</a>
<a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a>
<a href=/tags/>Tags</a>
<a href=/atom.xml>subscribe</a></nav></header><main><content><h4 align=center style=text-align:center;line-height:13.5pt><span lang=EN-US style=color:#000>Oracle</span><span style=color:#000>数据库日常维护手册<span lang=EN-US></span></span></h4><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>在<span lang=EN-US>Oracle</span>数据库运行期间，<span lang=EN-US>DBA</span>应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>一、<span lang=EN-US>Oracle</span>警告日志文件监控 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>Oracle</span><span style=font-size:9pt;color:#000>在运行过程中，会在警告日志文件<span lang=EN-US>(alert_SID.log)</span>中记录数据库的一些运行情况<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●数据库的启动、关闭，启动时的非缺省参数<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点<span lang=EN-US>(checkpoint)</span>操作没有执行完成造成不能切换，会记录不能切换的原因<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●对数据库进行的某些操作，如创建或删除表空间、增加数据文件<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误<span lang=EN-US>(ORA-600)</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>DBA</span><span style=font-size:9pt;color:#000>应该定期检查日志文件，根据日志中发现的问题及时进行处理<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>问题处理<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>启动参数不对检查初始化参数文件<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组<span lang=EN-US>;</span>想办法提高检查点或归档操作的效率<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单<span lang=EN-US>;</span>如有必要，撤消某些用户的系统权限<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>出现坏块检查是否是硬件问题<span lang=EN-US>(</span>如磁盘本生有坏块<span lang=EN-US>)</span>，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>表空间不够增加数据文件到相应的表空间<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>出现<span lang=EN-US>ORA-600</span>根据日志文件的内容查看相应的<span lang=EN-US>TRC</span>文件，如果是<span lang=EN-US>Oracle</span>的<span lang=EN-US>bug</span>，要及时打上相应的补丁</span></p><br><p style=text-indent:24pt;line-height:13.5pt><br><strong><span style=font-size:9pt;font-family:宋体;color:#000>    二、数据库表空间使用情况监控<span lang=EN-US>(</span>字典管理表空间<span lang=EN-US>) </span></span></strong><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>数据库运行了一段时间后，由于不断的在表空间上创建和删除对象，会在表空间上产生大量的碎片，<span lang=EN-US>DBA</span>应该及时了解表空间的碎片和可用空间情况，以决定是否要对碎片进行整理或为表空间增加数据文件。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>select tablespace_name, </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>count(*) chunks ,</span></code><br><code><span style=font-family:新宋体>max(bytes/1024/1024) max_chunk</span></code><br><code><span style=font-family:新宋体>from dba_free_space</span></code><br><code><span style=font-family:新宋体>group by tablespace_name; </span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>上面的<span lang=EN-US>SQL</span>列出了数据库中每个表空间的空闲块情况<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>其中，<span lang=EN-US>CHUNKS</span>列表示表空间中有多少可用的空闲块<span lang=EN-US>(</span>每个空闲块是由一些连续的<span lang=EN-US>Oracle</span>数据块组成<span lang=EN-US>)</span>，如果这样的空闲块过多，比如平均到每个数据文件上超过了<span lang=EN-US>100</span>个，那么该表空间的碎片状况就比较严重了，可以尝试用以下的<span lang=EN-US>SQL</span>命令进行表空间相邻碎片的接合<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>alter tablespace </span><span style=font-size:9pt;color:#000>表空间名<span lang=EN-US> coalesce;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>对表空间的扩充对表空间的数据文件大小进行扩展，或向表空间增加数据文件，例如：<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>alter database datafile ‘filename’ resize 2g;</span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>alter tablespace add datafile ‘filename’ size 2g;</span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>三、查看数据库的连接情况 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>DBA</span><span style=font-size:9pt;color:#000>要定时对数据库的连接情况进行检查，看与数据库建立的会话数目是不是正常，如果建立了过多的连接，会消耗数据库的资源。同时，对一些<span lang=EN-US>“</span>挂死<span lang=EN-US>”</span>的连接，可能会需要<span lang=EN-US>DBA</span>手工进行清理。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>以下的<span lang=EN-US>SQL</span>语句列出当前数据库建立的会话情况<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>select sid,serial#,username,program,machine,status </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>from v$session;</span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果<span lang=EN-US>DBA</span>要手工断开某个会话，则执行<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>alter system kill session 'SID,SERIAL#';</span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>四、备份 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>控制文件的备份：<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>在数据库结构发生变化时，如增加了表空间，增加了数据文件或重做日志文件这些操作，都会造成<span lang=EN-US>Oracle</span>数据库控制文件的变化，<span lang=EN-US>DBA</span>应及进行控制文件的备份，备份方法是<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>执行<span lang=EN-US>SQL</span>语句<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>alter database </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>backup controlfile to '/home/backup/control.bak';</span></code><br></span><span style=font-size:9pt;color:#000>或<span lang=EN-US>:</span></span><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>alter database </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>backup controlfile to trace;</span></code><br></span><span style=font-size:9pt;color:#000>这样，会在<span lang=EN-US>USER_DUMP_DEST(</span>初始化参数文件中指定<span lang=EN-US>)</span>目录下生成创建控制文件的<span lang=EN-US>SQL</span>命令。 <span lang=EN-US></span></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>数据逻辑备份：<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>导出：<span lang=EN-US>exp wd/******* file=***.dmp owner=wd</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>导入：<span lang=EN-US>imp wd/******* file=***.dmp fromuser=wd touser=wd</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span lang=EN-US style=font-size:9pt;font-family:宋体;color:#000> </span></strong></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>五、检查数据库文件的状态 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>DBA</span><span style=font-size:9pt;color:#000>要及时查看数据库中数据文件的状态<span lang=EN-US>(</span>如被误删除<span lang=EN-US>)</span>，根据实际情况决定如何进行处理，检查数据文件的状态的<span lang=EN-US>SQL</span>如下<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>select file_name,status </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>from dba_data_files;</span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果数据文件的<span lang=EN-US>STATUS</span>列不是<span lang=EN-US>AVAILABLE</span>，那么就要采取相应的措施，如对该数据文件进行恢复操作，或重建该数据文件所在的表空间。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>六、检查数据库定时作业的完成情况 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果数据库使用了<span lang=EN-US>Oracle</span>的<span lang=EN-US>JOB</span>来完成一些定时作业，要对这些<span lang=EN-US>JOB</span>的运行情况进行检查<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>select job,log_user,last_date,failures </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>from dba_jobs; </span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果<span lang=EN-US>FAILURES</span>列是一个大于<span lang=EN-US>0</span>的数的话，说明<span lang=EN-US>JOB</span>运行失败，要进一步的检查。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>七、数据库坏块的处理 </span></strong><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>当<span lang=EN-US>Oracle</span>数据库出现坏块时，<span lang=EN-US>Oracle</span>会在警告日志文件<span lang=EN-US>(alert_SID.log)</span>中记录坏块的信息<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>ORA-01578: ORACLE data block corrupted (file # 7, block # )</span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>ORA-01110: data file : '/oracle1/oradata/V920/oradata/V816/users01.dbf'</span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>其中， 代表坏块所在数据文件的绝对文件号， 代表坏块是数据文件上的第几个数据块<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>出现这种情况时，应该首先检查是否是硬件及操作系统上的故障导致<span lang=EN-US>Oracle</span>数据库出现坏块。在排除了数据库以外的原因后，再对发生坏块的数据库对象进行处理。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>1.</span><span style=font-size:9pt;color:#000>确定发生坏块的数据库对象<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>SELECT tablespace_name, </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>segment_type,</span></code><br><code><span style=font-family:新宋体>owner,</span></code><br><code><span style=font-family:新宋体>segment_name</span></code><br><code><span style=font-family:新宋体>FROM dba_extents</span></code><br><code><span style=font-family:新宋体>WHERE file_id =</span></code><br><code><span style=font-family:新宋体>AND</span></code><br><code><span style=font-family:新宋体>between block_id AND block_id+blocks-1; </span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>2.</span><span style=font-size:9pt;color:#000>决定修复方法<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果发生坏块的对象是一个索引，那么可以直接把索引<span lang=EN-US>DROP</span>掉后，再根据表里的记录进行重建<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果发生坏块的表的记录可以根据其它表的记录生成的话，那么可以直接把这个表<span lang=EN-US>DROP</span>掉后重建<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果有数据库的备份，则恢复数据库的方法来进行修复<span lang=EN-US>;</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>如果表里的记录没有其它办法恢复，那么坏块上的记录就丢失了，只能把表中其它数据块上的记录取出来，然后对这个表进行重建。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>3.</span><span style=font-size:9pt;color:#000>用<span lang=EN-US>Oracle</span>提供的<span lang=EN-US>DBMS_REPAIR</span>包标记出坏块<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>exec DBMS_REPAIR.SKIP_CORRUPT_BLOCKS(' ','');</span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>4.</span><span style=font-size:9pt;color:#000>使用<span lang=EN-US>Create table as select</span>命令将表中其它块上的记录保存到另一张表上<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>create table corrupt_table_bak </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>as</span></code><br><code><span style=font-family:新宋体>select * from corrupt_table; </span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>5.</span><span style=font-size:9pt;color:#000>用<span lang=EN-US>DROP TABLE</span>命令删除有坏块的表<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>drop table corrup_tatble; </span></code><span lang=EN-US style=font-size:9pt;color:#000></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>6.</span><span style=font-size:9pt;color:#000>用<span lang=EN-US>alter table rename</span>命令恢复原来的表<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000>alter table corrupt_table_bak </span></code><span lang=EN-US style=font-size:10pt;font-family:新宋体;color:#000><br><code><span style=font-family:新宋体>rename to corrupt_table; </span></code></span><span lang=EN-US style=font-size:9pt;color:#000></span><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>7.</span><span style=font-size:9pt;color:#000>如果表上存在索引，则要重建表上的索引<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;font-family:宋体;color:#000>八、操作系统相关维护 <span lang=EN-US></span></span></strong></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>DBA</span><span style=font-size:9pt;color:#000>要注意对操作系统的监控<span lang=EN-US>:</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●文件系统的空间使用情况<span lang=EN-US>(df -k)</span>，必要时对<span lang=EN-US>Oracle</span>的警告日志及<span lang=EN-US>TRC</span>文件进行清理<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●如果<span lang=EN-US>Oracle</span>提供网络服务，检查网络连接是否正常<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●检查操作系统的资源使用情况是否正常<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>●检查数据库服务器有没有硬件故障，如磁盘、内存报错<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><strong><span style=font-size:9pt;color:#000>九、数据库背景知识<span lang=EN-US></span></span></strong></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>配置文件<span lang=EN-US>  </span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>spfile</span><span style=font-size:9pt;color:#000>，位于<span lang=EN-US>$ORACLE_HOME/dbs/spfile<oracle_sid>.ora,</span>是一个二进制文件，不能直接编辑，<span lang=EN-US>Oracle9i</span>之后默认使用<span lang=EN-US>spfile</span>。可以通过<span lang=EN-US>alter system set </span>×××<span lang=EN-US>=</span>×××<span lang=EN-US>;</span>来修改参数，大部分参数修改后不用重启数据库。可以通过执行<span lang=EN-US>show parameter spfile</span>来查看是否使用了<span lang=EN-US>spfile</span>，如果执行结果为空，则数据库没有使用<span lang=EN-US>spfile</span>。执行<span lang=EN-US>create spfile from pfile; </span>然后重启数据库就启用了<span lang=EN-US>spfile</span>。<span lang=EN-US>  </span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>pfile</span><span style=font-size:9pt;color:#000>，位于<span lang=EN-US>$ORACLE_HOME/dbs/init<oracle_sid>.ora</span>，是一个<span lang=EN-US>ASCII</span>文件可以编辑，修改参数后需要重启数据库。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>tnsnames.ora, </span><span style=font-size:9pt;color:#000>位于<span lang=EN-US>$ORACLE_HOME/network/admin/tnsnames.ora, </span>记录了服务明的信息。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>listener.ora, </span><span style=font-size:9pt;color:#000>位于<span lang=EN-US>$ORACLE_HOME/network/admin/listener.ora</span>，记录了<span lang=EN-US>listener</span>的信息。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>日志文件<span lang=EN-US>  </span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>alert, </span><span style=font-size:9pt;color:#000>位于<span lang=EN-US>$ORACLE_BASE/admin/$ORACLE_SID/bdump/alert<$ORACLE_SID>.log, Oracle</span>的报警日志，如数据库出错可以在此文件中查看。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>redo, </span><span style=font-size:9pt;color:#000>位于<span lang=EN-US>$ORACLE_BASE/oradata/redo</span>××<span lang=EN-US>.log</span>，<span lang=EN-US>Orale</span>重做日志。<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>启动<span lang=EN-US>/</span>停止<span lang=EN-US>ORACLE</span>：<span lang=EN-US></span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span style=font-size:9pt;color:#000>以<span lang=EN-US>sysdba</span>权限登陆<span lang=EN-US>sqlplus</span>，<span lang=EN-US></span></span></p><br><p style=text-indent:42pt;line-height:13.5pt><span style=font-size:9pt;color:#000>停止：<span lang=EN-US>shutdown immediate</span></span></p><br><p style=text-indent:24pt;line-height:13.5pt><span lang=EN-US style=font-size:9pt;color:#000>    </span><span style=font-size:9pt;color:#000>启动：<span lang=EN-US>startup</span></span></p><br></content><div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wdicc.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>