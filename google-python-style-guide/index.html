<!doctype html><html>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>Google Python Style Guide - wd and cc</title><link rel=icon type=image/png href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:title" content="Google Python Style Guide">
<meta property="og:description" content="来自这里。翻译的目的是为了方便快速理解，所以没有太纠结很准确，最好是和英文对应看。 1 Background Google 的 python 代码风格">
<meta property="og:type" content="article">
<meta property="og:url" content="https://wdicc.com/google-python-style-guide/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-02-02T16:20:21+08:00">
<meta property="article:modified_time" content="2020-02-02T16:20:21+08:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Google Python Style Guide">
<meta name=twitter:description content="来自这里。翻译的目的是为了方便快速理解，所以没有太纠结很准确，最好是和英文对应看。 1 Background Google 的 python 代码风格">
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/normalize.css>
<link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/main.css>
<link rel=stylesheet type=text/css href=https://wdicc.com//light-syntax.css media="(prefers-color-scheme: light)"><link rel=stylesheet type=text/css href=https://wdicc.com/css/dark.css media="(prefers-color-scheme: dark)">
<link rel=stylesheet type=text/css href=https://wdicc.com//dark-syntax.css media="(prefers-color-scheme: dark)">
<script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script>
<script src=https://wdicc.com/js/main.js></script>
</head>
<body>
<div class="container wrapper post">
<div class=header>
<h1 class=site-title><a href=https://wdicc.com/>wd and cc</a></h1>
<div class=site-description><h2>&mdash; Happy every day</h2><nav class="nav social">
<ul class=flat><a href=https://github.com/wd title=Github><i data-feather=github></i></a><a href=https://twitter.com/wdicc1413 title=Twitter><i data-feather=twitter></i></a></ul>
</nav>
</div>
<nav class=nav>
<ul class=flat>
<li>
<a href=/>Home</a>
</li>
<li>
<a href=/post>All posts</a>
</li>
<li>
<a href=/tags>Tags</a>
</li>
<li>
<a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&q=">Search</a>
</li>
<li>
<a href=/atom.xml>Subscribe</a>
</li>
</ul>
</nav>
</div>
<div class=post-header>
<h1 class=title>Google Python Style Guide</h1>
<div class=meta>Posted at &mdash; Feb 2, 2020</div>
</div>
<div class=post-header>
<nav id=TableOfContents>
<ul>
<li><a href=#headline-1>1 Background</a>
</li>
<li><a href=#headline-2>2 Python Language Rules</a>
<ul>
<li><a href=#headline-3>2.1 Lint</a>
</li>
<li><a href=#headline-4>2.2 Imports</a>
</li>
<li><a href=#headline-5>2.3 Packages</a>
</li>
<li><a href=#headline-6>2.4 Exceptions</a>
</li>
<li><a href=#headline-7>2.5 Global variables</a>
</li>
<li><a href=#headline-8>2.6 Nested/Local/Inner Classes and Functions</a>
</li>
<li><a href=#headline-9>2.7 Comprehensions & Generator Expressions</a>
</li>
<li><a href=#headline-10>2.8 Default Iterators and Operators</a>
</li>
<li><a href=#headline-11>2.9 Generators</a>
</li>
<li><a href=#headline-12>2.10 Lambda Functions</a>
</li>
<li><a href=#headline-13>2.11 Conditional Expressions</a>
</li>
<li><a href=#headline-14>2.12 Default Argument Values</a>
</li>
<li><a href=#headline-15>2.13 Properties</a>
</li>
<li><a href=#headline-16>2.14 True/False Evaluations</a>
</li>
<li><a href=#headline-17>2.15 Deprecated Language Features</a>
</li>
<li><a href=#headline-18>2.16 Lexical Scoping</a>
</li>
<li><a href=#headline-19>2.17 Function and Method Decorators</a>
</li>
<li><a href=#headline-20>2.18 Threading</a>
</li>
<li><a href=#headline-21>2.19 Power Features</a>
</li>
<li><a href=#headline-22>2.20 Modern Python: Python 3 and from <span style=text-decoration:underline><span style=text-decoration:underline>future</span></span> imports</a>
</li>
<li><a href=#headline-23>2.21 Type Annotated Code</a>
</li>
</ul>
</li>
<li><a href=#headline-24>3 Python Style Rules</a>
<ul>
<li><a href=#headline-25>3.1 Semicolons</a>
</li>
<li><a href=#headline-26>3.2 Line length</a>
</li>
<li><a href=#headline-27>3.3 Parentheses</a>
</li>
<li><a href=#headline-28>3.4 Indentation</a>
<ul>
<li><a href=#headline-29>3.4.1 Trailing commas in sequences of items?</a>
</li>
</ul>
</li>
<li><a href=#headline-30>3.5 Blank Lines</a>
</li>
<li><a href=#headline-31>3.6 Whitespace</a>
</li>
<li><a href=#headline-32>3.7 Shebang Line</a>
</li>
<li><a href=#headline-33>3.8 Comments and Docstrings</a>
<ul>
<li><a href=#headline-34>3.8.1 Docstrings</a>
</li>
<li><a href=#headline-35>3.8.2 Modules</a>
</li>
<li><a href=#headline-36>3.8.3 Functions and Methods</a>
</li>
<li><a href=#headline-37>3.8.4 Classes</a>
</li>
<li><a href=#headline-38>3.8.5 Block and Inline Comments</a>
</li>
<li><a href=#headline-39>3.8.6 Punctuation, Spelling, and Grammar</a>
</li>
</ul>
</li>
<li><a href=#headline-40>3.9 Classes</a>
</li>
<li><a href=#headline-41>3.10 Strings</a>
</li>
<li><a href=#headline-42>3.11 Files and Sockets</a>
</li>
<li><a href=#headline-43>3.12 TODO Comments</a>
</li>
<li><a href=#headline-44>3.13 Imports formatting</a>
</li>
<li><a href=#headline-45>3.14 Statements</a>
</li>
<li><a href=#headline-46>3.15 Accessors</a>
</li>
<li><a href=#headline-47>3.16 Naming</a>
<ul>
<li><a href=#headline-48>3.16.1 Names to Avoid</a>
</li>
<li><a href=#headline-49>3.16.2 Naming Conventions</a>
</li>
<li><a href=#headline-50>3.16.3 File Naming</a>
</li>
<li><a href=#headline-51>3.16.4 Guidelines derived from Guido’s Recommendations</a>
</li>
<li><a href=#headline-52>3.17 Main</a>
</li>
<li><a href=#headline-53>3.18 Function length</a>
</li>
</ul>
</li>
<li><a href=#headline-54>3.19 Type Annotations</a>
<ul>
<li><a href=#headline-55>3.19.1 General Rules</a>
</li>
<li><a href=#headline-56>3.19.2 Line Breaking</a>
</li>
<li><a href=#headline-57>3.19.3 Forward Declarations</a>
</li>
<li><a href=#headline-58>3.19.4 Default Values</a>
</li>
<li><a href=#headline-59>3.19.5 NoneType</a>
</li>
<li><a href=#headline-60>3.19.6 Type Aliases</a>
</li>
<li><a href=#headline-61>3.19.7 Ignoring Types</a>
</li>
<li><a href=#headline-62>3.19.8 Typing Variables</a>
</li>
<li><a href=#headline-63>3.19.9 Tuples vs Lists</a>
</li>
<li><a href=#headline-64>3.19.10 TypeVars</a>
</li>
<li><a href=#headline-65>3.19.11 String types</a>
</li>
<li><a href=#headline-66>3.19.12 Imports For Typing</a>
</li>
<li><a href=#headline-67>3.19.13 Conditional Imports</a>
</li>
<li><a href=#headline-68>3.19.14 Circular Dependencies</a>
</li>
<li><a href=#headline-69>3.19.15 Generics</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href=#headline-70>4 Parting Words</a>
</li>
</ul>
</nav>
</div>
<div class=markdown>
<p>
来自<a href=https://google.github.io/styleguide/pyguide.html>这里</a>。翻译的目的是为了方便快速理解，所以没有太纠结很准确，最好是和英文对应看。</p>
<div id=outline-container-headline-1 class=outline-3>
<h3 id=headline-1>
1 Background
</h3>
<div id=outline-text-headline-1 class=outline-text-3>
<p>
Google 的 python 代码风格指导。</p>
<p>
有一个 vim 的配置。 Emacs 默认的似乎就可以。</p>
<p>
还有团队使用 yapf 自动格式化代码来避免对格式产生争论。</p>
</div>
</div>
<div id=outline-container-headline-2 class=outline-3>
<h3 id=headline-2>
2 Python Language Rules
</h3>
<div id=outline-text-headline-2 class=outline-text-3>
<div id=outline-container-headline-3 class=outline-4>
<h4 id=headline-3>
2.1 Lint
</h4>
<div id=outline-text-headline-3 class=outline-text-4>
<p>
使用 pylint 检查代码。</p>
<p>
可以通过行内注释关闭一些 warning</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=nb>dict</span> <span class=o>=</span> <span class=s1>&#39;something awful&#39;</span>  <span class=c1># Bad Idea... pylint: disable=redefined-builtin</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-4 class=outline-4>
<h4 id=headline-4>
2.2 Imports
</h4>
<div id=outline-text-headline-4 class=outline-text-4>
<ul>
<li>
<p><code>import x</code> 引入包或者模块</p>
</li>
<li>
<p><code>from x import y</code> x 是包前缀，y 是模块名称</p>
</li>
<li>
<p><code>from x import y as z</code> 如果有两个模块都叫 y 或者 y 的名字太长了</p>
</li>
<li>
<p><code>import y as z</code> 只有在 z 是个比较常见的缩写（例如 np 作为 numpy 的缩写）</p>
</li>
</ul>
<p>例如 <code>sound.effects.echo</code></p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>sound.effects</span> <span class=kn>import</span> <span class=n>echo</span>
<span class=o>...</span>
<span class=n>echo</span><span class=o>.</span><span class=n>EchoFilter</span><span class=p>(</span><span class=nb>input</span><span class=p>,</span> <span class=n>output</span><span class=p>,</span> <span class=n>delay</span><span class=o>=</span><span class=mf>0.7</span><span class=p>,</span> <span class=n>atten</span><span class=o>=</span><span class=mi>4</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-5 class=outline-4>
<h4 id=headline-5>
2.3 Packages
</h4>
<div id=outline-text-headline-5 class=outline-text-4>
<p>
总是使用全路径导入包。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># Reference absl.flags in code with the complete name (verbose).</span>
<span class=kn>import</span> <span class=nn>absl.flags</span>
<span class=kn>from</span> <span class=nn>doctor.who</span> <span class=kn>import</span> <span class=n>jodie</span>

<span class=n>FLAGS</span> <span class=o>=</span> <span class=n>absl</span><span class=o>.</span><span class=n>flags</span><span class=o>.</span><span class=n>FLAGS</span></code></pre></div>
</div>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># Reference flags in code with just the module name (common).</span>
<span class=kn>from</span> <span class=nn>absl</span> <span class=kn>import</span> <span class=n>flags</span>
<span class=kn>from</span> <span class=nn>doctor.who</span> <span class=kn>import</span> <span class=n>jodie</span>

<span class=n>FLAGS</span> <span class=o>=</span> <span class=n>flags</span><span class=o>.</span><span class=n>FLAGS</span></code></pre></div>
</div>
<p>
不要像下面这样，假设在 <code>doctor/who/</code> 下面有个 jodie.py。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># Unclear what module the author wanted and what will be imported.  The actual</span>
<span class=c1># import behavior depends on external factors controlling sys.path.</span>
<span class=c1># Which possible jodie module did the author intend to import?</span>
<span class=kn>import</span> <span class=nn>jodie</span></code></pre></div>
</div>
<p>
这个依赖于 sys.path 的情况，无法知道是想要第三方的 jodie 还是本目录的。</p>
</div>
</div>
<div id=outline-container-headline-6 class=outline-4>
<h4 id=headline-6>
2.4 Exceptions
</h4>
<div id=outline-text-headline-6 class=outline-text-4>
<ul>
<li>
<p>使用 <code>raise MyError('Error message')</code> 或者 <code>raise MyError()</code> ，不要用 <code>raise MyError, 'Error message'</code></p>
</li>
<li>
<p>如果可以的话，使用自带的 exception。例如对于不符合要求的数据报 <code>ValueError</code> 。不要使用 <code>assert</code> 来验证公开 api 传入的参数。 <code>assert</code> 只是用来保证内部数据的正确性的。</p>
</li>
</ul>
<p>使用下面这样的：</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python>  <span class=k>def</span> <span class=nf>connect_to_next_port</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>minimum</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;Connects to the next available port.
</span><span class=s2>
</span><span class=s2>    Args:
</span><span class=s2>      minimum: A port value greater or equal to 1024.
</span><span class=s2>
</span><span class=s2>    Returns:
</span><span class=s2>      The new minimum port.
</span><span class=s2>
</span><span class=s2>    Raises:
</span><span class=s2>      ConnectionError: If no available port is found.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>if</span> <span class=n>minimum</span> <span class=o>&lt;</span> <span class=mi>1024</span><span class=p>:</span>
      <span class=c1># Note that this raising of ValueError is not mentioned in the doc</span>
      <span class=c1># string&#39;s &#34;Raises:&#34; section because it is not appropriate to</span>
      <span class=c1># guarantee this specific behavioral reaction to API misuse.</span>
      <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s1>&#39;Minimum port must be at least 1024, not </span><span class=si>%d</span><span class=s1>.&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>minimum</span><span class=p>,))</span>
    <span class=n>port</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_next_open_port</span><span class=p>(</span><span class=n>minimum</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>port</span><span class=p>:</span>
      <span class=k>raise</span> <span class=ne>ConnectionError</span><span class=p>(</span><span class=s1>&#39;Could not connect to service on </span><span class=si>%d</span><span class=s1> or higher.&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>minimum</span><span class=p>,))</span>
    <span class=k>assert</span> <span class=n>port</span> <span class=o>&gt;=</span> <span class=n>minimum</span><span class=p>,</span> <span class=s1>&#39;Unexpected port </span><span class=si>%d</span><span class=s1> when minimum was </span><span class=si>%d</span><span class=s1>.&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>port</span><span class=p>,</span> <span class=n>minimum</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>port</span></code></pre></div>
</div>
<p>
不要用下面这样的：</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python>  <span class=k>def</span> <span class=nf>connect_to_next_port</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>minimum</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;Connects to the next available port.
</span><span class=s2>
</span><span class=s2>    Args:
</span><span class=s2>      minimum: A port value greater or equal to 1024.
</span><span class=s2>
</span><span class=s2>    Returns:
</span><span class=s2>      The new minimum port.
</span><span class=s2>    &#34;&#34;&#34;</span>
    <span class=k>assert</span> <span class=n>minimum</span> <span class=o>&gt;=</span> <span class=mi>1024</span><span class=p>,</span> <span class=s1>&#39;Minimum port must be at least 1024.&#39;</span>
    <span class=n>port</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_next_open_port</span><span class=p>(</span><span class=n>minimum</span><span class=p>)</span>
    <span class=k>assert</span> <span class=n>port</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span>
    <span class=k>return</span> <span class=n>port</span></code></pre></div>
</div>
<ul>
<li>
<p>可以定义自己的 Excpetion，但是应该继承已有的 exeption 类。名称应该以 Error 结尾，不要用类似 foo.FooError 这样的形式。</p>
</li>
<li>
<p>不要使用 <code>except:</code> 捕获所有异常，或者捕获 Exception StandardError，除非：</p>
<ul>
<li>
<p>打算再次抛出异常</p>
</li>
<li>
<p>创建一个隔离，记录和抑制异常，让异常不在往上传播，例如保护一个线程不会 crash。</p>
</li>
</ul>
<p>python 的 <code>except:</code> 会捕获包括错误的拼写，sys.exit() 调用，Ctrl+C 中断，测试用例失败，和其他的一些异常，一般不会需要都捕获。</p>
</li>
<li>
<p>减少 <code>try/except</code> 块的代码。代码太多可能会捕获你没想到的一些异常，而隐藏真正的错误。</p>
</li>
<li>
<p>使用 <code>finally</code> 执行一些不管有没有异常都需要执行的动作，一般可以用来做一些清理，关闭文件什么的。</p>
</li>
<li>
<p>捕获异常的时候使用 as 代替逗号。</p>
</li>
</ul>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>try</span><span class=p>:</span>
  <span class=k>raise</span> <span class=n>Error</span><span class=p>()</span>
<span class=k>except</span> <span class=n>Error</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
  <span class=k>pass</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-7 class=outline-4>
<h4 id=headline-7>
2.5 Global variables
</h4>
<div id=outline-text-headline-7 class=outline-text-4>
<p>
避免使用全局变量。</p>
<p>
全局的常量使用全大写。可以在变量前面加 _ 表示是内部的，外部应该使用公共方法来读取这些变量。</p>
</div>
</div>
<div id=outline-container-headline-8 class=outline-4>
<h4 id=headline-8>
2.6 Nested/Local/Inner Classes and Functions
</h4>
<div id=outline-text-headline-8 class=outline-text-4>
<p>
本地局部的函数或者类定义可以方便使用，但是这些类的实例不能被 pickled 序列化。也不能被直接测试，而且还会导致你的程序变长。不要用这个方式来隐藏一些方法，应该使用加 _ 的方法。</p>
</div>
</div>
<div id=outline-container-headline-9 class=outline-4>
<h4 id=headline-9>
2.7 Comprehensions & Generator Expressions
</h4>
<div id=outline-text-headline-9 class=outline-text-4>
<p>
简单的情况可以用。map 表达式，for 语句，filter 表达式。多个 for 或者 filter 不允许。使用循环吧。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
  <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=n>mapping_expr</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>iterable</span> <span class=k>if</span> <span class=n>filter_expr</span><span class=p>]</span>

  <span class=n>result</span> <span class=o>=</span> <span class=p>[{</span><span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=n>value</span><span class=p>}</span> <span class=k>for</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>iterable</span>
            <span class=k>if</span> <span class=n>a_long_filter_expression</span><span class=p>(</span><span class=n>value</span><span class=p>)]</span>

  <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=n>complicated_transform</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>iterable</span> <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>x</span><span class=p>)]</span>

  <span class=n>descriptive_name</span> <span class=o>=</span> <span class=p>[</span>
      <span class=n>transform</span><span class=p>({</span><span class=s1>&#39;key&#39;</span><span class=p>:</span> <span class=n>key</span><span class=p>,</span> <span class=s1>&#39;value&#39;</span><span class=p>:</span> <span class=n>value</span><span class=p>},</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>)</span>
      <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>generate_iterable</span><span class=p>(</span><span class=n>some_input</span><span class=p>)</span>
      <span class=k>if</span> <span class=n>complicated_condition_is_met</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
  <span class=p>]</span>

  <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
  <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
      <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>):</span>
          <span class=k>if</span> <span class=n>x</span> <span class=o>*</span> <span class=n>y</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>:</span>
              <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>

  <span class=k>return</span> <span class=p>{</span><span class=n>x</span><span class=p>:</span> <span class=n>complicated_transform</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
          <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>long_generator_function</span><span class=p>(</span><span class=n>parameter</span><span class=p>)</span>
          <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>}</span>

  <span class=n>squares_generator</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span>

  <span class=n>unique_names</span> <span class=o>=</span> <span class=p>{</span><span class=n>user</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>users</span> <span class=k>if</span> <span class=n>user</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>}</span>

  <span class=n>eat</span><span class=p>(</span><span class=n>jelly_bean</span> <span class=k>for</span> <span class=n>jelly_bean</span> <span class=ow>in</span> <span class=n>jelly_beans</span>
      <span class=k>if</span> <span class=n>jelly_bean</span><span class=o>.</span><span class=n>color</span> <span class=o>==</span> <span class=s1>&#39;black&#39;</span><span class=p>)</span></code></pre></div>
</div>
<p>
不要类似下面这样的，太难理解了。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>No</span><span class=p>:</span>
  <span class=n>result</span> <span class=o>=</span> <span class=p>[</span><span class=n>complicated_transform</span><span class=p>(</span>
                <span class=n>x</span><span class=p>,</span> <span class=n>some_argument</span><span class=o>=</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
            <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>iterable</span> <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>x</span><span class=p>)]</span>

  <span class=n>result</span> <span class=o>=</span> <span class=p>[(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span> <span class=k>if</span> <span class=n>x</span> <span class=o>*</span> <span class=n>y</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>]</span>

  <span class=k>return</span> <span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>)</span>
          <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
          <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
          <span class=k>if</span> <span class=n>x</span> <span class=o>!=</span> <span class=n>y</span>
          <span class=k>for</span> <span class=n>z</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
          <span class=k>if</span> <span class=n>y</span> <span class=o>!=</span> <span class=n>z</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-10 class=outline-4>
<h4 id=headline-10>
2.8 Default Iterators and Operators
</h4>
<div id=outline-text-headline-10 class=outline-text-4>
<p>
对于 list，dict，文件，使用自带的迭代器和操作符，这些都针对 in 和 not in 定义了自带的迭代器。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>  <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>adict</span><span class=p>:</span> <span class=o>...</span>
      <span class=k>if</span> <span class=n>key</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>adict</span><span class=p>:</span> <span class=o>...</span>
      <span class=k>if</span> <span class=n>obj</span> <span class=ow>in</span> <span class=n>alist</span><span class=p>:</span> <span class=o>...</span>
      <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>afile</span><span class=p>:</span> <span class=o>...</span>
      <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>adict</span><span class=o>.</span><span class=n>items</span><span class=p>():</span> <span class=o>...</span>
      <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>six</span><span class=o>.</span><span class=n>iteritems</span><span class=p>(</span><span class=n>adict</span><span class=p>):</span> <span class=o>...</span>

<span class=n>No</span><span class=p>:</span>   <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>adict</span><span class=o>.</span><span class=n>keys</span><span class=p>():</span> <span class=o>...</span>
      <span class=k>if</span> <span class=ow>not</span> <span class=n>adict</span><span class=o>.</span><span class=n>has_key</span><span class=p>(</span><span class=n>key</span><span class=p>):</span> <span class=o>...</span>
      <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>afile</span><span class=o>.</span><span class=n>readlines</span><span class=p>():</span> <span class=o>...</span>
      <span class=k>for</span> <span class=n>k</span><span class=p>,</span> <span class=n>v</span> <span class=ow>in</span> <span class=nb>dict</span><span class=o>.</span><span class=n>iteritems</span><span class=p>():</span> <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-11 class=outline-4>
<h4 id=headline-11>
2.9 Generators
</h4>
<div id=outline-text-headline-11 class=outline-text-4>
<p>
对于迭代器函数，在文档字符串里面使用 "Yields:" 代替 "Returns:"。</p>
</div>
</div>
<div id=outline-container-headline-12 class=outline-4>
<h4 id=headline-12>
2.10 Lambda Functions
</h4>
<div id=outline-text-headline-12 class=outline-text-4>
<p>
单行的时候可以用。如果代码长度超过 60-80 字符，可能使用嵌套函数更好。</p>
<p>
使用 operator 模块代替 lambda，例如 operator.mul 代替 lambda x, y: x * y。</p>
</div>
</div>
<div id=outline-container-headline-13 class=outline-4>
<h4 id=headline-13>
2.11 Conditional Expressions
</h4>
<div id=outline-text-headline-13 class=outline-text-4>
<p>简单的情况可以用。比较复杂的时候，使用完整的 if 语句。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>one_line</span> <span class=o>=</span> <span class=s1>&#39;yes&#39;</span> <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>else</span> <span class=s1>&#39;no&#39;</span>
<span class=n>slightly_split</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;yes&#39;</span> <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
                  <span class=k>else</span> <span class=s1>&#39;no, nein, nyet&#39;</span><span class=p>)</span>
<span class=n>the_longest_ternary_style_that_can_be_done</span> <span class=o>=</span> <span class=p>(</span>
    <span class=s1>&#39;yes, true, affirmative, confirmed, correct&#39;</span>
    <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
    <span class=k>else</span> <span class=s1>&#39;no, false, negative, nay&#39;</span><span class=p>)</span></code></pre></div>
</div>
<p>
下面错误的用法</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>bad_line_breaking</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;yes&#39;</span> <span class=k>if</span> <span class=n>predicate</span><span class=p>(</span><span class=n>value</span><span class=p>)</span> <span class=k>else</span>
                     <span class=s1>&#39;no&#39;</span><span class=p>)</span>
<span class=n>portion_too_long</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;yes&#39;</span>
                    <span class=k>if</span> <span class=n>some_long_module</span><span class=o>.</span><span class=n>some_long_predicate_function</span><span class=p>(</span>
                        <span class=n>really_long_variable_name</span><span class=p>)</span>
                    <span class=k>else</span> <span class=s1>&#39;no, false, negative, nay&#39;</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-14 class=outline-4>
<h4 id=headline-14>
2.12 Default Argument Values
</h4>
<div id=outline-text-headline-14 class=outline-text-4>
<p>
不要使用可变对象（mutable object）作为函数参数的默认值。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
         <span class=k>if</span> <span class=n>b</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
             <span class=n>b</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>Yes</span><span class=p>:</span> <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Sequence</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
         <span class=k>if</span> <span class=n>b</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
             <span class=n>b</span> <span class=o>=</span> <span class=p>[]</span>
<span class=n>Yes</span><span class=p>:</span> <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>Sequence</span> <span class=o>=</span> <span class=p>()):</span>  <span class=c1># Empty tuple OK since tuples are immutable</span>
         <span class=o>...</span></code></pre></div>
</div>
<p>
可变对象做初始值实际是在方法被 load 的时候就定了，不是调用的时候。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=p>[]):</span>
         <span class=o>...</span>
<span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()):</span>  <span class=c1># The time the module was loaded???</span>
         <span class=o>...</span>
<span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=o>=</span><span class=n>FLAGS</span><span class=o>.</span><span class=n>my_thing</span><span class=p>):</span>  <span class=c1># sys.argv has not yet been parsed...</span>
         <span class=o>...</span>
<span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>Mapping</span> <span class=o>=</span> <span class=p>{}):</span>  <span class=c1># Could still get passed to unchecked code</span>
         <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-15 class=outline-4>
<h4 id=headline-15>
2.13 Properties
</h4>
<div id=outline-text-headline-15 class=outline-text-4>
<p>
使用 <code>@property</code> 装饰器创建属性字段。</p>
</div>
</div>
<div id=outline-container-headline-16 class=outline-4>
<h4 id=headline-16>
2.14 True/False Evaluations
</h4>
<div id=outline-text-headline-16 class=outline-text-4>
<p>
尽量使用隐含的 false 。例如使用 <code>if foo:</code> 而不用 <code>if foo != []:</code> 。</p>
<ul>
<li>
<p>总是使用 <code>if foo is None:</code> 或者 <code>is not None</code> 来检查是否为 None。</p>
</li>
<li>
<p>不要用 <code>==</code> 比较布尔值。使用 <code>if not x</code> ，如果你需要区分 False 和 None，那使用 <code>if not x and x is not None:</code></p>
</li>
<li>
<p>对于序列类型（字符串，列表，元组），使用 <code>if seq:</code> 和 <code>if not seq:</code> 比 <code>if len(seq):</code> 和 <code>if not len(seq)</code> 好。</p>
</li>
<li>
<p>处理整型的时候，隐含的 false 带来的问题比益处多（例如把 None 当作 0）。你应该使用 0 和一个 integer 比较。</p>
</li>
</ul>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>if</span> <span class=ow>not</span> <span class=n>users</span><span class=p>:</span>
         <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;no users&#39;</span><span class=p>)</span>

     <span class=k>if</span> <span class=n>foo</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
         <span class=bp>self</span><span class=o>.</span><span class=n>handle_zero</span><span class=p>()</span>

     <span class=k>if</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>10</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
         <span class=bp>self</span><span class=o>.</span><span class=n>handle_multiple_of_ten</span><span class=p>()</span>

     <span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
         <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
             <span class=n>x</span> <span class=o>=</span> <span class=p>[]</span>

<span class=n>No</span><span class=p>:</span>  <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>users</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
         <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;no users&#39;</span><span class=p>)</span>

     <span class=k>if</span> <span class=n>foo</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>foo</span><span class=p>:</span>
         <span class=bp>self</span><span class=o>.</span><span class=n>handle_zero</span><span class=p>()</span>

     <span class=k>if</span> <span class=ow>not</span> <span class=n>i</span> <span class=o>%</span> <span class=mi>10</span><span class=p>:</span>
         <span class=bp>self</span><span class=o>.</span><span class=n>handle_multiple_of_ten</span><span class=p>()</span>

     <span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
         <span class=n>x</span> <span class=o>=</span> <span class=n>x</span> <span class=ow>or</span> <span class=p>[]</span></code></pre></div>
</div>
<ul>
<li>
<p>注意 '0' （字符串 0）是 true。</p>
</li>
</ul>
</div>
</div>
<div id=outline-container-headline-17 class=outline-4>
<h4 id=headline-17>
2.15 Deprecated Language Features
</h4>
<div id=outline-text-headline-17 class=outline-text-4>
<p>
使用字符串自带的方法，而不用 string 模块。使用函数调用而不是 apply。使用列表生成式和 for 循环代替使用匿名函数的 filte 和 map。使用 for 循环代替 reduce。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>words</span> <span class=o>=</span> <span class=n>foo</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>

     <span class=p>[</span><span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>my_list</span> <span class=k>if</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>5</span><span class=p>]</span>

     <span class=nb>map</span><span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>    <span class=c1># Ok. No inlined lambda expression.</span>

     <span class=n>fn</span><span class=p>(</span><span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span>  <span class=n>words</span> <span class=o>=</span> <span class=n>string</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>foo</span><span class=p>,</span> <span class=s1>&#39;:&#39;</span><span class=p>)</span>

     <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nb>filter</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>5</span><span class=p>,</span> <span class=n>my_list</span><span class=p>))</span>

     <span class=n>apply</span><span class=p>(</span><span class=n>fn</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>kwargs</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-18 class=outline-4>
<h4 id=headline-18>
2.16 Lexical Scoping
</h4>
<div id=outline-text-headline-18 class=outline-text-4>
<ul>
<li>
<p>lexical scoping: 词法作用域，静态作用域</p>
</li>
<li>
<p>dynamic scoping: 动态作用域</p>
</li>
</ul>
<p>python 会创建局部变量，理解清楚的话，一般不会有啥问题。可以用。</p>
</div>
</div>
<div id=outline-container-headline-19 class=outline-4>
<h4 id=headline-19>
2.17 Function and Method Decorators
</h4>
<div id=outline-text-headline-19 class=outline-text-4>
<p>
只在有明确好处的时候使用装饰器。避免使用 @staticmethod ，少用 @classmethod。</p>
<p>
装饰器对函数参数和返回结果有绝对权限，所以可以改变一些隐含的行为。另外，装饰器是在 import 的时候执行的，如果有代码错误可能程序就崩了。</p>
<p>
装饰器的文档应该明确说明这个是装饰器，应该给装饰器写测试用例。</p>
<p>
在装饰器里面避免外部依赖（例如文件，sockets，数据库连接什么的），因为那些在装饰器运行的时候可能不存在（在import 阶段，例如在 pydoc 或者其他工具里面）。装饰器应该要保证在各种情况下都可以成功。</p>
<p>
不要使用 @staticmethod ，除非为了和已有库的 api 定义集成。应该使用模块级别的函数代替。</p>
<p>
只在定义命名构造方法或者类级别的方法都时候使用 @classmethod，例如修改全局状态或者缓存。</p>
</div>
</div>
<div id=outline-container-headline-20 class=outline-4>
<h4 id=headline-20>
2.18 Threading
</h4>
<div id=outline-text-headline-20 class=outline-text-4>
<p>
不要依赖内部自带类型的原子性。</p>
<p>
python 的一些自带类型例如 dict 似乎支持原子操作，但是有些情况下又不原子。也不要依赖变量赋值的原子性。</p>
<p>
使用 Queue 模块的 Queue 类型来作为线程间数据通讯的方法。或者使用 threading 模块和他提供的 locking 方法。学习下如何使用 condition variables ，使用 threading.Condition 代替使用 lower-level locks.</p>
</div>
</div>
<div id=outline-container-headline-21 class=outline-4>
<h4 id=headline-21>
2.19 Power Features
</h4>
<div id=outline-text-headline-21 class=outline-text-4>
<p>
尽量避免使用。</p>
<p>
例如自定义 metaclass，接触 bytecode，on-the-fly 编译，动态继承，等等吧。。。</p>
<p>
标准库里面的模块使用到了没关系，例如 abc.ABCMeta, collections.namedtuple, dataclasses, and enum</p>
</div>
</div>
<div id=outline-container-headline-22 class=outline-4>
<h4 id=headline-22>
2.20 Modern Python: Python 3 and from <span style=text-decoration:underline><span style=text-decoration:underline>future</span></span> imports
</h4>
<div id=outline-text-headline-22 class=outline-text-4>
<p>
应该写兼容 python3 的代码。</p>
</div>
</div>
<div id=outline-container-headline-23 class=outline-4>
<h4 id=headline-23>
2.21 Type Annotated Code
</h4>
<div id=outline-text-headline-23 class=outline-text-4>
<p>
python3 支持 type hint，可以使用 pytype 检查。</p>
<p>
强烈建议更新代码的时候使用 type 支持。</p>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-24 class=outline-3>
<h3 id=headline-24>
3 Python Style Rules
</h3>
<div id=outline-text-headline-24 class=outline-text-3>
<div id=outline-container-headline-25 class=outline-4>
<h4 id=headline-25>
3.1 Semicolons
</h4>
<div id=outline-text-headline-25 class=outline-text-4>
<p>
不要用分号结尾。不要用分号把两行放一行。</p>
</div>
</div>
<div id=outline-container-headline-26 class=outline-4>
<h4 id=headline-26>
3.2 Line length
</h4>
<div id=outline-text-headline-26 class=outline-text-4>
<p>
一行 80 个字符。除非：</p>
<ul>
<li>
<p>长的 import 语句</p>
</li>
<li>
<p>URL，路径，或者注释里面的长标记</p>
</li>
<li>
<p>长的模块级别的常量，不好切的</p>
</li>
<li>
<p>pylint 的 disable 注释</p>
</li>
</ul>
<p>不要使用 \ 切分多行，除非是 with 语句里面有多个 context 管理器。</p>
<p>
有必要的话可以增加多余的括号。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>foo_bar</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;black&#39;</span><span class=p>,</span> <span class=n>design</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>x</span><span class=o>=</span><span class=s1>&#39;foo&#39;</span><span class=p>,</span>
             <span class=n>emphasis</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>highlight</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span>

     <span class=k>if</span> <span class=p>(</span><span class=n>width</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>height</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span>
         <span class=n>color</span> <span class=o>==</span> <span class=s1>&#39;red&#39;</span> <span class=ow>and</span> <span class=n>emphasis</span> <span class=o>==</span> <span class=s1>&#39;strong&#39;</span><span class=p>):</span></code></pre></div>
</div>
<p>
单行字符串太长的话，使用括号切分成多行。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=s1>&#39;This will build a very long long &#39;</span>
     <span class=s1>&#39;long long long long long long string&#39;</span><span class=p>)</span></code></pre></div>
</div>
<p>
注释里面的 url 尽量单独放一行</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>  <span class=c1># See details at</span>
      <span class=c1># http://www.example.com/us/developer/documentation/api/content/v2.0/csv_file_name_extension_full_specification.html</span>

<span class=n>No</span><span class=p>:</span>  <span class=c1># See details at</span>
     <span class=c1># http://www.example.com/us/developer/documentation/api/content/\</span>
     <span class=c1># v2.0/csv_file_name_extension_full_specification.html</span></code></pre></div>
</div>
<p>
with 语句里面可以使用 \ 拆分多行，也可以使用嵌套的 with。注意缩进。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>  <span class=k>with</span> <span class=n>very_long_first_expression_function</span><span class=p>()</span> <span class=k>as</span> <span class=n>spam</span><span class=p>,</span> \
           <span class=n>very_long_second_expression_function</span><span class=p>()</span> <span class=k>as</span> <span class=n>beans</span><span class=p>,</span> \
           <span class=n>third_thing</span><span class=p>()</span> <span class=k>as</span> <span class=n>eggs</span><span class=p>:</span>
          <span class=n>place_order</span><span class=p>(</span><span class=n>eggs</span><span class=p>,</span> <span class=n>beans</span><span class=p>,</span> <span class=n>spam</span><span class=p>,</span> <span class=n>beans</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span>  <span class=k>with</span> <span class=n>VeryLongFirstExpressionFunction</span><span class=p>()</span> <span class=k>as</span> <span class=n>spam</span><span class=p>,</span> \
          <span class=n>VeryLongSecondExpressionFunction</span><span class=p>()</span> <span class=k>as</span> <span class=n>beans</span><span class=p>:</span>
       <span class=n>PlaceOrder</span><span class=p>(</span><span class=n>eggs</span><span class=p>,</span> <span class=n>beans</span><span class=p>,</span> <span class=n>spam</span><span class=p>,</span> <span class=n>beans</span><span class=p>)</span>

<span class=n>Yes</span><span class=p>:</span>  <span class=k>with</span> <span class=n>very_long_first_expression_function</span><span class=p>()</span> <span class=k>as</span> <span class=n>spam</span><span class=p>:</span>
          <span class=k>with</span> <span class=n>very_long_second_expression_function</span><span class=p>()</span> <span class=k>as</span> <span class=n>beans</span><span class=p>:</span>
              <span class=n>place_order</span><span class=p>(</span><span class=n>beans</span><span class=p>,</span> <span class=n>spam</span><span class=p>)</span></code></pre></div>
</div>
<p>
如果还有其他超过 80 字符的情况，并且 yapf 工具也不能处理的话，可以容忍。</p>
</div>
</div>
<div id=outline-container-headline-27 class=outline-4>
<h4 id=headline-27>
3.3 Parentheses
</h4>
<div id=outline-text-headline-27 class=outline-text-4>
<p>
尽量少用括号。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>if</span> <span class=n>foo</span><span class=p>:</span>
         <span class=n>bar</span><span class=p>()</span>
     <span class=k>while</span> <span class=n>x</span><span class=p>:</span>
         <span class=n>x</span> <span class=o>=</span> <span class=n>bar</span><span class=p>()</span>
     <span class=k>if</span> <span class=n>x</span> <span class=ow>and</span> <span class=n>y</span><span class=p>:</span>
         <span class=n>bar</span><span class=p>()</span>
     <span class=k>if</span> <span class=ow>not</span> <span class=n>x</span><span class=p>:</span>
         <span class=n>bar</span><span class=p>()</span>
     <span class=c1># 只有一个元素的元组使用 () 比只有一个逗号清晰</span>
     <span class=n>onesie</span> <span class=o>=</span> <span class=p>(</span><span class=n>foo</span><span class=p>,)</span>
     <span class=k>return</span> <span class=n>foo</span>
     <span class=k>return</span> <span class=n>spam</span><span class=p>,</span> <span class=n>beans</span>
     <span class=k>return</span> <span class=p>(</span><span class=n>spam</span><span class=p>,</span> <span class=n>beans</span><span class=p>)</span>
     <span class=k>for</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>dict</span><span class=o>.</span><span class=n>items</span><span class=p>():</span> <span class=o>...</span>

<span class=n>No</span><span class=p>:</span>  <span class=k>if</span> <span class=p>(</span><span class=n>x</span><span class=p>):</span>
         <span class=n>bar</span><span class=p>()</span>
     <span class=k>if</span> <span class=ow>not</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
         <span class=n>bar</span><span class=p>()</span>
     <span class=k>return</span> <span class=p>(</span><span class=n>foo</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-28 class=outline-4>
<h4 id=headline-28>
3.4 Indentation
</h4>
<div id=outline-text-headline-28 class=outline-text-4>
<p>
使用 4 个空格缩进。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>   <span class=c1># 和开始的括号对齐</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=n>long_function_name</span><span class=p>(</span><span class=n>var_one</span><span class=p>,</span> <span class=n>var_two</span><span class=p>,</span>
                                <span class=n>var_three</span><span class=p>,</span> <span class=n>var_four</span><span class=p>)</span>
       <span class=n>meal</span> <span class=o>=</span> <span class=p>(</span><span class=n>spam</span><span class=p>,</span>
               <span class=n>beans</span><span class=p>)</span>

       <span class=c1># 和字典的开始括号对齐</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=p>{</span>
           <span class=n>long_dictionary_key</span><span class=p>:</span> <span class=n>value1</span> <span class=o>+</span>
                                <span class=n>value2</span><span class=p>,</span>
           <span class=o>...</span>
       <span class=p>}</span>

       <span class=c1># 4个空格的悬挂缩进；第一行什么都不放</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=n>long_function_name</span><span class=p>(</span>
           <span class=n>var_one</span><span class=p>,</span> <span class=n>var_two</span><span class=p>,</span> <span class=n>var_three</span><span class=p>,</span>
           <span class=n>var_four</span><span class=p>)</span>
       <span class=n>meal</span> <span class=o>=</span> <span class=p>(</span>
           <span class=n>spam</span><span class=p>,</span>
           <span class=n>beans</span><span class=p>)</span>

       <span class=c1># 字典里面的 4 空格悬挂缩进</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=p>{</span>
           <span class=n>long_dictionary_key</span><span class=p>:</span>
               <span class=n>long_dictionary_value</span><span class=p>,</span>
           <span class=o>...</span>
       <span class=p>}</span>

<span class=n>No</span><span class=p>:</span>    <span class=c1># 看不清第一行的内容了</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=n>long_function_name</span><span class=p>(</span><span class=n>var_one</span><span class=p>,</span> <span class=n>var_two</span><span class=p>,</span>
           <span class=n>var_three</span><span class=p>,</span> <span class=n>var_four</span><span class=p>)</span>
       <span class=n>meal</span> <span class=o>=</span> <span class=p>(</span><span class=n>spam</span><span class=p>,</span>
           <span class=n>beans</span><span class=p>)</span>

       <span class=c1># 2 空格缩进</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=n>long_function_name</span><span class=p>(</span>
         <span class=n>var_one</span><span class=p>,</span> <span class=n>var_two</span><span class=p>,</span> <span class=n>var_three</span><span class=p>,</span>
         <span class=n>var_four</span><span class=p>)</span>

       <span class=c1># 字典里面没有悬挂缩进</span>
       <span class=n>foo</span> <span class=o>=</span> <span class=p>{</span>
           <span class=n>long_dictionary_key</span><span class=p>:</span>
           <span class=n>long_dictionary_value</span><span class=p>,</span>
           <span class=o>...</span>
       <span class=p>}</span></code></pre></div>
</div>
<div id=outline-container-headline-29 class=outline-5>
<h5 id=headline-29>
3.4.1 Trailing commas in sequences of items?
</h5>
<div id=outline-text-headline-29 class=outline-text-5>
<p>
结尾的逗号只有在 ],},) 和最后的元素不在同一行的时候使用。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>   <span class=n>golomb3</span> <span class=o>=</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
<span class=n>Yes</span><span class=p>:</span>   <span class=n>golomb4</span> <span class=o>=</span> <span class=p>[</span>
           <span class=mi>0</span><span class=p>,</span>
           <span class=mi>1</span><span class=p>,</span>
           <span class=mi>4</span><span class=p>,</span>
           <span class=mi>6</span><span class=p>,</span>
       <span class=p>]</span>

<span class=n>No</span><span class=p>:</span>    <span class=n>golomb4</span> <span class=o>=</span> <span class=p>[</span>
           <span class=mi>0</span><span class=p>,</span>
           <span class=mi>1</span><span class=p>,</span>
           <span class=mi>4</span><span class=p>,</span>
           <span class=mi>6</span>
       <span class=p>]</span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-30 class=outline-4>
<h4 id=headline-30>
3.5 Blank Lines
</h4>
<div id=outline-text-headline-30 class=outline-text-4>
<p>
顶级定义间两个空行。方法之间，class 和第一个方法之前使用一个空行。def 行之后不要有空行。适当的在方法和函数里面使用一个空行。</p>
</div>
</div>
<div id=outline-container-headline-31 class=outline-4>
<h4 id=headline-31>
3.6 Whitespace
</h4>
<div id=outline-text-headline-31 class=outline-text-4>
<p>
在括号里面，括号和内容间不要有空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>spam</span><span class=p>(</span><span class=n>ham</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=p>{</span><span class=n>eggs</span><span class=p>:</span> <span class=mi>2</span><span class=p>},</span> <span class=p>[])</span>

<span class=n>No</span><span class=p>:</span>  <span class=n>spam</span><span class=p>(</span> <span class=n>ham</span><span class=p>[</span> <span class=mi>1</span> <span class=p>],</span> <span class=p>{</span> <span class=n>eggs</span><span class=p>:</span> <span class=mi>2</span> <span class=p>},</span> <span class=p>[</span> <span class=p>]</span> <span class=p>)</span></code></pre></div>
</div>
<p>
逗号，分号，冒号前不要加空格，除了行尾，后面需要加空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
         <span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
     <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>y</span><span class=p>,</span> <span class=n>x</span>

<span class=n>No</span><span class=p>:</span>  <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>4</span> <span class=p>:</span>
         <span class=nb>print</span><span class=p>(</span><span class=n>x</span> <span class=p>,</span> <span class=n>y</span><span class=p>)</span>
     <span class=n>x</span> <span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>y</span> <span class=p>,</span> <span class=n>x</span></code></pre></div>
</div>
<p>
参数列表，索引，切片的左括号前面不加空格</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>spam</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span>  <span class=n>spam</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>

<span class=n>Yes</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span><span class=p>[</span><span class=n>index</span><span class=p>]</span>

<span class=n>No</span><span class=p>:</span>  <span class=nb>dict</span> <span class=p>[</span><span class=s1>&#39;key&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nb>list</span> <span class=p>[</span><span class=n>index</span><span class=p>]</span></code></pre></div>
</div>
<p>
行尾不加多余的空格。操作符两边加空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>1</span>

<span class=n>No</span><span class=p>:</span>  <span class=n>x</span><span class=o>&lt;</span><span class=mi>1</span></code></pre></div>
</div>
<p>
传参数或者函数默认值的 = 左右不加空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>def</span> <span class=nf>complex</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span><span class=o>=</span><span class=mf>0.0</span><span class=p>):</span> <span class=k>return</span> <span class=n>Magic</span><span class=p>(</span><span class=n>r</span><span class=o>=</span><span class=n>real</span><span class=p>,</span> <span class=n>i</span><span class=o>=</span><span class=n>imag</span><span class=p>)</span>
<span class=n>Yes</span><span class=p>:</span> <span class=k>def</span> <span class=nf>complex</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>):</span> <span class=k>return</span> <span class=n>Magic</span><span class=p>(</span><span class=n>r</span><span class=o>=</span><span class=n>real</span><span class=p>,</span> <span class=n>i</span><span class=o>=</span><span class=n>imag</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>complex</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>):</span> <span class=k>return</span> <span class=n>Magic</span><span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=n>real</span><span class=p>,</span> <span class=n>i</span> <span class=o>=</span> <span class=n>imag</span><span class=p>)</span>
<span class=n>No</span><span class=p>:</span>  <span class=k>def</span> <span class=nf>complex</span><span class=p>(</span><span class=n>real</span><span class=p>,</span> <span class=n>imag</span><span class=p>:</span> <span class=nb>float</span><span class=o>=</span><span class=mf>0.0</span><span class=p>):</span> <span class=k>return</span> <span class=n>Magic</span><span class=p>(</span><span class=n>r</span> <span class=o>=</span> <span class=n>real</span><span class=p>,</span> <span class=n>i</span> <span class=o>=</span> <span class=n>imag</span><span class=p>)</span></code></pre></div>
</div>
<p>
不要使用空格做竖列对齐，这个维护起来容易成负担。有一些工具或者 ide 可以自动做这个事情，但是确实对不使用这些工具的人是个负担。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
  <span class=n>foo</span> <span class=o>=</span> <span class=mi>1000</span>  <span class=c1># comment</span>
  <span class=n>long_name</span> <span class=o>=</span> <span class=mi>2</span>  <span class=c1># comment that should not be aligned</span>

  <span class=n>dictionary</span> <span class=o>=</span> <span class=p>{</span>
      <span class=s1>&#39;foo&#39;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
      <span class=s1>&#39;long_name&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
  <span class=p>}</span>

<span class=n>No</span><span class=p>:</span>
  <span class=n>foo</span>       <span class=o>=</span> <span class=mi>1000</span>  <span class=c1># comment</span>
  <span class=n>long_name</span> <span class=o>=</span> <span class=mi>2</span>     <span class=c1># comment that should not be aligned</span>

  <span class=n>dictionary</span> <span class=o>=</span> <span class=p>{</span>
      <span class=s1>&#39;foo&#39;</span>      <span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
      <span class=s1>&#39;long_name&#39;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
  <span class=p>}</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-32 class=outline-4>
<h4 id=headline-32>
3.7 Shebang Line
</h4>
<div id=outline-text-headline-32 class=outline-text-4>
<p>
大部分 .py 文件都不需要 #! 这行。主文件可以使用 <code>#!/usr/bin/python</code> 加 2 或者 3 结尾。</p>
<p>
这个只有直接运行的主程序有用，对于 import 的模块没用。</p>
</div>
</div>
<div id=outline-container-headline-33 class=outline-4>
<h4 id=headline-33>
3.8 Comments and Docstrings
</h4>
<div id=outline-text-headline-33 class=outline-text-4>
<p>
确保针对模块，函数，方法使用了正确的文档字符串和行内的注释。</p>
<div id=outline-container-headline-34 class=outline-5>
<h5 id=headline-34>
3.8.1 Docstrings
</h5>
<div id=outline-text-headline-34 class=outline-text-5>
<p>
总是使用 """ 格式的文档字符串。</p>
</div>
</div>
<div id=outline-container-headline-35 class=outline-5>
<h5 id=headline-35>
3.8.2 Modules
</h5>
<div id=outline-text-headline-35 class=outline-text-5>
<p>
每个文件都有 lincense 声明，文件开头说明下模块内容和示例。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=s2>&#34;&#34;&#34;用一行简介模块或者程序功能
</span><span class=s2>
</span><span class=s2>留一个空行。后面说明模块的说明，可以加例子。
</span><span class=s2>
</span><span class=s2>  Typical usage example:
</span><span class=s2>
</span><span class=s2>  foo = ClassFoo()
</span><span class=s2>  bar = foo.FunctionBar()
</span><span class=s2>&#34;&#34;&#34;</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-36 class=outline-5>
<h5 id=headline-36>
3.8.3 Functions and Methods
</h5>
<div id=outline-text-headline-36 class=outline-text-5>
<p>
主要需要说明参数，返回值，异常。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>fetch_bigtable_rows</span><span class=p>(</span><span class=n>big_table</span><span class=p>,</span> <span class=n>keys</span><span class=p>,</span> <span class=n>other_silly_variable</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;Fetches rows from a Bigtable.
</span><span class=s2>
</span><span class=s2>    Retrieves rows pertaining to the given keys from the Table instance
</span><span class=s2>    represented by big_table.  Silly things may happen if
</span><span class=s2>    other_silly_variable is not None.
</span><span class=s2>
</span><span class=s2>    Args:
</span><span class=s2>        big_table: An open Bigtable Table instance.
</span><span class=s2>        keys: A sequence of strings representing the key of each table row
</span><span class=s2>            to fetch.
</span><span class=s2>        other_silly_variable: Another optional variable, that has a much
</span><span class=s2>            longer name than the other args, and which does nothing.
</span><span class=s2>
</span><span class=s2>    Returns:
</span><span class=s2>        A dict mapping keys to the corresponding table row data
</span><span class=s2>        fetched. Each row is represented as a tuple of strings. For
</span><span class=s2>        example:
</span><span class=s2>
</span><span class=s2>        {&#39;Serak&#39;: (&#39;Rigel VII&#39;, &#39;Preparer&#39;),
</span><span class=s2>         &#39;Zim&#39;: (&#39;Irk&#39;, &#39;Invader&#39;),
</span><span class=s2>         &#39;Lrrr&#39;: (&#39;Omicron Persei 8&#39;, &#39;Emperor&#39;)}
</span><span class=s2>
</span><span class=s2>        If a key from the keys argument is missing from the dictionary,
</span><span class=s2>        then that row was not found in the table.
</span><span class=s2>
</span><span class=s2>    Raises:
</span><span class=s2>        IOError: An error occurred accessing the bigtable.Table object.
</span><span class=s2>    &#34;&#34;&#34;</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-37 class=outline-5>
<h5 id=headline-37>
3.8.4 Classes
</h5>
<div id=outline-text-headline-37 class=outline-text-5>
<p>
如果有公共属性，需要说明下。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>SampleClass</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
    <span class=s2>&#34;&#34;&#34;Summary of class here.
</span><span class=s2>
</span><span class=s2>    Longer class information....
</span><span class=s2>    Longer class information....
</span><span class=s2>
</span><span class=s2>    Attributes:
</span><span class=s2>        likes_spam: A boolean indicating if we like SPAM or not.
</span><span class=s2>        eggs: An integer count of the eggs we have laid.
</span><span class=s2>    &#34;&#34;&#34;</span>

    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>likes_spam</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;Inits SampleClass with blah.&#34;&#34;&#34;</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>likes_spam</span> <span class=o>=</span> <span class=n>likes_spam</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>eggs</span> <span class=o>=</span> <span class=mi>0</span>

    <span class=k>def</span> <span class=nf>public_method</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
        <span class=s2>&#34;&#34;&#34;Performs operation blah.&#34;&#34;&#34;</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-38 class=outline-5>
<h5 id=headline-38>
3.8.5 Block and Inline Comments
</h5>
<div id=outline-text-headline-38 class=outline-text-5>
<p>
对于代码里面逻辑复杂或者难理解的地方，如果需要在 code review 的时候解释说明，那最好直接写到代码里面。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># We use a weighted dictionary search to find out where i is in</span>
<span class=c1># the array.  We extrapolate position based on the largest num</span>
<span class=c1># in the array and the array size and then do binary search to</span>
<span class=c1># get the exact number.</span>

<span class=k>if</span> <span class=n>i</span> <span class=o>&amp;</span> <span class=p>(</span><span class=n>i</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>  <span class=c1># True if i is 0 or a power of 2.</span></code></pre></div>
</div>
<p>
inline 的注释应该在 # 前留两个空格。另外，注释里面不要去直接解释代码，这个没啥意义。</p>
</div>
</div>
<div id=outline-container-headline-39 class=outline-5>
<h5 id=headline-39>
3.8.6 Punctuation, Spelling, and Grammar
</h5>
<div id=outline-text-headline-39 class=outline-text-5>
<p>
应该是说注意语法啥的，代码的质量也包括注释的质量。</p>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-40 class=outline-4>
<h4 id=headline-40>
3.9 Classes
</h4>
<div id=outline-text-headline-40 class=outline-text-4>
<p>
如果一个类没有明显的基类，那就继承 object。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=k>class</span> <span class=nc>SampleClass</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
         <span class=k>pass</span>


     <span class=k>class</span> <span class=nc>OuterClass</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>

         <span class=k>class</span> <span class=nc>InnerClass</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
             <span class=k>pass</span>


     <span class=k>class</span> <span class=nc>ChildClass</span><span class=p>(</span><span class=n>ParentClass</span><span class=p>):</span>
         <span class=s2>&#34;&#34;&#34;Explicitly inherits from another class already.&#34;&#34;&#34;</span>

<span class=n>No</span><span class=p>:</span> <span class=k>class</span> <span class=nc>SampleClass</span><span class=p>:</span>
        <span class=k>pass</span>


    <span class=k>class</span> <span class=nc>OuterClass</span><span class=p>:</span>

        <span class=k>class</span> <span class=nc>InnerClass</span><span class=p>:</span>
            <span class=k>pass</span></code></pre></div>
</div>
<p>
更好的兼容性。还帮忙定义了一些 __ 开头的方法。</p>
</div>
</div>
<div id=outline-container-headline-41 class=outline-4>
<h4 id=headline-41>
3.10 Strings
</h4>
<div id=outline-text-headline-41 class=outline-text-4>
<p>
使用 format 或者 % 格式化字符串。python 3.6 还支持了 f-string。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>x</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span>
     <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s</span><span class=s1>, </span><span class=si>%s</span><span class=s1>!&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>imperative</span><span class=p>,</span> <span class=n>expletive</span><span class=p>)</span>
     <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>{}</span><span class=s1>, </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>first</span><span class=p>,</span> <span class=n>second</span><span class=p>)</span>
     <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;name: </span><span class=si>%s</span><span class=s1>; score: </span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
     <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;name: </span><span class=si>{}</span><span class=s1>; score: </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
     <span class=n>x</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;name: </span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s1>; score: </span><span class=si>{</span><span class=n>n</span><span class=si>}</span><span class=s1>&#39;</span>  <span class=c1># Python 3.6+</span>

<span class=n>No</span><span class=p>:</span> <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>%s%s</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>  <span class=c1># use + in this case</span>
    <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>{}{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>  <span class=c1># use + in this case</span>
    <span class=n>x</span> <span class=o>=</span> <span class=n>first</span> <span class=o>+</span> <span class=s1>&#39;, &#39;</span> <span class=o>+</span> <span class=n>second</span>
    <span class=n>x</span> <span class=o>=</span> <span class=s1>&#39;name: &#39;</span> <span class=o>+</span> <span class=n>name</span> <span class=o>+</span> <span class=s1>&#39;; score: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>n</span><span class=p>)</span></code></pre></div>
</div>
<p>
避免在循环里面使用 + 和 += 操作符连接字符串。因为 string 是 immutable ，这样会创建很多临时对象。可以使用个 list 然后 ''.join(list) 这样，或者使用 io.BytesIO。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=n>items</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;&lt;table&gt;&#39;</span><span class=p>]</span>
     <span class=k>for</span> <span class=n>last_name</span><span class=p>,</span> <span class=n>first_name</span> <span class=ow>in</span> <span class=n>employee_list</span><span class=p>:</span>
         <span class=n>items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;&lt;tr&gt;&lt;td&gt;</span><span class=si>%s</span><span class=s1>, </span><span class=si>%s</span><span class=s1>&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>last_name</span><span class=p>,</span> <span class=n>first_name</span><span class=p>))</span>
     <span class=n>items</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s1>&#39;&lt;/table&gt;&#39;</span><span class=p>)</span>
     <span class=n>employee_table</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>items</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span> <span class=n>employee_table</span> <span class=o>=</span> <span class=s1>&#39;&lt;table&gt;&#39;</span>
    <span class=k>for</span> <span class=n>last_name</span><span class=p>,</span> <span class=n>first_name</span> <span class=ow>in</span> <span class=n>employee_list</span><span class=p>:</span>
        <span class=n>employee_table</span> <span class=o>+=</span> <span class=s1>&#39;&lt;tr&gt;&lt;td&gt;</span><span class=si>%s</span><span class=s1>, </span><span class=si>%s</span><span class=s1>&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class=o>%</span> <span class=p>(</span><span class=n>last_name</span><span class=p>,</span> <span class=n>first_name</span><span class=p>)</span>
    <span class=n>employee_table</span> <span class=o>+=</span> <span class=s1>&#39;&lt;/table&gt;&#39;</span></code></pre></div>
</div>
<p>
灵活使用 ' 和 " ，避免使用 \\ 转义。多行字符串使用 """ ，不用 ''' 。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python>  <span class=n>No</span><span class=p>:</span>
  <span class=n>long_string</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;This is pretty ugly.
</span><span class=s2>Don&#39;t do this.
</span><span class=s2>&#34;&#34;&#34;</span>

  <span class=n>Yes</span><span class=p>:</span>
  <span class=n>long_string</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;This is fine if your use case can accept
</span><span class=s2>      extraneous leading spaces.&#34;&#34;&#34;</span>

  <span class=n>Yes</span><span class=p>:</span>
  <span class=n>long_string</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;And this is fine if you can not accept</span><span class=se>\n</span><span class=s2>&#34;</span> <span class=o>+</span>
                 <span class=s2>&#34;extraneous leading spaces.&#34;</span><span class=p>)</span>

  <span class=n>Yes</span><span class=p>:</span>
  <span class=n>long_string</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;And this too is fine if you can not accept</span><span class=se>\n</span><span class=s2>&#34;</span>
                 <span class=s2>&#34;extraneous leading spaces.&#34;</span><span class=p>)</span>

  <span class=n>Yes</span><span class=p>:</span>
  <span class=kn>import</span> <span class=nn>textwrap</span>

  <span class=n>long_string</span> <span class=o>=</span> <span class=n>textwrap</span><span class=o>.</span><span class=n>dedent</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;</span><span class=se>\
</span><span class=se></span><span class=s2>      This is also fine, because textwrap.dedent()
</span><span class=s2>      will collapse common leading spaces in each line.&#34;&#34;&#34;</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-42 class=outline-4>
<h4 id=headline-42>
3.11 Files and Sockets
</h4>
<div id=outline-text-headline-42 class=outline-text-4>
<p>
使用完 file 和 sockets 之后显式的关闭。要不然</p>
<ul>
<li>
<p>会消耗文件描述符。</p>
</li>
<li>
<p>会导致其他操作例如移动删除什么的失败。</p>
</li>
<li>
<p>及时关闭可以更容易发现一些不恰当的使用，有问题会早暴露。</p>
</li>
</ul>
<p>当文件或者sockets 对象被销毁的时候会自动关闭，但是依赖这个特性是个不好的习惯</p>
<ul>
<li>
<p>python 不同版本的垃圾回收策略会不一样，也没保证啥时候会关闭。</p>
</li>
<li>
<p>一些意料之外的文件引用，比如全局变量，异常堆栈里面的引用什么的，可能会导致存活时间变长。</p>
</li>
</ul>
<p>使用 with 语句来打开文件</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;hello.txt&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>hello_file</span><span class=p>:</span>
    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>hello_file</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span></code></pre></div>
</div>
<p>
文件类型的对象，但是还不支持 with 语句的，可以使用 contextlib.closing()</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>contextlib</span>

<span class=k>with</span> <span class=n>contextlib</span><span class=o>.</span><span class=n>closing</span><span class=p>(</span><span class=n>urllib</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=s2>&#34;http://www.python.org/&#34;</span><span class=p>))</span> <span class=k>as</span> <span class=n>front_page</span><span class=p>:</span>
    <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>front_page</span><span class=p>:</span>
        <span class=nb>print</span><span class=p>(</span><span class=n>line</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-43 class=outline-4>
<h4 id=headline-43>
3.12 TODO Comments
</h4>
<div id=outline-text-headline-43 class=outline-text-4>
<p>
注释里面使用 TODO 来标记临时的一些处理，或者一些有待改进的处理。</p>
<p>
TODO 使用 TODO 开头，后面括号里面使用邮件或者名字标记是谁加的，然后跟着是 todo 内容。</p>
<p>
这个格式要求是为了将来方便搜索。TODO 并不表示以后也需要这个人去修复这个问题。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># TODO(kl@gmail.com): Use a &#34;*&#34; here for string repetition.</span>
<span class=c1># TODO(Zeke) Change this to use relations.</span></code></pre></div>
</div>
<p>
如果一个 TODO 是为了标记将来做什么，那最好把时间 (“Fix by November 2009”) 或者触发的事件 (“Remove this code when all clients can handle XML responses.”) 也加上。</p>
</div>
</div>
<div id=outline-container-headline-44 class=outline-4>
<h4 id=headline-44>
3.13 Imports formatting
</h4>
<div id=outline-text-headline-44 class=outline-text-4>
<p>
一个模块一行</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span> <span class=kn>import</span> <span class=nn>os</span>
     <span class=kn>import</span> <span class=nn>sys</span>

<span class=n>No</span><span class=p>:</span>  <span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>sys</span></code></pre></div>
</div>
<p>
import 都写在文件顶部，在模块的文档字符串之后，在模块的全局变量和常量之前。按照最通用到最不通用排序。</p>
<ol>
<li>
<p>future import 语句来打开文件</p>
</li>
</ol>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>absolute_import</span>
<span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>division</span>
<span class=kn>from</span> <span class=nn>__future__</span> <span class=kn>import</span> <span class=n>print_function</span></code></pre></div>
</div>
<ol>
<li>
<p>python 标准库</p>
</li>
</ol>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>sys</span></code></pre></div>
</div>
<ol>
<li>
<p>第三方库</p>
</li>
</ol>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span></code></pre></div>
</div>
<ol>
<li>
<p>代码库子模块</p>
</li>
</ol>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>otherproject.ai</span> <span class=kn>import</span> <span class=n>mind</span></code></pre></div>
</div>
<ol>
<li>
<p>程序自己的子模块(已经废弃)。新的处理方式是和 4 一样处理就行。</p>
</li>
</ol>
<p>使用词典序，忽略大小写，基于模块包的全称。在不同块之前增加一个空行。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>import</span> <span class=nn>collections</span>
<span class=kn>import</span> <span class=nn>queue</span>
<span class=kn>import</span> <span class=nn>sys</span>

<span class=kn>from</span> <span class=nn>absl</span> <span class=kn>import</span> <span class=n>app</span>
<span class=kn>from</span> <span class=nn>absl</span> <span class=kn>import</span> <span class=n>flags</span>
<span class=kn>import</span> <span class=nn>bs4</span>
<span class=kn>import</span> <span class=nn>cryptography</span>
<span class=kn>import</span> <span class=nn>tensorflow</span> <span class=k>as</span> <span class=nn>tf</span>

<span class=kn>from</span> <span class=nn>book.genres</span> <span class=kn>import</span> <span class=n>scifi</span>
<span class=kn>from</span> <span class=nn>myproject.backend.hgwells</span> <span class=kn>import</span> <span class=n>time_machine</span>
<span class=kn>from</span> <span class=nn>myproject.backend.state_machine</span> <span class=kn>import</span> <span class=n>main_loop</span>
<span class=kn>from</span> <span class=nn>otherproject.ai</span> <span class=kn>import</span> <span class=n>body</span>
<span class=kn>from</span> <span class=nn>otherproject.ai</span> <span class=kn>import</span> <span class=n>mind</span>
<span class=kn>from</span> <span class=nn>otherproject.ai</span> <span class=kn>import</span> <span class=n>soul</span>

<span class=c1># Older style code may have these imports down here instead:</span>
<span class=c1>#from myproject.backend.hgwells import time_machine</span>
<span class=c1>#from myproject.backend.state_machine import main_loop</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-45 class=outline-4>
<h4 id=headline-45>
3.14 Statements
</h4>
<div id=outline-text-headline-45 class=outline-text-4>
<p>
通常一行一句。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>

  <span class=k>if</span> <span class=n>foo</span><span class=p>:</span> <span class=n>bar</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>

<span class=n>No</span><span class=p>:</span>

  <span class=k>if</span> <span class=n>foo</span><span class=p>:</span> <span class=n>bar</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>
  <span class=k>else</span><span class=p>:</span>   <span class=n>baz</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>

  <span class=k>try</span><span class=p>:</span>               <span class=n>bar</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>
  <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span> <span class=n>baz</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>

  <span class=k>try</span><span class=p>:</span>
      <span class=n>bar</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span>
  <span class=k>except</span> <span class=ne>ValueError</span><span class=p>:</span> <span class=n>baz</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-46 class=outline-4>
<h4 id=headline-46>
3.15 Accessors
</h4>
<div id=outline-text-headline-46 class=outline-text-4>
<p>
如果比较简单，可以使用公共属性，而不用 geter/seter，毕竟没必要多一次函数调用。稍微复杂点的可以使用 @property。</p>
<p>
对于复杂的，可以使用 get_foo() 和 set_foo() 这样的函数调用。如果以前允许通过属性访问，不要把新的函数直接绑定过去。这样依然用原来的方法的那些代码就会报错，可以让他们意识到新的逻辑的复杂程度。</p>
</div>
</div>
<div id=outline-container-headline-47 class=outline-4>
<h4 id=headline-47>
3.16 Naming
</h4>
<div id=outline-text-headline-47 class=outline-text-4>
<p>
module_name, package_name, ClassName, method_name, ExceptionName, function_name, GLOBAL_CONSTANT_NAME, global_var_name, instance_var_name, function_parameter_name, local_var_name</p>
<p>
函数名，变量名，文件名应该自说明，避免使用缩写。特别的，不用有歧义的或者项目外的人不熟悉的词，不要通过删除单词里面的字母来产生缩写。</p>
<p>
总是使用 .py 扩展名。</p>
<div id=outline-container-headline-48 class=outline-5>
<h5 id=headline-48>
3.16.1 Names to Avoid
</h5>
<div id=outline-text-headline-48 class=outline-text-5>
<ul>
<li>
<p>单字母名字，除非是计数器或者迭代器之类。也可以在 tye/except 语句里面使用 e 表示异常。</p>
</li>
<li>
<p>包/模块名里面使用 -</p>
</li>
<li>
<p>__ 开头并且和结尾的名字，这个是 python 自己会用的。</p>
</li>
</ul>
</div>
</div>
<div id=outline-container-headline-49 class=outline-5>
<h5 id=headline-49>
3.16.2 Naming Conventions
</h5>
<div id=outline-text-headline-49 class=outline-text-5>
<ul>
<li>
<p>"internal" 的意思是模块的内部，或者类内部的被保护或者私有属性</p>
</li>
<li>
<p>使用 _ 保护模块变量或者函数（不会被 from module import * 导入）. 使用 __ 可以让一个实例变量或者方法可以让他们变成类的私有属性，但是不鼓励这么做，这个会带来阅读困难，也不好测试，并且还不是真的私有。</p>
</li>
<li>
<p>可以把其他相关的类放到一个模块的顶部，不用限制一个模块只有一个类，和 java 不一样。</p>
</li>
<li>
<p>类名字使用首字母大写，模块名字使用小写下划线。</p>
</li>
<li>
<p>测试用例里面的方法使用 test 开头。test&lt;MethodUnderTest>_&lt;state> 例如 testPop_EmptyStack，这样也行，毕竟没有什么更好的办法。</p>
</li>
</ul>
</div>
</div>
<div id=outline-container-headline-50 class=outline-5>
<h5 id=headline-50>
3.16.3 File Naming
</h5>
<div id=outline-text-headline-50 class=outline-text-5>
<p>
必须是 .py 结尾，不能包含 - 。如果你想要一个文件没有扩展名，那可以建一个软连接或者写个 bash 文件包含 exec "$0.py" "$@"。</p>
</div>
</div>
<div id=outline-container-headline-51 class=outline-5>
<h5 id=headline-51>
3.16.4 Guidelines derived from Guido’s Recommendations
</h5>
<div id=outline-text-headline-51 class=outline-text-5>
<table>
<thead>
<tr>
<th>Type</th>
<th>Public</th>
<th>Internal</th>
</tr>
</thead>
<tbody>
<tr>
<td>Packages</td>
<td>lower_with_under</td>
<td></td>
</tr>
<tr>
<td>Modules</td>
<td>lower_with_under</td>
<td>_lower_with_under</td>
</tr>
<tr>
<td>Classes</td>
<td>CapWords</td>
<td>_CapWords</td>
</tr>
<tr>
<td>Exceptions</td>
<td>CapWords</td>
<td></td>
</tr>
<tr>
<td>Functions</td>
<td>lower_with_under()</td>
<td>_lower_with_under()</td>
</tr>
<tr>
<td>Global/Class Constants</td>
<td>CAPS_WITH_UNDER</td>
<td>_CAPS_WITH_UNDER</td>
</tr>
<tr>
<td>Global/Class Variables</td>
<td>lower_with_under</td>
<td>_lower_with_under</td>
</tr>
<tr>
<td>Instance Variables</td>
<td>lower_with_under</td>
<td>_lower_with_under (protected)</td>
</tr>
<tr>
<td>Method Names</td>
<td>lower_with_under()</td>
<td>_lower_with_under() (protected)</td>
</tr>
<tr>
<td>Function/Method Parameters</td>
<td>lower_with_under</td>
<td></td>
</tr>
<tr>
<td>Local Variables</td>
<td>lower_with_under</td>
<td></td>
</tr>
</tbody>
</table>
<p>
不鼓励使用 __ 开头的变量。</p>
</div>
</div>
<div id=outline-container-headline-52 class=outline-5>
<h5 id=headline-52>
3.17 Main
</h5>
<div id=outline-text-headline-52 class=outline-text-5>
<p>
即使一个文件是个可执行的文件，也应该允许被 import，并且 import 不能有副作用，例如直接运行。主要的功能应该在 main() 函数里面。</p>
<p>
pydoc 和单元测试都需要文件是可以被 import 的。程序应该总是检查 <code>__name__</code> 。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
    <span class=o>...</span>

<span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
    <span class=n>main</span><span class=p>()</span></code></pre></div>
</div>
<p>
注意要兼容 pydoc ，顶级的函数调用，创建对象以及其他操作都会在 import 的时候就执行。</p>
</div>
</div>
<div id=outline-container-headline-53 class=outline-5>
<h5 id=headline-53>
3.18 Function length
</h5>
<div id=outline-text-headline-53 class=outline-text-5>
<p>
最好是短小精悍的。这里没有硬性规定，超过 40 行的，看看在不影响程序结构的情况下是不是可以拆分。</p>
<p>
即使长的函数现在看着没啥问题，但是过几个月之后，需要修改或者增加新功能的时候会比较痛苦。</p>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-54 class=outline-4>
<h4 id=headline-54>
3.19 Type Annotations
</h4>
<div id=outline-text-headline-54 class=outline-text-4>
<div id=outline-container-headline-55 class=outline-5>
<h5 id=headline-55>
3.19.1 General Rules
</h5>
<div id=outline-text-headline-55 class=outline-text-5>
<ul>
<li>
<p>仔细看看 PEP-484</p>
</li>
<li>
<p>在一个方法里面，只有在有必要定义的时候才给 self 和 cls 定义类型，例如 <code>@classmethod def create(cls: Type[T]) -> T: return cls()</code></p>
</li>
<li>
<p>如果一些变量或者返回类型不应该明确，使用 any</p>
</li>
<li>
<p>并不需要注解模块里面的所有方法</p>
<ul>
<li>
<p>至少注解公开 API</p>
</li>
<li>
<p>在安全和代码清晰和灵活间取得平衡</p>
</li>
<li>
<p>对出过类型引起的 bug 的地放增加类型注解</p>
</li>
<li>
<p>针对比较难理解的代码增加类型注解</p>
</li>
<li>
<p>针对比较稳定的代码增加类型注解。通常给稳定代码增加注解不会损失灵活性。</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id=outline-container-headline-56 class=outline-5>
<h5 id=headline-56>
3.19.2 Line Breaking
</h5>
<div id=outline-text-headline-56 class=outline-text-5>
<p>
参考前面的缩进的定义。</p>
<p>
增加了类型注解之后，很多函数的签名会变成一个参数一行。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
              <span class=n>first_var</span><span class=p>:</span> <span class=nb>int</span><span class=p>,</span>
              <span class=n>second_var</span><span class=p>:</span> <span class=n>Foo</span><span class=p>,</span>
              <span class=n>third_var</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Bar</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
Always prefer breaking between variables, and not for example between variable names and type annotations. However, if everything fits on the same line, go for it.</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>first_var</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
如果返回函数名参数加返回类型太长，可以另起一行空 4 个空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>first_var</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>MyLongType1</span><span class=p>,</span> <span class=n>MyLongType1</span><span class=p>]:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
更长的情况</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span> <span class=n>other_arg</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>MyLongType</span><span class=p>]</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>OtherLongType</span><span class=p>,</span> <span class=n>MyLongType</span><span class=p>]:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
pylint 允许和括号对齐，但是这样会降低可读性。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>No</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
              <span class=n>other_arg</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>MyLongType</span><span class=p>]</span>
             <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>OtherLongType</span><span class=p>,</span> <span class=n>MyLongType</span><span class=p>]:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
类似上面的例子，尽量不打断类型注解。但是如果太长，也可以换行，保持子类型不被打断。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>first_var</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>MyLongType1</span><span class=p>],</span>
                     <span class=n>List</span><span class=p>[</span><span class=n>MyLongType2</span><span class=p>]],</span>
    <span class=n>second_var</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span>
        <span class=n>MyLongType3</span><span class=p>,</span> <span class=n>MyLongType4</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
If a single name and type is too long, consider using an alias for the type. The last resort is to break after the colon and indent by 4.</p>
<p>
如果一个类型的名字自己本身太长了，考虑定义一个别名。实在没办法，在冒号后面换行。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>my_function</span><span class=p>(</span>
    <span class=n>long_variable_name</span><span class=p>:</span>
        <span class=n>long_module_name</span><span class=o>.</span><span class=n>LongTypeName</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
  <span class=o>...</span>

<span class=n>No</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>my_function</span><span class=p>(</span>
    <span class=n>long_variable_name</span><span class=p>:</span> <span class=n>long_module_name</span><span class=o>.</span>
        <span class=n>LongTypeName</span><span class=p>,</span>
<span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-57 class=outline-5>
<h5 id=headline-57>
3.19.3 Forward Declarations
</h5>
<div id=outline-text-headline-57 class=outline-text-5>
<p>
如果需要一个在模块里面还没有定义的类名，可以使用字符串名字。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>MyClass</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>

  <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
               <span class=n>stack</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=s2>&#34;MyClass&#34;</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-58 class=outline-5>
<h5 id=headline-58>
3.19.4 Default Values
</h5>
<div id=outline-text-headline-58 class=outline-text-5>
<p>
基于 PEP-008，只有在同时有类型注解和默认值的时候 = 前后才会同时有空格。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>func</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
  <span class=o>...</span>

<span class=n>No</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>func</span><span class=p>(</span><span class=n>a</span><span class=p>:</span><span class=nb>int</span><span class=o>=</span><span class=mi>0</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-59 class=outline-5>
<h5 id=headline-59>
3.19.5 NoneType
</h5>
<div id=outline-text-headline-59 class=outline-text-5>
<p>
NoneType 是个 fist class 类型，None 是 NoneType 的别名。如果一个参数可以是 None，那应该声明下。你可以使用 Union，但是如果只有一种其他类型，可以使用 Optional。</p>
<p>
使用明确的 Optional 定义，早先的 PEP-484 允许 <code>a: Text = None</code> 解释为 <code>a: Optional[Text] = None</code> ，但是现在不推荐了。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>Yes</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>func</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Text</span><span class=p>],</span> <span class=n>b</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Text</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Text</span><span class=p>:</span>
  <span class=o>...</span>
<span class=k>def</span> <span class=nf>multiple_nullable_union</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=n>Text</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Text</span>
  <span class=o>...</span>

<span class=n>No</span><span class=p>:</span>
<span class=k>def</span> <span class=nf>nullable_union</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=kc>None</span><span class=p>,</span> <span class=n>Text</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Text</span><span class=p>:</span>
  <span class=o>...</span>
<span class=k>def</span> <span class=nf>implicit_optional</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=n>Text</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Text</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-60 class=outline-5>
<h5 id=headline-60>
3.19.6 Type Aliases
</h5>
<div id=outline-text-headline-60 class=outline-text-5>
<p>
可以给类型建别名，命名应该是大写开头的。如果只在这个模块里面使用，应该使用 _ 开头。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>_ShortName</span> <span class=o>=</span> <span class=n>module_with_long_name</span><span class=o>.</span><span class=n>TypeWithLongName</span>
<span class=n>ComplexMap</span> <span class=o>=</span> <span class=n>Mapping</span><span class=p>[</span><span class=n>Text</span><span class=p>,</span> <span class=n>List</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]]</span></code></pre></div>
</div>
<p>
类似的还有嵌套的类型定义，或者函数返回的多变量。</p>
</div>
</div>
<div id=outline-container-headline-61 class=outline-5>
<h5 id=headline-61>
3.19.7 Ignoring Types
</h5>
<div id=outline-text-headline-61 class=outline-text-5>
<p>
可以使用 <code># type: ignore</code> 注释关闭单行的类型检查。</p>
<p>
pytype 支持关闭特定的类型错误。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=c1># pytype: disable=attribute-error</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-62 class=outline-5>
<h5 id=headline-62>
3.19.8 Typing Variables
</h5>
<div id=outline-text-headline-62 class=outline-text-5>
<p>
如果一个变量很难通过推导得出，那可以在注释或者冒号后面定义类型。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>a</span> <span class=o>=</span> <span class=n>SomeUndecoratedFunction</span><span class=p>()</span>  <span class=c1># type: Foo</span>
<span class=n>a</span><span class=p>:</span> <span class=n>Foo</span> <span class=o>=</span> <span class=n>SomeUndecoratedFunction</span><span class=p>()</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-63 class=outline-5>
<h5 id=headline-63>
3.19.9 Tuples vs Lists
</h5>
<div id=outline-text-headline-63 class=outline-text-5>
<p>
不像 list 只能有一个类型，tuple 可以有多个。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>a</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>  <span class=c1># type: List[int]</span>
<span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>  <span class=c1># type: Tuple[int, ...]</span>
<span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>,</span> <span class=mf>3.5</span><span class=p>)</span>  <span class=c1># type: Tuple[int, Text, float]</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-64 class=outline-5>
<h5 id=headline-64>
3.19.10 TypeVars
</h5>
<div id=outline-text-headline-64 class=outline-text-5>
<p>
python 的 type 支持范型。通过 TypeVar 这个工厂方法使用。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>TypeVar</span>
<span class=n>T</span> <span class=o>=</span> <span class=n>TypeVar</span><span class=p>(</span><span class=s2>&#34;T&#34;</span><span class=p>)</span>
<span class=o>...</span>
<span class=k>def</span> <span class=nf>next</span><span class=p>(</span><span class=n>l</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>T</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>T</span><span class=p>:</span>
  <span class=k>return</span> <span class=n>l</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span></code></pre></div>
</div>
<p>
可以给 TypeVar 增加限制条件</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=n>AddableType</span> <span class=o>=</span> <span class=n>TypeVar</span><span class=p>(</span><span class=s2>&#34;AddableType&#34;</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>float</span><span class=p>,</span> <span class=n>Text</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>a</span><span class=p>:</span> <span class=n>AddableType</span><span class=p>,</span> <span class=n>b</span><span class=p>:</span> <span class=n>AddableType</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AddableType</span><span class=p>:</span>
  <span class=k>return</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span></code></pre></div>
</div>
<p>
有个比较常用的类型是 AnyStr，用它来表示 bytes 或者 unicode 。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>AnyStr</span>
<span class=k>def</span> <span class=nf>check_length</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=n>AnyStr</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AnyStr</span><span class=p>:</span>
  <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>42</span><span class=p>:</span>
    <span class=k>return</span> <span class=n>x</span>
  <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>()</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-65 class=outline-5>
<h5 id=headline-65>
3.19.11 String types
</h5>
<div id=outline-text-headline-65 class=outline-text-5>
<p>
对于 python3 使用 str。其他说明都是些关于 2 和 3 兼容的。</p>
</div>
</div>
<div id=outline-container-headline-66 class=outline-5>
<h5 id=headline-66>
3.19.12 Imports For Typing
</h5>
<div id=outline-text-headline-66 class=outline-text-5>
<p>
只导入需要的类型，可以一行导入多个。这些类型也应该作为关键字，不要在你的代码里面使用，如果有冲突可以通过 as 来起个别名。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span><span class=p>,</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>Optional</span>
<span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span> <span class=k>as</span> <span class=n>AnyType</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-67 class=outline-5>
<h5 id=headline-67>
3.19.13 Conditional Imports
</h5>
<div id=outline-text-headline-67 class=outline-text-5>
<p>
只有在实验情况下才使用条件导入。</p>
</div>
</div>
<div id=outline-container-headline-68 class=outline-5>
<h5 id=headline-68>
3.19.14 Circular Dependencies
</h5>
<div id=outline-text-headline-68 class=outline-text-5>
<p>
类型的循环引用一般都是有代码问题，这些代码应该被重构。</p>
<p>
使用 Any 替换那些导致循环引用的模块。后面使用这个模块真实的类型定义（不过 Any 的属性还是 Any）。</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Any</span>

<span class=n>some_mod</span> <span class=o>=</span> <span class=n>Any</span>  <span class=c1># some_mod.py imports this module.</span>
<span class=o>...</span>

<span class=k>def</span> <span class=nf>my_method</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>var</span><span class=p>:</span> <span class=n>some_mod</span><span class=o>.</span><span class=n>SomeType</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
</div>
</div>
<div id=outline-container-headline-69 class=outline-5>
<h5 id=headline-69>
3.19.15 Generics
</h5>
<div id=outline-text-headline-69 class=outline-text-5>
<p>
When annotating, prefer to specify type parameters for generic types; otherwise, the generics’ parameters will be assumed to be Any.</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>get_names</span><span class=p>(</span><span class=n>employee_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=n>Any</span><span class=p>]:</span>
  <span class=o>...</span>

<span class=c1># These are both interpreted as get_names(employee_ids: List[Any]) -&gt; Dict[Any, Any]</span>
<span class=k>def</span> <span class=nf>get_names</span><span class=p>(</span><span class=n>employee_ids</span><span class=p>:</span> <span class=nb>list</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
  <span class=o>...</span>

<span class=k>def</span> <span class=nf>get_names</span><span class=p>(</span><span class=n>employee_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
  <span class=o>...</span></code></pre></div>
</div>
<p>
If the best type parameter for a generic is Any, make it explicit, but remember that in many cases TypeVar might be more appropriate:</p>
<div class="src src-python">
<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=k>def</span> <span class=nf>get_names</span><span class=p>(</span><span class=n>employee_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Any</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>Any</span><span class=p>,</span> <span class=n>Text</span><span class=p>]:</span>
  <span class=s2>&#34;&#34;&#34;Returns a mapping from employee ID to employee name for given IDs.&#34;&#34;&#34;</span>

<span class=n>T</span> <span class=o>=</span> <span class=n>TypeVar</span><span class=p>(</span><span class=s1>&#39;T&#39;</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>get_names</span><span class=p>(</span><span class=n>employee_ids</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>T</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=n>T</span><span class=p>,</span> <span class=n>Text</span><span class=p>]:</span>
  <span class=s2>&#34;&#34;&#34;Returns a mapping from employee ID to employee name for given IDs.&#34;&#34;&#34;</span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id=outline-container-headline-70 class=outline-3>
<h3 id=headline-70>
4 Parting Words
</h3>
<div id=outline-text-headline-70 class=outline-text-3>
<p>
保持一致性。</p>
<p>
编辑代码的时候，注意看看原来的代码的风格。别破坏原来的代码风格。</p>
<p>
代码风格指导的目的是为了让大家形成一种共同语言，这样更多的关注代码的逻辑。如果一个代码里面语言太多反而会导致阅读代码变困难，所以应该避免。</p>
</div>
</div>
</div>
<div class=post-tags>
<nav class="nav tags">
<ul class=flat>
<li><a href=/tags/python>python</a></li>
</ul>
</nav>
</div>
<div id=disqus_thread></div>
<script type=text/javascript>(function(){var a,b;if(window.location.hostname=="localhost")return;a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='wdicc',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript>
<a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
</div>
<div class="footer wrapper">
<nav class=nav>
<div> Copyright © 2020 wd. All Rights Reserved | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div>
</nav>
</div>
<script>feather.replace()</script>
</body>
</html>