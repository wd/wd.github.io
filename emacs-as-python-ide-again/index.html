<!doctype html><html lang=en><head><title>Emacs as Python IDE Again &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Emacs as Python IDE Again</h1></header><div class=content__body><p><a href=/emacs-as-python-ide/>上一篇</a>里面说了使用 emacs 编辑 python 文件的方式，已经过去 2 年了，时代变了。更新一下。</p><p>随着 vscode 横空出世，带来了 LSP，这个东西是所有编辑器都可以受益的，有人开发了 lsp-mode，目前我感觉 lsp 比 jedi 好用多了。</p><p>elpy 目前还不支持 lsp。所以放弃了 elpy 了。</p><p>主要配置如下。使用了 <code class=verbatim>lsp-python-ms</code> 和 <code class=verbatim>lsp-mode</code>, <code class=verbatim>pipenv</code> 。我原来用 pyenv + virtualvenv，pipenv 是把两个整合的东西。pipenv 还支持 lock，以后估计会流行吧。</p><div class="src src-lisp"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lisp data-lang=lisp><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> lsp-python-ms
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:demand</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>;;(setq lsp-python-ms-extra-paths &#34;&#34;)</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> lsp-python-ms-executable
</span></span><span style=display:flex><span>        (<span style=color:#a6e22e>string-trim</span> (shell-command-to-string
</span></span><span style=display:flex><span>                      <span style=color:#e6db74>&#34;find ~/.vscode/extensions/ -name &#39;Microsoft.Python.LanguageServer&#39; | sort | tail -1&#34;</span>)))
</span></span><span style=display:flex><span>  <span style=color:#75715e>;; for dev build of language server</span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> lsp-python-ms-dir
</span></span><span style=display:flex><span>        (file-name-directory lsp-python-ms-executable)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>use-package</span> lsp-mode
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:commands</span> lsp
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:hook</span>  (python-mode <span style=color:#f92672>.</span> (lambda ()
</span></span><span style=display:flex><span>                          (pipenv-activate)
</span></span><span style=display:flex><span>                          (<span style=color:#a6e22e>require</span> <span style=color:#e6db74>&#39;lsp-python-ms</span>)
</span></span><span style=display:flex><span>                          (lsp)))
</span></span><span style=display:flex><span>  <span style=color:#e6db74>:config</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>setq</span> lsp-auto-configure <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>use-package</span> pipenv
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:init</span>
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>setq</span>
</span></span><span style=display:flex><span>     pipenv-projectile-after-switch-function
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>#&#39;</span>pipenv-projectile-after-switch-extended))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>use-package</span> company-lsp
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:ensure</span> <span style=color:#66d9ef>t</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:config</span>
</span></span><span style=display:flex><span>    (add-to-list <span style=color:#e6db74>&#39;company-backends</span> <span style=color:#e6db74>&#39;company-lsp</span>)
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>)</span></span></code></pre></div></div><p>lsp server 实际上有好几个，不过我觉得微软的那个似乎比较好用。 <code class=verbatim>lsp-python-ms</code> 是使用了微软的 lsp server，你可以自己编译一个，也可以直接使用 vscode 里面的，这样省去了自己编译的麻烦。</p><p>lsp-mode 自带使用那个 lsp-ui 来显示一些信息我感觉很慢不好用，所以通过 <code class=verbatim>lsp-auto-configure</code> 把他禁用了，我弄了一下也没有办法让这货和 <code class=verbatim>flycheck-flake8</code> 一起好好工作，我还是喜欢 flake8 所以就这样了。</p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2019-08-13</p></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd © 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>