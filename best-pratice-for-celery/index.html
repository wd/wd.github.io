<!doctype html><html lang=en><head><title>Best Pratice for Celery &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Best Pratice for Celery</h1></header><div class=content__body><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Celery beat and worker</h3><div id=outline-text-headline-1 class=outline-text-3><p>Celery works with two separate parts, the beat and the worker. The beat is the control center which determine when and where to send the tasks, there should be only one beat in each celery network. The worker is the one who runs the tasks and send the results back to the beat, there could be lots of works in each network.</p></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>Result backend</h3><div id=outline-text-headline-2 class=outline-text-3><p>Result backend is the place where task results stored. By default, celery support many storage types, like PostgreSQL, Redis, etc. If you store the results in the database, you may need to clean the old data from the database periodically. I use Redis as the result backend, it will expire the old data automatically.</p></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Broker</h3><div id=outline-text-headline-3 class=outline-text-3><p>Broker is used to communicate among the workers and the beta. Celery support Redis, RabbitMQ, etc. as it’s broker. I use Redis too, in a different database with the result backend.</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Scheduler</h3><div id=outline-text-headline-4 class=outline-text-3><p>Scheduler is the place where you can add periodically tasks. The tasks store in a local database file by default. You can specify the file by <code>-s /home/celery/var/run/celerybeat-schedule</code>, you also can use a custom scheduler like a <a href=http://docs.celeryproject.org/en/master/userguide/periodic-tasks.html#id8>database table</a>, but I think the default method is more simple and convenient to use. The only problem is when you want to migrate the scheduler to an other server, you may also need to transfer the database file.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Running commands</h3><div id=outline-text-headline-5 class=outline-text-3><p>You can run the worker like:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ celery -A proj beat</span></span></code></pre></div></div><p>And also can run the beat with the worker:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ celery -A proj worker —beat</span></span></code></pre></div></div><p>Or run the beat separately like:</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>$ celery -A proj beat -s /home/celery/var/run/celerybeat-schedule</span></span></code></pre></div></div></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Monitoring</h3><div id=outline-text-headline-6 class=outline-text-3><p>Celery has provided some command to show it's running status.</p><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>// List active nodes in this cluster
</span></span><span style=display:flex><span>$ celery -A proj status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// inspect tasks
</span></span><span style=display:flex><span>$ celery -A proj inspect active
</span></span><span style=display:flex><span>$ celery -A proj inspect scheduled
</span></span><span style=display:flex><span>$ celery -A proj inspect reserved
</span></span><span style=display:flex><span>$ celery -A proj inspect revoked
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// Curses Celery task monitor
</span></span><span style=display:flex><span>$ celery -A proj events</span></span></code></pre></div></div><p>Also, there is a web-monitor named <a href=https://flower.readthedocs.io/en/latest/>Flower</a>. It can connect to the broker and inspect the task status in real-time.</p></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>It's better to not mix configurations with django</h3><div id=outline-text-headline-7 class=outline-text-3><p>You maybe want to check my <a href=/logging-in-celery-and-django/>last post for celery and django</a>, the log files will be both processed by django and celery but by different process, this may cause some problems.</p><p>You can put some common settings like redis, database in a sperate file, and import in django and celery, but don't import django settings into celery.</p></div></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2019-07-17</p><hr>On this page:<nav id=TableOfContents><ul><li><a href=#headline-1>Celery beat and worker</a></li><li><a href=#headline-2>Result backend</a></li><li><a href=#headline-3>Broker</a></li><li><a href=#headline-4>Scheduler</a></li><li><a href=#headline-5>Running commands</a></li><li><a href=#headline-6>Monitoring</a></li><li><a href=#headline-7>It's better to not mix configurations with django</a></li></ul></nav></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd © 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>