<!doctype html><html lang=en><head><title>Add float debug button for react native &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Add float debug button for react native</h1></header><div class=content__body><p>React-native 里面在模拟器里面可以通过快捷键打开开发菜单，在设备里面可以通过摇晃设备打开开发菜单。但是摇晃有时候并不是一个好的操作，比如是个 pad，或者比如你自己的设备本身会触发晃动动作。那么如何在开发模式下面增加一个按钮打开这个菜单呢？可惜官方对这个功能没有兴趣多做开发 <a href=https://github.com/facebook/react-native/issues/10191>https://github.com/facebook/react-native/issues/10191</a> 。</p><h2 id=ios>iOS</h2><p>ios 里面直接就把这个接口暴露出来了，可以直接在 js 里面调用。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>import</span> {<span style=color:#a6e22e>NativeModules</span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-native&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 在某个按钮的动作里面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> {<span style=color:#a6e22e>DevMenu</span>} <span style=color:#f92672>=</span> <span style=color:#a6e22e>NativeModules</span>;
</span></span><span style=display:flex><span><span style=color:#a6e22e>DevMenu</span>.<span style=color:#a6e22e>show</span>();
</span></span></code></pre></div><h2 id=android>Android</h2><p>iOS 是 react-native 的亲儿子，Android 里面并没有那么方便的方法，得自己通过 native 代码加。</p><p>下面两种方式加的都是 <code>android.support.design.widget.FloatingActionButton</code> 按钮，其它的类似。需要增加好编译依赖 <code>compile 'com.android.support:design:23.0.0'</code>，版本号按照自己的修改下。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addDevButton</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            MainApplication application <span style=color:#f92672>=</span> (MainApplication) getApplication();
</span></span><span style=display:flex><span>            ReactNativeHost reactNativeHost <span style=color:#f92672>=</span> application.<span style=color:#a6e22e>getReactNativeHost</span>();
</span></span><span style=display:flex><span>            ReactInstanceManager reactInstanceManager <span style=color:#f92672>=</span> reactNativeHost.<span style=color:#a6e22e>getReactInstanceManager</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> DevSupportManager devSupportManager <span style=color:#f92672>=</span> reactInstanceManager.<span style=color:#a6e22e>getDevSupportManager</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 这里是增加一个自定义菜单</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//            devSupportManager.addCustomDevOption(&#34;Custom dev option&#34;, new DevOptionHandler() {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                @Override</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                public void onOptionSelected() {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                    Toast.makeText(MainActivity.this, &#34;Hello from custom dev option&#34;, Toast.LENGTH_SHORT).show();</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//                }</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//            });</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Fake empty container dev_button_layout</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 创建一个 layout</span>
</span></span><span style=display:flex><span>            RelativeLayout lContainerLayout <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RelativeLayout(mActivity.<span style=color:#a6e22e>getApplicationContext</span>());
</span></span><span style=display:flex><span>            lContainerLayout.<span style=color:#a6e22e>setLayoutParams</span>(<span style=color:#66d9ef>new</span> RelativeLayout.<span style=color:#a6e22e>LayoutParams</span>(
</span></span><span style=display:flex><span>                    ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> , ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// custom view</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 创建一个 button</span>
</span></span><span style=display:flex><span>            FloatingActionButton button <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> FloatingActionButton(mActivity);
</span></span><span style=display:flex><span>            button.<span style=color:#a6e22e>setImageResource</span>(R.<span style=color:#a6e22e>drawable</span>.<span style=color:#a6e22e>ga_airplane</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            RelativeLayout.<span style=color:#a6e22e>LayoutParams</span> lButtonParams <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RelativeLayout.<span style=color:#a6e22e>LayoutParams</span>(
</span></span><span style=display:flex><span>                    ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>WRAP_CONTENT</span>, ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>WRAP_CONTENT</span>
</span></span><span style=display:flex><span>            );
</span></span><span style=display:flex><span>            lButtonParams.<span style=color:#a6e22e>addRule</span>(RelativeLayout.<span style=color:#a6e22e>ALIGN_PARENT_RIGHT</span>);
</span></span><span style=display:flex><span>            lButtonParams.<span style=color:#a6e22e>addRule</span>(RelativeLayout.<span style=color:#a6e22e>ALIGN_PARENT_BOTTOM</span>);
</span></span><span style=display:flex><span>            button.<span style=color:#a6e22e>setLayoutParams</span>(lButtonParams);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            ViewGroup.<span style=color:#a6e22e>MarginLayoutParams</span> mp <span style=color:#f92672>=</span> (ViewGroup.<span style=color:#a6e22e>MarginLayoutParams</span>) button.<span style=color:#a6e22e>getLayoutParams</span>();
</span></span><span style=display:flex><span>            mp.<span style=color:#a6e22e>setMargins</span>(0, 0, 0, dpToPx(mActivity, 125));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            button.<span style=color:#a6e22e>setLayoutParams</span>(mp);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>//设定拖动动作</span>
</span></span><span style=display:flex><span>            button.<span style=color:#a6e22e>setOnTouchListener</span>(<span style=color:#66d9ef>new</span> View.<span style=color:#a6e22e>OnTouchListener</span>() {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onTouch</span>(View v, MotionEvent event) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>switch</span> (event.<span style=color:#a6e22e>getActionMasked</span>()) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>:
</span></span><span style=display:flex><span>                            dX <span style=color:#f92672>=</span> v.<span style=color:#a6e22e>getX</span>() <span style=color:#f92672>-</span> event.<span style=color:#a6e22e>getRawX</span>();
</span></span><span style=display:flex><span>                            dY <span style=color:#f92672>=</span> v.<span style=color:#a6e22e>getY</span>() <span style=color:#f92672>-</span> event.<span style=color:#a6e22e>getRawY</span>();
</span></span><span style=display:flex><span>                            lastAction <span style=color:#f92672>=</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_MOVE</span>:
</span></span><span style=display:flex><span>                            v.<span style=color:#a6e22e>setY</span>(event.<span style=color:#a6e22e>getRawY</span>() <span style=color:#f92672>+</span> dY);
</span></span><span style=display:flex><span>                            v.<span style=color:#a6e22e>setX</span>(event.<span style=color:#a6e22e>getRawX</span>() <span style=color:#f92672>+</span> dX);
</span></span><span style=display:flex><span>                            lastAction <span style=color:#f92672>=</span> MotionEvent.<span style=color:#a6e22e>ACTION_MOVE</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_UP</span>:
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>if</span> (lastAction <span style=color:#f92672>==</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>)
</span></span><span style=display:flex><span>                                <span style=color:#75715e>// 点击的时候打开菜单</span>
</span></span><span style=display:flex><span>                                devSupportManager.<span style=color:#a6e22e>showDevOptionsDialog</span>();
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            lContainerLayout.<span style=color:#a6e22e>addView</span>(button);
</span></span><span style=display:flex><span>            addContentView(lContainerLayout, <span style=color:#66d9ef>new</span> ViewGroup.<span style=color:#a6e22e>LayoutParams</span>(
</span></span><span style=display:flex><span>                    ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> , ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> ));
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p>上面是纯代码方式，还可以通过 xml 文件方式搞定。</p><p>新建一个 layout 文件，取名比如叫做 <code>dev_button_layout.xml</code>， rootTag 是 <code>RelativeLayout</code>。然后在里面添加一个 <code>FloatingActionButton</code>，id 设置为 <code>dev_button</code>，然后设置好属性和位置。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addDevButton</span>() {
</span></span><span style=display:flex><span>            MainApplication application <span style=color:#f92672>=</span> (MainApplication) getApplication();
</span></span><span style=display:flex><span>            ReactNativeHost reactNativeHost <span style=color:#f92672>=</span> application.<span style=color:#a6e22e>getReactNativeHost</span>();
</span></span><span style=display:flex><span>            ReactInstanceManager reactInstanceManager <span style=color:#f92672>=</span> reactNativeHost.<span style=color:#a6e22e>getReactInstanceManager</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> DevSupportManager devSupportManager <span style=color:#f92672>=</span> reactInstanceManager.<span style=color:#a6e22e>getDevSupportManager</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            View view <span style=color:#f92672>=</span> View.<span style=color:#a6e22e>inflate</span>(mActivity, R.<span style=color:#a6e22e>layout</span>.<span style=color:#a6e22e>dev_button_layout</span>, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>            FloatingActionButton button <span style=color:#f92672>=</span> (FloatingActionButton) view.<span style=color:#a6e22e>findViewById</span>(R.<span style=color:#a6e22e>id</span>.<span style=color:#a6e22e>dev_button</span>);
</span></span><span style=display:flex><span>            <span style=color:#75715e>//button.setImageResource(R.drawable.ga_airplane);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            button.<span style=color:#a6e22e>setOnTouchListener</span>(<span style=color:#66d9ef>new</span> View.<span style=color:#a6e22e>OnTouchListener</span>() {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>onTouch</span>(View v, MotionEvent event) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>switch</span> (event.<span style=color:#a6e22e>getActionMasked</span>()) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>:
</span></span><span style=display:flex><span>                            dX <span style=color:#f92672>=</span> v.<span style=color:#a6e22e>getX</span>() <span style=color:#f92672>-</span> event.<span style=color:#a6e22e>getRawX</span>();
</span></span><span style=display:flex><span>                            dY <span style=color:#f92672>=</span> v.<span style=color:#a6e22e>getY</span>() <span style=color:#f92672>-</span> event.<span style=color:#a6e22e>getRawY</span>();
</span></span><span style=display:flex><span>                            lastAction <span style=color:#f92672>=</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_MOVE</span>:
</span></span><span style=display:flex><span>                            v.<span style=color:#a6e22e>setY</span>(event.<span style=color:#a6e22e>getRawY</span>() <span style=color:#f92672>+</span> dY);
</span></span><span style=display:flex><span>                            v.<span style=color:#a6e22e>setX</span>(event.<span style=color:#a6e22e>getRawX</span>() <span style=color:#f92672>+</span> dX);
</span></span><span style=display:flex><span>                            lastAction <span style=color:#f92672>=</span> MotionEvent.<span style=color:#a6e22e>ACTION_MOVE</span>;
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>case</span> MotionEvent.<span style=color:#a6e22e>ACTION_UP</span>:
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>if</span> (lastAction <span style=color:#f92672>==</span> MotionEvent.<span style=color:#a6e22e>ACTION_DOWN</span>)
</span></span><span style=display:flex><span>                                devSupportManager.<span style=color:#a6e22e>showDevOptionsDialog</span>();
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            addContentView(view, <span style=color:#66d9ef>new</span> ViewGroup.<span style=color:#a6e22e>LayoutParams</span>(
</span></span><span style=display:flex><span>                    ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> , ViewGroup.<span style=color:#a6e22e>LayoutParams</span>.<span style=color:#a6e22e>MATCH_PARENT</span> ));
</span></span><span style=display:flex><span>        }
</span></span></code></pre></div><p>然后在你的 <code>MainActivity</code> 的 <code>onCreate</code> 里面，在 <code>super.onCreate(savedInstanceState);</code> 后面增加</p><pre tabindex=0><code>            // debug 环境下才显示
            if(BuildConfig.DEBUG)
                addDevButton();
</code></pre></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2017-09-02</p></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd © 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>