<!doctype html><html lang=en><head><title>Howto Make react-redux Work With react-navigation &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>Howto Make react-redux Work With react-navigation</h1></header><div class=content__body><p>这周花了一些时间研究 <code class=verbatim>react-redux</code> 和怎么让它和 <code class=verbatim>react-navigation</code> 配合一起工作，总结一下，把代码和注释直接贴这里了，也可以看这个 <a href=https://gist.github.com/wd/7935c3fb20f2517280b8e050796310b3>gist</a>。</p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 一个简单的 RN 应用，有 2 个页面，使用了 react-navigation 的 StackNavigator 来做界面管理
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 为了说明如何使用 redux，以及如何让 redux 和 StackNavigator 配合
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 为了容易理解，把所有内容都放到了一个页面里面，实际开发的时候不要这么做
</span></span></span><span style=display:flex><span><span style=color:#75715e> * 参考：
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  https://github.com/jackielii/simplest-redux-example
</span></span></span><span style=display:flex><span><span style=color:#75715e> *  http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>React</span>, { <span style=color:#a6e22e>Component</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>StyleSheet</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Text</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>View</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Button</span>
</span></span><span style=display:flex><span>} <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-native&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>Provider</span>, <span style=color:#a6e22e>connect</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-redux&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>createStore</span>, <span style=color:#a6e22e>combineReducers</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;redux&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>StackNavigator</span>, <span style=color:#a6e22e>addNavigationHelpers</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#39;react-navigation&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Home 页面，UI 组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyHome</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;init home, props&#39;</span>, <span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_nextPage</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// navigation 依然在 this.props 里面获取，和不用 redux 的时候用法一样
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>navigation</span>} <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>navigation</span>.<span style=color:#a6e22e>navigate</span>(<span style=color:#e6db74>&#34;App&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 所有的传递过来的状态，都需要从 this.props.screenProps 里面读取 (4)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// 我这里给不同页面的 action 取了各自的命名空间，避免冲突，也可以直接所有 action 都在一个命名空间，这块我还在摸索如何处理比较好 (5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>onIncButtonClicked</span>} <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>screenProps</span>.<span style=color:#a6e22e>MyAppActions</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 界面有两个按钮，一个用来增加另外一个页面的计数器，一个用来访问下一个页面
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>View</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>container</span>}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Button</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Inc counter&#34;</span> <span style=color:#a6e22e>onPress</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onIncButtonClicked</span>}<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/Button&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Button</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Next page&#34;</span> <span style=color:#a6e22e>onPress</span><span style=color:#f92672>=</span>{()=&gt;<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>_nextPage</span>()}<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/Button&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/View&gt;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 这个组件只是用来测试就算一个 props 传递给子组件，在 props 被修改的时候也会被自动刷新
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ShowText</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>counter</span>} <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Text</span><span style=color:#f92672>&gt;</span>{<span style=color:#a6e22e>counter</span>}<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Text&gt;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// App 页面，UI 组件
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyApp</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;init App, props&#39;</span>, <span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>componentWillReceiveProps</span>(<span style=color:#a6e22e>newProps</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;myapp recive props&#39;</span>, <span style=color:#a6e22e>newProps</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 组件的 state/props 获取，有自己的命名空间 (1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>counter</span>} <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>screenProps</span>.<span style=color:#a6e22e>MyApp</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 组件的 action props (5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>let</span> {<span style=color:#a6e22e>onIncButtonClicked</span>, <span style=color:#a6e22e>onDecButtonClicked</span>} <span style=color:#f92672>=</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>screenProps</span>.<span style=color:#a6e22e>MyAppActions</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 界面有一个计数器的结果，两个按钮
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>View</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>styles</span>.<span style=color:#a6e22e>container</span>}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>ShowText</span> <span style=color:#a6e22e>counter</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>counter</span>} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Button</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Inc counter&#34;</span> <span style=color:#a6e22e>onPress</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onIncButtonClicked</span>}<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/Button&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Button</span> <span style=color:#a6e22e>title</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Dec counter&#34;</span> <span style=color:#a6e22e>onPress</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>onDecButtonClicked</span>}<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/Button&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/View&gt;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 初始化 StackNavigator，定义页面路由
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>AppNavigator</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>StackNavigator</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Home</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>screen</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>MyHome</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>App</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>screen</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>MyApp</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 包装一下 StackNavigator，因为有些参数需要定制一下
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyStackNavigator</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside MyStackNavigator&#34;</span>, <span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// screenProps: 使用这个往所有的页面传递 props，这个是和直接使用 redux 不同的地方 (4)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// navigation: 因为使用 redux 之后，就不会直接操作 this.state 了，所以得告诉 StackNavigator dispatch 方法和 state 从哪里读取
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>AppNavigator</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>screenProps</span><span style=color:#f92672>=</span>{<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>}
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>navigation</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>addNavigationHelpers</span>({
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>dispatch</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>dispatch</span>, <span style=color:#75715e>// 通过 action props 定义 (2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                    <span style=color:#a6e22e>state</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>nav</span>, <span style=color:#75715e>// 通过 state props 定义 (3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                })} <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义 state 和 props 的关系，所有 redux 应用都需要 (6)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mapStateToProps</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>ownProps</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside mapstate to props&#34;</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>ownProps</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这两个是不同的命名空间，和上面你使用的时候的路径对应 (1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;MyApp&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>MyApp</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;MyHome&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>MyHome</span>,
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 定义 StackNavigator 的 state (3)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;nav&#34;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>nav</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义 action 和 props 的关系，所有 redux 应用都需要
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>mapDispatchToProps</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>dispatch</span>, <span style=color:#a6e22e>ownProps</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside map dispath to props&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 这两个也是不同的命名空间，和上面使用的时候路径对应 (5)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#39;MyAppActions&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onIncButtonClicked</span><span style=color:#f92672>:</span> () =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;INC_COUNTER&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>payload</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>dispatch</span>(<span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onDecButtonClicked</span><span style=color:#f92672>:</span> () =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;DEC_COUNTER&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>payload</span><span style=color:#f92672>:</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>dispatch</span>(<span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;MyHomeActions&#39;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>onNextButtonClicked</span><span style=color:#f92672>:</span> () =&gt; {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>action</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;NEXT_PAGE&#34;</span>
</span></span><span style=display:flex><span>                };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>dispatch</span>(<span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 定义 StackNavigator 的 action props (2)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#39;dispatch&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>dispatch</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义 home 页面的 reducer，不过因为那个页面唯一的一个 action 是触发别的页面的动作的，所以这个 reducer 其实也可以没有
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 所以从这里也能看出来，reducer 并不一定按照页面去分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>homeReducer</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>action</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside home reducer&#34;</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span> <span style=color:#f92672>||</span> {};
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义一个初始化的 state
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>myAppInitState</span> <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#39;counter&#39;</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>};
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义 app 页面的 reducer
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>myAppReducer</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>myAppInitState</span>, <span style=color:#a6e22e>action</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 收到的 state 实际上只是自己命名空间下的 (6)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside myAppReducer&#34;</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>myState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 需要处理的 action 的逻辑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 要注意，一个 action 被触发的时候，所有的 reducer 都会被调用，所以其实更像是订阅自己想要处理的 action
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>switch</span> (<span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;DEC_COUNTER&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;INC_COUNTER&#34;</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 如果修改了 state，必须要返回一个新的对象，不能直接在原对象上修改，否则 state 变化不会触发组件的刷新
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>return</span> Object.<span style=color:#a6e22e>assign</span>({}, <span style=color:#a6e22e>myState</span>, {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;counter&#39;</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>myState</span>.<span style=color:#a6e22e>counter</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>action</span>.<span style=color:#a6e22e>payload</span>
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>default</span><span style=color:#f92672>:</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义一个 StackNavigator 用到的初始化状态，这个很重要
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>initialState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AppNavigator</span>.<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>getStateForAction</span>(<span style=color:#a6e22e>AppNavigator</span>.<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>getActionForPathAndParams</span>(<span style=color:#e6db74>&#39;Home&#39;</span>));
</span></span><span style=display:flex><span><span style=color:#75715e>// 定义 StackNavigator 的 reducer，代码直接复制来的
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>navReducer</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>state</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>initialState</span>, <span style=color:#a6e22e>action</span>) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;inside nav reducer&#34;</span>, <span style=color:#a6e22e>state</span>, <span style=color:#a6e22e>action</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>nextState</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>AppNavigator</span>.<span style=color:#a6e22e>router</span>.<span style=color:#a6e22e>getStateForAction</span>(<span style=color:#a6e22e>action</span>, <span style=color:#a6e22e>state</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Simply return the original `state` if `nextState` is null or undefined.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>nextState</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>state</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 创建 store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>store</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>createStore</span>(<span style=color:#a6e22e>combineReducers</span>({
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 这里的 MyApp 等和前面定义 mapStateToProps 的地方对应 (6)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// 这里也是导致 reducer 收到的 state 只有自己命名空间下数据的一个原因 (6)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>MyApp</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>myAppReducer</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MyHome</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>homeReducer</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>nav</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>navReducer</span>
</span></span><span style=display:flex><span>}));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 让 redux 加持一下，保佑
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>App</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>mapStateToProps</span>, <span style=color:#a6e22e>mapDispatchToProps</span>)(<span style=color:#a6e22e>MyStackNavigator</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 其他的就是比较常见的 redux 的逻辑了，另外需要说明的是实际使用的时候，肯定会做页面拆分，如何拆分可能都会有不同的看法，我也还在摸索
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Root</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Component</span><span style=color:#f92672>&lt;</span>{}<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>props</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(<span style=color:#a6e22e>props</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>render</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>Provider</span> <span style=color:#a6e22e>store</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>store</span>}<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>App</span> <span style=color:#a6e22e>prop1</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;prop1&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/Provider&gt;</span>
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>styles</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>StyleSheet</span>.<span style=color:#a6e22e>create</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>container</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>flex</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>justifyContent</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alignItems</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>backgroundColor</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#F5FCFF&#39;</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>welcome</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fontSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>20</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>textAlign</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>margin</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>instructions</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>textAlign</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;center&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>color</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#333333&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>marginBottom</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>5</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>});</span></span></code></pre></div></div></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2017-10-21</p></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd © 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>