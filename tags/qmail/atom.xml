<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Qmail on wd and cc</title>
    <link>https://wdicc.com/tags/qmail/atom/index.xml</link>
    <description>Recent content in Qmail on wd and cc</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <atom:link href="https://wdicc.com/tags/qmail/atom/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Howto Qmail with spamassassin</title>
      <link>https://wdicc.com/howto-qmail-with-spamassassin/</link>
      <pubDate>Mon, 16 Jan 2006 00:00:00 +0000</pubDate>
      
      <guid>https://wdicc.com/howto-qmail-with-spamassassin/</guid>
      <description>http://sylvestre.ledru.info/howto/howto_qmail_spamassassin.php&lt;br /&gt;

By Sylvestre Ledru June 2003&lt;br /&gt;
Version francaise&lt;br /&gt;
Return to the linux page&lt;br /&gt;

(02/04/2002), Bug fix :&lt;br /&gt;
I just add a little bug fix for some OS which remove the +x on qmail-queue (the qmail-scanner is not concerned)&lt;br /&gt;
(01/11/2003), Qmail-scanner :&lt;br /&gt;
I had a new way of calling spamassassin client using qmail-scanner.&lt;br /&gt;
(23/07/2003), Preferences :&lt;br /&gt;
Matthew Francis sent me a quite good howto explaining how to get user preferences for spamassassin. It is available here.&lt;br /&gt;
(08/06/2003), Localisation :&lt;br /&gt;
If you want to change the language of the spam report (ie why the email has been tagged as a spam), just change the locales to your language (dpkg-reconfigure locales under debian) and install gettext (apt-get install gettext) and you will have the appropriate version (french for example)...&lt;br /&gt;
(11/03/2005), Update :&lt;br /&gt;
After almost two years without updates, my other howto about qmail is much more complet and uptodate, I clean this one :&lt;br /&gt;
- first method deprecated&lt;br /&gt;
- new version of spamassassin 3.0.X&lt;br /&gt;
- use of netqmail instead of qmail&lt;br /&gt;
- new version of qmail-scanner with the q-s-st patch (activation of Spamassassin just for a domain)&lt;br /&gt;

If you like this howto and you want to thank me for my work : here is my wishlist on Amazon - France or my Amazon US wishlist :)&lt;br /&gt;
If you are a corporation and you make some business thanks to my howto, we&#39;ll love to have a present from you (or just tell me who is using my howto).&lt;br /&gt;
Thank to Scott Kinkade for his cash donation. I really do appreciate.&lt;br /&gt;

If you want more informations about the intallation of qmail, I wrote a long howto about.&lt;br /&gt;
I wrote this howto because there is a lack of documentation about qmail with spamassassin.&lt;br /&gt;

This howto has been designed for qmail with vpopmail but it should work without a lot of modifications with something else than vpopmail.&lt;br /&gt;

Spamassassin is a very powerfull program which checks if the receveid email is a spam or not. The analys is based on a list of mark. If the sum of all the mark exceed a specified amount (for example 5), the email will be tagged (****SPAM**** in the topic).&lt;br /&gt;
With this, it is very easy to create a rule which will move all emails into a specific directory (i.e. trash:)&lt;br /&gt;

If you want to link Qmail with spamassassin, it is quite easy.&lt;br /&gt;
First, install spamassassin and install razor and pyzor if you want to use it.&lt;br /&gt;
Under debian :&lt;br /&gt;
apt-get install spamassassin You should use the &#34;debian unstable or testing&#34; version of spamassassin which, most of the time, will find more spam.&lt;br /&gt;

Under other system (Redhat, Suse, Solaris ...) : The latest version of spamassassin today is the version 3.0.2. The installation is almost the same, only a few directives changed.&lt;br /&gt;
wget http://useast.spamassassin.org/released/Mail-SpamAssassin-2.55.tar.gz&lt;br /&gt;
tar -zxvf Mail-SpamAssassin-2.55.tar.gz&lt;br /&gt;
cd Mail-SpamAssassin-2.55&lt;br /&gt;
perl Makefile.PL&lt;br /&gt;
make&lt;br /&gt;
make install&lt;br /&gt;
cp spamd/debian-rc-script.sh /etc/init.d/spamassassin You can replace debian by redhat, solaris, netbsd, suse ...&lt;br /&gt;
chmod +x /etc/init.d/spamassassin&lt;br /&gt;

Then, edit /etc/spamassassin/local.cf&lt;br /&gt;
Version 2.5X :&lt;br /&gt;
required_hits 6.0&lt;br /&gt;
rewrite_subject 1&lt;br /&gt;
report_header 1&lt;br /&gt;
use_terse_report 1&lt;br /&gt;
defang_mime 1&lt;br /&gt;
dns_available yes&lt;br /&gt;
dcc_add_header 1&lt;br /&gt;
use_pyzor 1 (Only if you have installed pyzor)&lt;br /&gt;
use_razor2 (Only if you have installed razor2)&lt;br /&gt;
use_dcc 1&lt;br /&gt;
Version 3 :&lt;br /&gt;
#Number of points to tag the spam required_hits 5.0 # Add the result in the header always_add_headers 1 # change the subject rewrite_subject 1 report_safe 1 use_terse_report 1 # dns checks (warning : increase the process length) dns_available yes dcc_add_header 0 # Don&#39;t skip the relay black list skip_rbl_checks 0 use_dcc 1 dcc_timeout 10 # Remote verification use_pyzor 1 pyzor_timeout 10 pyzor_add_header 1 # Never from the previous results auto_learn 1 # use the bayes filter use_bayes 1 # Where spamassassin must store these informations : bayes_path /var/qmail/spamassassin/ # Where he stores the auto white list results : auto_whitelist_path /var/qmail/spamassassin/auto_whitelist&lt;br /&gt;
If you want to have detailled information about spamassassin processing, add the line in the local.cf file : timelog_path /var/log/spamassassin, run the daemon with the -D option (so, specify it in the /etc/default/spamassassin file under debian), create the directory with appropriate rights (should be vpopmail). In the directory, you will have for each email a file which sum up the spamassassin process (it is a debug option !).&lt;br /&gt;

I use these rules. Feel free to change ! Documentation about this is available here : perldoc Mail::SpamAssassin::Conf&lt;br /&gt;

In /etc/default/spamassassin (if this file does not exist, create it)&lt;br /&gt;
Change ENABLED to 1, then add these options : - &#34;-m 10 -v --auto-whitelist&#34; for the version 2.5X.&lt;br /&gt;
- &#34;-v -m 10 -u vpopmail --nouser-config&#34; for the version 3&lt;br /&gt;
With that stuff, you can launch spamd which is bascilly a spamassassin deamon (provide great performances).&lt;br /&gt;
-m 10 =&amp;gt; 10 childs&lt;br /&gt;
-v =&amp;gt; vpopmail config&lt;br /&gt;
--auto-whitelist =&amp;gt; Use auto whitelist (friend list)&lt;br /&gt;
Instead of spamassassin, you have to use spamc in order to test email.&lt;br /&gt;
There are some options &#34;-c -u vpopmail&#34; which enabled the creation of preferences for a domain or a user but it does not work very well for me.&lt;br /&gt;
/etc/init.d/spamassassin start&lt;br /&gt;

Next, the modification of qmail in order to check emails.&lt;br /&gt;
Basically, there are two kind of configuration for qmail :&lt;br /&gt;
- the fastest/easiest way is to change the qmail-queue in order to &#34;introduce&#34; the spamasssin check.Deprecated&lt;br /&gt;
- the cleanest way is to use qmail-scanner.&lt;br /&gt;
Changing the qmail-queue program&lt;br /&gt;
cp /var/qmail/bin/qmail-queue /var/qmail/bin/qmail-queue.orig&lt;br /&gt;
chown qmailq:qmail qmail-queue&lt;br /&gt;
chown qmailq:qmail qmail-queue.orig&lt;br /&gt;
chmod u+s qmail-queue.orig&lt;br /&gt;
chmod o+r,+x qmail-queue.orig qmail-queue Not fundamental but sometime it is necessary (depends the system)&lt;br /&gt;

mkdir /home/vpopmail/.spamassassin&lt;br /&gt;
cd /home/vpopmail&lt;br /&gt;
chmod 777 /home/vpopmail/.spamassassin&lt;br /&gt;

chown -R qmailq:qmail .spamassassin&lt;br /&gt;
chmod u=rwx,g=rx,o= /home/vpopmail/.spamassassin&lt;br /&gt;
Now, delete the content of the executable which manage the queue.&lt;br /&gt;
echo -n &amp;gt; /var/qmail/bin/qmail-queue&lt;br /&gt;
Then, edit the qmail-queue file and add this inside :&lt;br /&gt;
#!/bin/sh&lt;br /&gt;
/usr/bin/spamc | /var/qmail/bin/qmail-queue.orig&lt;br /&gt;
I agree that it is a quick/dirty method. It causes some issues with the injection of a bounce in the queue. (qmail-queue is not planned to work this way).&lt;br /&gt;
With qmail-scanner - Visit http://sylvestre.ledru.info/howto/howto_qmail_vpopmail.php for more informations&lt;br /&gt;
First, you have to patch qmail with the qmailqueue-patch or install netqmail which has already this plugin.&lt;br /&gt;
Qmail with the patch :&lt;br /&gt;
wget http://qmail.agarik.com/qmail-1.03.tar.gz&lt;br /&gt;
tar -zxvf qmail-1.03.tar.gz&lt;br /&gt;
cd qmail-1.03&lt;br /&gt;
wget http://qmail.mirrored.ca/moni.csi.hu/pub/glibc-2.3.1/qmail-1.03.errno.patch&lt;br /&gt;
wget http://sylvestre.ledru.info/howto/qmail/qmailqueue-patch&lt;br /&gt;
patch -p1 &amp;lt; qmail-1.03.errno.patch&lt;br /&gt;
patch -p1 &amp;lt; qmailqueue-patch&lt;br /&gt;
With netqmail :&lt;br /&gt;
wget http://qmail.agarik.com/netqmail-1.05.tar.gz&lt;br /&gt;
tar -zxvf netqmail-1.05.tar.gz&lt;br /&gt;
cd netqmail-1.05/&lt;br /&gt;
./collate.sh&lt;br /&gt;
cd netqmail-1.05&lt;br /&gt;
Add the QMAILQUEUE parameter to the /etc/tcp.smtp file :&lt;br /&gt;
127.0.0.1:allow,RELAYCLIENT=&#34;&#34;,QMAILQUEUE=&#34;/var/qmail/bin/qmail-scanner-queue.pl&#34;&lt;br /&gt;
198.168.1.:allow,RELAYCLIENT=&#34;&#34;,QMAILQUEUE=&#34;/var/qmail/bin/qmail-scanner-queue.pl&#34;&lt;br /&gt;
:allow,QMAILQUEUE=&#34;/var/qmail/bin/qmail-scanner-queue.pl&#34;&lt;br /&gt;
Rehash tcpserver :&lt;br /&gt;
/usr/local/bin/tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &amp;lt; /etc/tcp.smtp&lt;br /&gt;
chmod 644 /etc/tcp.smtp.cdb&lt;br /&gt;
And then, install qmail-scanner with qmail-scanner-st&lt;br /&gt;
. qmail-scanner-st is a patched version a qmail-scanner which enabled great features like auto delete/reject/quarantine spam over a specified score but also to select which scanners will be used for a domain and even for a user, then, it is possible to configure the spamassassin / antivirus just for one domain/user.&lt;br /&gt;
wget http://unc.dl.sourceforge.net/sourceforge/qmail-scanner/qmail-scanner-1.25.tgz wget http://xoomer.virgilio.it/j.toribio/qmail-scanner/download/q-s-1.25st-20050207.patch.gz&lt;br /&gt;
gunzip q-s-1.25st-20050207.patch.gz&lt;br /&gt;
tar -zxvf qmail-scanner-1.25.tgz&lt;br /&gt;
cd qmail-scanner-1.25/&lt;br /&gt;
patch -p1 &amp;lt; ../q-s-1.25st-20050207.patch&lt;br /&gt;
groupadd qscand&lt;br /&gt;
useradd -c &#34;Qmail-Scanner Account&#34; -g qscand -s /bin/false qscand&lt;br /&gt;
./configure --qs-user qscand --qs-group qscand --spooldir /var/spool/qmailscan --qmaildir /var/qmail --bindir /var/qmail/bin --qmail-queue-binary /var/qmail/bin/qmail-queue --admin-fromname &#34;Mail admin&#34; --admin postmaster --domain vladimir.avence.info --notify sender,admin,recips --local-domains `cat /var/qmail/control/rcpthosts | tr &#34;\n&#34; &#34; &#34;` --silent-viruses auto --unzip 1 --add-dscr-hdrs 1 --archive 0 --redundant yes --log-crypto 0 --scanners &#34;fast_spamassassin&#34; --scanners-per-domain yes --sa-subject &#34;*****SPAM*****&#34; --sa-delete 5 --install 1&lt;br /&gt;
After the installation, if you want to change your preferences, you have to edit the /var/qmail/bin/qmail-scanner-queue.pl file. In this file, you can also add option for the spamassassin client.&lt;br /&gt;
If you want to enable/disable some scanners, edit the /var/spool/qmailscan/scanners_per_domain.txt&lt;br /&gt;
To rehash the scanner per domain file : /var/qmail/bin/qmail-scanner-queue.pl -p&lt;br /&gt;
To rehash the quarantine attachement file : /var/qmail/bin/qmail-scanner-queue.pl -g&lt;br /&gt;
trunks.ecranbleu.org:sa,ps,clamdscan_scanner&lt;br /&gt;

# sa = spamassassin&lt;br /&gt;
# ps = perl scanner&lt;br /&gt;

This should be enough to use SpamAssassin on the whole system.&lt;br /&gt;
I have to try to find how it can be linked with vpopmail in order to create preference for a specific domain or a specific user. (if someone knows : sylvestre@ecranbleu.org)&lt;br /&gt;

Problems :&lt;br /&gt;
- link with vpopmail&lt;br /&gt;
This howto is inspired and corrected from :&lt;br /&gt;
http://www.euronet.nl/users/erhnam/linux/qmail/qmail.htm.&lt;br /&gt;
</description>
    </item>
    
    <item>
      <title>caphit qmail 配置</title>
      <link>https://wdicc.com/caphit-qmail-conf/</link>
      <pubDate>Mon, 16 Jan 2006 00:00:00 +0000</pubDate>
      
      <guid>https://wdicc.com/caphit-qmail-conf/</guid>
      <description>参考网址&lt;br /&gt;
http://lifewithqmail.org(中文版http://lifewithqmail.org/LWQ-CN.html)&lt;br /&gt;
http://qmail.te8.com/rpms/glibc-2.3.1/(patch下载地址)&lt;br /&gt;
http://www.fehcom.de/qmail/qmail.html&lt;br /&gt;
http://www.pipeline.com.au/staff/mbowe/isp/vpopmail-mysql.htm&lt;br /&gt;
http://bbs.chinaunix.net/forum/viewtopic.php?t=254662&lt;br /&gt;

ucspi-tcp&lt;br /&gt;
http://cr.yp.to/ucspi-tcp.html&lt;br /&gt;
ucspi-tcp-0.88.a_record.patch，ucspi-tcp-0.88.errno.patch，ucspi-tcp-0.88.nodefaultrbl.patch&lt;br /&gt;
（或者）ucspi-tcp-0.88.a_record.patch，ucspi-tcp-0.88.errno.patch，ucspi-tcp-0.88.nobase.patch&lt;br /&gt;
patch -d ucspi-tcp.xxx -p1 &amp;lt; ucspi-tcp-xxx.patch&lt;br /&gt;
make&amp;amp;&amp;amp;make setup check&lt;br /&gt;

daemontools&lt;br /&gt;
http://cr.yp.to/daemontools.html&lt;br /&gt;
daemontools-0.76.errno.patch&lt;br /&gt;
package/install&lt;br /&gt;
Adding svscanboot to inittab...init should start svscan now.&lt;br /&gt;

cmd5checkpw&lt;br /&gt;
http://www.fehcom.de/qmail/auth/cmd5checkpw-030_tgz.bin&lt;br /&gt;
make&amp;amp;&amp;amp;make setup&lt;br /&gt;

qmail 1.03&lt;br /&gt;
http://cr.yp.to/qmail.html&lt;br /&gt;
http://www.fehcom.de/qmail/qmail.html&lt;br /&gt;
http://www.fehcom.de/qmail/spamcontrol/spamcontrol-2311_tgz.bin&lt;br /&gt;
tar zxvf spamcontrol-2311_tgz.bin&lt;br /&gt;
编辑conf-spamcontrol&lt;br /&gt;
建立用户组&lt;br /&gt;
groupadd nofiles&lt;br /&gt;
useradd -g nofiles -d /var/qmail qmaild -s /sbin/nologin&lt;br /&gt;
useradd -g nofiles -d /var/qmail qmaill -s /sbin/nologin&lt;br /&gt;
useradd -g nofiles -d /var/qmail qmailp -s /sbin/nologin&lt;br /&gt;
useradd -g nofiles -d /var/qmail/alias alias -s /sbin/nologin&lt;br /&gt;
groupadd qmail&lt;br /&gt;
useradd -g qmail -d /var/qmail qmailq -s /sbin/nologin&lt;br /&gt;
useradd -g qmail -d /var/qmail qmailr -s /sbin/nologin&lt;br /&gt;
useradd -g qmail -d /var/qmail qmails -s /sbin/nologin&lt;br /&gt;
./install_spamcontrol.sh&lt;br /&gt;
make setup check&lt;br /&gt;
./config-fast xxxx.com&lt;br /&gt;

vpopmail&lt;br /&gt;
http://sourceforge.net/projects/vpopmail/&lt;br /&gt;
groupadd vchkpw;useradd vpopmail&lt;br /&gt;
CREATE DATABASE vpopmail;&lt;br /&gt;
GRANT select,insert,update,delete,create,drop ON vpopmail.* TO vpopmailuser@localhost IDENTIFIED BY &#39;vpoppasswd&#39;;&lt;br /&gt;
配置(用igenus需要enable-many-domains)&lt;br /&gt;
./configure   --enable-logging=p&lt;br /&gt;
--enable-domain-quotas=y&lt;br /&gt;
--enable-auth-module=mysql&lt;br /&gt;
--enable-tcprules-prog=/usr/local/bin/tcprules&lt;br /&gt;
--enable-tcpserver-file=/etc/tcp.smtp&lt;br /&gt;
--disable-mysql-limits&lt;br /&gt;
--enable-mysql-logging&lt;br /&gt;
--enable-many-domains&lt;br /&gt;
make&amp;amp;&amp;amp;make install-strip&lt;br /&gt;
vi vpopmail.mysql&lt;br /&gt;
vi vlimits.default&lt;br /&gt;
echo &#34;xxxx.com&#34; &amp;gt; /home/vpopmail/etc/defaultdomain&lt;br /&gt;
vi /home/vpopmail/domains/.quotawarn.msg&lt;br /&gt;
From: CAPH Postmaster&lt;br /&gt;
&lt;postmaster@xxx.com&gt; Reply-To: postmaster@xxx.com&lt;br /&gt;
To: SomeCompany User:;&lt;br /&gt;
Subject: Mail quota warning&lt;br /&gt;
Mime-Version: 1.0&lt;br /&gt;
Content-Type: text/plain; charset=iso-8859-1&lt;br /&gt;
Content-Transfer-Encoding: 7bit&lt;/postmaster@xxx.com&gt;&lt;br /&gt;

Your mailbox on the server is now more than 90% full.&lt;br /&gt;

So that you can continue to receive mail,&lt;br /&gt;
you need to remove some messages from your mailbox.&lt;br /&gt;

If you require assistance with this,&lt;br /&gt;
please contact our support department :&lt;br /&gt;

email : postmaster@xxx.com&lt;br /&gt;
Tel   : 010 68372647&lt;br /&gt;
echo &#34;Message rejected. Not enough storage space in user&#39;s mailbox to accept message.&#34; &amp;gt; /home/vpopmail/domains/.over-quota.msg&lt;br /&gt;

/var/qmail/rc&lt;br /&gt;
vi /var/qmail/rc&lt;br /&gt;
#!/bin/sh&lt;br /&gt;

# Using stdout for logging&lt;br /&gt;
# Using control/defaultdelivery from qmail-local to deliver messages by default&lt;br /&gt;

exec env - PATH=&#34;/var/qmail/bin:$PATH&#34;&lt;br /&gt;
qmail-start &#34;`cat /var/qmail/control/defaultdelivery`&#34;&lt;br /&gt;

echo ./Maildir/ &amp;gt;/var/qmail/control/defaultdelivery&lt;br /&gt;
chmod 755 /var/qmail/rc&lt;br /&gt;
mkdir /var/log/qmail&lt;br /&gt;

/var/qmail/bin/qmailctl&lt;br /&gt;

vi /var/qmail/bin/qmailctl&lt;br /&gt;
#!/bin/sh&lt;br /&gt;

# description: the qmail MTA&lt;br /&gt;

PATH=/var/qmail/bin:/bin:/usr/bin:/usr/local/bin:/usr/local/sbin&lt;br /&gt;
export PATH&lt;br /&gt;
LOG_AUTH=1&lt;br /&gt;
export LOG_AUTH&lt;br /&gt;

QMAILDUID=`id -u qmaild`&lt;br /&gt;
NOFILESGID=`id -g qmaild`&lt;br /&gt;

case &#34;$1&#34; in&lt;br /&gt;
start)&lt;br /&gt;
echo &#34;Starting qmail&#34;&lt;br /&gt;
if svok /service/qmail-send ; then&lt;br /&gt;
svc -u /service/qmail-send /service/qmail-send/log&lt;br /&gt;
else&lt;br /&gt;
echo &#34;qmail-send supervise not running&#34;&lt;br /&gt;
fi&lt;br /&gt;
if svok /service/qmail-smtpd ; then&lt;br /&gt;
svc -u /service/qmail-smtpd /service/qmail-smtpd/log&lt;br /&gt;
else&lt;br /&gt;
echo &#34;qmail-smtpd supervise not running&#34;&lt;br /&gt;
fi&lt;br /&gt;
if svok /service/qmail-pop3d ; then&lt;br /&gt;
svc -u /service/qmail-pop3d /service/qmail-pop3d/log&lt;br /&gt;
else&lt;br /&gt;
echo qmail-pop3d supervise not running&lt;br /&gt;
fi&lt;br /&gt;
if [ -d /var/lock/subsys ]; then&lt;br /&gt;
touch /var/lock/subsys/qmail&lt;br /&gt;
fi&lt;br /&gt;
;;&lt;br /&gt;
stop)&lt;br /&gt;
echo &#34;Stopping qmail...&#34;&lt;br /&gt;
echo &#34;  qmail-smtpd&#34;&lt;br /&gt;
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br /&gt;
echo &#34;  qmail-smtpd&#34;&lt;br /&gt;
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br /&gt;
echo &#34;  qmail-send&#34;&lt;br /&gt;
svc -d /service/qmail-send /service/qmail-send/log&lt;br /&gt;
echo &#34;  qmail-pop3d&#34;&lt;br /&gt;
svc -d /service/qmail-pop3d /service/qmail-pop3d/log&lt;br /&gt;
if [ -f /var/lock/subsys/qmail ]; then&lt;br /&gt;
rm /var/lock/subsys/qmail&lt;br /&gt;
fi&lt;br /&gt;
;;&lt;br /&gt;
stat)&lt;br /&gt;
svstat /service/qmail-send&lt;br /&gt;
svstat /service/qmail-send/log&lt;br /&gt;
svstat /service/qmail-smtpd&lt;br /&gt;
svstat /service/qmail-smtpd/log&lt;br /&gt;
svstat /service/qmail-pop3d&lt;br /&gt;
svstat /service/qmail-pop3d/log&lt;br /&gt;
qmail-qstat&lt;br /&gt;
;;&lt;br /&gt;
doqueue|alrm|flush)&lt;br /&gt;
echo &#34;Flushing timeout table and sending ALRM signal to qmail-send.&#34;&lt;br /&gt;
/var/qmail/bin/qmail-tcpok&lt;br /&gt;
svc -a /service/qmail-send&lt;br /&gt;
;;&lt;br /&gt;
queue)&lt;br /&gt;
qmail-qstat&lt;br /&gt;
qmail-qread&lt;br /&gt;
;;&lt;br /&gt;
reload|hup)&lt;br /&gt;
echo &#34;Sending HUP signal to qmail-send.&#34;&lt;br /&gt;
svc -h /service/qmail-send&lt;br /&gt;
;;&lt;br /&gt;
pause)&lt;br /&gt;
echo &#34;Pausing qmail-send&#34;&lt;br /&gt;
svc -p /service/qmail-send&lt;br /&gt;
echo &#34;Pausing qmail-smtpd&#34;&lt;br /&gt;
svc -p /service/qmail-smtpd&lt;br /&gt;
echo &#34;Pausing qmail-pop3d&#34;&lt;br /&gt;
svc -p /service/qmail-smtpd&lt;br /&gt;
echo &#34;Pausing qmail-pop3d&#34;&lt;br /&gt;
svc -p /service/qmail-pop3d&lt;br /&gt;
;;&lt;br /&gt;
cont)&lt;br /&gt;
echo &#34;Continuing qmail-send&#34;&lt;br /&gt;
svc -c /service/qmail-send&lt;br /&gt;
echo &#34;Continuing qmail-smtpd&#34;&lt;br /&gt;
svc -c /service/qmail-smtpd&lt;br /&gt;
echo &#34;Continuing qmail-pop3d&#34;&lt;br /&gt;
svc -c /service/qmail-pop3d&lt;br /&gt;
;;&lt;br /&gt;
restart)&lt;br /&gt;
echo &#34;Restarting qmail:&#34;&lt;br /&gt;
echo &#34;* Stopping qmail-smtpd.&#34;&lt;br /&gt;
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br /&gt;
echo &#34;* Sending qmail-send SIGTERM and restarting.&#34;&lt;br /&gt;
svc -t /service/qmail-send /service/qmail-send/log&lt;br /&gt;
echo &#34;* Restarting qmail-smtpd.&#34;&lt;br /&gt;
svc -u /service/qmail-smtpd /service/qmail-smtpd/log&lt;br /&gt;
echo &#34;* Restarting qmail-pop3d.&#34;&lt;br /&gt;
svc -t /service/qmail-pop3d /service/qmail-pop3d/log&lt;br /&gt;
;;&lt;br /&gt;
cdb)&lt;br /&gt;
tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &amp;lt; /etc/tcp.smtp&lt;br /&gt;
tcprules /etc/tcp.pop3.cdb /etc/tcp.pop3.tmp &amp;lt; /etc/tcp.pop3&lt;br /&gt;
chmod 644 /etc/tcp.smtp.cdb&lt;br /&gt;
chmod 644 /etc/tcp.pop3.cdb&lt;br /&gt;
echo &#34;Reloaded /etc/tcp.smtp.&#34;&lt;br /&gt;
echo &#34;Reloaded /etc/tcp.pop3.&#34;&lt;br /&gt;
;;&lt;br /&gt;
help)&lt;br /&gt;
cat &amp;lt;   stop -- stops mail service (smtp connections refused, nothing goes out)&lt;br /&gt;
start -- starts mail service (smtp connection accepted, mail can go out)&lt;br /&gt;
pause -- temporarily stops mail service (connections accepted, nothing leaves)&lt;br /&gt;
cont -- continues paused mail service&lt;br /&gt;
stat -- displays status of mail service&lt;br /&gt;
cont -- continues paused mail service&lt;br /&gt;
stat -- displays status of mail service&lt;br /&gt;
cdb -- rebuild the tcpserver cdb file for smtp&lt;br /&gt;
restart -- stops and restarts smtp, sends qmail-send a TERM &amp;amp; restarts it&lt;br /&gt;
doqueue -- schedules queued messages for immediate delivery&lt;br /&gt;
reload -- sends qmail-send HUP, rereading locals and virtualdomains&lt;br /&gt;
queue -- shows status of queue&lt;br /&gt;
alrm -- same as doqueue&lt;br /&gt;
flush -- same as doqueue&lt;br /&gt;
hup -- same as reload&lt;br /&gt;
HELP&lt;br /&gt;
;;&lt;br /&gt;
*)&lt;br /&gt;
echo &#34;Usage: $0 {start|stop|restart|doqueue|flush|reload|stat|pause|cont|cdb|queue|help}&#34;&lt;br /&gt;
exit 1&lt;br /&gt;
;;&lt;br /&gt;
esac&lt;br /&gt;

exit 0&lt;br /&gt;

chmod 755 /var/qmail/bin/qmailctl&lt;br /&gt;
ln -s /var/qmail/bin/qmailctl /usr/bin&lt;br /&gt;
echo 20 &amp;gt; /var/qmail/control/concurrencyincoming&lt;br /&gt;
chmod 644 /var/qmail/control/concurrencyincoming&lt;br /&gt;

supervise 脚本&lt;br /&gt;
mkdir -p /var/qmail/supervise/qmail-send/log&lt;br /&gt;
mkdir -p /var/qmail/supervise/qmail-smtpd/log&lt;br /&gt;
mkdir -p /var/qmail/supervise/qmail-pop3d/log&lt;br /&gt;

qmail-send&lt;br /&gt;

/var/qmail/supervise/qmail-send/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;
exec /var/qmail/rc&lt;br /&gt;

/var/qmail/supervise/qmail-send/log/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t /var/log/qmail&lt;br /&gt;

qmail-smtpd&lt;br /&gt;

/var/qmail/supervise/qmail-smtpd/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;

#QMAILDUID=`id -u qmaild`&lt;br /&gt;
NOFILESGID=`id -g qmaild`&lt;br /&gt;
QMAILDUID=`id -u vpopmail`&lt;br /&gt;
QMAILDGID=`id -g vpopmail`&lt;br /&gt;

MAXSMTPD=`cat /var/qmail/control/concurrencyincoming`&lt;br /&gt;
LOCAL=`head -1 /var/qmail/control/me`&lt;br /&gt;
if [ -z &#34;$QMAILDUID&#34; -o -z &#34;$NOFILESGID&#34; -o -z &#34;$MAXSMTPD&#34; -o -z &#34;$LOCAL&#34; ]; then&lt;br /&gt;
echo QMAILDUID, NOFILESGID, MAXSMTPD, or LOCAL is unset in&lt;br /&gt;
echo /var/qmail/supervise/qmail-smtpd/run&lt;br /&gt;
exit 1&lt;br /&gt;
fi&lt;br /&gt;
if [ ! -f /var/qmail/control/rcpthosts ]; then&lt;br /&gt;
echo &#34;No /var/qmail/control/rcpthosts!&#34;&lt;br /&gt;
echo &#34;Refusing to start SMTP listener because it&#39;ll create an open relay&#34;&lt;br /&gt;
exit 1&lt;br /&gt;
fi&lt;br /&gt;
exec /usr/local/bin/softlimit -m 30000000&lt;br /&gt;
/usr/local/bin/tcpserver -v -H -R -l &#34;$LOCAL&#34; -x /etc/tcp.smtp.cdb -c &#34;$MAXSMTPD&#34;&lt;br /&gt;
-u &#34;$QMAILDUID&#34; -g &#34;$QMAILDGID&#34; 0 smtp /usr/local/bin/rblsmtpd -r relays.ordb.org&lt;br /&gt;
/var/qmail/bin/qmail-smtpd&lt;br /&gt;
/home/vpopmail/bin/vchkpw /bin/true /bin/cmd5checkpw /bin/true 2&amp;gt;&amp;amp;1&lt;br /&gt;

/var/qmail/supervise/qmail-smtpd/log/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t&lt;br /&gt;
/var/log/qmail/smtpd&lt;br /&gt;

qmail-pop3d&lt;br /&gt;

/var/qmail/supervise/qmail-pop3d/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;

LOCAL=`head -1 /var/qmail/control/me`&lt;br /&gt;

exec /usr/local/bin/softlimit -m 30000000&lt;br /&gt;
/usr/local/bin/tcpserver -x /etc/tcp.pop3.cdb&lt;br /&gt;
-H -l $LOCAL&lt;br /&gt;
-v -c 20 -R 0 pop3&lt;br /&gt;
/var/qmail/bin/qmail-popup $LOCAL&lt;br /&gt;
/home/vpopmail/bin/vchkpw /var/qmail/bin/qmail-pop3d Maildir 2&amp;gt;&amp;amp;1&lt;br /&gt;

/var/qmail/supervise/qmail-pop3d/log/run&lt;br /&gt;

#!/bin/sh&lt;br /&gt;
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t&lt;br /&gt;
/var/log/qmail/pop3d&lt;br /&gt;

chmod 755 /var/qmail/supervise/qmail-send/run;chmod 755 /var/qmail/supervise/qmail-send/log/run&lt;br /&gt;
chmod 755 /var/qmail/supervise/qmail-smtpd/run;chmod 755 /var/qmail/supervise/qmail-smtpd/log/run&lt;br /&gt;
chmod 755 /var/qmail/supervise/qmail-pop3d/run;chmod 755 /var/qmail/supervise/qmail-pop3d/log/run&lt;br /&gt;
mkdir -p /var/log/qmail/smtpd;chown qmaill /var/log/qmail /var/log/qmail/smtpd&lt;br /&gt;
ln -s /var/qmail/supervise/qmail-send /var/qmail/supervise/qmail-smtpd /var/qmail/supervise/qmail-pop3d /service&lt;br /&gt;
touch .qmail-root .qmail-postmaster&lt;br /&gt;
ln -s .qmail-postmaster /var/qmail/alias/.qmail-mailer-daemon&lt;br /&gt;
chmod 644 /var/qmail/alias/.qmail-root /var/qmail/alias/.qmail-postmaster&lt;br /&gt;

clamav&lt;br /&gt;
http://www.clamav.net/&lt;br /&gt;
groupadd clamav&lt;br /&gt;
useradd -g clamav -s /sbin/nologin clamav -d /tmp&lt;br /&gt;
./configure&lt;br /&gt;
make check&lt;br /&gt;
make install&lt;br /&gt;

maildrop&lt;br /&gt;

./configure&lt;br /&gt;
make;make install-strip;make install-man&lt;br /&gt;

spamassassin&lt;br /&gt;

perl Makefile.PL&lt;br /&gt;
make&lt;br /&gt;
make install&lt;br /&gt;
cp spamd/redhat-rc-script.sh /etc/init.d/spamd&lt;br /&gt;

qmail-scanner&lt;br /&gt;

groupadd qscand;useradd -g qscand -s /sbin/nologin qscand -d /tmp&lt;br /&gt;
./configure --spooldir /var/qmailscan --qmaildir /var/qmail --bindir /var/qmail/bin --qmail-queue-binary&lt;br /&gt;
/var/qmail/bin/qmail-queue  --admin postmaster --domain xxx.com --notify sender,admin --local-domains &#34;xxx.com,xxx.com.cn,xxx.com.cn&#34; --silent-viruses auto --debug yes --unzip 1&lt;br /&gt;
--block-password-protected 0 --add-dscr-hdrs 0 --archive 0 --redundant yes --log-details syslog --log-crypto 0&lt;br /&gt;
--fix-mime 2  --ignore-eol-check 0 --scanners &#34;clamscan,fast_spamassassin&#34;&lt;br /&gt;

cp qmail-scanner-queue.pl /var/qmail/bin&lt;br /&gt;
chown qscand:qscand /var/qmail/bin/qmail-scanner-queue.pl&lt;br /&gt;
chmod 4755 /var/qmail/bin/qmail-scanner-queue.pl&lt;br /&gt;
vi /etc/tcp.smtp&lt;br /&gt;

127.:allow,RELAYCLIENT=&#34;&#34;,MFDNSCHECK=&#34;&#34;,BADMIMETYPE=&#34;&#34;,RBLSMTPD=&#34;&#34;,QMAILQUEUE=&#34;/var/&lt;br /&gt;
qmail/bin/qmail-scanner-queue.pl&#34;&lt;br /&gt;

qmailctl cdb&lt;br /&gt;
qmailctl restart&lt;br /&gt;
contrib/test_installation.sh -doit测试&lt;br /&gt;
</description>
    </item>
    
  </channel>
</rss>