<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Qmail on wd and cc</title><link>https://wdicc.com/tags/qmail/</link><description>Recent content in Qmail on wd and cc</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Mon, 16 Jan 2006 00:00:00 +0000</lastBuildDate><atom:link href="https://wdicc.com/tags/qmail/atom.xml" rel="self" type="application/rss+xml"/><item><title>caphit qmail 配置</title><link>https://wdicc.com/caphit-qmail-conf/</link><pubDate>Mon, 16 Jan 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/caphit-qmail-conf/</guid><description>参考网址&lt;br />
http://lifewithqmail.org(中文版http://lifewithqmail.org/LWQ-CN.html)&lt;br />
http://qmail.te8.com/rpms/glibc-2.3.1/(patch下载地址)&lt;br />
http://www.fehcom.de/qmail/qmail.html&lt;br />
http://www.pipeline.com.au/staff/mbowe/isp/vpopmail-mysql.htm&lt;br />
http://bbs.chinaunix.net/forum/viewtopic.php?t=254662&lt;br />

ucspi-tcp&lt;br />
http://cr.yp.to/ucspi-tcp.html&lt;br />
ucspi-tcp-0.88.a_record.patch，ucspi-tcp-0.88.errno.patch，ucspi-tcp-0.88.nodefaultrbl.patch&lt;br />
（或者）ucspi-tcp-0.88.a_record.patch，ucspi-tcp-0.88.errno.patch，ucspi-tcp-0.88.nobase.patch&lt;br />
patch -d ucspi-tcp.xxx -p1 &amp;lt; ucspi-tcp-xxx.patch&lt;br />
make&amp;amp;&amp;amp;make setup check&lt;br />

daemontools&lt;br />
http://cr.yp.to/daemontools.html&lt;br />
daemontools-0.76.errno.patch&lt;br />
package/install&lt;br />
Adding svscanboot to inittab...init should start svscan now.&lt;br />

cmd5checkpw&lt;br />
http://www.fehcom.de/qmail/auth/cmd5checkpw-030_tgz.bin&lt;br />
make&amp;amp;&amp;amp;make setup&lt;br />

qmail 1.03&lt;br />
http://cr.yp.to/qmail.html&lt;br />
http://www.fehcom.de/qmail/qmail.html&lt;br />
http://www.fehcom.de/qmail/spamcontrol/spamcontrol-2311_tgz.bin&lt;br />
tar zxvf spamcontrol-2311_tgz.bin&lt;br />
编辑conf-spamcontrol&lt;br />
建立用户组&lt;br />
groupadd nofiles&lt;br />
useradd -g nofiles -d /var/qmail qmaild -s /sbin/nologin&lt;br />
useradd -g nofiles -d /var/qmail qmaill -s /sbin/nologin&lt;br />
useradd -g nofiles -d /var/qmail qmailp -s /sbin/nologin&lt;br />
useradd -g nofiles -d /var/qmail/alias alias -s /sbin/nologin&lt;br />
groupadd qmail&lt;br />
useradd -g qmail -d /var/qmail qmailq -s /sbin/nologin&lt;br />
useradd -g qmail -d /var/qmail qmailr -s /sbin/nologin&lt;br />
useradd -g qmail -d /var/qmail qmails -s /sbin/nologin&lt;br />
./install_spamcontrol.sh&lt;br />
make setup check&lt;br />
./config-fast xxxx.com&lt;br />

vpopmail&lt;br />
http://sourceforge.net/projects/vpopmail/&lt;br />
groupadd vchkpw;useradd vpopmail&lt;br />
CREATE DATABASE vpopmail;&lt;br />
GRANT select,insert,update,delete,create,drop ON vpopmail.* TO vpopmailuser@localhost IDENTIFIED BY 'vpoppasswd';&lt;br />
配置(用igenus需要enable-many-domains)&lt;br />
./configure --enable-logging=p&lt;br />
--enable-domain-quotas=y&lt;br />
--enable-auth-module=mysql&lt;br />
--enable-tcprules-prog=/usr/local/bin/tcprules&lt;br />
--enable-tcpserver-file=/etc/tcp.smtp&lt;br />
--disable-mysql-limits&lt;br />
--enable-mysql-logging&lt;br />
--enable-many-domains&lt;br />
make&amp;amp;&amp;amp;make install-strip&lt;br />
vi vpopmail.mysql&lt;br />
vi vlimits.default&lt;br />
echo "xxxx.com" &amp;gt; /home/vpopmail/etc/defaultdomain&lt;br />
vi /home/vpopmail/domains/.quotawarn.msg&lt;br />
From: CAPH Postmaster&lt;br />
&lt;postmaster@xxx.com> Reply-To: postmaster@xxx.com&lt;br />
To: SomeCompany User:;&lt;br />
Subject: Mail quota warning&lt;br />
Mime-Version: 1.0&lt;br />
Content-Type: text/plain; charset=iso-8859-1&lt;br />
Content-Transfer-Encoding: 7bit&lt;/postmaster@xxx.com>&lt;br />

Your mailbox on the server is now more than 90% full.&lt;br />

So that you can continue to receive mail,&lt;br />
you need to remove some messages from your mailbox.&lt;br />

If you require assistance with this,&lt;br />
please contact our support department :&lt;br />

email : postmaster@xxx.com&lt;br />
Tel : 010 68372647&lt;br />
echo "Message rejected. Not enough storage space in user's mailbox to accept message." &amp;gt; /home/vpopmail/domains/.over-quota.msg&lt;br />

/var/qmail/rc&lt;br />
vi /var/qmail/rc&lt;br />
#!/bin/sh&lt;br />

# Using stdout for logging&lt;br />
# Using control/defaultdelivery from qmail-local to deliver messages by default&lt;br />

exec env - PATH="/var/qmail/bin:$PATH"&lt;br />
qmail-start "`cat /var/qmail/control/defaultdelivery`"&lt;br />

echo ./Maildir/ &amp;gt;/var/qmail/control/defaultdelivery&lt;br />
chmod 755 /var/qmail/rc&lt;br />
mkdir /var/log/qmail&lt;br />

/var/qmail/bin/qmailctl&lt;br />

vi /var/qmail/bin/qmailctl&lt;br />
#!/bin/sh&lt;br />

# description: the qmail MTA&lt;br />

PATH=/var/qmail/bin:/bin:/usr/bin:/usr/local/bin:/usr/local/sbin&lt;br />
export PATH&lt;br />
LOG_AUTH=1&lt;br />
export LOG_AUTH&lt;br />

QMAILDUID=`id -u qmaild`&lt;br />
NOFILESGID=`id -g qmaild`&lt;br />

case "$1" in&lt;br />
start)&lt;br />
echo "Starting qmail"&lt;br />
if svok /service/qmail-send ; then&lt;br />
svc -u /service/qmail-send /service/qmail-send/log&lt;br />
else&lt;br />
echo "qmail-send supervise not running"&lt;br />
fi&lt;br />
if svok /service/qmail-smtpd ; then&lt;br />
svc -u /service/qmail-smtpd /service/qmail-smtpd/log&lt;br />
else&lt;br />
echo "qmail-smtpd supervise not running"&lt;br />
fi&lt;br />
if svok /service/qmail-pop3d ; then&lt;br />
svc -u /service/qmail-pop3d /service/qmail-pop3d/log&lt;br />
else&lt;br />
echo qmail-pop3d supervise not running&lt;br />
fi&lt;br />
if [ -d /var/lock/subsys ]; then&lt;br />
touch /var/lock/subsys/qmail&lt;br />
fi&lt;br />
;;&lt;br />
stop)&lt;br />
echo "Stopping qmail..."&lt;br />
echo " qmail-smtpd"&lt;br />
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br />
echo " qmail-smtpd"&lt;br />
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br />
echo " qmail-send"&lt;br />
svc -d /service/qmail-send /service/qmail-send/log&lt;br />
echo " qmail-pop3d"&lt;br />
svc -d /service/qmail-pop3d /service/qmail-pop3d/log&lt;br />
if [ -f /var/lock/subsys/qmail ]; then&lt;br />
rm /var/lock/subsys/qmail&lt;br />
fi&lt;br />
;;&lt;br />
stat)&lt;br />
svstat /service/qmail-send&lt;br />
svstat /service/qmail-send/log&lt;br />
svstat /service/qmail-smtpd&lt;br />
svstat /service/qmail-smtpd/log&lt;br />
svstat /service/qmail-pop3d&lt;br />
svstat /service/qmail-pop3d/log&lt;br />
qmail-qstat&lt;br />
;;&lt;br />
doqueue|alrm|flush)&lt;br />
echo "Flushing timeout table and sending ALRM signal to qmail-send."&lt;br />
/var/qmail/bin/qmail-tcpok&lt;br />
svc -a /service/qmail-send&lt;br />
;;&lt;br />
queue)&lt;br />
qmail-qstat&lt;br />
qmail-qread&lt;br />
;;&lt;br />
reload|hup)&lt;br />
echo "Sending HUP signal to qmail-send."&lt;br />
svc -h /service/qmail-send&lt;br />
;;&lt;br />
pause)&lt;br />
echo "Pausing qmail-send"&lt;br />
svc -p /service/qmail-send&lt;br />
echo "Pausing qmail-smtpd"&lt;br />
svc -p /service/qmail-smtpd&lt;br />
echo "Pausing qmail-pop3d"&lt;br />
svc -p /service/qmail-smtpd&lt;br />
echo "Pausing qmail-pop3d"&lt;br />
svc -p /service/qmail-pop3d&lt;br />
;;&lt;br />
cont)&lt;br />
echo "Continuing qmail-send"&lt;br />
svc -c /service/qmail-send&lt;br />
echo "Continuing qmail-smtpd"&lt;br />
svc -c /service/qmail-smtpd&lt;br />
echo "Continuing qmail-pop3d"&lt;br />
svc -c /service/qmail-pop3d&lt;br />
;;&lt;br />
restart)&lt;br />
echo "Restarting qmail:"&lt;br />
echo "* Stopping qmail-smtpd."&lt;br />
svc -d /service/qmail-smtpd /service/qmail-smtpd/log&lt;br />
echo "* Sending qmail-send SIGTERM and restarting."&lt;br />
svc -t /service/qmail-send /service/qmail-send/log&lt;br />
echo "* Restarting qmail-smtpd."&lt;br />
svc -u /service/qmail-smtpd /service/qmail-smtpd/log&lt;br />
echo "* Restarting qmail-pop3d."&lt;br />
svc -t /service/qmail-pop3d /service/qmail-pop3d/log&lt;br />
;;&lt;br />
cdb)&lt;br />
tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &amp;lt; /etc/tcp.smtp&lt;br />
tcprules /etc/tcp.pop3.cdb /etc/tcp.pop3.tmp &amp;lt; /etc/tcp.pop3&lt;br />
chmod 644 /etc/tcp.smtp.cdb&lt;br />
chmod 644 /etc/tcp.pop3.cdb&lt;br />
echo "Reloaded /etc/tcp.smtp."&lt;br />
echo "Reloaded /etc/tcp.pop3."&lt;br />
;;&lt;br />
help)&lt;br />
cat &amp;lt; stop -- stops mail service (smtp connections refused, nothing goes out)&lt;br />
start -- starts mail service (smtp connection accepted, mail can go out)&lt;br />
pause -- temporarily stops mail service (connections accepted, nothing leaves)&lt;br />
cont -- continues paused mail service&lt;br />
stat -- displays status of mail service&lt;br />
cont -- continues paused mail service&lt;br />
stat -- displays status of mail service&lt;br />
cdb -- rebuild the tcpserver cdb file for smtp&lt;br />
restart -- stops and restarts smtp, sends qmail-send a TERM &amp;amp; restarts it&lt;br />
doqueue -- schedules queued messages for immediate delivery&lt;br />
reload -- sends qmail-send HUP, rereading locals and virtualdomains&lt;br />
queue -- shows status of queue&lt;br />
alrm -- same as doqueue&lt;br />
flush -- same as doqueue&lt;br />
hup -- same as reload&lt;br />
HELP&lt;br />
;;&lt;br />
*)&lt;br />
echo "Usage: $0 {start|stop|restart|doqueue|flush|reload|stat|pause|cont|cdb|queue|help}"&lt;br />
exit 1&lt;br />
;;&lt;br />
esac&lt;br />

exit 0&lt;br />

chmod 755 /var/qmail/bin/qmailctl&lt;br />
ln -s /var/qmail/bin/qmailctl /usr/bin&lt;br />
echo 20 &amp;gt; /var/qmail/control/concurrencyincoming&lt;br />
chmod 644 /var/qmail/control/concurrencyincoming&lt;br />

supervise 脚本&lt;br />
mkdir -p /var/qmail/supervise/qmail-send/log&lt;br />
mkdir -p /var/qmail/supervise/qmail-smtpd/log&lt;br />
mkdir -p /var/qmail/supervise/qmail-pop3d/log&lt;br />

qmail-send&lt;br />

/var/qmail/supervise/qmail-send/run&lt;br />

#!/bin/sh&lt;br />
exec /var/qmail/rc&lt;br />

/var/qmail/supervise/qmail-send/log/run&lt;br />

#!/bin/sh&lt;br />
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t /var/log/qmail&lt;br />

qmail-smtpd&lt;br />

/var/qmail/supervise/qmail-smtpd/run&lt;br />

#!/bin/sh&lt;br />

#QMAILDUID=`id -u qmaild`&lt;br />
NOFILESGID=`id -g qmaild`&lt;br />
QMAILDUID=`id -u vpopmail`&lt;br />
QMAILDGID=`id -g vpopmail`&lt;br />

MAXSMTPD=`cat /var/qmail/control/concurrencyincoming`&lt;br />
LOCAL=`head -1 /var/qmail/control/me`&lt;br />
if [ -z "$QMAILDUID" -o -z "$NOFILESGID" -o -z "$MAXSMTPD" -o -z "$LOCAL" ]; then&lt;br />
echo QMAILDUID, NOFILESGID, MAXSMTPD, or LOCAL is unset in&lt;br />
echo /var/qmail/supervise/qmail-smtpd/run&lt;br />
exit 1&lt;br />
fi&lt;br />
if [ ! -f /var/qmail/control/rcpthosts ]; then&lt;br />
echo "No /var/qmail/control/rcpthosts!"&lt;br />
echo "Refusing to start SMTP listener because it'll create an open relay"&lt;br />
exit 1&lt;br />
fi&lt;br />
exec /usr/local/bin/softlimit -m 30000000&lt;br />
/usr/local/bin/tcpserver -v -H -R -l "$LOCAL" -x /etc/tcp.smtp.cdb -c "$MAXSMTPD"&lt;br />
-u "$QMAILDUID" -g "$QMAILDGID" 0 smtp /usr/local/bin/rblsmtpd -r relays.ordb.org&lt;br />
/var/qmail/bin/qmail-smtpd&lt;br />
/home/vpopmail/bin/vchkpw /bin/true /bin/cmd5checkpw /bin/true 2&amp;gt;&amp;amp;1&lt;br />

/var/qmail/supervise/qmail-smtpd/log/run&lt;br />

#!/bin/sh&lt;br />
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t&lt;br />
/var/log/qmail/smtpd&lt;br />

qmail-pop3d&lt;br />

/var/qmail/supervise/qmail-pop3d/run&lt;br />

#!/bin/sh&lt;br />

LOCAL=`head -1 /var/qmail/control/me`&lt;br />

exec /usr/local/bin/softlimit -m 30000000&lt;br />
/usr/local/bin/tcpserver -x /etc/tcp.pop3.cdb&lt;br />
-H -l $LOCAL&lt;br />
-v -c 20 -R 0 pop3&lt;br />
/var/qmail/bin/qmail-popup $LOCAL&lt;br />
/home/vpopmail/bin/vchkpw /var/qmail/bin/qmail-pop3d Maildir 2&amp;gt;&amp;amp;1&lt;br />

/var/qmail/supervise/qmail-pop3d/log/run&lt;br />

#!/bin/sh&lt;br />
exec /usr/local/bin/setuidgid qmaill /usr/local/bin/multilog t&lt;br />
/var/log/qmail/pop3d&lt;br />

chmod 755 /var/qmail/supervise/qmail-send/run;chmod 755 /var/qmail/supervise/qmail-send/log/run&lt;br />
chmod 755 /var/qmail/supervise/qmail-smtpd/run;chmod 755 /var/qmail/supervise/qmail-smtpd/log/run&lt;br />
chmod 755 /var/qmail/supervise/qmail-pop3d/run;chmod 755 /var/qmail/supervise/qmail-pop3d/log/run&lt;br />
mkdir -p /var/log/qmail/smtpd;chown qmaill /var/log/qmail /var/log/qmail/smtpd&lt;br />
ln -s /var/qmail/supervise/qmail-send /var/qmail/supervise/qmail-smtpd /var/qmail/supervise/qmail-pop3d /service&lt;br />
touch .qmail-root .qmail-postmaster&lt;br />
ln -s .qmail-postmaster /var/qmail/alias/.qmail-mailer-daemon&lt;br />
chmod 644 /var/qmail/alias/.qmail-root /var/qmail/alias/.qmail-postmaster&lt;br />

clamav&lt;br />
http://www.clamav.net/&lt;br />
groupadd clamav&lt;br />
useradd -g clamav -s /sbin/nologin clamav -d /tmp&lt;br />
./configure&lt;br />
make check&lt;br />
make install&lt;br />

maildrop&lt;br />

./configure&lt;br />
make;make install-strip;make install-man&lt;br />

spamassassin&lt;br />

perl Makefile.PL&lt;br />
make&lt;br />
make install&lt;br />
cp spamd/redhat-rc-script.sh /etc/init.d/spamd&lt;br />

qmail-scanner&lt;br />

groupadd qscand;useradd -g qscand -s /sbin/nologin qscand -d /tmp&lt;br />
./configure --spooldir /var/qmailscan --qmaildir /var/qmail --bindir /var/qmail/bin --qmail-queue-binary&lt;br />
/var/qmail/bin/qmail-queue --admin postmaster --domain xxx.com --notify sender,admin --local-domains "xxx.com,xxx.com.cn,xxx.com.cn" --silent-viruses auto --debug yes --unzip 1&lt;br />
--block-password-protected 0 --add-dscr-hdrs 0 --archive 0 --redundant yes --log-details syslog --log-crypto 0&lt;br />
--fix-mime 2 --ignore-eol-check 0 --scanners "clamscan,fast_spamassassin"&lt;br />

cp qmail-scanner-queue.pl /var/qmail/bin&lt;br />
chown qscand:qscand /var/qmail/bin/qmail-scanner-queue.pl&lt;br />
chmod 4755 /var/qmail/bin/qmail-scanner-queue.pl&lt;br />
vi /etc/tcp.smtp&lt;br />

127.:allow,RELAYCLIENT="",MFDNSCHECK="",BADMIMETYPE="",RBLSMTPD="",QMAILQUEUE="/var/&lt;br />
qmail/bin/qmail-scanner-queue.pl"&lt;br />

qmailctl cdb&lt;br />
qmailctl restart&lt;br />
contrib/test_installation.sh -doit测试&lt;br /></description></item><item><title>Howto Qmail with spamassassin</title><link>https://wdicc.com/howto-qmail-with-spamassassin/</link><pubDate>Mon, 16 Jan 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/howto-qmail-with-spamassassin/</guid><description>http://sylvestre.ledru.info/howto/howto_qmail_spamassassin.php&lt;br />

By Sylvestre Ledru June 2003&lt;br />
Version francaise&lt;br />
Return to the linux page&lt;br />

(02/04/2002), Bug fix :&lt;br />
I just add a little bug fix for some OS which remove the +x on qmail-queue (the qmail-scanner is not concerned)&lt;br />
(01/11/2003), Qmail-scanner :&lt;br />
I had a new way of calling spamassassin client using qmail-scanner.&lt;br />
(23/07/2003), Preferences :&lt;br />
Matthew Francis sent me a quite good howto explaining how to get user preferences for spamassassin. It is available here.&lt;br />
(08/06/2003), Localisation :&lt;br />
If you want to change the language of the spam report (ie why the email has been tagged as a spam), just change the locales to your language (dpkg-reconfigure locales under debian) and install gettext (apt-get install gettext) and you will have the appropriate version (french for example)...&lt;br />
(11/03/2005), Update :&lt;br />
After almost two years without updates, my other howto about qmail is much more complet and uptodate, I clean this one :&lt;br />
- first method deprecated&lt;br />
- new version of spamassassin 3.0.X&lt;br />
- use of netqmail instead of qmail&lt;br />
- new version of qmail-scanner with the q-s-st patch (activation of Spamassassin just for a domain)&lt;br />

If you like this howto and you want to thank me for my work : here is my wishlist on Amazon - France or my Amazon US wishlist :)&lt;br />
If you are a corporation and you make some business thanks to my howto, we'll love to have a present from you (or just tell me who is using my howto).&lt;br />
Thank to Scott Kinkade for his cash donation. I really do appreciate.&lt;br />

If you want more informations about the intallation of qmail, I wrote a long howto about.&lt;br />
I wrote this howto because there is a lack of documentation about qmail with spamassassin.&lt;br />

This howto has been designed for qmail with vpopmail but it should work without a lot of modifications with something else than vpopmail.&lt;br />

Spamassassin is a very powerfull program which checks if the receveid email is a spam or not. The analys is based on a list of mark. If the sum of all the mark exceed a specified amount (for example 5), the email will be tagged (****SPAM**** in the topic).&lt;br />
With this, it is very easy to create a rule which will move all emails into a specific directory (i.e. trash:)&lt;br />

If you want to link Qmail with spamassassin, it is quite easy.&lt;br />
First, install spamassassin and install razor and pyzor if you want to use it.&lt;br />
Under debian :&lt;br />
apt-get install spamassassin You should use the "debian unstable or testing" version of spamassassin which, most of the time, will find more spam.&lt;br />

Under other system (Redhat, Suse, Solaris ...) : The latest version of spamassassin today is the version 3.0.2. The installation is almost the same, only a few directives changed.&lt;br />
wget http://useast.spamassassin.org/released/Mail-SpamAssassin-2.55.tar.gz&lt;br />
tar -zxvf Mail-SpamAssassin-2.55.tar.gz&lt;br />
cd Mail-SpamAssassin-2.55&lt;br />
perl Makefile.PL&lt;br />
make&lt;br />
make install&lt;br />
cp spamd/debian-rc-script.sh /etc/init.d/spamassassin You can replace debian by redhat, solaris, netbsd, suse ...&lt;br />
chmod +x /etc/init.d/spamassassin&lt;br />

Then, edit /etc/spamassassin/local.cf&lt;br />
Version 2.5X :&lt;br />
required_hits 6.0&lt;br />
rewrite_subject 1&lt;br />
report_header 1&lt;br />
use_terse_report 1&lt;br />
defang_mime 1&lt;br />
dns_available yes&lt;br />
dcc_add_header 1&lt;br />
use_pyzor 1 (Only if you have installed pyzor)&lt;br />
use_razor2 (Only if you have installed razor2)&lt;br />
use_dcc 1&lt;br />
Version 3 :&lt;br />
#Number of points to tag the spam required_hits 5.0 # Add the result in the header always_add_headers 1 # change the subject rewrite_subject 1 report_safe 1 use_terse_report 1 # dns checks (warning : increase the process length) dns_available yes dcc_add_header 0 # Don't skip the relay black list skip_rbl_checks 0 use_dcc 1 dcc_timeout 10 # Remote verification use_pyzor 1 pyzor_timeout 10 pyzor_add_header 1 # Never from the previous results auto_learn 1 # use the bayes filter use_bayes 1 # Where spamassassin must store these informations : bayes_path /var/qmail/spamassassin/ # Where he stores the auto white list results : auto_whitelist_path /var/qmail/spamassassin/auto_whitelist&lt;br />
If you want to have detailled information about spamassassin processing, add the line in the local.cf file : timelog_path /var/log/spamassassin, run the daemon with the -D option (so, specify it in the /etc/default/spamassassin file under debian), create the directory with appropriate rights (should be vpopmail). In the directory, you will have for each email a file which sum up the spamassassin process (it is a debug option !).&lt;br />

I use these rules. Feel free to change ! Documentation about this is available here : perldoc Mail::SpamAssassin::Conf&lt;br />

In /etc/default/spamassassin (if this file does not exist, create it)&lt;br />
Change ENABLED to 1, then add these options : - "-m 10 -v --auto-whitelist" for the version 2.5X.&lt;br />
- "-v -m 10 -u vpopmail --nouser-config" for the version 3&lt;br />
With that stuff, you can launch spamd which is bascilly a spamassassin deamon (provide great performances).&lt;br />
-m 10 =&amp;gt; 10 childs&lt;br />
-v =&amp;gt; vpopmail config&lt;br />
--auto-whitelist =&amp;gt; Use auto whitelist (friend list)&lt;br />
Instead of spamassassin, you have to use spamc in order to test email.&lt;br />
There are some options "-c -u vpopmail" which enabled the creation of preferences for a domain or a user but it does not work very well for me.&lt;br />
/etc/init.d/spamassassin start&lt;br />

Next, the modification of qmail in order to check emails.&lt;br />
Basically, there are two kind of configuration for qmail :&lt;br />
- the fastest/easiest way is to change the qmail-queue in order to "introduce" the spamasssin check.Deprecated&lt;br />
- the cleanest way is to use qmail-scanner.&lt;br />
Changing the qmail-queue program&lt;br />
cp /var/qmail/bin/qmail-queue /var/qmail/bin/qmail-queue.orig&lt;br />
chown qmailq:qmail qmail-queue&lt;br />
chown qmailq:qmail qmail-queue.orig&lt;br />
chmod u+s qmail-queue.orig&lt;br />
chmod o+r,+x qmail-queue.orig qmail-queue Not fundamental but sometime it is necessary (depends the system)&lt;br />

mkdir /home/vpopmail/.spamassassin&lt;br />
cd /home/vpopmail&lt;br />
chmod 777 /home/vpopmail/.spamassassin&lt;br />

chown -R qmailq:qmail .spamassassin&lt;br />
chmod u=rwx,g=rx,o= /home/vpopmail/.spamassassin&lt;br />
Now, delete the content of the executable which manage the queue.&lt;br />
echo -n &amp;gt; /var/qmail/bin/qmail-queue&lt;br />
Then, edit the qmail-queue file and add this inside :&lt;br />
#!/bin/sh&lt;br />
/usr/bin/spamc | /var/qmail/bin/qmail-queue.orig&lt;br />
I agree that it is a quick/dirty method. It causes some issues with the injection of a bounce in the queue. (qmail-queue is not planned to work this way).&lt;br />
With qmail-scanner - Visit http://sylvestre.ledru.info/howto/howto_qmail_vpopmail.php for more informations&lt;br />
First, you have to patch qmail with the qmailqueue-patch or install netqmail which has already this plugin.&lt;br />
Qmail with the patch :&lt;br />
wget http://qmail.agarik.com/qmail-1.03.tar.gz&lt;br />
tar -zxvf qmail-1.03.tar.gz&lt;br />
cd qmail-1.03&lt;br />
wget http://qmail.mirrored.ca/moni.csi.hu/pub/glibc-2.3.1/qmail-1.03.errno.patch&lt;br />
wget http://sylvestre.ledru.info/howto/qmail/qmailqueue-patch&lt;br />
patch -p1 &amp;lt; qmail-1.03.errno.patch&lt;br />
patch -p1 &amp;lt; qmailqueue-patch&lt;br />
With netqmail :&lt;br />
wget http://qmail.agarik.com/netqmail-1.05.tar.gz&lt;br />
tar -zxvf netqmail-1.05.tar.gz&lt;br />
cd netqmail-1.05/&lt;br />
./collate.sh&lt;br />
cd netqmail-1.05&lt;br />
Add the QMAILQUEUE parameter to the /etc/tcp.smtp file :&lt;br />
127.0.0.1:allow,RELAYCLIENT="",QMAILQUEUE="/var/qmail/bin/qmail-scanner-queue.pl"&lt;br />
198.168.1.:allow,RELAYCLIENT="",QMAILQUEUE="/var/qmail/bin/qmail-scanner-queue.pl"&lt;br />
:allow,QMAILQUEUE="/var/qmail/bin/qmail-scanner-queue.pl"&lt;br />
Rehash tcpserver :&lt;br />
/usr/local/bin/tcprules /etc/tcp.smtp.cdb /etc/tcp.smtp.tmp &amp;lt; /etc/tcp.smtp&lt;br />
chmod 644 /etc/tcp.smtp.cdb&lt;br />
And then, install qmail-scanner with qmail-scanner-st&lt;br />
. qmail-scanner-st is a patched version a qmail-scanner which enabled great features like auto delete/reject/quarantine spam over a specified score but also to select which scanners will be used for a domain and even for a user, then, it is possible to configure the spamassassin / antivirus just for one domain/user.&lt;br />
wget http://unc.dl.sourceforge.net/sourceforge/qmail-scanner/qmail-scanner-1.25.tgz wget http://xoomer.virgilio.it/j.toribio/qmail-scanner/download/q-s-1.25st-20050207.patch.gz&lt;br />
gunzip q-s-1.25st-20050207.patch.gz&lt;br />
tar -zxvf qmail-scanner-1.25.tgz&lt;br />
cd qmail-scanner-1.25/&lt;br />
patch -p1 &amp;lt; ../q-s-1.25st-20050207.patch&lt;br />
groupadd qscand&lt;br />
useradd -c "Qmail-Scanner Account" -g qscand -s /bin/false qscand&lt;br />
./configure --qs-user qscand --qs-group qscand --spooldir /var/spool/qmailscan --qmaildir /var/qmail --bindir /var/qmail/bin --qmail-queue-binary /var/qmail/bin/qmail-queue --admin-fromname "Mail admin" --admin postmaster --domain vladimir.avence.info --notify sender,admin,recips --local-domains `cat /var/qmail/control/rcpthosts | tr "\n" " "` --silent-viruses auto --unzip 1 --add-dscr-hdrs 1 --archive 0 --redundant yes --log-crypto 0 --scanners "fast_spamassassin" --scanners-per-domain yes --sa-subject "*****SPAM*****" --sa-delete 5 --install 1&lt;br />
After the installation, if you want to change your preferences, you have to edit the /var/qmail/bin/qmail-scanner-queue.pl file. In this file, you can also add option for the spamassassin client.&lt;br />
If you want to enable/disable some scanners, edit the /var/spool/qmailscan/scanners_per_domain.txt&lt;br />
To rehash the scanner per domain file : /var/qmail/bin/qmail-scanner-queue.pl -p&lt;br />
To rehash the quarantine attachement file : /var/qmail/bin/qmail-scanner-queue.pl -g&lt;br />
trunks.ecranbleu.org:sa,ps,clamdscan_scanner&lt;br />

# sa = spamassassin&lt;br />
# ps = perl scanner&lt;br />

This should be enough to use SpamAssassin on the whole system.&lt;br />
I have to try to find how it can be linked with vpopmail in order to create preference for a specific domain or a specific user. (if someone knows : sylvestre@ecranbleu.org)&lt;br />

Problems :&lt;br />
- link with vpopmail&lt;br />
This howto is inspired and corrected from :&lt;br />
http://www.euronet.nl/users/erhnam/linux/qmail/qmail.htm.&lt;br /></description></item></channel></rss>