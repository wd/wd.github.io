<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Other on wd and cc</title><link>https://wdicc.com/tags/other/</link><description>Recent content in Other on wd and cc</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Sun, 16 Sep 2007 00:00:00 +0000</lastBuildDate><atom:link href="https://wdicc.com/tags/other/atom.xml" rel="self" type="application/rss+xml"/><item><title>gdm登陆窗口的方块乱码</title><link>https://wdicc.com/gdm-problem/</link><pubDate>Sun, 16 Sep 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/gdm-problem/</guid><description>&lt;p>这几天一直有个问题解决不了，gdm的登陆窗口上面的字体是方块。我一般都是使用home下面的.fonts.conf 来配置字体的。不过gdm启动的时候好像也不会读取你home的下吧，所以还是把他放到了/etc/fonts/local.conf 里面。&lt;/p></description></item><item><title>安装配置一台 apache+php+mysql 的rh el4服务器</title><link>https://wdicc.com/setup-apache-mysql-php-in-rhel4/</link><pubDate>Sun, 16 Sep 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/setup-apache-mysql-php-in-rhel4/</guid><description>&lt;p>&lt;strong>系统&lt;/strong>&lt;/p> &lt;p>rh el4 是四张盘，用第一张启动电脑。前面没啥好说的了，后面选择软件的时候，不要选x界面的东西，开发工具全选上，别的好像默认就行了，大概需要2G好像是。&lt;/p></description></item><item><title>给ibm server设置raid</title><link>https://wdicc.com/raid-on-ibm-server/</link><pubDate>Sun, 16 Sep 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/raid-on-ibm-server/</guid><description>昨天去给一台没拆封的ibm server装系统，头一次弄了raid，发现操作起来也不难。之前心里没底，就去yahoo搜索了一下，发现图解的都是使用server guide 那个光盘安装windows的（其实就一篇文章，n多人转载了），这次装就顺便拍了一下，呵呵。&lt;br />

server guide 光盘的图，用serverguide安装也挺简单的，光盘启动之后按照提示一步一步来就行了。&lt;br />

&lt;img src="http://photo11.yupoo.com/20070916/085847_910633405.jpg" />&lt;br />

&lt;img src="http://photo11.yupoo.com/20070916/085837_2093046889.jpg" />&lt;br /></description></item><item><title>涉及到linux系统安全的几个文件</title><link>https://wdicc.com/some-importent-files-in-linux/</link><pubDate>Tue, 24 Jul 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/some-importent-files-in-linux/</guid><description>&lt;p>部分内容转自&lt;a href="http://man.chinaunix.net/linux/debian/debian_learning/index.html" target="_blank">这里&lt;/a>&lt;/p> &lt;p>&lt;strong>1 cron.allow,cron.deny&lt;/strong>&lt;/p> &lt;blockquote> &lt;p>If the cron.allow file exists, then you must be listed therein in order to be allowed to use this command. If the cron.allow file does not exist but the cron.deny file does exist, then you must not be listed in the cron.deny file in order to use this command. If neither of these files exists, only the super user will be allowed to use this command.&lt;/p></description></item><item><title>smsd 发送中文短信乱码</title><link>https://wdicc.com/smsd-and-chinese/</link><pubDate>Thu, 05 Jul 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/smsd-and-chinese/</guid><description>&lt;p>smsd是使用mysql数据库的，所以这个乱码很容易把人搞晕。我之前&lt;a href="http://blog.wdicc.com/wordpress/gnokii_howto_chinese_sms/">写过&lt;/a>gnokii发送短信是和locale有关系的，只要在utf8的locale下面就可以正常发送中文短信了。而smsd也和这个类似，也需要utf8的locale。但是还需要注意的一点就是mysql也是有编码设置的。所以可能会认为，文本插入数据库之前是不是也需要对数据库做utf8的设置呢？其实是不需要的，这么做反而会造成乱码。&lt;/p> &lt;p>smsd连接mysql用的是mysql默认的字符集，那么我们插入文本的时候，也同样需要使用这个字符集，需要注意的是，这个文本也需要是utf8编码的。mysql默认的字符集通常是 “default-character-set&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; latin1”。&lt;/p></description></item><item><title>oracle 的 job 又遇到问题了</title><link>https://wdicc.com/oracle-jobs/</link><pubDate>Fri, 29 Jun 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/oracle-jobs/</guid><description>&lt;p>还是高级复制的问题，这次可能是因为job执行过程中，对方机器刚好重启导致的。反正job是卡在那里了，都10多天了。&lt;/p></description></item><item><title>稍微深入了解了一下cacti的thold插件的邮件通知</title><link>https://wdicc.com/change-trigger-setting-for-thold/</link><pubDate>Thu, 28 Jun 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/change-trigger-setting-for-thold/</guid><description>&lt;p>通过cacti的thold插件，可以做到snmp抓取到的数值低于你规定的值的时候进行邮件通知，例如我用他来监控磁盘空间，当磁盘空间低于某个数的时候就会给指定的email发邮件。但是有一点郁闷的是，有时候，可能是由于网络原因，抓取会超时，这样就会导致触发trigger，给你发送邮件。5分钟抓取一次，我这里的情况是几乎每个小时总会有2，3封这种邮件，很烦人，而且根本没意义。早就想屏蔽掉这种情况了，看了代码挺复杂就懒得弄，今天实在受不了了，深入了解了一下。&lt;/p></description></item><item><title>为resin配置oracle连接池</title><link>https://wdicc.com/resin-and-oracle/</link><pubDate>Wed, 27 Jun 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/resin-and-oracle/</guid><description>&lt;p>resin 2.x 的配置方法和 3.x 的方法有区别。按照&lt;a href="http://www.caucho.com/resin-3.1/doc/db-thirdparty.xtp">官方文档&lt;/a>，做下面的配置。&lt;/p> &lt;p>&lt;pre lang="txt">&lt;database>&lt;br />
 &lt;jndi-name>oraPool&lt;/jndi-name>&lt;br />
 &lt;driver>&lt;br />
 &lt;type>oracle.jdbc.pool.OracleConnectionPoolDataSource&lt;/type>&lt;br />
 &lt;url>jdbc:oracle:thin:@localhost:1521:dbname&lt;/url>&lt;br />
 &lt;user>username&lt;/user>&lt;br />
 &lt;password>password&lt;/password>&lt;br />
 &lt;/driver>&lt;br />
#....&lt;br />
&lt;/database>&lt;/pre>&lt;br />
&lt;p>&amp;nbsp;在上面的 &lt;font color="#ff0000">.... &lt;/font>这里还可以添加&lt;a href="http://www.caucho.com/resin-3.1/doc/database-tags.xtp">其他的&lt;/a>配置信息。配置好之后启动resin，会发现提示类似下面的信息。&lt;/p></description></item><item><title>resin 的安装步骤</title><link>https://wdicc.com/install-resin/</link><pubDate>Thu, 21 Jun 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/install-resin/</guid><description>&lt;p>resin目前已经到了3.1版本，从resin网站上面下载的resin不带jdk，需要自己去下载。resin的下载页面在&lt;a href="http://www.caucho.com/download/index.xtp">这里&lt;/a>。下载最新的 Resin Pro 3.1.1 版本。&lt;/p></description></item><item><title>linux tuning</title><link>https://wdicc.com/linux-tuning/</link><pubDate>Mon, 04 Jun 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/linux-tuning/</guid><description>地址 &lt;a href="http://www.enigma.id.au/linux_tuning.txt">http://www.enigma.id.au/linux_tuning.txt&lt;/a>&lt;br />

&lt;pre class="prettyprint lang-bash">
# server with a decent amount of memory.
#
# This file should be saved as /etc/sysctl.conf
# You can source it manually if your system has booted by using:
# sysctl -e -p /etc/sysctl.conf
#
# Paul Day, paul (at) bur.st
#
# Last updated 02/03/05 and tested on 2.6.9
#

# Increase RPC slots
sunrpc.tcp_slot_table_entries = 32
sunrpc.udp_slot_table_entries = 32
# Increase size of RPC datagram queue length
net.unix.max_dgram_qlen = 50
# Log spoofed, source routed and redirects
net.ipv4.conf.default.log_martians = 1
# Don't accept source routes
net.ipv4.conf.default.accept_source_route = 0
# Don't send redirects
net.ipv4.conf.default.send_redirects = 0
# Source route verification on - incoming packets must match outgoing routing
net.ipv4.conf.default.rp_filter = 1
# Don't accept redirects
net.ipv4.conf.default.accept_redirects = 0
# Don't forward source routes
net.ipv4.conf.default.mc_forwarding = 0
# Disable forwarding 
net.ipv4.conf.default.forwarding = 0
# Log spoofed, source routed and redirects
net.ipv4.conf.all.log_martians = 1
# Don't relay bootp
net.ipv4.conf.all.bootp_relay = 0
# Don't proxy arp for anyone
net.ipv4.conf.all.proxy_arp = 0
# Don't accept source route packets
net.ipv4.conf.all.accept_source_route = 0
# Don't send redirects
net.ipv4.conf.all.send_redirects = 0
# Source route verification on - incoming packets must match outgoing routing
net.ipv4.conf.all.rp_filter = 1
# Don't accept redirects
net.ipv4.conf.all.accept_redirects = 0
# Don't forward source routes
net.ipv4.conf.all.mc_forwarding = 0
# Don't enable forwarding
net.ipv4.conf.all.forwarding = 0
# Don't allow the arp table to become bigger than this
net.ipv4.neigh.default.gc_thresh3 = 2048
# Tell the gc when to become aggressive with arp table cleaning.
# Adjust this based on size of the LAN. 256 is suitable for most
net.ipv4.neigh.default.gc_thresh2 = 1024
# Adjust where the gc will leave arp table alone - set to 32.
net.ipv4.neigh.default.gc_thresh1 = 32
# Adjust to arp table gc to clean-up more often
net.ipv4.neigh.default.gc_interval = 30
# Increase TCP
net.ipv4.neigh.default.proxy_qlen = 96
net.ipv4.neigh.default.unres_qlen = 6
# Increase size of socket buffers
net.ipv4.tcp_rmem = 4096	98304	349520
net.ipv4.tcp_wmem = 4096	65535	262142
net.ipv4.tcp_mem = 98304	262142	393216
# Turn off sack
net.ipv4.tcp_dsack = 0
# Don't use ECN because too many sites have wacky routers that can't handle it`
net.ipv4.tcp_ecn = 0
net.ipv4.tcp_reordering = 3
# Turn off sack/fack
net.ipv4.tcp_fack = 0
# Enable bad error message Protection
net.ipv4.icmp_ignore_bogus_error_responses = 1
# Ignore broadcasts pings, could become part of a Smurf
net.ipv4.icmp_echo_ignore_broadcasts = 1
# But don't ignore directed pings
net.ipv4.icmp_echo_ignore_all = 0
# Widen local port range
net.ipv4.ip_local_port_range = 33000	60000
# Bump up TCP socket queuer to help with syn floods
net.ipv4.tcp_max_syn_backlog = 2048
# Turn syn-cookie protection on
net.ipv4.tcp_syncookies = 1
# Drop it so lack of FIN times out quicker
net.ipv4.tcp_fin_timeout = 30
# How many times to retry killing an alive TCP connection
net.ipv4.tcp_retries2 = 15
net.ipv4.tcp_retries1 = 3
# Enable a fix for RFC1337 - time-wait assassination hazards in TCP
net.ipv4.tcp_rfc1337 = 1
# Drop keep-alive time
net.ipv4.tcp_keepalive_time = 3600
# Set number of times to retry a SYN-ACK in a half-open new connections
net.ipv4.tcp_synack_retries = 5
# Set number of times to retry SYN in a new connection
net.ipv4.tcp_syn_retries = 5
# Turn off sack
net.ipv4.tcp_sack = 0
# Enable really big (>65kB) TCP window scaling if we want it.
net.ipv4.tcp_window_scaling = 1
# Turn off timestamps
# Turn this back on if you're on a gigabit or very busy network
# Having it off is one less thing the IP stack needs to work on
net.ipv4.tcp_timestamps = 0
# Increase number of incoming connections backlog
net.core.somaxconn = 512
# Bump optmem_max up
net.core.optmem_max = 20480
# Increase number of incoming connections backlog
net.core.netdev_max_backlog = 1024
net.core.dev_weight = 64
# Bump up default r/wmem to max
net.core.rmem_default = 262141
net.core.wmem_default = 262141
# Bump up max r/wmem
net.core.rmem_max = 262141
net.core.wmem_max = 262141
# Increase size of file handles and inode cache
fs.file-max = 209708&lt;/pre>

&lt;p class="poweredbyperformancing">Powered by &lt;a href="http://scribefire.com/">ScribeFire&lt;/a>.&lt;/p></description></item><item><title>oracle 的高级复制出了点问题，记录下解决办法</title><link>https://wdicc.com/rep-of-oracle/</link><pubDate>Fri, 18 May 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/rep-of-oracle/</guid><description>早上来了同事就来找我，有两台同步的服务器数据库没有同步成功，查查咋回事。&lt;br />

一台A，从B处同步。蒙了一下，果然有个dba_jobs表，呵呵。&lt;br />

&lt;pre class="prettyprint lang-sql">

在A处执行上面的命令，好像repadmin的job都在正常执行。
在B处执行上面的命令，能查到类似下面的信息

&lt;pre class="prettyprint lang-text">
---------- ------------------------------ -------------------
NEXT_DATE FAILURES B
------------------- ---------- -
47 repadmin 2006-05-16 19:37:29
4001-01-01 00:00:00 16 Y&lt;/pre>

显然是job挂了。查看了一下挂的时间，原来是联通机房机柜断电那天，A机器在联通机房，那天断电了6个小时。B机器上面的同步尝试了16次之后就挂起了。解决方法也不难，用repadmin用户登录，然后执行下面的语句，&lt;strong>谁的job只能由谁来执行&lt;/strong>：

&lt;pre class="prettyprint lang-sql">

47是job id，sysdate表示当前时间。等会再看吧，执行成功之后会把 failures 重新计数，B变成N。</description></item><item><title>awk 数组的一个应用</title><link>https://wdicc.com/awk-array/</link><pubDate>Thu, 17 May 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/awk-array/</guid><description>sed和awk这本书看了好久了，sed部分将就看完了，awk部分基本没怎么看。上次有人问起一个比较文件的问题，发现awk来解决非常的简单。&lt;br />

比较两个文件A、B，打印出包含在A中的，但是不包含在B中的所有行。&lt;br />

根据题目要求，awk的解决方法如下:&lt;br />
&lt;pre class="prettyprint lang-bash">

里面NR表示行号，FNR表示当前文件中的行号。NR==FNR的时候，表示此时正在读取B文件，以B中的$0为索引，建立一个数组，并且都赋值为1。
当NR>FNR 的时候，表示此时在读取A文件，如果a[$0]为1，那么就表示这个$0是在B里面也存在的，是吧？所以，如果要B里面不存在的，那么就得是a[$0]不为1的，就是没做过赋值的。所以了，就是这个了。

进阶一下，比较两个文件A、B，打印包含在A中第一列，但是不包含在B中第二列的整行。

类似的：
&lt;pre class="prettyprint lang-bash">

比较文件内容还可以用comm命令，还有人提出了grep命令，例如第一个问题：
&lt;pre class="prettyprint lang-bash"></description></item><item><title>apache 的一个启动失败的问题的解决方法</title><link>https://wdicc.com/solve-apache-start-fail/</link><pubDate>Wed, 18 Apr 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/solve-apache-start-fail/</guid><description>这个问题网上好多方法，记录一下方便自己以后查看。&lt;br />

&lt;pre class="prettyprint lang-text">
[Wed Apr 18 19:56:47 2007] [notice] Digest: done
[Wed Apr 18 19:56:47 2007] [warn] pid file /usr/local/apache54/logs/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
[Wed Apr 18 19:56:47 2007] [emerg] (28)No space left on device: Couldn't create accept lock&lt;/pre>

解决方法就是
&lt;pre class="prettyprint lang-bash"></description></item><item><title>复习了一下 OSI 7层模型 和 tcp/ip 4层模型</title><link>https://wdicc.com/osi-and-tcp-ip/</link><pubDate>Tue, 17 Apr 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/osi-and-tcp-ip/</guid><description>老是记不住这些，每次被问道只能说知道，但是说不出来名字。刚从irc里面得到一个好记得方法。&lt;br />

&lt;b>All people seemes to need data processed.&lt;/b>&lt;br />

这句话的字头刚好就是7层模型的字头。&lt;br />

A->Application 应用层 \&lt;br />
P->Presentation 表示层 -- 应用层(HTTP、TFTP、FTP、NFS、SMTP、Telnet、SNMP、DNS)&lt;br />
S->Session 会话层 /&lt;br />
T->Transport 传输层 ----- 传输层(TCP/UDP)&lt;br />
N->Network 网络层 ----- Internet 层(IP、ICMP、ARP、RARP)&lt;br />
D->Data Link 数据链路层 \&lt;br />
P->Physical 物理层 / 网络访问层 &lt;br />

这样似乎好记一点。。&lt;br /></description></item><item><title>今天又理解了nagios的两个配置</title><link>https://wdicc.com/nagios-conf/</link><pubDate>Mon, 16 Apr 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/nagios-conf/</guid><description>&lt;b>Host and Service Dependencies&lt;/b>&lt;br />

当监控的host或者service之间有依赖关系的时候，可以通过定义dependence来让nagios知道应该通知什么。&lt;br />

比如我这里的服务器都在idc托管，而我的nagios却是运行在公司的一台服务器上面。这样，有时候可能就需要考虑依赖关系了。比如当公司的网络出问题的时候（事实上经常出现），比如断网，总不能让他也认为是idc托管的服务器出问题了而给你发通知吧。host dependence正好可以解决这个问题。&lt;br />

比如 A 是idc的，B 是公司的网关（或者某个应该一直在线的服务器，比如sina.com.cn）。当nagios检测到A连不上的时候，他会根据dependence来检测B，如果B也连不上了，那么就只通知你B连不上了。&lt;br />

大概的配置如下&lt;br />
&lt;pre class="prettyprint lang-text">
 host_name B
 dependent_host_name A
 notification_failure_criteria d,u
 }&lt;/pre>

&lt;b>Notification Escalations&lt;/b>

escalations 的意思就是扩大。整个这个的意思应该就是扩大通知范围。之前一直没理解是什么意思，今天看了才明白。其实就是定义出问题的时候，什么时候扩大通知。

比如A服务器挂了，他对应的contactgroup就会立刻得到通知。但是，如果这个组里面的人在睡觉或者在做什么事情忽略了这个通知，怎么办呢？当然nagios会通知多次，但是如果这些都忽略掉了或者没有收到怎么办？这样这个escalations就有作用了，他可以定义几次通知contatgroup之后就开始通知别的人。还有一些别的功能，就不多说了。</description></item><item><title>unix 进程</title><link>https://wdicc.com/unix-process/</link><pubDate>Wed, 11 Apr 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/unix-process/</guid><description>看了 &lt;a href="http://www-128.ibm.com/developerworks/aix/library/au-speakingunix8/?ca=dgr-lnxw01speakunix8">Speaking UNIX, Part 8: UNIX processes&lt;/a> 之后做一点笔记。&lt;br />

&lt;b>A real multitasker&lt;/b>&lt;br />

在unix、linux、freebsd、mac os x、windows等系统里面，计算任务都表现为进程。unix 看上去可以同时运行很多任务，因为每个进程都只占用一部分cpu时间。&lt;br />

进程就像一个容器，包括运行的程序，环境变量，程序的输入输出等。可以把进程想像为一个国家，有自己的边界，资源和产品。&lt;br />

每个进程也都有自己的owner（属组），owner通常是运行这个程序的人，有些系统服务的owner或许会是某个特殊的用户，或者是root。例如，为了安全，某个Apache server的owner可能是属于一个叫www的用户的，这个用户有权限来存取web服务需要的文件，这些文件别的用户是不能访问的。&lt;br />

一个进程的owner可能会改变，但是一个进程在同一个时间只能有一个owner。&lt;br />

setuid和setgid可以让一个进程获得比owner更高的权限。&lt;br />

一个setuid进程，例如top，运行的时候使用的是owner的权限。因此，当你运行top的时候，你的权限就被提升为root了。类似的，一个setgid进程，运行的时候具有的是group owner的权限。&lt;br />

例如，在Mac osx里面的wall命令（就是write all的缩写），因为他需要给每个物理或者虚拟的终端设备写信息，所以他被setgid tty。&lt;br />

&lt;b>Taking inventory&lt;/b>&lt;br />

类似其他系统资源，unix系统里面的进程id总数虽然多，但是是有限的（实际上，一个系统几乎从来都不会出现进程id数不够的情况）。每一个新的进程，例如运行vi或者xclock，都会立刻分配一个进程id。在unix系统里面可以用ps命令查看进程。&lt;br />

ps -a -w -x 可以显示所有进程列表。-a显示所有在tty设备上面运行的进程，-x显示所有不是在tty设备上面运行的程序，-w使用“宽”模式显示，用来查看进程一些长的项目。&lt;br />

-o 还可以指定输出信息的列表。比如 -o pid,uname,command,state,stime,time 。&lt;br />

&lt;b>Daddy, where do processes come from?&lt;/b>&lt;br />

 在unix系统里面，有些进程会从系统启动到关闭整个过程中一直运行。大部分进程从任务开始到结束都很快。&lt;br />

 每个新的unix进程都是从已经存在的进程产生的。另外，每个新的进程（子进程）都克隆自他的父进程。at least for an instant, until the child continues execution independently.如果每个进程都来自一个已经存在的进程，那么“第一个进程来自哪里？”，先有鸡还是先有蛋的问题。&lt;br />

第一个进程是由kernel在启动过程中产生的，叫做init。ps -l 1命令可以查看。&lt;br />
F S UID PID PPID C PRI NI ADDR SZ WCHAN TTY TIME CMD&lt;br />
4 S 0 1 0 0 76 0 - 376 - ? 0:06 init [2] &lt;br />

可以看到，init的uid是0，也就是root。不像其他进程，init的ppid（父进程id）是0。&lt;br />

图 2,3 稍微解释一下。&lt;br />
&lt;ol>&lt;li>进程A运行了几条指令。进程A有自己的资源、输入输出、环境变量等。&lt;/li>&lt;li>遇到一条fork()指令，会产生一个新的进程。进程A遇到fork之后，立刻产生一个新的进程Z。进程Z是A的克隆，有与A一行的环境变量、内存内容、程序状态、打开文件等。&lt;/li>&lt;li>进程Z一开始就从fork后面的指令继续执行，就是进程A剩下的部分。进程A也继续执行剩下的部分。&lt;/li>&lt;li>在fork指令后面的指令中，会检查当前的进程是子进程还是父进程。就是说，进程Z和进程A在后续的指令中各自分别确定自己是父进程还是子进程。区别是，fork指令会在子进程中返回0，而且父进程中返回子进程的进程id。&lt;/li>&lt;li>在前面的测试之后，进程A和进程Z各自使用独立的code path，就好像他们都来自一条路，后来选择了不同的岔路一样。&lt;/li>&lt;/ol>&lt;br />

在fork之后，进程A也许会继续运行同样的程序。然而，进程Z或许会立刻变成另外一个程序。进程Z现在完全就是一个独立于其父进程A的进程了。&lt;br />

&lt;b>Forking around&lt;/b>&lt;br />

可以在命令行实际体验一下fork。打开一个新的xterm，你现在应该知道xterm有自己的进程，而且，在xterm里面，shell是有xterm产生的一个单独的进程。&lt;br />

通过ps命令的输出可以看到，在ppid字段那里，就是父进程的id。 &lt;br />

使用&amp;符号可以将程序放到后台执行。执行的时候会同时输出各个进程的id。jobs命令可以查看当前运行的进程。标签1，2，3可以用来标记不同的会话。kill %N 就是结束第N个会话。fg %N 可以将一个会话放到前台。&lt;br />

&lt;b>To the great process pool in the sky&lt;/b>&lt;br />

有些进程是一直存在的，例如init，有些会将自己转变成其他的（例如shell）。大部分进程最终都会自然死掉，也就是程序运行完毕的时候。&lt;br />

你可以让一个进程suspended（挂起），也可以让他复苏。还有像前面说的，你也可以使用kill命令结束一个进程。&lt;br />

ctrl-Z 可以挂起一个进程。进程在前台运行的时候，ctrl+c 可以结束这个进程。在shell内部使用unix signals来对一个进程产生影响。你可以从一个进程像另一个发送signal（信号），也可以让进程自己给自己发送信号。&lt;br />

man 7 signal或者kill -L 可以看到所有的signal。使用kill命令可以发送这些signal。&lt;br />

刚针对fork测试了一下，写一个简单的c程序&lt;br />
&lt;pre class="prettyprint lang-c">

main(){
 int a;
 printf("Before fork.\\n");
 a = fork();
 printf("After fork, fork returns %d\\n", a);
}&lt;/pre>

保存之后用gcc编译一下，执行一个，可以看到结果。fork之后的程序会继续执行下面的指令，唯独fork的返回值不同。</description></item><item><title>awstats 如何统计以前的日志？</title><link>https://wdicc.com/awstats-log/</link><pubDate>Mon, 02 Apr 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/awstats-log/</guid><description>突然想安装一个awstats了，参考 &lt;a href="http://www.chedong.com/tech/awstats.html">车东&lt;/a> 的文章，安装了一个。可是发现一个问题，设置了logfile为 access_log.%YYYY-24%MM-24%DD-24.log 之后，发现只能把昨天的日志统计进来，可是我的log下面还有好多呢，想统计以前的，怎么弄呢？幸好，awstats已经考虑到这个问题了。&lt;br />

awstats.pl 脚本支持在命令行指定logfile，这样简单了，改变这个参数就可以了。不过要注意的是，如果你的data里面已经处理新的日志，那么指定logfile也没用了，以前的没办法更新进来了。只能是删掉data里面的内容，然后重新从最早的开始生成一遍。我写了一个脚本来做这个事情。&lt;br />

&lt;pre class="prettyprint lang-bash">

awstats_dir=/opt/tt2/awstats/wwwroot/cgi-bin
logfile_dir="/usr/local/apache/logs/"

cd $awstats_dir

for file in `find $logfile_dir -name "access_log.2*" | sort`;do
 #echo "$file"
 ./awstats.pl －update -config=wd -LogFile=$file
done&lt;/pre>

保存为 awstats.sh ，然后执行就可以了。他会查找 logfile_dir 下面所有的 access_log.2 开头的文件，作为参数来更新记录。</description></item><item><title>oracle 文本界面的安装</title><link>https://wdicc.com/oracle-text-install/</link><pubDate>Wed, 14 Mar 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/oracle-text-install/</guid><description>oracle 的手册里面讲的通常都是图形界面下面的安装，就是用oracle登录桌面，然后运行安装程序的方法。可实际上维护服务器的时候，大多用的还是&lt;font color="#3333ff">远程&lt;/font>文本界面。这样很有必要看看如何通过文本界面来安装oracle。&lt;br />

oracle本身的安装程序也提供了这个方法，就是使用 responseFile 。这个 responseFile 其实就是在图形界面安装的时候的一些选择，保存到文件之后，直接告诉安装程序从这里读取设置就好了。将oracle的安装文件 ship.db.lnx32.cpio.gz 解压：&lt;br />

&lt;pre class="prettyprint lang-bash">
cpio -idmv &lt; ship.db.cpio&lt;/pre>

这样可以看到有个Disk1的文件夹，里面有个response目录，里面好多response文件，不过我还不知道这些有什么区别，里面设置项也很多，还没弄明白。我使用的不是这里的response文件。是通过下面的方法获取的rsp文件。

可以通过在记录模式中运行软件或通过手动编辑示例响应文件来创建响应文件。以下是一个基本演示：

 1. 用此命令启动 OUI 来创建响应文件：

 ./runInstaller -record -destinationFile /tmp/recorded.rsp
 
 2. 选择您需要的所有部分（源目标目录、主目录、主目录名、产品）。
 3. 当您看到 Summary 屏幕时，不要单击 Install，而是单击 Cancel。
 4. 仔细查看在 tmp/recorded.rsp 中创建的结果响应文件。如果需要，可以手动编辑该文件，只要您遵守使用规定的格式即可（请参见文档）。
 5. 现在如下执行静默安装：

 ./runInstaller -silent -responseFile /tmp/recorded.rsp

 在运行脚本时将会报告安装的进度。

如果您由于响应文件中的条目不正确而遇到安装故障，安装将失败并显示一条诊断消息。详细信息可在 oraInventory/logs 目录中找到。在每次使用响应文件运行 OUI 时，会创建具有 installActions-&lt;时间戳>.log 和 silentInstall&lt;时间戳>.log 格式名称的日志。

这样，只需要找台机器在图形界面下面运行一下安装程序，生成一个rsp文件，然后放到真正需要安装的服务器上面，修改一下安装路径，设置一下sys密码，就可以开始安装了。</description></item><item><title>oracle在rh里面的安装流程</title><link>https://wdicc.com/install-oracle-in-rh/</link><pubDate>Wed, 14 Mar 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/install-oracle-in-rh/</guid><description>&lt;b>第1部分 安装操作系统&lt;/b>&lt;br />

首先需要安装系统....Red Hat Enterprise Linux 2.1，Red Hat Enterprise Linux 3，Novell SUSE Linux Enterprise Server 8 是通过 oracle 10g认证的三个linux发行套件，不知道oracle 10.3有没有对这个修改。默认情况下，oracle 10g只能在rh的这两个版本安装，如果不是上面两个，运行安装程序会直接打印错误。不过也有方法在别的版本安装的，后面有说明。&lt;br />

按照&lt;a href="http://blog.wdicc.com/wordpress/2007/03/14/307/">上一篇文章&lt;/a>，安装linux的时候可以不选择图形界面，这样还可以节省不少空间。按照oracle的文档，说需要安装下面的这些软件包。&lt;br />

&lt;pre class="prettyprint lang-bash">
compat-gcc-c++ compat-libstdc++ compat-libstdc++-devel&lt;/pre>

我实际安装过程中，compat-gcc compat-gcc-c++ compat-libstdc++ compat-libstdc++-devel 这几个包我没有安装也可以安装oracle。</description></item><item><title>升级了一下cacti</title><link>https://wdicc.com/upgrade-cacti/</link><pubDate>Thu, 08 Mar 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/upgrade-cacti/</guid><description>cacti几个月前就提示我&lt;a href="http://cactiusers.org/">Architecture&lt;/a>插件有升级了，一直懒得弄。今天发现cacti也升级了，就去看了看，顺便升级了一下。记录一下升级需要注意点的东西。&lt;br />

debian 里面的cacti设置的比较好，log、rra、resource目录都是分开放的，不在cacti目录下面，做了一个链接过去。其他系统升级的时候注意要先备份这三个目录先。建议使用debian的这种方法，这样下次升级省事了。&lt;br />

然后就是很简单的，下载cacti，覆盖，修改config文件，浏览器连接，提示升级，按照步骤来就行了。然后再打上Architecture补丁，再修改config文件就行了。&lt;br /></description></item><item><title>lvm 学习笔记</title><link>https://wdicc.com/lvm-note/</link><pubDate>Tue, 06 Mar 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/lvm-note/</guid><description>lvm出来很久了，一直没弄过。当初的了解就是使用他之后就获得动态调整分区的特性。昨天装了一个rh，先尝试了一下使用这个lvm。&lt;br />

&lt;strong>lvm里面用到的一些概念&lt;/strong>&lt;br />

lvm其实就是将一些“物理”分区，比如 /dev/hda1，/dev/hda6 ，或者“物理”硬盘，比如 /dev/hda，/dev/hdb 这些，都弄到一起，然后在外面看来，他们是一个整体，也就是一个VG（Volume Group，卷组），其实就类似于一块硬盘了。&lt;br />

而这些“物理”分区，或者“物理”硬盘，就是 /dev/hda1，/dev/hdb 这些，就是一个个PV（Physical Volume，物理卷）。可以看到PV可以是一个分区，也可以是一块硬盘。&lt;br />

有了VG我们还不能直接使用他，就和我们还需要给硬盘分区一样，我们也需要给VG分区，也就是创建LV（Logical Volume，逻辑卷）。这样，LV的数据其实就分布到了LV所在的VG里面，也就是所有的PV对应的分区或者硬盘里面。&lt;br />

掌握了VG，PV，LV这些概念之后，操作起来就很容易了。&lt;br /></description></item><item><title>我的 .fvwm2rc 文件</title><link>https://wdicc.com/my-fvwm2rc/</link><pubDate>Thu, 25 Jan 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/my-fvwm2rc/</guid><description>########&lt;br />
#set Environment variables&lt;br />

SetEnv fvwm_img $[FVWM_USERDIR]/images&lt;br />
SetEnv fvwm_icon $[FVWM_USERDIR]/icons&lt;br />
SetEnv fvwm_scrpt $[FVWM_USERDIR]/scripts&lt;br />
SetEnv fvwm_wallpapers $[FVWM_USERDIR]/wallpaper&lt;br />

SetEnv fvwm_webbrowser /usr/bin/firefox&lt;br />
SetEnv fvwm_term /usr/bin/urxvtc&lt;br />
SetEnv fvwm_mail /usr/bin/mutt&lt;br />
#SetEnv fvwm_media_player /usr/bin/xmms&lt;br />
SetEnv fvwm_video_player /usr/bin/mplayer&lt;br />

#这部分设置fvwm的一些变量，这样方便以后如果有变化的话，不需要全文去修改，只修改这里就可以了。&lt;br />
#后面使用 $[var_name] 来引用&lt;br />
##################################&lt;br /></description></item><item><title>使用perl操作mysql数据库</title><link>https://wdicc.com/perl-and-mysql/</link><pubDate>Thu, 04 Jan 2007 00:00:00 +0000</pubDate><guid>https://wdicc.com/perl-and-mysql/</guid><description>东抄西抄拼凑的代码。关于perl dbi的文档可以查看&lt;a href="http://search.cpan.org/~timb/DBI/DBI.pm">这里&lt;/a>。&lt;br />
&lt;pre class="prettyprint lang-perl">
use DBI;
use strict;
#use Data::Dumper;

my $mobile = @ARGV[0];
my $msg = @ARGV[1];
my $db = "gnokii";
my $host = 'localhost';
my $user = 'gnokii';
my $password = 'pwd';
my $in = 'inbox';
my $out = 'outbox';

my $dbh = DBI->connect("DBI:mysql:database=$db;host=$host",$user, $password, {RaiseError => 1});

print "$msgn";
my $sql = qq{ insert into $out (number,text) values ("$mobile","$msg")};

#my $sql = qq{ SELECT * from $out };
my $sth = $dbh->prepare( $sql );
$sth->execute();
#my @result;

#while (@result = $sth->fetchrow_array){
# print "$result[0],$result[1],$result[4]n";
# }

$sth->finish();
$dbh->disconnect();&lt;/pre></description></item><item><title>恢复grub</title><link>https://wdicc.com/recover-grub/</link><pubDate>Sat, 30 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/recover-grub/</guid><description>安装双系统的时候，如果后安装的 win ，那么就会把mbr的grub信息干掉。通常的建议是先安装win后安装linux。&lt;br />

今天遇到的情况是通过 vmware  安装 suse 到物理硬盘的时候，没有将 grub 安装到 mbr，这样需要重新安装一下grub。&lt;br />

我的方法是找了一个 knoppix ，然后启动到 level 2 ，启动之后执行下面的命令先。&lt;br />
&lt;pre class="prettyprint lang-bash">
mount -o proc none /mnt/hdax/proc
mount --bind /dev/ /mnt/hdax/dev&lt;/pre>
这样操作之后，就可以chroot到硬盘上面的系统了。
&lt;pre class="prettyprint lang-bash">
然后自己修改 /boot/grub/menu.1st 文件。之后执行 grub 命令。
&lt;pre class="prettyprint lang-bash">
grub> setup (hd0)&lt;/pre>
我这里操作的时候遇到一个问题，suse好像往grub的map.xxx.gz里面写了关于fd0的信息，这样运行grub命令的时候会尝试去读取软驱。我在bios里面禁用了软驱才ok。</description></item><item><title>一个简单问题的三种实现方法</title><link>https://wdicc.com/3-solve-way/</link><pubDate>Thu, 21 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/3-solve-way/</guid><description>#arch-cn irc上面rock提出了一个需求，将一行太长的文字让他自动按照要求换行。&lt;br />

刚开始拿到这个问题的时候，感觉sed或者awk好像实现不了亚，没那么智能的，可是简单分析一下，“按照要求” 我们假定要求是 “每5个字符” 就换行一次。这样这个问题就明朗了。再换句话说，需求就是 “每5个字符插入一个换行符”。&lt;br />

第一种方法，用sed：&lt;br />
&lt;pre class="prettyprint lang-bash">
第二种方法，用gawk（sssslang提供）：
&lt;pre class="prettyprint lang-bash">cat $content | gawk --re-interval '{gsub(/(.){2}/,"&amp;n">
第三种方法，好像有点bt，用perl：
&lt;pre class="prettyprint lang-perl">
@content = `tail /var/log/postfix.log`;
foreach (@content) {
for ($i=0; $i &lt; length($_); $i+=$cut) {
 print substr("$_",$i,$cut)."\n";
 }
}&lt;/pre>
反斜杠\都被过滤掉了，不知道咋回事，自己看着加上。。</description></item><item><title>我的第一个perl脚本</title><link>https://wdicc.com/irssi_bot/</link><pubDate>Sat, 16 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/irssi_bot/</guid><description>是给irssi写的，只不过通过他和irssi接口，所有功能都是bash脚本实现的，回头看看如何转到perl。&lt;br />
&lt;pre class="prettyprint lang-perl">
use vars qw($VERSION %IRSSI);

use Irssi;
$VERSION = '1.00';
%IRSSI = (
authors => 'wd',
contact => 'wd@wdicc.com',
name => 'My First Script',
description => 'This script allows ' .
'you to query weather and other info ' .
'using some command.',
license => 'Public Domain',
);

sub send_msg {
my ($server, $who, @result) = @_;
my $count;
$count = 1;
while ($count &lt;= @result) {
$server->command("msg $who $result[$count-1]");
$count++;
}
}

sub pre_send {
my ($server, $who) =@_;
$server->command("msg $who 0I'm working,Waiting me...");
}

sub end_send {
my ($server, $who) =@_;
$server->command("msg $who 0...The end.");
}

sub msg_public {
my ($server, $msg, $nick, $address, $target) = @_;
my @result;my $who;

$who = $target;
if ($target eq "") { $who = $nick; }

if ($msg =~ /^!([Dd]ict|[Ww]eather|[Gg]oogle|[Hh]elp|nslookup|rss).*$/) {
&amp;pre_send($server,$who);
$msg =~ s/!//;
if ($msg =~ /^[Hh]elp.*$/) {
@result = ("Usage:",
"!dict ur_word",
" eg: !dict license",
"!weather location [today|tomorrow]",
" eg: !weather beijing",
"!google sth.",
" eg: !google archlinux",
"!nslookup domin_name",
" eg: !nslookup archlinux.org",
"!rss feed_url",
" eg: !rss http://blog.wdicc.com/wordpress/feed/");
} else {
@result = `/home/stef/get $msg`;
}
#$server->print("#arch-cn", "$nick, $target, $who");
&amp;send_msg($server, $who, @result);
&amp;end_send($server, $who);
}
}

Irssi::signal_add_first('message public', 'msg_public');
Irssi::signal_add_first('message private', 'msg_public');&lt;/pre></description></item><item><title>继续来解决gnokii中文问题</title><link>https://wdicc.com/gnokii_howto_chinese_sms/</link><pubDate>Mon, 11 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/gnokii_howto_chinese_sms/</guid><description>这玩意原来和 &lt;a href="http://groups.google.com/group/mailing.unix.gnokii/browse_thread/thread/a006ae68df36d863/2931523e4eafaa06%232931523e4eafaa06">locale&lt;/a> 有关系。一个utf8编码的文件（里面包含中文），只要执行gnokii之前设置一下正确的locale手机收到就是正常的。比如我建立了下面的一个发送短信的命令。&lt;br />
&lt;pre class="prettyprint lang-bash">
LC_ALL=zh_CN.utf8
/usr/local/gnokii/bin/gnokii $@&lt;/pre>
这样cat utf8_text | gnokii_utf8 --sendsms ur_phone_num发送就没问题了。看样子和smsd和mysql的版本是没有关系的。之前尝试在debian上面升级mysql虽然失败了，不过看样子也没多大影响。 :)</description></item><item><title>iptables做端口映射的一点新的心得</title><link>https://wdicc.com/iptables-and-portmap/</link><pubDate>Thu, 07 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/iptables-and-portmap/</guid><description>iptables做端口映射很简单的一个事情，我之前也写了&lt;a href="http://blog.wdicc.com/wordpress/2006/05/09/153/">如何来实现&lt;/a>这个咚咚。今天要用到的时候，遇到了问题，写写怎么解决的。&lt;br />

写好SNAT和DNAT相关语句之后，在INPUT、FORWARD和OUTPUT里面针对各个端口都开放了权限，可是就是访问不了，看tcpdump可以看到，SNAT肯定是进行了，因为有对方回来的信息。后来仔细分析了一下整个转换的过程，发现了问题所在。&lt;br />

这里总共涉及到三台电脑，假设A是我们的server，B是中转server，C是希望通过B来访问A的客户端，所以一次完整的请求如下图。&lt;br />
&lt;pre class="prettyprint lang-text">
所以呢，以25端口为例，需要开放的端口依次是：
&lt;pre class="prettyprint lang-text">
B : INPUT (目标端口25)
B : FORWARD (目标端口25)
B : OUTPUT (目标端口25)
A : INPUT (目标端口25)
--->上面是请求，下面开始回应请求
A : OUTPUT (源端口25)
B : INPUT (源端口25)
B : FORWARD (源端口25)
B : OUTPUT (源端口25)
C : INPUT (源端口25)&lt;/pre>
如此，一次请求发送过去的时候，所有数据包的目的端口都是25（假设B开放的转发端口也是25），源端口是1024-65535之间的某个数值，反回来所有数据包的源端口都是25，目的端口对应前面的那个端口。

我的问题就是光开放了B的FORWARD的目的端口25，源端口25没有打开，这样数据不能正确返回给C，打开就好了。</description></item><item><title>debian下面解决gnokii读取短信的bug</title><link>https://wdicc.com/gnokii_cant_get_sms/</link><pubDate>Wed, 06 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/gnokii_cant_get_sms/</guid><description>上一篇文章提到过gnokii读取AT模式下设备的短信的时候会有&lt;a href="http://blog.wdicc.com/wordpress/2006/12/05/277/">问题&lt;/a>，从xh那里看到了解决方法，自己也goolgle了&lt;a href="http://thread.gmane.org/gmane.linux.drivers.gnokii/7918/focus=7922">一下&lt;/a>，总结一下debian（sarge）下面解决这个问题的方法。&lt;br />

故障现象如下：&lt;br />
&lt;pre class="prettyprint lang-text">
[...]
Message sent: 0x12 / 0x0009
41 54 2b 43 50 4d 53 3f 0d | AT+CPMS?
write: [AT+CPMS?]
read : [AT+CPMS?+CPMS:
"SM",2,30,"SM",2,30OK]
Message received: 0x12 / 0x002d
02 41 54 2b 43 50 4d 53 3f 0d 0d 0a 2b 43 50 4d | AT+CPMS? +CPM
53 3a 20 22 53 4d 22 2c 32 2c 33 30 2c 22 53 4d | S: "SM",2,30,"SM
22 2c 32 2c 33 30 0d 0a 0d 0a 4f 4b 0d | ",2,30 OK
Received message type 12
GetSMS SM 1 failed! (Command failed.)
Serial device: closing device&lt;/pre>
还有一个smsd的问题：
&lt;pre class="prettyprint lang-text">
解决这个问题需要给gnokii打一个补丁，debian下面就需要自己来制作一个包，参考 &lt;a href="http://debian.linuxsir.org/doc/inthedebianway/debian_build_package.html">构建 Debian 软件包&lt;/a> 这篇文章，操作如下。

首先下载包的源代码：
&lt;pre class="prettyprint lang-bash">
此时他会在当前目录下面下载并解压gnokii的源代码包，并且打上debian需要的patch。此时需要将下面的patch给gnokii打上，修改都是针对common/phones/atgen.c的。
&lt;pre class="prettyprint lang-diff">
+++ atgen.c 2006-12-06 12:40:59.201314062 +0800
@@ -537,22 +537,15 @@
{
at_driver_instance *drvinst = AT_DRVINST(state);
gn_data data;
- gn_sms_status sms_status;
char req[32];
gn_error ret = GN_ERR_NONE;

if (mt != drvinst->smsmemorytype) {
gn_data_clear(&amp;data);
- data.sms_status = &amp;sms_status;
- ret = AT_GetSMSStatus(&amp;data, state);
+ sprintf(req, "AT+CPMS=\"%s\"r", memorynames[mt]);
+ ret = sm_message_send(13, GN_OP_Init, req, state);
if (ret != GN_ERR_NONE)
return ret;
-
- sprintf(req, "AT+CPMS=\"%s\",\"%s\",\"%s\"r", memorynames[mt], memorynames[mt],
- memorynames[data.sms_status->new_message_store]);
- ret = sm_message_send(23, GN_OP_Init, req, state);
- if (ret != GN_ERR_NONE)
- return GN_ERR_NOTREADY;
ret = sm_block_no_retry(GN_OP_Init, &amp;data, state);
if (ret == GN_ERR_NONE)
drvinst->smsmemorytype = mt;
@@ -1355,7 +1348,10 @@

if (sscanf(buf.line2, "+CPMS: \"%*c%*c\",%d,%*d,\"%*c%*c\",%*d,%*d,\"%c%c\",%*d,%*d",
&amp;data->sms_status->number, &amp;store[0], &amp;store[1]) != 3)
- return GN_ERR_FAILED;
+
+ if (sscanf(buf.line2, "+CPMS: \"%c%c\",%d,%*d,\"%*c%*c\",%*d,%*d",
+ &amp;store[0], &amp;store[1], &amp;data->sms_status->number) != 3)
+ return GN_ERR_FAILED;

data->sms_status->unread = 0;
data->sms_status->changed = 0;&lt;/pre>
把上面的内容保存一下，比如取名为cant_get_sms.patch，或者来&lt;a href="http://blog.wdicc.com/wordpress/download/cant_get_sms.patch">这里&lt;/a>下载，然后执行下面的命令：
&lt;pre class="prettyprint lang-bash">
apt-get -b source gnokii&lt;/pre>
此时会看到debian正在编译gnokii（编译之前可能需要下载编译需要的dev库，按照提示来就可以了），编译完成之后会将打包成6个deb文件，用dpkg -i命令重装一下你需要的就可以了。 此时再试试看gnokii --getsms SM 1命令，是不是没问题了？</description></item><item><title>给nagios添加故障时短信通知</title><link>https://wdicc.com/nagios-sms-alert/</link><pubDate>Tue, 05 Dec 2006 00:00:00 +0000</pubDate><guid>https://wdicc.com/nagios-sms-alert/</guid><description>nagios可以配置为在故障的时候发送Email，执行什么程序等。光执行程序这项可以实现的功能就太多了，没有做不到只有想不到。说说看我是怎么给nagios添加短信通知的。&lt;br />

首先需要一个能发送短信的东东，有些专门用来发送短信的猫，插上一张sim卡就可以用了，当然也可以找一个手机来做这个事情。然后用gnokii来通过sim卡发送短信，他主要是linux下面用来管理nokia手机的一个软件，当然所有支持AT指令的都可以使用。&lt;br />

debian上面安装好gnokii之后，/etc/gnokiirc是他的配置文件，主要修改两个地方：&lt;br />
model = AT&lt;br />
serial_baudrate = 9600&lt;br />
然后还需要将nagios用户（也就是启动nagios的用户）或者其他需要操作猫的用户加入dialout组，这样才有权限操作/dev/ttyS0这个设备，也就是第一个串口设备。&lt;br />
我的短信猫是通过串口连接到电脑的，如果你的是usb的或者其他类型的方式，比如蓝牙红外什么的，需要加载特定的模块，具体方法参考gnokii的网站。连接短信猫之后，可以用minicom测试一下是不是连接正确，他是类似于win下面的超级终端的一个程序。要注意连接的比特率，如果设备不支持可能不会有效果。设置好之后输入个AT，看是不是返回OK，如果返回那就连接正确了。&lt;br />

然后可以试试看执行gnokii --identify，我这里输出下面的内容：&lt;br />
&lt;pre class="prettyprint lang-bash">
GNOKII Version 0.6.5
IMEI : 500182395xxxxxx
Manufacturer : WAVECOM MODEM
Model : MULTIBAND 900E 1800
Revision : 533b09gg.2C2 1742344 061002 11:23&lt;/pre>
这样表示我的猫被正确识别了。如果有问题，可以修改gnokiirc文件，打开debug模式，看看问题所在。发个短信试试看：
&lt;pre class="prettyprint lang-bash">#echo -e "testntest 2">
GNOKII Version 0.6.5
Send succeeded!&lt;/pre>
收到短信了么？呵呵。之后修改nagios的misccommands.cfg文件，添加你的cmd：
&lt;pre class="prettyprint lang-bash">
command_name host-notify-by-sms
command_line /bin/echo -e "$HOSTADDRESS$($NOTIFICATIONNUMBER$)n$HOSTSTATE$n$OUTPUT$n$SHORTDATETIME$" | /usr/bin/gnokii --sendsms $CONTACTPAGER$ 2>>/dev/null
}

define command{
command_name notify-by-sms
command_line /bin/echo -e "$HOSTADDRESS$($NOTIFICATIONNUMBER$)n$SERVICEDESC$-$SERVICESTATE$n$OUTPUT$n$SHORTDATETIME$" | /usr/bin/gnokii --sendsms $CONTACTPAGER$ 2>>/dev/null
}&lt;/pre>
然后修改contacts.cfg，设置service_notification_commands、host_notification_commands，并且设置pager为电话号码。cmd里面可以通知的内容参考nagios doc里面的Using Macros In Commands。

可以试试看让一台服务器down了测试一下了。

以前用猫附带的一个软件（或许也可能是我们写的，因为听说附带软件的话比较贵）发送短信，总是会重复发送，有时一条短信会发送好多次。那个软件的原理是这样的，我将需要发送的短信按照一定的格式写入数据库，然后这个软件从数据库读取没发送的进行发送，然后将其修改为已发送。我猜可能重复发送的原因是“修改为已发送 ”这个过程中出问题了，修改了很多次才成功。

现在gnokii还有个问题可能就是读取短信的时候会提示失败，据说是个bug，xh这里有&lt;a title="AT model使用gnokii来收取短消息" href="http://www.grisword.com/tt/Grisword/126">解决办法&lt;/a>，有兴趣可以看看，我这里暂时好像还不需要读取短信。</description></item></channel></rss>