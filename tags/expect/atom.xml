<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Expect on wd and cc</title>
    <link>https://wdicc.com/tags/expect/atom/index.xml</link>
    <description>Recent content in Expect on wd and cc</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <atom:link href="https://wdicc.com/tags/expect/atom/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>自动连接 ssh 并输入密码</title>
      <link>https://wdicc.com/autossh-and-auto-enter-password/</link>
      <pubDate>Wed, 13 Oct 2010 00:00:00 +0000</pubDate>
      
      <guid>https://wdicc.com/autossh-and-auto-enter-password/</guid>
      <description>这年头不翻墙就看不到真像了，前几天整了个 ssh 代理，就研究了下自动登录。&lt;br /&gt;

ssh 自动登录首选就是使用 key 了，可对方不干，那就只能使用密码了。自动输入密码可以用 expect。查这个的时候发现了一个 expect-lite，发现也挺有意思的，他把写 expect 脚本简单化了，比如想 send xxx，那就用 &gt;xxxx 就行了，想 expect yyy 那就 &lt;yyy 就好了，等等这些，呵呵。不过我后来没用这个，还是用的标准的 expect，代码如下。&lt;br /&gt;

&lt;pre class=&#34;prettyprint lang-expect&#34;&gt;
spawn autossh -M 20000 -p SSH_PORT -N -D 7070 YOUR_NAME@YOUR_SERVER
set timeout 60
expect {
     assword: {
         stty -echo
         send &#34;YOUR_PASS\r&#34;
         stty echo
         #exp_continue
     }
    incorrect {
         send_user &#34;invalid password or account\n&#34;
         exit
     }
    timeout {
         send_user &#34;connection to host timed out\n&#34;
         exit
     }
    eof {
         send_user &#34;connection to host failed\n&#34;
         exit
     }
}
if {[fork]!=0} exit
disconnect
&lt;/pre&gt;&lt;br /&gt;

那里面那个 autossh 能自动给你重连，没仔细研究。那个 20000 后面的参数都是给 ssh 的，具体含意可以看 ssh 的 man。&lt;br /&gt;

最主要是最后那两行，能做到连接上之后主程序就退出了，不占用你的终端，而不影响 ssh 的连接。&lt;br /&gt;
</description>
    </item>
    
  </channel>
</rss>