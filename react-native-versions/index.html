<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>React Native Versions - wd and cc</title><link rel=icon type=image/png href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="React Native Versions"><meta property="og:description" content="RN 里面有很多个个版本号 package.json 里面定义的 version 。 android/app/build.gradle 里面定义的 versionName 和 versionCode 。 ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。 如果你使用 code-push 的话，还有"><meta property="og:type" content="article"><meta property="og:url" content="https://wdicc.com/react-native-versions/"><meta property="article:published_time" content="2019-07-26T15:45:27+08:00"><meta property="article:modified_time" content="2019-07-26T15:45:27+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="React Native Versions"><meta name=twitter:description content="RN 里面有很多个个版本号 package.json 里面定义的 version 。 android/app/build.gradle 里面定义的 versionName 和 versionCode 。 ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。 如果你使用 code-push 的话，还有"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/main.css><link rel=stylesheet type=text/css href=https://wdicc.com//light-syntax.css media="(prefers-color-scheme: light)"><link rel=stylesheet type=text/css href=https://wdicc.com/css/dark.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css href=https://wdicc.com//dark-syntax.css media="(prefers-color-scheme: dark)"><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=https://wdicc.com/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title><a href=https://wdicc.com/>wd and cc</a></h1><div class=site-description><h2>&mdash; Happy every day</h2><nav class="nav social"><ul class=flat><a href=https://github.com/wd title=Github><i data-feather=github></i></a><a href=https://twitter.com/wd title=Twitter><i data-feather=twitter></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/post>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&q=">Search</a></li><li><a href=/atom.xml>Subscribe</a></li></ul></nav></div><div class=post-header><h1 class=title>React Native Versions</h1><div class=meta>Posted at &mdash; Jul 26, 2019</div></div><div class=post-header></div><div class=markdown><p>RN 里面有很多个个版本号</p><ol><li><p><code>package.json</code> 里面定义的 <code>version</code> 。</p></li><li><p><code>android/app/build.gradle</code> 里面定义的 <code>versionName</code> 和 <code>versionCode</code> 。</p></li><li><p><code>ios/YOURAPP/Info.plist</code> 里面定义的 <code>CFBundleShortVersionString</code> 和 <code>CFBundleVersion</code> 。</p></li><li><p>如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 <code>Label</code> 一般是 <code>v</code> 开头的。</p></li></ol><p>这几个版本号都有用，需要有规划的使用。我的经验如下。</p><ol><li><p>统一 <code>version</code>, <code>versionName</code>, <code>CFBundleShortVersionString</code> ，使用类似 <code>x.y.z</code> 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的，</p></li><li><p><code>versionCode</code> 和 <code>CFBundleVersion</code> 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。</p></li><li><p>如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则：</p><ol><li><p>如果 native 代码有变更，那需要增加 <code>x.y</code> ，比如可以从 <code>1.0</code> 变成 <code>1.1</code> 也可以是变成 <code>2.0</code> 。</p></li><li><p>如果只是 js 代码更新，那只增加 <code>z</code> ，其他不变，同时 code-push 发布的时候，使用 <code>-t</code> 指定 target version 为 <code>x.y.0 ~ x.y.z</code> 这样的形式。</p></li></ol></li></ol><p>基于上面的设置，实际一个 app 的版本号就是类似于 <code>1.2.2(111)-v23</code> 或者 <code>1.2.2(111)-un</code> 这样的形式。 <code>1.2.2</code> 表示 native 版本， <code>111</code> 是编译版本， <code>v23</code> 是 codepush 的版本，如果没更新 codepush 那可能是 <code>un</code> 。 <code>1.2.2(111)</code> 部分可以通过 RN 模块或者程序启动时候注入到 js 里面来， <code>v23</code> 部分可以使用 codepush 的 api 取。</p><p>一般我们以 <code>package.json</code> 里面的版本为准，android 可以让 gradle 读取这个文件自动变更版本， ios 需要自己写一个程序。</p><div class="src src-groovy"><div class=highlight><pre class=chroma><code class=language-groovy data-lang=groovy><span class=kt>def</span> <span class=nf>getNpmVersion</span><span class=o>()</span> <span class=o>{</span>
    <span class=kt>def</span> <span class=n>inputFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s2>&#34;../package.json&#34;</span><span class=o>)</span>
    <span class=kt>def</span> <span class=n>packageJson</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JsonSlurper</span><span class=o>().</span><span class=na>parseText</span><span class=o>(</span><span class=n>inputFile</span><span class=o>.</span><span class=na>text</span><span class=o>)</span>
    <span class=k>return</span> <span class=n>packageJson</span><span class=o>[</span><span class=s2>&#34;version&#34;</span><span class=o>]</span>
<span class=o>}</span>

<span class=kt>def</span> <span class=nf>getNpmVersionArray</span><span class=o>()</span> <span class=o>{</span> <span class=c1>// major [0], minor [1], patch [2]
</span><span class=c1></span>    <span class=kt>def</span> <span class=o>(</span><span class=n>major</span><span class=o>,</span> <span class=n>minor</span><span class=o>,</span> <span class=n>patch</span><span class=o>)</span> <span class=o>=</span> <span class=n>getNpmVersion</span><span class=o>().</span><span class=na>tokenize</span><span class=o>(</span><span class=s1>&#39;.&#39;</span><span class=o>)</span>
    <span class=k>return</span> <span class=o>[</span><span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>major</span><span class=o>),</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>minor</span><span class=o>),</span> <span class=n>Integer</span><span class=o>.</span><span class=na>parseInt</span><span class=o>(</span><span class=n>patch</span><span class=o>)]</span> <span class=k>as</span> <span class=kt>int</span><span class=o>[]</span>
<span class=o>}</span>

<span class=n>versionName</span> <span class=s2>&#34;${versionMajor}.${versionMinor}.${versionPatch}&#34;</span></code></pre></div></div><p>ios 写程序用类似命令改 <code>/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString ${PACKAGE_VERSION}" "ios/YOURAPP/Info.plist"</code> 就可以。可以修改 package.json 增加 <code>version</code></p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript>    <span class=s2>&#34;scripts&#34;</span><span class=o>:</span> <span class=p>{</span>
        <span class=s2>&#34;start&#34;</span><span class=o>:</span> <span class=s2>&#34;node node_modules/react-native/local-cli/cli.js start&#34;</span><span class=p>,</span>
        <span class=s2>&#34;test&#34;</span><span class=o>:</span> <span class=s2>&#34;jest&#34;</span><span class=p>,</span>
        <span class=s2>&#34;lint&#34;</span><span class=o>:</span> <span class=s2>&#34;node_modules/.bin/eslint app&#34;</span><span class=p>,</span>
        <span class=s2>&#34;version&#34;</span><span class=o>:</span> <span class=s2>&#34;./version-ios.sh&#34;</span><span class=p>,</span>
        <span class=s2>&#34;precommit&#34;</span><span class=o>:</span> <span class=s2>&#34;./pre-commit&#34;</span><span class=p>,</span>
        <span class=s2>&#34;postinstall&#34;</span><span class=o>:</span> <span class=s2>&#34;patch-package&#34;</span>
    <span class=p>},</span>
</code></pre></div></div><p>使用 npm version 的时候就可以自动同步修改 ios，android 的版本号了。</p></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/react-native>react-native</a></li></ul></nav></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='wdicc';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="footer wrapper"><nav class=nav><div>Copyright © 2020 wd. All Rights Reserved | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>