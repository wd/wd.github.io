<!doctype html><html lang=en><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://wdicc.com/favicon.ico><title>React Native Versions | wd and cc</title><meta name=title content="React Native Versions"><meta name=description content="RN 里面有很多个个版本号

package.json 里面定义的 version 。
android/app/build.gradle 里面定义的 versionName 和 versionCode 。
ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。
如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 Label 一般是 v 开头的。

这几个版本号都有用，需要有规划的使用。我的经验如下。

统一 version, versionName, CFBundleShortVersionString ，使用类似 x.y.z 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的，
versionCode 和 CFBundleVersion 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。

如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则："><meta name=keywords content="react-native,"><meta property="og:url" content="https://wdicc.com/react-native-versions/"><meta property="og:site_name" content="wd and cc"><meta property="og:title" content="React Native Versions"><meta property="og:description" content="RN 里面有很多个个版本号
package.json 里面定义的 version 。 android/app/build.gradle 里面定义的 versionName 和 versionCode 。 ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。 如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 Label 一般是 v 开头的。 这几个版本号都有用，需要有规划的使用。我的经验如下。
统一 version, versionName, CFBundleShortVersionString ，使用类似 x.y.z 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的， versionCode 和 CFBundleVersion 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。 如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则："><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-26T15:45:27+08:00"><meta property="article:modified_time" content="2019-07-26T15:45:27+08:00"><meta property="article:tag" content="React-Native"><meta name=twitter:card content="summary"><meta name=twitter:title content="React Native Versions"><meta name=twitter:description content="RN 里面有很多个个版本号
package.json 里面定义的 version 。 android/app/build.gradle 里面定义的 versionName 和 versionCode 。 ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。 如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 Label 一般是 v 开头的。 这几个版本号都有用，需要有规划的使用。我的经验如下。
统一 version, versionName, CFBundleShortVersionString ，使用类似 x.y.z 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的， versionCode 和 CFBundleVersion 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。 如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则："><meta itemprop=name content="React Native Versions"><meta itemprop=description content="RN 里面有很多个个版本号
package.json 里面定义的 version 。 android/app/build.gradle 里面定义的 versionName 和 versionCode 。 ios/YOURAPP/Info.plist 里面定义的 CFBundleShortVersionString 和 CFBundleVersion 。 如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 Label 一般是 v 开头的。 这几个版本号都有用，需要有规划的使用。我的经验如下。
统一 version, versionName, CFBundleShortVersionString ，使用类似 x.y.z 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的， versionCode 和 CFBundleVersion 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。 如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则："><meta itemprop=datePublished content="2019-07-26T15:45:27+08:00"><meta itemprop=dateModified content="2019-07-26T15:45:27+08:00"><meta itemprop=wordCount content="696"><meta itemprop=keywords content="React-Native"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--code-background-color:#f2f2f2;--code-color:#222;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--code-background-color:#000;--code-color:#ddd;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px}blockquote{border-left:1px solid #999;color:var(--code-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto !important}.highlight,.code{padding:1px 15px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>wd and cc</h2></a><p>-- Good good study, day day up!</p><nav><a href=/>Home</a>
<a href=/posts/>Posts</a>
<a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a>
<a href=/tags/>Tags</a>
<a href=/atom.xml>subscribe</a></nav></header><main><h1>React Native Versions</h1><p><i><time datetime=2019-07-26>26 Jul, 2019
</time></i><a href=https://wdicc.com/tags/react-native/>#React-Native</a></p><content><p>RN 里面有很多个个版本号</p><ol><li><code>package.json</code> 里面定义的 <code>version</code> 。</li><li><code>android/app/build.gradle</code> 里面定义的 <code>versionName</code> 和 <code>versionCode</code> 。</li><li><code>ios/YOURAPP/Info.plist</code> 里面定义的 <code>CFBundleShortVersionString</code> 和 <code>CFBundleVersion</code> 。</li><li>如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 <code>Label</code> 一般是 <code>v</code> 开头的。</li></ol><p>这几个版本号都有用，需要有规划的使用。我的经验如下。</p><ol><li>统一 <code>version</code>, <code>versionName</code>, <code>CFBundleShortVersionString</code> ，使用类似 <code>x.y.z</code> 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的，</li><li><code>versionCode</code> 和 <code>CFBundleVersion</code> 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。</li><li><p>如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则：</p><ol><li>如果 native 代码有变更，那需要增加 <code>x.y</code> ，比如可以从 <code>1.0</code> 变成 <code>1.1</code> 也可以是变成 <code>2.0</code> 。</li><li>如果只是 js 代码更新，那只增加 <code>z</code> ，其他不变，同时 code-push 发布的时候，使用 <code>-t</code> 指定 target version 为 <code>x.y.0 ~ x.y.z</code> 这样的形式。</li></ol></li></ol><p>基于上面的设置，实际一个 app 的版本号就是类似于 <code>1.2.2(111)-v23</code> 或者 <code>1.2.2(111)-un</code> 这样的形式。 <code>1.2.2</code> 表示 native 版本， <code>111</code> 是编译版本， <code>v23</code> 是 codepush 的版本，如果没更新 codepush 那可能是 <code>un</code> 。 <code>1.2.2(111)</code> 部分可以通过 RN 模块或者程序启动时候注入到 js 里面来， <code>v23</code> 部分可以使用 codepush 的 api 取。</p><p>一般我们以 <code>package.json</code> 里面的版本为准，android 可以让 gradle 读取这个文件自动变更版本， ios 需要自己写一个程序。</p><div class="src src-groovy"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#902000>def</span> <span style=color:#06287e>getNpmVersion</span><span style=color:#666>()</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#902000>def</span> inputFile <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>new</span> File<span style=color:#666>(</span><span style=color:#4070a0>&#34;../package.json&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#902000>def</span> packageJson <span style=color:#666>=</span> <span style=color:#007020;font-weight:700>new</span> JsonSlurper<span style=color:#666>().</span><span style=color:#4070a0>parseText</span><span style=color:#666>(</span>inputFile<span style=color:#666>.</span><span style=color:#4070a0>text</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#007020;font-weight:700>return</span> packageJson<span style=color:#666>[</span><span style=color:#4070a0>&#34;version&#34;</span><span style=color:#666>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#902000>def</span> <span style=color:#06287e>getNpmVersionArray</span><span style=color:#666>()</span> <span style=color:#666>{</span> <span style=color:#60a0b0;font-style:italic>// major [0], minor [1], patch [2]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#60a0b0;font-style:italic></span>    <span style=color:#902000>def</span> <span style=color:#666>(</span>major<span style=color:#666>,</span> minor<span style=color:#666>,</span> patch<span style=color:#666>)</span> <span style=color:#666>=</span> getNpmVersion<span style=color:#666>().</span><span style=color:#4070a0>tokenize</span><span style=color:#666>(</span><span style=color:#4070a0>&#39;.&#39;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#007020;font-weight:700>return</span> <span style=color:#666>[</span>Integer<span style=color:#666>.</span><span style=color:#4070a0>parseInt</span><span style=color:#666>(</span>major<span style=color:#666>),</span> Integer<span style=color:#666>.</span><span style=color:#4070a0>parseInt</span><span style=color:#666>(</span>minor<span style=color:#666>),</span> Integer<span style=color:#666>.</span><span style=color:#4070a0>parseInt</span><span style=color:#666>(</span>patch<span style=color:#666>)]</span> <span style=color:#007020;font-weight:700>as</span> <span style=color:#902000>int</span><span style=color:#666>[]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>versionName <span style=color:#4070a0>&#34;${versionMajor}.${versionMinor}.${versionPatch}&#34;</span></span></span></code></pre></div></div><p>ios 写程序用类似命令改 <code>/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString ${PACKAGE_VERSION}" "ios/YOURAPP/Info.plist"</code> 就可以。可以修改 package.json 增加 <code>version</code></p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>    <span style=color:#4070a0>&#34;scripts&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>        <span style=color:#4070a0>&#34;start&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;node node_modules/react-native/local-cli/cli.js start&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>        <span style=color:#4070a0>&#34;test&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;jest&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>        <span style=color:#4070a0>&#34;lint&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;node_modules/.bin/eslint app&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>        <span style=color:#4070a0>&#34;version&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;./version-ios.sh&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>        <span style=color:#4070a0>&#34;precommit&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;./pre-commit&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>        <span style=color:#4070a0>&#34;postinstall&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;patch-package&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>    },</span></span></code></pre></div></div><p>使用 npm version 的时候就可以自动同步修改 ios，android 的版本号了。</p></content></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>