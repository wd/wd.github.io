<!doctype html><html lang=en><head><title>React Native Versions &ndash; wd and cc</title>
<meta name=description content="Good good study, day day up!"><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=UTF-8><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://wdicc.com/css/palettes/base16-dark.css><link rel=stylesheet href=https://wdicc.com/css/risotto.css><link rel=stylesheet href=https://wdicc.com/css/custom.css><link rel=icon href=https://wdicc.com/favicon.ico></head><body><div class=page><header class=page__header><nav class="page__nav main-nav"><ul><h1 class=page__logo><a href=https://wdicc.com/ class=page__logo-inner>wd and cc</a></h1><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/posts/ title>Posts</a></li><li class=main-nav__item><a class=nav-main-item href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=" title>Search</a></li><li class=main-nav__item><a class=nav-main-item href=https://wdicc.com/atom.xml title>subscribe</a></li></ul></nav></header><section class=page__body><header class=content__header><h1>React Native Versions</h1></header><div class=content__body><p>RN 里面有很多个个版本号</p><ol><li><code>package.json</code> 里面定义的 <code>version</code> 。</li><li><code>android/app/build.gradle</code> 里面定义的 <code>versionName</code> 和 <code>versionCode</code> 。</li><li><code>ios/YOURAPP/Info.plist</code> 里面定义的 <code>CFBundleShortVersionString</code> 和 <code>CFBundleVersion</code> 。</li><li>如果你使用 code-push 的话，还有一个 code-push 自己的版本号，叫做 <code>Label</code> 一般是 <code>v</code> 开头的。</li></ol><p>这几个版本号都有用，需要有规划的使用。我的经验如下。</p><ol><li>统一 <code>version</code>, <code>versionName</code>, <code>CFBundleShortVersionString</code> ，使用类似 <code>x.y.z</code> 这样的格式，升级的时候都一起升级，每次发布这个版本前都会在 git 打一个 tag。这个是用来表示用户看到的 native 的版本。这样你的 app 在 ios 和 android 的市场里面，同一个版本的，一般就是同一套代码打包的，</li><li><code>versionCode</code> 和 <code>CFBundleVersion</code> 各自表示各平台软件的真实版本，可能会出现同一个 1 里面的版本的情况下，这个有多个的情况。一般的应用市场发布的时候，也是认这个版本号的。这个编号只增不减，原则上每次打包都增加，不管代码有无变更。</li><li><p>如果使用了 code-push，那还 1 里面的版本号还需要遵守一个原则：</p><ol><li>如果 native 代码有变更，那需要增加 <code>x.y</code> ，比如可以从 <code>1.0</code> 变成 <code>1.1</code> 也可以是变成 <code>2.0</code> 。</li><li>如果只是 js 代码更新，那只增加 <code>z</code> ，其他不变，同时 code-push 发布的时候，使用 <code>-t</code> 指定 target version 为 <code>x.y.0 ~ x.y.z</code> 这样的形式。</li></ol></li></ol><p>基于上面的设置，实际一个 app 的版本号就是类似于 <code>1.2.2(111)-v23</code> 或者 <code>1.2.2(111)-un</code> 这样的形式。 <code>1.2.2</code> 表示 native 版本， <code>111</code> 是编译版本， <code>v23</code> 是 codepush 的版本，如果没更新 codepush 那可能是 <code>un</code> 。 <code>1.2.2(111)</code> 部分可以通过 RN 模块或者程序启动时候注入到 js 里面来， <code>v23</code> 部分可以使用 codepush 的 api 取。</p><p>一般我们以 <code>package.json</code> 里面的版本为准，android 可以让 gradle 读取这个文件自动变更版本， ios 需要自己写一个程序。</p><div class="src src-groovy"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getNpmVersion</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> inputFile <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;../package.json&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> packageJson <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JsonSlurper<span style=color:#f92672>().</span><span style=color:#a6e22e>parseText</span><span style=color:#f92672>(</span>inputFile<span style=color:#f92672>.</span><span style=color:#a6e22e>text</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> packageJson<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;version&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>getNpmVersionArray</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span> <span style=color:#75715e>// major [0], minor [1], patch [2]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>def</span> <span style=color:#f92672>(</span>major<span style=color:#f92672>,</span> minor<span style=color:#f92672>,</span> patch<span style=color:#f92672>)</span> <span style=color:#f92672>=</span> getNpmVersion<span style=color:#f92672>().</span><span style=color:#a6e22e>tokenize</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>[</span>Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>(</span>major<span style=color:#f92672>),</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>(</span>minor<span style=color:#f92672>),</span> Integer<span style=color:#f92672>.</span><span style=color:#a6e22e>parseInt</span><span style=color:#f92672>(</span>patch<span style=color:#f92672>)]</span> <span style=color:#66d9ef>as</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>versionName <span style=color:#e6db74>&#34;${versionMajor}.${versionMinor}.${versionPatch}&#34;</span></span></span></code></pre></div></div><p>ios 写程序用类似命令改 <code>/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString ${PACKAGE_VERSION}" "ios/YOURAPP/Info.plist"</code> 就可以。可以修改 package.json 增加 <code>version</code></p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>    <span style=color:#e6db74>&#34;scripts&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;start&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;node node_modules/react-native/local-cli/cli.js start&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;jest&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;lint&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;node_modules/.bin/eslint app&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;version&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;./version-ios.sh&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;precommit&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;./pre-commit&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;postinstall&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;patch-package&#34;</span>
</span></span><span style=display:flex><span>    },</span></span></code></pre></div></div><p>使用 npm version 的时候就可以自动同步修改 ios，android 的版本号了。</p></div><footer class=content__footer></footer></section><section class=page__aside><div class=aside__about><div class=aside__about><img class=about__logo src=https://wdicc.com/favicon.ico alt=Logo><h1 class=about__title>Happy every day!</h1><p class=about__description>Good good study, day day up!</p></div><ul class=aside__social-links><li><a href=https://github.com/wd rel=me aria-label=GitHub title=GitHub><i class="fa-brands fa-github" aria-hidden=true></i></a>&nbsp;</li></ul></div><hr><div class=aside__content><p>2019-07-26</p></div></section><footer class=page__footer><p><br><span class=active>$ echo $LANG<br><b>zh_CN</b></span><br></p><br><br><p class=copyright>wd © 2025</p><p class=advertisement>Powered by <a href=https://gohugo.io/>hugo</a> and <a href=https://github.com/joeroe/risotto>risotto</a>.</p></footer></div></body></html>