<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Howto Make react-redux Work With react-navigation - wd and cc</title><link rel=icon type=image/png href=/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Howto Make react-redux Work With react-navigation"><meta property="og:description" content="这周花了一些时间研究 react-redux 和怎么让它和 react-navigation 配合一起工作，总结一下，把代码和注释直接贴这里了，也可以看这个 g"><meta property="og:type" content="article"><meta property="og:url" content="https://wdicc.com/amp/howto-make-react-redux-work-with-react-navigation/"><meta property="article:published_time" content="2017-10-21T08:19:28+08:00"><meta property="article:modified_time" content="2017-10-21T08:19:28+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Howto Make react-redux Work With react-navigation"><meta name=twitter:description content="这周花了一些时间研究 react-redux 和怎么让它和 react-navigation 配合一起工作，总结一下，把代码和注释直接贴这里了，也可以看这个 g"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://wdicc.com/css/main.css><link rel=stylesheet type=text/css href=https://wdicc.com//light-syntax.css media="(prefers-color-scheme: light)"><link rel=stylesheet type=text/css href=https://wdicc.com/css/dark.css media="(prefers-color-scheme: dark)"><link rel=stylesheet type=text/css href=https://wdicc.com//dark-syntax.css media="(prefers-color-scheme: dark)"><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><script src=https://wdicc.com/js/main.js></script></head><body><div class="container wrapper post"><div class=header><h1 class=site-title><a href=https://wdicc.com/>wd and cc</a></h1><div class=site-description><h2>&mdash; Happy every day</h2><nav class="nav social"><ul class=flat><a href=https://github.com/wd title=Github><i data-feather=github></i></a><a href=https://twitter.com/wd title=Twitter><i data-feather=twitter></i></a></ul></nav></div><nav class=nav><ul class=flat><li><a href=/>Home</a></li><li><a href=/post>All posts</a></li><li><a href=/tags>Tags</a></li><li><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&q=">Search</a></li><li><a href=/atom.xml>Subscribe</a></li></ul></nav></div><div class=post-header><h1 class=title>Howto Make react-redux Work With react-navigation</h1><div class=meta>Posted at &mdash; Oct 21, 2017</div></div><div class=post-header></div><div class=markdown><p>这周花了一些时间研究 <code class=verbatim>react-redux</code> 和怎么让它和 <code class=verbatim>react-navigation</code> 配合一起工作，总结一下，把代码和注释直接贴这里了，也可以看这个 <a href=https://gist.github.com/wd/7935c3fb20f2517280b8e050796310b3>gist</a>。</p><div class="src src-javascript"><div class=highlight><pre class=chroma><code class=language-javascript data-lang=javascript><span class=cm>/**
</span><span class=cm> * 一个简单的 RN 应用，有 2 个页面，使用了 react-navigation 的 StackNavigator 来做界面管理
</span><span class=cm> * 为了说明如何使用 redux，以及如何让 redux 和 StackNavigator 配合
</span><span class=cm> * 为了容易理解，把所有内容都放到了一个页面里面，实际开发的时候不要这么做
</span><span class=cm> * 参考：
</span><span class=cm> *  https://github.com/jackielii/simplest-redux-example
</span><span class=cm> *  http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html
</span><span class=cm> */</span>

<span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>Component</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span>
    <span class=nx>StyleSheet</span><span class=p>,</span>
    <span class=nx>Text</span><span class=p>,</span>
    <span class=nx>View</span><span class=p>,</span>
    <span class=nx>Button</span>
<span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-native&#39;</span><span class=p>;</span>

<span class=kr>import</span> <span class=p>{</span> <span class=nx>Provider</span><span class=p>,</span> <span class=nx>connect</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-redux&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>createStore</span><span class=p>,</span> <span class=nx>combineReducers</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;redux&#39;</span><span class=p>;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>StackNavigator</span><span class=p>,</span> <span class=nx>addNavigationHelpers</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react-navigation&#39;</span><span class=p>;</span>

<span class=c1>// Home 页面，UI 组件
</span><span class=c1></span><span class=kr>class</span> <span class=nx>MyHome</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;init home, props&#39;</span><span class=p>,</span> <span class=nx>props</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>_nextPage</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// navigation 依然在 this.props 里面获取，和不用 redux 的时候用法一样
</span><span class=c1></span>        <span class=kd>let</span> <span class=p>{</span><span class=nx>navigation</span><span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>;</span>
        <span class=nx>navigation</span><span class=p>.</span><span class=nx>navigate</span><span class=p>(</span><span class=s2>&#34;App&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// 所有的传递过来的状态，都需要从 this.props.screenProps 里面读取 (4)
</span><span class=c1></span>        <span class=c1>// 我这里给不同页面的 action 取了各自的命名空间，避免冲突，也可以直接所有 action 都在一个命名空间，这块我还在摸索如何处理比较好 (5)
</span><span class=c1></span>        <span class=kd>let</span> <span class=p>{</span><span class=nx>onIncButtonClicked</span><span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>screenProps</span><span class=p>.</span><span class=nx>MyAppActions</span><span class=p>;</span>

        <span class=c1>// 界面有两个按钮，一个用来增加另外一个页面的计数器，一个用来访问下一个页面
</span><span class=c1></span>        <span class=k>return</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>View</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>container</span><span class=p>}</span><span class=o>&gt;</span>
                <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>title</span><span class=o>=</span><span class=s2>&#34;Inc counter&#34;</span> <span class=nx>onPress</span><span class=o>=</span><span class=p>{</span><span class=nx>onIncButtonClicked</span><span class=p>}</span><span class=o>&gt;&lt;</span><span class=err>/Button&gt;</span>
                <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>title</span><span class=o>=</span><span class=s2>&#34;Next page&#34;</span> <span class=nx>onPress</span><span class=o>=</span><span class=p>{()=&gt;</span><span class=k>this</span><span class=p>.</span><span class=nx>_nextPage</span><span class=p>()}</span><span class=o>&gt;&lt;</span><span class=err>/Button&gt;</span>
            <span class=o>&lt;</span><span class=err>/View&gt;</span>
        <span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 这个组件只是用来测试就算一个 props 传递给子组件，在 props 被修改的时候也会被自动刷新
</span><span class=c1></span><span class=kr>class</span> <span class=nx>ShowText</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
        <span class=kd>let</span> <span class=p>{</span><span class=nx>counter</span><span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>;</span>

        <span class=k>return</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>Text</span><span class=o>&gt;</span><span class=p>{</span><span class=nx>counter</span><span class=p>}</span><span class=o>&lt;</span><span class=err>/Text&gt;</span>
        <span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// App 页面，UI 组件
</span><span class=c1></span><span class=kr>class</span> <span class=nx>MyApp</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;init App, props&#39;</span><span class=p>,</span> <span class=nx>props</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>componentWillReceiveProps</span><span class=p>(</span><span class=nx>newProps</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;myapp recive props&#39;</span><span class=p>,</span> <span class=nx>newProps</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// 组件的 state/props 获取，有自己的命名空间 (1)
</span><span class=c1></span>        <span class=kd>let</span> <span class=p>{</span><span class=nx>counter</span><span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>screenProps</span><span class=p>.</span><span class=nx>MyApp</span><span class=p>;</span>
        <span class=c1>// 组件的 action props (5)
</span><span class=c1></span>        <span class=kd>let</span> <span class=p>{</span><span class=nx>onIncButtonClicked</span><span class=p>,</span> <span class=nx>onDecButtonClicked</span><span class=p>}</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>screenProps</span><span class=p>.</span><span class=nx>MyAppActions</span><span class=p>;</span>

        <span class=c1>// 界面有一个计数器的结果，两个按钮
</span><span class=c1></span>        <span class=k>return</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>View</span> <span class=nx>style</span><span class=o>=</span><span class=p>{</span><span class=nx>styles</span><span class=p>.</span><span class=nx>container</span><span class=p>}</span><span class=o>&gt;</span>
                <span class=o>&lt;</span><span class=nx>ShowText</span> <span class=nx>counter</span><span class=o>=</span><span class=p>{</span><span class=nx>counter</span><span class=p>}</span> <span class=o>/&gt;</span>
                <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>title</span><span class=o>=</span><span class=s2>&#34;Inc counter&#34;</span> <span class=nx>onPress</span><span class=o>=</span><span class=p>{</span><span class=nx>onIncButtonClicked</span><span class=p>}</span><span class=o>&gt;&lt;</span><span class=err>/Button&gt;</span>
                <span class=o>&lt;</span><span class=nx>Button</span> <span class=nx>title</span><span class=o>=</span><span class=s2>&#34;Dec counter&#34;</span> <span class=nx>onPress</span><span class=o>=</span><span class=p>{</span><span class=nx>onDecButtonClicked</span><span class=p>}</span><span class=o>&gt;&lt;</span><span class=err>/Button&gt;</span>
            <span class=o>&lt;</span><span class=err>/View&gt;</span>
        <span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 初始化 StackNavigator，定义页面路由
</span><span class=c1></span><span class=kd>let</span> <span class=nx>AppNavigator</span> <span class=o>=</span> <span class=nx>StackNavigator</span><span class=p>({</span>
    <span class=nx>Home</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>screen</span><span class=o>:</span> <span class=nx>MyHome</span>
    <span class=p>},</span>
    <span class=nx>App</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>screen</span><span class=o>:</span> <span class=nx>MyApp</span>
    <span class=p>}</span>
<span class=p>});</span>

<span class=c1>// 包装一下 StackNavigator，因为有些参数需要定制一下
</span><span class=c1></span><span class=kr>class</span> <span class=nx>MyStackNavigator</span> <span class=kr>extends</span> <span class=nx>Component</span> <span class=p>{</span>
    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside MyStackNavigator&#34;</span><span class=p>,</span> <span class=nx>props</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// screenProps: 使用这个往所有的页面传递 props，这个是和直接使用 redux 不同的地方 (4)
</span><span class=c1></span>        <span class=c1>// navigation: 因为使用 redux 之后，就不会直接操作 this.state 了，所以得告诉 StackNavigator dispatch 方法和 state 从哪里读取
</span><span class=c1></span>        <span class=k>return</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>AppNavigator</span>
                <span class=nx>screenProps</span><span class=o>=</span><span class=p>{</span><span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>}</span>
                <span class=nx>navigation</span><span class=o>=</span><span class=p>{</span><span class=nx>addNavigationHelpers</span><span class=p>({</span>
                    <span class=nx>dispatch</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>dispatch</span><span class=p>,</span> <span class=c1>// 通过 action props 定义 (2)
</span><span class=c1></span>                    <span class=nx>state</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>props</span><span class=p>.</span><span class=nx>nav</span><span class=p>,</span> <span class=c1>// 通过 state props 定义 (3)
</span><span class=c1></span>                <span class=p>})}</span> <span class=o>/&gt;</span>
        <span class=p>)</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 定义 state 和 props 的关系，所有 redux 应用都需要 (6)
</span><span class=c1></span><span class=kd>let</span> <span class=nx>mapStateToProps</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>ownProps</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside mapstate to props&#34;</span><span class=p>,</span> <span class=nx>state</span><span class=p>,</span> <span class=nx>ownProps</span><span class=p>);</span>
    <span class=k>return</span> <span class=p>{</span>
        <span class=c1>// 这两个是不同的命名空间，和上面你使用的时候的路径对应 (1)
</span><span class=c1></span>        <span class=s2>&#34;MyApp&#34;</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>MyApp</span><span class=p>,</span>
        <span class=s2>&#34;MyHome&#34;</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>MyHome</span><span class=p>,</span>
        <span class=c1>// 定义 StackNavigator 的 state (3)
</span><span class=c1></span>        <span class=s2>&#34;nav&#34;</span><span class=o>:</span> <span class=nx>state</span><span class=p>.</span><span class=nx>nav</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=c1>// 定义 action 和 props 的关系，所有 redux 应用都需要
</span><span class=c1></span><span class=kd>let</span> <span class=nx>mapDispatchToProps</span> <span class=o>=</span> <span class=p>(</span><span class=nx>dispatch</span><span class=p>,</span> <span class=nx>ownProps</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside map dispath to props&#34;</span><span class=p>);</span>
    <span class=k>return</span> <span class=p>{</span>
        <span class=c1>// 这两个也是不同的命名空间，和上面使用的时候路径对应 (5)
</span><span class=c1></span>        <span class=s1>&#39;MyAppActions&#39;</span><span class=o>:</span> <span class=p>{</span>
            <span class=nx>onIncButtonClicked</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
                <span class=kd>let</span> <span class=nx>action</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;INC_COUNTER&#34;</span><span class=p>,</span>
                    <span class=nx>payload</span><span class=o>:</span> <span class=mi>1</span>
                <span class=p>};</span>

                <span class=nx>dispatch</span><span class=p>(</span><span class=nx>action</span><span class=p>);</span>
            <span class=p>},</span>
            <span class=nx>onDecButtonClicked</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
                <span class=kd>let</span> <span class=nx>action</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;DEC_COUNTER&#34;</span><span class=p>,</span>
                    <span class=nx>payload</span><span class=o>:</span> <span class=o>-</span><span class=mi>1</span>
                <span class=p>};</span>

                <span class=nx>dispatch</span><span class=p>(</span><span class=nx>action</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=s1>&#39;MyHomeActions&#39;</span><span class=o>:</span> <span class=p>{</span>
            <span class=nx>onNextButtonClicked</span><span class=o>:</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
                <span class=kd>let</span> <span class=nx>action</span> <span class=o>=</span> <span class=p>{</span>
                    <span class=nx>type</span><span class=o>:</span> <span class=s2>&#34;NEXT_PAGE&#34;</span>
                <span class=p>};</span>

                <span class=nx>dispatch</span><span class=p>(</span><span class=nx>action</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=c1>// 定义 StackNavigator 的 action props (2)
</span><span class=c1></span>        <span class=s1>&#39;dispatch&#39;</span><span class=o>:</span> <span class=nx>dispatch</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// 定义 home 页面的 reducer，不过因为那个页面唯一的一个 action 是触发别的页面的动作的，所以这个 reducer 其实也可以没有
</span><span class=c1>// 所以从这里也能看出来，reducer 并不一定按照页面去分
</span><span class=c1></span><span class=kd>let</span> <span class=nx>homeReducer</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside home reducer&#34;</span><span class=p>,</span> <span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>);</span>
    <span class=k>return</span> <span class=nx>state</span> <span class=o>||</span> <span class=p>{};</span>
<span class=p>};</span>

<span class=c1>// 定义一个初始化的 state
</span><span class=c1></span><span class=kd>let</span> <span class=nx>myAppInitState</span> <span class=o>=</span> <span class=p>{</span> <span class=s1>&#39;counter&#39;</span><span class=o>:</span> <span class=mi>10</span><span class=p>};</span>
<span class=c1>// 定义 app 页面的 reducer
</span><span class=c1></span><span class=kd>let</span> <span class=nx>myAppReducer</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>myAppInitState</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=c1>// 收到的 state 实际上只是自己命名空间下的 (6)
</span><span class=c1></span>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside myAppReducer&#34;</span><span class=p>,</span> <span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>);</span>
    <span class=kd>let</span> <span class=nx>myState</span> <span class=o>=</span> <span class=nx>state</span><span class=p>;</span>
    <span class=c1>// 需要处理的 action 的逻辑
</span><span class=c1></span>    <span class=c1>// 要注意，一个 action 被触发的时候，所有的 reducer 都会被调用，所以其实更像是订阅自己想要处理的 action
</span><span class=c1></span>    <span class=k>switch</span> <span class=p>(</span><span class=nx>action</span><span class=p>.</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>case</span> <span class=s2>&#34;DEC_COUNTER&#34;</span><span class=o>:</span>
        <span class=k>case</span> <span class=s2>&#34;INC_COUNTER&#34;</span><span class=o>:</span>
            <span class=c1>// 如果修改了 state，必须要返回一个新的对象，不能直接在原对象上修改，否则 state 变化不会触发组件的刷新
</span><span class=c1></span>            <span class=k>return</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>assign</span><span class=p>({},</span> <span class=nx>myState</span><span class=p>,</span> <span class=p>{</span>
                <span class=s1>&#39;counter&#39;</span><span class=o>:</span> <span class=nx>myState</span><span class=p>.</span><span class=nx>counter</span> <span class=o>+</span> <span class=nx>action</span><span class=p>.</span><span class=nx>payload</span>
            <span class=p>});</span>
        <span class=k>default</span><span class=o>:</span>
            <span class=k>return</span> <span class=nx>state</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>};</span>

<span class=c1>// 定义一个 StackNavigator 用到的初始化状态，这个很重要
</span><span class=c1></span><span class=kr>const</span> <span class=nx>initialState</span> <span class=o>=</span> <span class=nx>AppNavigator</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>getStateForAction</span><span class=p>(</span><span class=nx>AppNavigator</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>getActionForPathAndParams</span><span class=p>(</span><span class=s1>&#39;Home&#39;</span><span class=p>));</span>
<span class=c1>// 定义 StackNavigator 的 reducer，代码直接复制来的
</span><span class=c1></span><span class=kr>const</span> <span class=nx>navReducer</span> <span class=o>=</span> <span class=p>(</span><span class=nx>state</span> <span class=o>=</span> <span class=nx>initialState</span><span class=p>,</span> <span class=nx>action</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;inside nav reducer&#34;</span><span class=p>,</span> <span class=nx>state</span><span class=p>,</span> <span class=nx>action</span><span class=p>);</span>
    <span class=kr>const</span> <span class=nx>nextState</span> <span class=o>=</span> <span class=nx>AppNavigator</span><span class=p>.</span><span class=nx>router</span><span class=p>.</span><span class=nx>getStateForAction</span><span class=p>(</span><span class=nx>action</span><span class=p>,</span> <span class=nx>state</span><span class=p>);</span>

    <span class=c1>// Simply return the original `state` if `nextState` is null or undefined.
</span><span class=c1></span>    <span class=k>return</span> <span class=nx>nextState</span> <span class=o>||</span> <span class=nx>state</span><span class=p>;</span>
<span class=p>};</span>

<span class=c1>// 创建 store
</span><span class=c1></span><span class=kd>let</span> <span class=nx>store</span> <span class=o>=</span> <span class=nx>createStore</span><span class=p>(</span><span class=nx>combineReducers</span><span class=p>({</span>
    <span class=c1>// 这里的 MyApp 等和前面定义 mapStateToProps 的地方对应 (6)
</span><span class=c1></span>    <span class=c1>// 这里也是导致 reducer 收到的 state 只有自己命名空间下数据的一个原因 (6)
</span><span class=c1></span>    <span class=nx>MyApp</span><span class=o>:</span> <span class=nx>myAppReducer</span><span class=p>,</span>
    <span class=nx>MyHome</span><span class=o>:</span> <span class=nx>homeReducer</span><span class=p>,</span>
    <span class=nx>nav</span><span class=o>:</span> <span class=nx>navReducer</span>
<span class=p>}));</span>

<span class=c1>// 让 redux 加持一下，保佑
</span><span class=c1></span><span class=kd>let</span> <span class=nx>App</span> <span class=o>=</span> <span class=nx>connect</span><span class=p>(</span><span class=nx>mapStateToProps</span><span class=p>,</span> <span class=nx>mapDispatchToProps</span><span class=p>)(</span><span class=nx>MyStackNavigator</span><span class=p>);</span>

<span class=c1>// 其他的就是比较常见的 redux 的逻辑了，另外需要说明的是实际使用的时候，肯定会做页面拆分，如何拆分可能都会有不同的看法，我也还在摸索
</span><span class=c1></span><span class=kr>export</span> <span class=k>default</span> <span class=kr>class</span> <span class=nx>Root</span> <span class=kr>extends</span> <span class=nx>Component</span><span class=o>&lt;</span><span class=p>{}</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=nx>constructor</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
        <span class=kr>super</span><span class=p>(</span><span class=nx>props</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nx>render</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>(</span>
            <span class=o>&lt;</span><span class=nx>Provider</span> <span class=nx>store</span><span class=o>=</span><span class=p>{</span><span class=nx>store</span><span class=p>}</span><span class=o>&gt;</span>
                <span class=o>&lt;</span><span class=nx>App</span> <span class=nx>prop1</span><span class=o>=</span><span class=s2>&#34;prop1&#34;</span> <span class=o>/&gt;</span>
            <span class=o>&lt;</span><span class=err>/Provider&gt;</span>
        <span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>


<span class=kr>const</span> <span class=nx>styles</span> <span class=o>=</span> <span class=nx>StyleSheet</span><span class=p>.</span><span class=nx>create</span><span class=p>({</span>
    <span class=nx>container</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>flex</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
        <span class=nx>justifyContent</span><span class=o>:</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
        <span class=nx>alignItems</span><span class=o>:</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
        <span class=nx>backgroundColor</span><span class=o>:</span> <span class=s1>&#39;#F5FCFF&#39;</span><span class=p>,</span>
    <span class=p>},</span>
    <span class=nx>welcome</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>fontSize</span><span class=o>:</span> <span class=mi>20</span><span class=p>,</span>
        <span class=nx>textAlign</span><span class=o>:</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
        <span class=nx>margin</span><span class=o>:</span> <span class=mi>10</span><span class=p>,</span>
    <span class=p>},</span>
    <span class=nx>instructions</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>textAlign</span><span class=o>:</span> <span class=s1>&#39;center&#39;</span><span class=p>,</span>
        <span class=nx>color</span><span class=o>:</span> <span class=s1>&#39;#333333&#39;</span><span class=p>,</span>
        <span class=nx>marginBottom</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span>
    <span class=p>},</span>
<span class=p>});</span>
</code></pre></div></div></div><div class=post-tags><nav class="nav tags"><ul class=flat><li><a href=/tags/react-native>react-native</a></li><li><a href=/tags/redux>redux</a></li><li><a href=/tags/react-redux>react-redux</a></li><li><a href=/tags/react-navigation>react-navigation</a></li></ul></nav></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")
return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='wdicc';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by
Disqus.</a></noscript><a href=http://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><div class="footer wrapper"><nav class=nav><div>Copyright © 2020 wd. All Rights Reserved | <a href=https://github.com/vividvilla/ezhil>Ezhil theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></nav></div><script>feather.replace()</script></body></html>