<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,viewport-fit=cover,initial-scale=1"><title>Google Python Style Guide | wd and cc</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css><header><nav><ul><li class=pull-left><a href=https://wdicc.com/>/home/wd and cc</a></li><li class=pull-left><a href=/tags/>~/tags</a></li><li class=pull-left><a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&q=">~/search</a></li><li class=pull-right><a href=/atom.xml>~/subscribe</a></li></ul></nav></header></head><body><br><div class=article-meta><h1><span class=title>Google Python Style Guide</span></h1><h2 class=date>2020/02/02</h2><p class=terms>Tags: <a href=/tags/python>python</a></p></div><div id=TOC><nav id=TableOfContents><ul><li><a href=#headline-1>1 Background</a></li><li><a href=#headline-2>2 Python Language Rules</a><ul><li><a href=#headline-3>2.1 Lint</a></li><li><a href=#headline-4>2.2 Imports</a></li><li><a href=#headline-5>2.3 Packages</a></li><li><a href=#headline-6>2.4 Exceptions</a></li><li><a href=#headline-7>2.5 Global variables</a></li><li><a href=#headline-8>2.6 Nested/Local/Inner Classes and Functions</a></li><li><a href=#headline-9>2.7 Comprehensions & Generator Expressions</a></li><li><a href=#headline-10>2.8 Default Iterators and Operators</a></li><li><a href=#headline-11>2.9 Generators</a></li><li><a href=#headline-12>2.10 Lambda Functions</a></li><li><a href=#headline-13>2.11 Conditional Expressions</a></li><li><a href=#headline-14>2.12 Default Argument Values</a></li><li><a href=#headline-15>2.13 Properties</a></li><li><a href=#headline-16>2.14 True/False Evaluations</a></li><li><a href=#headline-17>2.15 Deprecated Language Features</a></li><li><a href=#headline-18>2.16 Lexical Scoping</a></li><li><a href=#headline-19>2.17 Function and Method Decorators</a></li><li><a href=#headline-20>2.18 Threading</a></li><li><a href=#headline-21>2.19 Power Features</a></li><li><a href=#headline-22>2.20 Modern Python: Python 3 and from <span style=text-decoration:underline><span style=text-decoration:underline>future</span></span> imports</a></li><li><a href=#headline-23>2.21 Type Annotated Code</a></li></ul></li><li><a href=#headline-24>3 Python Style Rules</a><ul><li><a href=#headline-25>3.1 Semicolons</a></li><li><a href=#headline-26>3.2 Line length</a></li><li><a href=#headline-27>3.3 Parentheses</a></li><li><a href=#headline-28>3.4 Indentation</a><ul><li><a href=#headline-29>3.4.1 Trailing commas in sequences of items?</a></li></ul></li><li><a href=#headline-30>3.5 Blank Lines</a></li><li><a href=#headline-31>3.6 Whitespace</a></li><li><a href=#headline-32>3.7 Shebang Line</a></li><li><a href=#headline-33>3.8 Comments and Docstrings</a><ul><li><a href=#headline-34>3.8.1 Docstrings</a></li><li><a href=#headline-35>3.8.2 Modules</a></li><li><a href=#headline-36>3.8.3 Functions and Methods</a></li><li><a href=#headline-37>3.8.4 Classes</a></li><li><a href=#headline-38>3.8.5 Block and Inline Comments</a></li><li><a href=#headline-39>3.8.6 Punctuation, Spelling, and Grammar</a></li></ul></li><li><a href=#headline-40>3.9 Classes</a></li><li><a href=#headline-41>3.10 Strings</a></li><li><a href=#headline-42>3.11 Files and Sockets</a></li><li><a href=#headline-43>3.12 TODO Comments</a></li><li><a href=#headline-44>3.13 Imports formatting</a></li><li><a href=#headline-45>3.14 Statements</a></li><li><a href=#headline-46>3.15 Accessors</a></li><li><a href=#headline-47>3.16 Naming</a><ul><li><a href=#headline-48>3.16.1 Names to Avoid</a></li><li><a href=#headline-49>3.16.2 Naming Conventions</a></li><li><a href=#headline-50>3.16.3 File Naming</a></li><li><a href=#headline-51>3.16.4 Guidelines derived from Guido’s Recommendations</a></li><li><a href=#headline-52>3.17 Main</a></li><li><a href=#headline-53>3.18 Function length</a></li></ul></li><li><a href=#headline-54>3.19 Type Annotations</a><ul><li><a href=#headline-55>3.19.1 General Rules</a></li><li><a href=#headline-56>3.19.2 Line Breaking</a></li><li><a href=#headline-57>3.19.3 Forward Declarations</a></li><li><a href=#headline-58>3.19.4 Default Values</a></li><li><a href=#headline-59>3.19.5 NoneType</a></li><li><a href=#headline-60>3.19.6 Type Aliases</a></li><li><a href=#headline-61>3.19.7 Ignoring Types</a></li><li><a href=#headline-62>3.19.8 Typing Variables</a></li><li><a href=#headline-63>3.19.9 Tuples vs Lists</a></li><li><a href=#headline-64>3.19.10 TypeVars</a></li><li><a href=#headline-65>3.19.11 String types</a></li><li><a href=#headline-66>3.19.12 Imports For Typing</a></li><li><a href=#headline-67>3.19.13 Conditional Imports</a></li><li><a href=#headline-68>3.19.14 Circular Dependencies</a></li><li><a href=#headline-69>3.19.15 Generics</a></li></ul></li></ul></li><li><a href=#headline-70>4 Parting Words</a></li></ul></nav></div><main><p>来自<a href=https://google.github.io/styleguide/pyguide.html>这里</a>。翻译的目的是为了方便快速理解，所以没有太纠结很准确，最好是和英文对应看。</p><h3 id=headline-1>1 Background</h3><p>Google 的 python 代码风格指导。</p><p>有一个 vim 的配置。 Emacs 默认的似乎就可以。</p><p>还有团队使用 yapf 自动格式化代码来避免对格式产生争论。</p><h3 id=headline-2>2 Python Language Rules</h3><h4 id=headline-3>2.1 Lint</h4><p>使用 pylint 检查代码。</p><p>可以通过行内注释关闭一些 warning</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#007020>dict</span> <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;something awful&#39;</span>  <span style=color:#888># Bad Idea... pylint: disable=redefined-builtin</span></code></pre></td></tr></table></div></div></div><h4 id=headline-4>2.2 Imports</h4><ul><li><p><code>import x</code> 引入包或者模块</p></li><li><p><code>from x import y</code> x 是包前缀，y 是模块名称</p></li><li><p><code>from x import y as z</code> 如果有两个模块都叫 y 或者 y 的名字太长了</p></li><li><p><code>import y as z</code> 只有在 z 是个比较常见的缩写（例如 np 作为 numpy 的缩写）</p></li></ul><p>例如 <code>sound.effects.echo</code></p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>sound.effects</span> <span style=color:#080;font-weight:700>import</span> echo
<span style=color:#333>...</span>
echo<span style=color:#333>.</span>EchoFilter(<span style=color:#007020>input</span>, output, delay<span style=color:#333>=</span><span style=color:#60e;font-weight:700>0.7</span>, atten<span style=color:#333>=</span><span style=color:#00d;font-weight:700>4</span>)</code></pre></td></tr></table></div></div></div><h4 id=headline-5>2.3 Packages</h4><p>总是使用全路径导入包。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># Reference absl.flags in code with the complete name (verbose).</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>absl.flags</span>
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>doctor.who</span> <span style=color:#080;font-weight:700>import</span> jodie

FLAGS <span style=color:#333>=</span> absl<span style=color:#333>.</span>flags<span style=color:#333>.</span>FLAGS</code></pre></td></tr></table></div></div></div><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># Reference flags in code with just the module name (common).</span>
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>absl</span> <span style=color:#080;font-weight:700>import</span> flags
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>doctor.who</span> <span style=color:#080;font-weight:700>import</span> jodie

FLAGS <span style=color:#333>=</span> flags<span style=color:#333>.</span>FLAGS</code></pre></td></tr></table></div></div></div><p>不要像下面这样，假设在 <code>doctor/who/</code> 下面有个 jodie.py。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># Unclear what module the author wanted and what will be imported.  The actual</span>
<span style=color:#888># import behavior depends on external factors controlling sys.path.</span>
<span style=color:#888># Which possible jodie module did the author intend to import?</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>jodie</span></code></pre></td></tr></table></div></div></div><p>这个依赖于 sys.path 的情况，无法知道是想要第三方的 jodie 还是本目录的。</p><h4 id=headline-6>2.4 Exceptions</h4><ul><li><p>使用 <code>raise MyError('Error message')</code> 或者 <code>raise MyError()</code> ，不要用 <code>raise MyError, 'Error message'</code></p></li><li><p>如果可以的话，使用自带的 exception。例如对于不符合要求的数据报 <code>ValueError</code> 。不要使用 <code>assert</code> 来验证公开 api 传入的参数。 <code>assert</code> 只是用来保证内部数据的正确性的。</p></li></ul><p>使用下面这样的：</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>connect_to_next_port</span>(self, minimum):
    <span style=background-color:#fff0f0>&#34;&#34;&#34;Connects to the next available port.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Args:
</span><span style=background-color:#fff0f0>      minimum: A port value greater or equal to 1024.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Returns:
</span><span style=background-color:#fff0f0>      The new minimum port.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Raises:
</span><span style=background-color:#fff0f0>      ConnectionError: If no available port is found.
</span><span style=background-color:#fff0f0>    &#34;&#34;&#34;</span>
    <span style=color:#080;font-weight:700>if</span> minimum <span style=color:#333>&lt;</span> <span style=color:#00d;font-weight:700>1024</span>:
      <span style=color:#888># Note that this raising of ValueError is not mentioned in the doc</span>
      <span style=color:#888># string&#39;s &#34;Raises:&#34; section because it is not appropriate to</span>
      <span style=color:#888># guarantee this specific behavioral reaction to API misuse.</span>
      <span style=color:#080;font-weight:700>raise</span> <span style=color:red;font-weight:700>ValueError</span>(<span style=background-color:#fff0f0>&#39;Minimum port must be at least 1024, not </span><span style=background-color:#eee>%d</span><span style=background-color:#fff0f0>.&#39;</span> <span style=color:#333>%</span> (minimum,))
    port <span style=color:#333>=</span> self<span style=color:#333>.</span>_find_next_open_port(minimum)
    <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> port:
      <span style=color:#080;font-weight:700>raise</span> ConnectionError(<span style=background-color:#fff0f0>&#39;Could not connect to service on </span><span style=background-color:#eee>%d</span><span style=background-color:#fff0f0> or higher.&#39;</span> <span style=color:#333>%</span> (minimum,))
    <span style=color:#080;font-weight:700>assert</span> port <span style=color:#333>&gt;=</span> minimum, <span style=background-color:#fff0f0>&#39;Unexpected port </span><span style=background-color:#eee>%d</span><span style=background-color:#fff0f0> when minimum was </span><span style=background-color:#eee>%d</span><span style=background-color:#fff0f0>.&#39;</span> <span style=color:#333>%</span> (port, minimum)
    <span style=color:#080;font-weight:700>return</span> port</code></pre></td></tr></table></div></div></div><p>不要用下面这样的：</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>connect_to_next_port</span>(self, minimum):
    <span style=background-color:#fff0f0>&#34;&#34;&#34;Connects to the next available port.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Args:
</span><span style=background-color:#fff0f0>      minimum: A port value greater or equal to 1024.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Returns:
</span><span style=background-color:#fff0f0>      The new minimum port.
</span><span style=background-color:#fff0f0>    &#34;&#34;&#34;</span>
    <span style=color:#080;font-weight:700>assert</span> minimum <span style=color:#333>&gt;=</span> <span style=color:#00d;font-weight:700>1024</span>, <span style=background-color:#fff0f0>&#39;Minimum port must be at least 1024.&#39;</span>
    port <span style=color:#333>=</span> self<span style=color:#333>.</span>_find_next_open_port(minimum)
    <span style=color:#080;font-weight:700>assert</span> port <span style=color:#000;font-weight:700>is</span> <span style=color:#000;font-weight:700>not</span> None
    <span style=color:#080;font-weight:700>return</span> port</code></pre></td></tr></table></div></div></div><ul><li><p>可以定义自己的 Excpetion，但是应该继承已有的 exeption 类。名称应该以 Error 结尾，不要用类似 foo.FooError 这样的形式。</p></li><li><p>不要使用 <code>except:</code> 捕获所有异常，或者捕获 Exception StandardError，除非：</p><ul><li><p>打算再次抛出异常</p></li><li><p>创建一个隔离，记录和抑制异常，让异常不在往上传播，例如保护一个线程不会 crash。</p></li></ul><p>python 的 <code>except:</code> 会捕获包括错误的拼写，sys.exit() 调用，Ctrl+C 中断，测试用例失败，和其他的一些异常，一般不会需要都捕获。</p></li><li><p>减少 <code>try/except</code> 块的代码。代码太多可能会捕获你没想到的一些异常，而隐藏真正的错误。</p></li><li><p>使用 <code>finally</code> 执行一些不管有没有异常都需要执行的动作，一般可以用来做一些清理，关闭文件什么的。</p></li><li><p>捕获异常的时候使用 as 代替逗号。</p></li></ul><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>try</span>:
  <span style=color:#080;font-weight:700>raise</span> Error()
<span style=color:#080;font-weight:700>except</span> Error <span style=color:#080;font-weight:700>as</span> error:
  <span style=color:#080;font-weight:700>pass</span></code></pre></td></tr></table></div></div></div><h4 id=headline-7>2.5 Global variables</h4><p>避免使用全局变量。</p><p>全局的常量使用全大写。可以在变量前面加 _ 表示是内部的，外部应该使用公共方法来读取这些变量。</p><h4 id=headline-8>2.6 Nested/Local/Inner Classes and Functions</h4><p>本地局部的函数或者类定义可以方便使用，但是这些类的实例不能被 pickled 序列化。也不能被直接测试，而且还会导致你的程序变长。不要用这个方式来隐藏一些方法，应该使用加 _ 的方法。</p><h4 id=headline-9>2.7 Comprehensions & Generator Expressions</h4><p>简单的情况可以用。map 表达式，for 语句，filter 表达式。多个 for 或者 filter 不允许。使用循环吧。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
  result <span style=color:#333>=</span> [mapping_expr <span style=color:#080;font-weight:700>for</span> value <span style=color:#000;font-weight:700>in</span> iterable <span style=color:#080;font-weight:700>if</span> filter_expr]

  result <span style=color:#333>=</span> [{<span style=background-color:#fff0f0>&#39;key&#39;</span>: value} <span style=color:#080;font-weight:700>for</span> value <span style=color:#000;font-weight:700>in</span> iterable
            <span style=color:#080;font-weight:700>if</span> a_long_filter_expression(value)]

  result <span style=color:#333>=</span> [complicated_transform(x)
            <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> iterable <span style=color:#080;font-weight:700>if</span> predicate(x)]

  descriptive_name <span style=color:#333>=</span> [
      transform({<span style=background-color:#fff0f0>&#39;key&#39;</span>: key, <span style=background-color:#fff0f0>&#39;value&#39;</span>: value}, color<span style=color:#333>=</span><span style=background-color:#fff0f0>&#39;black&#39;</span>)
      <span style=color:#080;font-weight:700>for</span> key, value <span style=color:#000;font-weight:700>in</span> generate_iterable(some_input)
      <span style=color:#080;font-weight:700>if</span> complicated_condition_is_met(key, value)
  ]

  result <span style=color:#333>=</span> []
  <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>10</span>):
      <span style=color:#080;font-weight:700>for</span> y <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>5</span>):
          <span style=color:#080;font-weight:700>if</span> x <span style=color:#333>*</span> y <span style=color:#333>&gt;</span> <span style=color:#00d;font-weight:700>10</span>:
              result<span style=color:#333>.</span>append((x, y))

  <span style=color:#080;font-weight:700>return</span> {x: complicated_transform(x)
          <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> long_generator_function(parameter)
          <span style=color:#080;font-weight:700>if</span> x <span style=color:#000;font-weight:700>is</span> <span style=color:#000;font-weight:700>not</span> None}

  squares_generator <span style=color:#333>=</span> (x<span style=color:#333>**</span><span style=color:#00d;font-weight:700>2</span> <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>10</span>))

  unique_names <span style=color:#333>=</span> {user<span style=color:#333>.</span>name <span style=color:#080;font-weight:700>for</span> user <span style=color:#000;font-weight:700>in</span> users <span style=color:#080;font-weight:700>if</span> user <span style=color:#000;font-weight:700>is</span> <span style=color:#000;font-weight:700>not</span> None}

  eat(jelly_bean <span style=color:#080;font-weight:700>for</span> jelly_bean <span style=color:#000;font-weight:700>in</span> jelly_beans
      <span style=color:#080;font-weight:700>if</span> jelly_bean<span style=color:#333>.</span>color <span style=color:#333>==</span> <span style=background-color:#fff0f0>&#39;black&#39;</span>)</code></pre></td></tr></table></div></div></div><p>不要类似下面这样的，太难理解了。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>No:
  result <span style=color:#333>=</span> [complicated_transform(
                x, some_argument<span style=color:#333>=</span>x<span style=color:#333>+</span><span style=color:#00d;font-weight:700>1</span>)
            <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> iterable <span style=color:#080;font-weight:700>if</span> predicate(x)]

  result <span style=color:#333>=</span> [(x, y) <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>10</span>) <span style=color:#080;font-weight:700>for</span> y <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>5</span>) <span style=color:#080;font-weight:700>if</span> x <span style=color:#333>*</span> y <span style=color:#333>&gt;</span> <span style=color:#00d;font-weight:700>10</span>]

  <span style=color:#080;font-weight:700>return</span> ((x, y, z)
          <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>5</span>)
          <span style=color:#080;font-weight:700>for</span> y <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>5</span>)
          <span style=color:#080;font-weight:700>if</span> x <span style=color:#333>!=</span> y
          <span style=color:#080;font-weight:700>for</span> z <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>range</span>(<span style=color:#00d;font-weight:700>5</span>)
          <span style=color:#080;font-weight:700>if</span> y <span style=color:#333>!=</span> z)</code></pre></td></tr></table></div></div></div><h4 id=headline-10>2.8 Default Iterators and Operators</h4><p>对于 list，dict，文件，使用自带的迭代器和操作符，这些都针对 in 和 not in 定义了自带的迭代器。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:  <span style=color:#080;font-weight:700>for</span> key <span style=color:#000;font-weight:700>in</span> adict: <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>if</span> key <span style=color:#000;font-weight:700>not</span> <span style=color:#000;font-weight:700>in</span> adict: <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>if</span> obj <span style=color:#000;font-weight:700>in</span> alist: <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>for</span> line <span style=color:#000;font-weight:700>in</span> afile: <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>for</span> k, v <span style=color:#000;font-weight:700>in</span> adict<span style=color:#333>.</span>items(): <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>for</span> k, v <span style=color:#000;font-weight:700>in</span> six<span style=color:#333>.</span>iteritems(adict): <span style=color:#333>...</span>

No:   <span style=color:#080;font-weight:700>for</span> key <span style=color:#000;font-weight:700>in</span> adict<span style=color:#333>.</span>keys(): <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> adict<span style=color:#333>.</span>has_key(key): <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>for</span> line <span style=color:#000;font-weight:700>in</span> afile<span style=color:#333>.</span>readlines(): <span style=color:#333>...</span>
      <span style=color:#080;font-weight:700>for</span> k, v <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>dict</span><span style=color:#333>.</span>iteritems(): <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h4 id=headline-11>2.9 Generators</h4><p>对于迭代器函数，在文档字符串里面使用 "Yields:" 代替 "Returns:"。</p><h4 id=headline-12>2.10 Lambda Functions</h4><p>单行的时候可以用。如果代码长度超过 60-80 字符，可能使用嵌套函数更好。</p><p>使用 operator 模块代替 lambda，例如 operator.mul 代替 lambda x, y: x * y。</p><h4 id=headline-13>2.11 Conditional Expressions</h4><p>简单的情况可以用。比较复杂的时候，使用完整的 if 语句。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>one_line <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;yes&#39;</span> <span style=color:#080;font-weight:700>if</span> predicate(value) <span style=color:#080;font-weight:700>else</span> <span style=background-color:#fff0f0>&#39;no&#39;</span>
slightly_split <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#39;yes&#39;</span> <span style=color:#080;font-weight:700>if</span> predicate(value)
                  <span style=color:#080;font-weight:700>else</span> <span style=background-color:#fff0f0>&#39;no, nein, nyet&#39;</span>)
the_longest_ternary_style_that_can_be_done <span style=color:#333>=</span> (
    <span style=background-color:#fff0f0>&#39;yes, true, affirmative, confirmed, correct&#39;</span>
    <span style=color:#080;font-weight:700>if</span> predicate(value)
    <span style=color:#080;font-weight:700>else</span> <span style=background-color:#fff0f0>&#39;no, false, negative, nay&#39;</span>)</code></pre></td></tr></table></div></div></div><p>下面错误的用法</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>bad_line_breaking <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#39;yes&#39;</span> <span style=color:#080;font-weight:700>if</span> predicate(value) <span style=color:#080;font-weight:700>else</span>
                     <span style=background-color:#fff0f0>&#39;no&#39;</span>)
portion_too_long <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#39;yes&#39;</span>
                    <span style=color:#080;font-weight:700>if</span> some_long_module<span style=color:#333>.</span>some_long_predicate_function(
                        really_long_variable_name)
                    <span style=color:#080;font-weight:700>else</span> <span style=background-color:#fff0f0>&#39;no, false, negative, nay&#39;</span>)</code></pre></td></tr></table></div></div></div><h4 id=headline-14>2.12 Default Argument Values</h4><p>不要使用可变对象（mutable object）作为函数参数的默认值。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b<span style=color:#333>=</span>None):
         <span style=color:#080;font-weight:700>if</span> b <span style=color:#000;font-weight:700>is</span> None:
             b <span style=color:#333>=</span> []
Yes: <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b: Optional[Sequence] <span style=color:#333>=</span> None):
         <span style=color:#080;font-weight:700>if</span> b <span style=color:#000;font-weight:700>is</span> None:
             b <span style=color:#333>=</span> []
Yes: <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b: Sequence <span style=color:#333>=</span> ()):  <span style=color:#888># Empty tuple OK since tuples are immutable</span>
         <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>可变对象做初始值实际是在方法被 load 的时候就定了，不是调用的时候。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b<span style=color:#333>=</span>[]):
         <span style=color:#333>...</span>
No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b<span style=color:#333>=</span>time<span style=color:#333>.</span>time()):  <span style=color:#888># The time the module was loaded???</span>
         <span style=color:#333>...</span>
No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b<span style=color:#333>=</span>FLAGS<span style=color:#333>.</span>my_thing):  <span style=color:#888># sys.argv has not yet been parsed...</span>
         <span style=color:#333>...</span>
No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>foo</span>(a, b: Mapping <span style=color:#333>=</span> {}):  <span style=color:#888># Could still get passed to unchecked code</span>
         <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h4 id=headline-15>2.13 Properties</h4><p>使用 <code>@property</code> 装饰器创建属性字段。</p><h4 id=headline-16>2.14 True/False Evaluations</h4><p>尽量使用隐含的 false 。例如使用 <code>if foo:</code> 而不用 <code>if foo != []:</code> 。</p><ul><li><p>总是使用 <code>if foo is None:</code> 或者 <code>is not None</code> 来检查是否为 None。</p></li><li><p>不要用 <code>==</code> 比较布尔值。使用 <code>if not x</code> ，如果你需要区分 False 和 None，那使用 <code>if not x and x is not None:</code></p></li><li><p>对于序列类型（字符串，列表，元组），使用 <code>if seq:</code> 和 <code>if not seq:</code> 比 <code>if len(seq):</code> 和 <code>if not len(seq)</code> 好。</p></li><li><p>处理整型的时候，隐含的 false 带来的问题比益处多（例如把 None 当作 0）。你应该使用 0 和一个 integer 比较。</p></li></ul><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> users:
         <span style=color:#080;font-weight:700>print</span>(<span style=background-color:#fff0f0>&#39;no users&#39;</span>)

     <span style=color:#080;font-weight:700>if</span> foo <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span>:
         self<span style=color:#333>.</span>handle_zero()

     <span style=color:#080;font-weight:700>if</span> i <span style=color:#333>%</span> <span style=color:#00d;font-weight:700>10</span> <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span>:
         self<span style=color:#333>.</span>handle_multiple_of_ten()

     <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>f</span>(x<span style=color:#333>=</span>None):
         <span style=color:#080;font-weight:700>if</span> x <span style=color:#000;font-weight:700>is</span> None:
             x <span style=color:#333>=</span> []

No:  <span style=color:#080;font-weight:700>if</span> <span style=color:#007020>len</span>(users) <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span>:
         <span style=color:#080;font-weight:700>print</span>(<span style=background-color:#fff0f0>&#39;no users&#39;</span>)

     <span style=color:#080;font-weight:700>if</span> foo <span style=color:#000;font-weight:700>is</span> <span style=color:#000;font-weight:700>not</span> None <span style=color:#000;font-weight:700>and</span> <span style=color:#000;font-weight:700>not</span> foo:
         self<span style=color:#333>.</span>handle_zero()

     <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> i <span style=color:#333>%</span> <span style=color:#00d;font-weight:700>10</span>:
         self<span style=color:#333>.</span>handle_multiple_of_ten()

     <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>f</span>(x<span style=color:#333>=</span>None):
         x <span style=color:#333>=</span> x <span style=color:#000;font-weight:700>or</span> []</code></pre></td></tr></table></div></div></div><ul><li><p>注意 '0' （字符串 0）是 true。</p></li></ul><h4 id=headline-17>2.15 Deprecated Language Features</h4><p>使用字符串自带的方法，而不用 string 模块。使用函数调用而不是 apply。使用列表生成式和 for 循环代替使用匿名函数的 filte 和 map。使用 for 循环代替 reduce。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: words <span style=color:#333>=</span> foo<span style=color:#333>.</span>split(<span style=background-color:#fff0f0>&#39;:&#39;</span>)

     [x[<span style=color:#00d;font-weight:700>1</span>] <span style=color:#080;font-weight:700>for</span> x <span style=color:#000;font-weight:700>in</span> my_list <span style=color:#080;font-weight:700>if</span> x[<span style=color:#00d;font-weight:700>2</span>] <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>5</span>]

     <span style=color:#007020>map</span>(math<span style=color:#333>.</span>sqrt, data)    <span style=color:#888># Ok. No inlined lambda expression.</span>

     fn(<span style=color:#333>*</span>args, <span style=color:#333>**</span>kwargs)

No:  words <span style=color:#333>=</span> string<span style=color:#333>.</span>split(foo, <span style=background-color:#fff0f0>&#39;:&#39;</span>)

     <span style=color:#007020>map</span>(<span style=color:#080;font-weight:700>lambda</span> x: x[<span style=color:#00d;font-weight:700>1</span>], <span style=color:#007020>filter</span>(<span style=color:#080;font-weight:700>lambda</span> x: x[<span style=color:#00d;font-weight:700>2</span>] <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>5</span>, my_list))

     <span style=color:#007020>apply</span>(fn, args, kwargs)</code></pre></td></tr></table></div></div></div><h4 id=headline-18>2.16 Lexical Scoping</h4><ul><li><p>lexical scoping: 词法作用域，静态作用域</p></li><li><p>dynamic scoping: 动态作用域</p></li></ul><p>python 会创建局部变量，理解清楚的话，一般不会有啥问题。可以用。</p><h4 id=headline-19>2.17 Function and Method Decorators</h4><p>只在有明确好处的时候使用装饰器。避免使用 @staticmethod ，少用 @classmethod。</p><p>装饰器对函数参数和返回结果有绝对权限，所以可以改变一些隐含的行为。另外，装饰器是在 import 的时候执行的，如果有代码错误可能程序就崩了。</p><p>装饰器的文档应该明确说明这个是装饰器，应该给装饰器写测试用例。</p><p>在装饰器里面避免外部依赖（例如文件，sockets，数据库连接什么的），因为那些在装饰器运行的时候可能不存在（在import 阶段，例如在 pydoc 或者其他工具里面）。装饰器应该要保证在各种情况下都可以成功。</p><p>不要使用 @staticmethod ，除非为了和已有库的 api 定义集成。应该使用模块级别的函数代替。</p><p>只在定义命名构造方法或者类级别的方法都时候使用 @classmethod，例如修改全局状态或者缓存。</p><h4 id=headline-20>2.18 Threading</h4><p>不要依赖内部自带类型的原子性。</p><p>python 的一些自带类型例如 dict 似乎支持原子操作，但是有些情况下又不原子。也不要依赖变量赋值的原子性。</p><p>使用 Queue 模块的 Queue 类型来作为线程间数据通讯的方法。或者使用 threading 模块和他提供的 locking 方法。学习下如何使用 condition variables ，使用 threading.Condition 代替使用 lower-level locks.</p><h4 id=headline-21>2.19 Power Features</h4><p>尽量避免使用。</p><p>例如自定义 metaclass，接触 bytecode，on-the-fly 编译，动态继承，等等吧。。。</p><p>标准库里面的模块使用到了没关系，例如 abc.ABCMeta, collections.namedtuple, dataclasses, and enum</p><h4 id=headline-22>2.20 Modern Python: Python 3 and from <span style=text-decoration:underline><span style=text-decoration:underline>future</span></span> imports</h4><p>应该写兼容 python3 的代码。</p><h4 id=headline-23>2.21 Type Annotated Code</h4><p>python3 支持 type hint，可以使用 pytype 检查。</p><p>强烈建议更新代码的时候使用 type 支持。</p><h3 id=headline-24>3 Python Style Rules</h3><h4 id=headline-25>3.1 Semicolons</h4><p>不要用分号结尾。不要用分号把两行放一行。</p><h4 id=headline-26>3.2 Line length</h4><p>一行 80 个字符。除非：</p><ul><li><p>长的 import 语句</p></li><li><p>URL，路径，或者注释里面的长标记</p></li><li><p>长的模块级别的常量，不好切的</p></li><li><p>pylint 的 disable 注释</p></li></ul><p>不要使用 \ 切分多行，除非是 with 语句里面有多个 context 管理器。</p><p>有必要的话可以增加多余的括号。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: foo_bar(self, width, height, color<span style=color:#333>=</span><span style=background-color:#fff0f0>&#39;black&#39;</span>, design<span style=color:#333>=</span>None, x<span style=color:#333>=</span><span style=background-color:#fff0f0>&#39;foo&#39;</span>,
             emphasis<span style=color:#333>=</span>None, highlight<span style=color:#333>=</span><span style=color:#00d;font-weight:700>0</span>)

     <span style=color:#080;font-weight:700>if</span> (width <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span> <span style=color:#000;font-weight:700>and</span> height <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span> <span style=color:#000;font-weight:700>and</span>
         color <span style=color:#333>==</span> <span style=background-color:#fff0f0>&#39;red&#39;</span> <span style=color:#000;font-weight:700>and</span> emphasis <span style=color:#333>==</span> <span style=background-color:#fff0f0>&#39;strong&#39;</span>):</code></pre></td></tr></table></div></div></div><p>单行字符串太长的话，使用括号切分成多行。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#39;This will build a very long long &#39;</span>
     <span style=background-color:#fff0f0>&#39;long long long long long long string&#39;</span>)</code></pre></td></tr></table></div></div></div><p>注释里面的 url 尽量单独放一行</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:  <span style=color:#888># See details at</span>
      <span style=color:#888># http://www.example.com/us/developer/documentation/api/content/v2.0/csv_file_name_extension_full_specification.html</span>

No:  <span style=color:#888># See details at</span>
     <span style=color:#888># http://www.example.com/us/developer/documentation/api/content/\</span>
     <span style=color:#888># v2.0/csv_file_name_extension_full_specification.html</span></code></pre></td></tr></table></div></div></div><p>with 语句里面可以使用 \ 拆分多行，也可以使用嵌套的 with。注意缩进。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:  <span style=color:#080;font-weight:700>with</span> very_long_first_expression_function() <span style=color:#080;font-weight:700>as</span> spam, \
           very_long_second_expression_function() <span style=color:#080;font-weight:700>as</span> beans, \
           third_thing() <span style=color:#080;font-weight:700>as</span> eggs:
          place_order(eggs, beans, spam, beans)

No:  <span style=color:#080;font-weight:700>with</span> VeryLongFirstExpressionFunction() <span style=color:#080;font-weight:700>as</span> spam, \
          VeryLongSecondExpressionFunction() <span style=color:#080;font-weight:700>as</span> beans:
       PlaceOrder(eggs, beans, spam, beans)

Yes:  <span style=color:#080;font-weight:700>with</span> very_long_first_expression_function() <span style=color:#080;font-weight:700>as</span> spam:
          <span style=color:#080;font-weight:700>with</span> very_long_second_expression_function() <span style=color:#080;font-weight:700>as</span> beans:
              place_order(beans, spam)</code></pre></td></tr></table></div></div></div><p>如果还有其他超过 80 字符的情况，并且 yapf 工具也不能处理的话，可以容忍。</p><h4 id=headline-27>3.3 Parentheses</h4><p>尽量少用括号。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>if</span> foo:
         bar()
     <span style=color:#080;font-weight:700>while</span> x:
         x <span style=color:#333>=</span> bar()
     <span style=color:#080;font-weight:700>if</span> x <span style=color:#000;font-weight:700>and</span> y:
         bar()
     <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span> x:
         bar()
     <span style=color:#888># 只有一个元素的元组使用 () 比只有一个逗号清晰</span>
     onesie <span style=color:#333>=</span> (foo,)
     <span style=color:#080;font-weight:700>return</span> foo
     <span style=color:#080;font-weight:700>return</span> spam, beans
     <span style=color:#080;font-weight:700>return</span> (spam, beans)
     <span style=color:#080;font-weight:700>for</span> (x, y) <span style=color:#000;font-weight:700>in</span> <span style=color:#007020>dict</span><span style=color:#333>.</span>items(): <span style=color:#333>...</span>

No:  <span style=color:#080;font-weight:700>if</span> (x):
         bar()
     <span style=color:#080;font-weight:700>if</span> <span style=color:#000;font-weight:700>not</span>(x):
         bar()
     <span style=color:#080;font-weight:700>return</span> (foo)</code></pre></td></tr></table></div></div></div><h4 id=headline-28>3.4 Indentation</h4><p>使用 4 个空格缩进。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:   <span style=color:#888># 和开始的括号对齐</span>
       foo <span style=color:#333>=</span> long_function_name(var_one, var_two,
                                var_three, var_four)
       meal <span style=color:#333>=</span> (spam,
               beans)

       <span style=color:#888># 和字典的开始括号对齐</span>
       foo <span style=color:#333>=</span> {
           long_dictionary_key: value1 <span style=color:#333>+</span>
                                value2,
           <span style=color:#333>...</span>
       }

       <span style=color:#888># 4个空格的悬挂缩进；第一行什么都不放</span>
       foo <span style=color:#333>=</span> long_function_name(
           var_one, var_two, var_three,
           var_four)
       meal <span style=color:#333>=</span> (
           spam,
           beans)

       <span style=color:#888># 字典里面的 4 空格悬挂缩进</span>
       foo <span style=color:#333>=</span> {
           long_dictionary_key:
               long_dictionary_value,
           <span style=color:#333>...</span>
       }

No:    <span style=color:#888># 看不清第一行的内容了</span>
       foo <span style=color:#333>=</span> long_function_name(var_one, var_two,
           var_three, var_four)
       meal <span style=color:#333>=</span> (spam,
           beans)

       <span style=color:#888># 2 空格缩进</span>
       foo <span style=color:#333>=</span> long_function_name(
         var_one, var_two, var_three,
         var_four)

       <span style=color:#888># 字典里面没有悬挂缩进</span>
       foo <span style=color:#333>=</span> {
           long_dictionary_key:
           long_dictionary_value,
           <span style=color:#333>...</span>
       }</code></pre></td></tr></table></div></div></div><h5 id=headline-29>3.4.1 Trailing commas in sequences of items?</h5><p>结尾的逗号只有在 ],},) 和最后的元素不在同一行的时候使用。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:   golomb3 <span style=color:#333>=</span> [<span style=color:#00d;font-weight:700>0</span>, <span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>3</span>]
Yes:   golomb4 <span style=color:#333>=</span> [
           <span style=color:#00d;font-weight:700>0</span>,
           <span style=color:#00d;font-weight:700>1</span>,
           <span style=color:#00d;font-weight:700>4</span>,
           <span style=color:#00d;font-weight:700>6</span>,
       ]

No:    golomb4 <span style=color:#333>=</span> [
           <span style=color:#00d;font-weight:700>0</span>,
           <span style=color:#00d;font-weight:700>1</span>,
           <span style=color:#00d;font-weight:700>4</span>,
           <span style=color:#00d;font-weight:700>6</span>
       ]</code></pre></td></tr></table></div></div></div><h4 id=headline-30>3.5 Blank Lines</h4><p>顶级定义间两个空行。方法之间，class 和第一个方法之前使用一个空行。def 行之后不要有空行。适当的在方法和函数里面使用一个空行。</p><h4 id=headline-31>3.6 Whitespace</h4><p>在括号里面，括号和内容间不要有空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: spam(ham[<span style=color:#00d;font-weight:700>1</span>], {eggs: <span style=color:#00d;font-weight:700>2</span>}, [])

No:  spam( ham[ <span style=color:#00d;font-weight:700>1</span> ], { eggs: <span style=color:#00d;font-weight:700>2</span> }, [ ] )</code></pre></td></tr></table></div></div></div><p>逗号，分号，冒号前不要加空格，除了行尾，后面需要加空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>if</span> x <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>4</span>:
         <span style=color:#080;font-weight:700>print</span>(x, y)
     x, y <span style=color:#333>=</span> y, x

No:  <span style=color:#080;font-weight:700>if</span> x <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>4</span> :
         <span style=color:#080;font-weight:700>print</span>(x , y)
     x , y <span style=color:#333>=</span> y , x</code></pre></td></tr></table></div></div></div><p>参数列表，索引，切片的左括号前面不加空格</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: spam(<span style=color:#00d;font-weight:700>1</span>)

No:  spam (<span style=color:#00d;font-weight:700>1</span>)

Yes: <span style=color:#007020>dict</span>[<span style=background-color:#fff0f0>&#39;key&#39;</span>] <span style=color:#333>=</span> <span style=color:#007020>list</span>[index]

No:  <span style=color:#007020>dict</span> [<span style=background-color:#fff0f0>&#39;key&#39;</span>] <span style=color:#333>=</span> <span style=color:#007020>list</span> [index]</code></pre></td></tr></table></div></div></div><p>行尾不加多余的空格。操作符两边加空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: x <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>1</span>

No:  x<span style=color:#333>&lt;</span><span style=color:#00d;font-weight:700>1</span></code></pre></td></tr></table></div></div></div><p>传参数或者函数默认值的 = 左右不加空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>complex</span>(real, imag<span style=color:#333>=</span><span style=color:#60e;font-weight:700>0.0</span>): <span style=color:#080;font-weight:700>return</span> Magic(r<span style=color:#333>=</span>real, i<span style=color:#333>=</span>imag)
Yes: <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>complex</span>(real, imag: <span style=color:#007020>float</span> <span style=color:#333>=</span> <span style=color:#60e;font-weight:700>0.0</span>): <span style=color:#080;font-weight:700>return</span> Magic(r<span style=color:#333>=</span>real, i<span style=color:#333>=</span>imag)

No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>complex</span>(real, imag <span style=color:#333>=</span> <span style=color:#60e;font-weight:700>0.0</span>): <span style=color:#080;font-weight:700>return</span> Magic(r <span style=color:#333>=</span> real, i <span style=color:#333>=</span> imag)
No:  <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>complex</span>(real, imag: <span style=color:#007020>float</span><span style=color:#333>=</span><span style=color:#60e;font-weight:700>0.0</span>): <span style=color:#080;font-weight:700>return</span> Magic(r <span style=color:#333>=</span> real, i <span style=color:#333>=</span> imag)</code></pre></td></tr></table></div></div></div><p>不要使用空格做竖列对齐，这个维护起来容易成负担。有一些工具或者 ide 可以自动做这个事情，但是确实对不使用这些工具的人是个负担。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
  foo <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>1000</span>  <span style=color:#888># comment</span>
  long_name <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>2</span>  <span style=color:#888># comment that should not be aligned</span>

  dictionary <span style=color:#333>=</span> {
      <span style=background-color:#fff0f0>&#39;foo&#39;</span>: <span style=color:#00d;font-weight:700>1</span>,
      <span style=background-color:#fff0f0>&#39;long_name&#39;</span>: <span style=color:#00d;font-weight:700>2</span>,
  }

No:
  foo       <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>1000</span>  <span style=color:#888># comment</span>
  long_name <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>2</span>     <span style=color:#888># comment that should not be aligned</span>

  dictionary <span style=color:#333>=</span> {
      <span style=background-color:#fff0f0>&#39;foo&#39;</span>      : <span style=color:#00d;font-weight:700>1</span>,
      <span style=background-color:#fff0f0>&#39;long_name&#39;</span>: <span style=color:#00d;font-weight:700>2</span>,
  }</code></pre></td></tr></table></div></div></div><h4 id=headline-32>3.7 Shebang Line</h4><p>大部分 .py 文件都不需要 #! 这行。主文件可以使用 <code>#!/usr/bin/python</code> 加 2 或者 3 结尾。</p><p>这个只有直接运行的主程序有用，对于 import 的模块没用。</p><h4 id=headline-33>3.8 Comments and Docstrings</h4><p>确保针对模块，函数，方法使用了正确的文档字符串和行内的注释。</p><h5 id=headline-34>3.8.1 Docstrings</h5><p>总是使用 """ 格式的文档字符串。</p><h5 id=headline-35>3.8.2 Modules</h5><p>每个文件都有 lincense 声明，文件开头说明下模块内容和示例。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=background-color:#fff0f0>&#34;&#34;&#34;用一行简介模块或者程序功能
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>留一个空行。后面说明模块的说明，可以加例子。
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>  Typical usage example:
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>  foo = ClassFoo()
</span><span style=background-color:#fff0f0>  bar = foo.FunctionBar()
</span><span style=background-color:#fff0f0>&#34;&#34;&#34;</span></code></pre></td></tr></table></div></div></div><h5 id=headline-36>3.8.3 Functions and Methods</h5><p>主要需要说明参数，返回值，异常。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>fetch_bigtable_rows</span>(big_table, keys, other_silly_variable<span style=color:#333>=</span>None):
    <span style=background-color:#fff0f0>&#34;&#34;&#34;Fetches rows from a Bigtable.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Retrieves rows pertaining to the given keys from the Table instance
</span><span style=background-color:#fff0f0>    represented by big_table.  Silly things may happen if
</span><span style=background-color:#fff0f0>    other_silly_variable is not None.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Args:
</span><span style=background-color:#fff0f0>        big_table: An open Bigtable Table instance.
</span><span style=background-color:#fff0f0>        keys: A sequence of strings representing the key of each table row
</span><span style=background-color:#fff0f0>            to fetch.
</span><span style=background-color:#fff0f0>        other_silly_variable: Another optional variable, that has a much
</span><span style=background-color:#fff0f0>            longer name than the other args, and which does nothing.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Returns:
</span><span style=background-color:#fff0f0>        A dict mapping keys to the corresponding table row data
</span><span style=background-color:#fff0f0>        fetched. Each row is represented as a tuple of strings. For
</span><span style=background-color:#fff0f0>        example:
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>        {&#39;Serak&#39;: (&#39;Rigel VII&#39;, &#39;Preparer&#39;),
</span><span style=background-color:#fff0f0>         &#39;Zim&#39;: (&#39;Irk&#39;, &#39;Invader&#39;),
</span><span style=background-color:#fff0f0>         &#39;Lrrr&#39;: (&#39;Omicron Persei 8&#39;, &#39;Emperor&#39;)}
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>        If a key from the keys argument is missing from the dictionary,
</span><span style=background-color:#fff0f0>        then that row was not found in the table.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Raises:
</span><span style=background-color:#fff0f0>        IOError: An error occurred accessing the bigtable.Table object.
</span><span style=background-color:#fff0f0>    &#34;&#34;&#34;</span></code></pre></td></tr></table></div></div></div><h5 id=headline-37>3.8.4 Classes</h5><p>如果有公共属性，需要说明下。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>SampleClass</span>(<span style=color:#007020>object</span>):
    <span style=background-color:#fff0f0>&#34;&#34;&#34;Summary of class here.
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Longer class information....
</span><span style=background-color:#fff0f0>    Longer class information....
</span><span style=background-color:#fff0f0>
</span><span style=background-color:#fff0f0>    Attributes:
</span><span style=background-color:#fff0f0>        likes_spam: A boolean indicating if we like SPAM or not.
</span><span style=background-color:#fff0f0>        eggs: An integer count of the eggs we have laid.
</span><span style=background-color:#fff0f0>    &#34;&#34;&#34;</span>

    <span style=color:#080;font-weight:700>def</span> __init__(self, likes_spam<span style=color:#333>=</span>False):
        <span style=background-color:#fff0f0>&#34;&#34;&#34;Inits SampleClass with blah.&#34;&#34;&#34;</span>
        self<span style=color:#333>.</span>likes_spam <span style=color:#333>=</span> likes_spam
        self<span style=color:#333>.</span>eggs <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>

    <span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>public_method</span>(self):
        <span style=background-color:#fff0f0>&#34;&#34;&#34;Performs operation blah.&#34;&#34;&#34;</span></code></pre></td></tr></table></div></div></div><h5 id=headline-38>3.8.5 Block and Inline Comments</h5><p>对于代码里面逻辑复杂或者难理解的地方，如果需要在 code review 的时候解释说明，那最好直接写到代码里面。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># We use a weighted dictionary search to find out where i is in</span>
<span style=color:#888># the array.  We extrapolate position based on the largest num</span>
<span style=color:#888># in the array and the array size and then do binary search to</span>
<span style=color:#888># get the exact number.</span>

<span style=color:#080;font-weight:700>if</span> i <span style=color:#333>&amp;</span> (i<span style=color:#333>-</span><span style=color:#00d;font-weight:700>1</span>) <span style=color:#333>==</span> <span style=color:#00d;font-weight:700>0</span>:  <span style=color:#888># True if i is 0 or a power of 2.</span></code></pre></td></tr></table></div></div></div><p>inline 的注释应该在 # 前留两个空格。另外，注释里面不要去直接解释代码，这个没啥意义。</p><h5 id=headline-39>3.8.6 Punctuation, Spelling, and Grammar</h5><p>应该是说注意语法啥的，代码的质量也包括注释的质量。</p><h4 id=headline-40>3.9 Classes</h4><p>如果一个类没有明显的基类，那就继承 object。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>SampleClass</span>(<span style=color:#007020>object</span>):
         <span style=color:#080;font-weight:700>pass</span>


     <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>OuterClass</span>(<span style=color:#007020>object</span>):

         <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>InnerClass</span>(<span style=color:#007020>object</span>):
             <span style=color:#080;font-weight:700>pass</span>


     <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>ChildClass</span>(ParentClass):
         <span style=background-color:#fff0f0>&#34;&#34;&#34;Explicitly inherits from another class already.&#34;&#34;&#34;</span>

No: <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>SampleClass</span>:
        <span style=color:#080;font-weight:700>pass</span>


    <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>OuterClass</span>:

        <span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>InnerClass</span>:
            <span style=color:#080;font-weight:700>pass</span></code></pre></td></tr></table></div></div></div><p>更好的兼容性。还帮忙定义了一些 __ 开头的方法。</p><h4 id=headline-41>3.10 Strings</h4><p>使用 format 或者 % 格式化字符串。python 3.6 还支持了 f-string。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: x <span style=color:#333>=</span> a <span style=color:#333>+</span> b
     x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;</span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>, </span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>!&#39;</span> <span style=color:#333>%</span> (imperative, expletive)
     x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;{}, {}&#39;</span><span style=color:#333>.</span>format(first, second)
     x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;name: </span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>; score: </span><span style=background-color:#eee>%d</span><span style=background-color:#fff0f0>&#39;</span> <span style=color:#333>%</span> (name, n)
     x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;name: {}; score: {}&#39;</span><span style=color:#333>.</span>format(name, n)
     x <span style=color:#333>=</span> f<span style=background-color:#fff0f0>&#39;name: {name}; score: {n}&#39;</span>  <span style=color:#888># Python 3.6+</span>

No: x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;</span><span style=background-color:#eee>%s%s</span><span style=background-color:#fff0f0>&#39;</span> <span style=color:#333>%</span> (a, b)  <span style=color:#888># use + in this case</span>
    x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;{}{}&#39;</span><span style=color:#333>.</span>format(a, b)  <span style=color:#888># use + in this case</span>
    x <span style=color:#333>=</span> first <span style=color:#333>+</span> <span style=background-color:#fff0f0>&#39;, &#39;</span> <span style=color:#333>+</span> second
    x <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;name: &#39;</span> <span style=color:#333>+</span> name <span style=color:#333>+</span> <span style=background-color:#fff0f0>&#39;; score: &#39;</span> <span style=color:#333>+</span> <span style=color:#007020>str</span>(n)</code></pre></td></tr></table></div></div></div><p>避免在循环里面使用 + 和 += 操作符连接字符串。因为 string 是 immutable ，这样会创建很多临时对象。可以使用个 list 然后 ''.join(list) 这样，或者使用 io.BytesIO。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: items <span style=color:#333>=</span> [<span style=background-color:#fff0f0>&#39;&lt;table&gt;&#39;</span>]
     <span style=color:#080;font-weight:700>for</span> last_name, first_name <span style=color:#000;font-weight:700>in</span> employee_list:
         items<span style=color:#333>.</span>append(<span style=background-color:#fff0f0>&#39;&lt;tr&gt;&lt;td&gt;</span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>, </span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span style=color:#333>%</span> (last_name, first_name))
     items<span style=color:#333>.</span>append(<span style=background-color:#fff0f0>&#39;&lt;/table&gt;&#39;</span>)
     employee_table <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;&#39;</span><span style=color:#333>.</span>join(items)

No: employee_table <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#39;&lt;table&gt;&#39;</span>
    <span style=color:#080;font-weight:700>for</span> last_name, first_name <span style=color:#000;font-weight:700>in</span> employee_list:
        employee_table <span style=color:#333>+=</span> <span style=background-color:#fff0f0>&#39;&lt;tr&gt;&lt;td&gt;</span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>, </span><span style=background-color:#eee>%s</span><span style=background-color:#fff0f0>&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span style=color:#333>%</span> (last_name, first_name)
    employee_table <span style=color:#333>+=</span> <span style=background-color:#fff0f0>&#39;&lt;/table&gt;&#39;</span></code></pre></td></tr></table></div></div></div><p>灵活使用 ' 和 " ，避免使用 \\ 转义。多行字符串使用 """ ，不用 ''' 。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>  No:
  long_string <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;&#34;&#34;This is pretty ugly.
</span><span style=background-color:#fff0f0>Don&#39;t do this.
</span><span style=background-color:#fff0f0>&#34;&#34;&#34;</span>

  Yes:
  long_string <span style=color:#333>=</span> <span style=background-color:#fff0f0>&#34;&#34;&#34;This is fine if your use case can accept
</span><span style=background-color:#fff0f0>      extraneous leading spaces.&#34;&#34;&#34;</span>

  Yes:
  long_string <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#34;And this is fine if you can not accept</span><span style=color:#666;background-color:#fff0f0;font-weight:700>\n</span><span style=background-color:#fff0f0>&#34;</span> <span style=color:#333>+</span>
                 <span style=background-color:#fff0f0>&#34;extraneous leading spaces.&#34;</span>)

  Yes:
  long_string <span style=color:#333>=</span> (<span style=background-color:#fff0f0>&#34;And this too is fine if you can not accept</span><span style=color:#666;background-color:#fff0f0;font-weight:700>\n</span><span style=background-color:#fff0f0>&#34;</span>
                 <span style=background-color:#fff0f0>&#34;extraneous leading spaces.&#34;</span>)

  Yes:
  <span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>textwrap</span>

  long_string <span style=color:#333>=</span> textwrap<span style=color:#333>.</span>dedent(<span style=background-color:#fff0f0>&#34;&#34;&#34;</span><span style=color:#666;background-color:#fff0f0;font-weight:700>\
</span><span style=color:#666;background-color:#fff0f0;font-weight:700></span><span style=background-color:#fff0f0>      This is also fine, because textwrap.dedent()
</span><span style=background-color:#fff0f0>      will collapse common leading spaces in each line.&#34;&#34;&#34;</span>)</code></pre></td></tr></table></div></div></div><h4 id=headline-42>3.11 Files and Sockets</h4><p>使用完 file 和 sockets 之后显式的关闭。要不然</p><ul><li><p>会消耗文件描述符。</p></li><li><p>会导致其他操作例如移动删除什么的失败。</p></li><li><p>及时关闭可以更容易发现一些不恰当的使用，有问题会早暴露。</p></li></ul><p>当文件或者sockets 对象被销毁的时候会自动关闭，但是依赖这个特性是个不好的习惯</p><ul><li><p>python 不同版本的垃圾回收策略会不一样，也没保证啥时候会关闭。</p></li><li><p>一些意料之外的文件引用，比如全局变量，异常堆栈里面的引用什么的，可能会导致存活时间变长。</p></li></ul><p>使用 with 语句来打开文件</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>with</span> <span style=color:#007020>open</span>(<span style=background-color:#fff0f0>&#34;hello.txt&#34;</span>) <span style=color:#080;font-weight:700>as</span> hello_file:
    <span style=color:#080;font-weight:700>for</span> line <span style=color:#000;font-weight:700>in</span> hello_file:
        <span style=color:#080;font-weight:700>print</span>(line)</code></pre></td></tr></table></div></div></div><p>文件类型的对象，但是还不支持 with 语句的，可以使用 contextlib.closing()</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>contextlib</span>

<span style=color:#080;font-weight:700>with</span> contextlib<span style=color:#333>.</span>closing(urllib<span style=color:#333>.</span>urlopen(<span style=background-color:#fff0f0>&#34;http://www.python.org/&#34;</span>)) <span style=color:#080;font-weight:700>as</span> front_page:
    <span style=color:#080;font-weight:700>for</span> line <span style=color:#000;font-weight:700>in</span> front_page:
        <span style=color:#080;font-weight:700>print</span>(line)</code></pre></td></tr></table></div></div></div><h4 id=headline-43>3.12 TODO Comments</h4><p>注释里面使用 TODO 来标记临时的一些处理，或者一些有待改进的处理。</p><p>TODO 使用 TODO 开头，后面括号里面使用邮件或者名字标记是谁加的，然后跟着是 todo 内容。</p><p>这个格式要求是为了将来方便搜索。TODO 并不表示以后也需要这个人去修复这个问题。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># TODO(kl@gmail.com): Use a &#34;*&#34; here for string repetition.</span>
<span style=color:#888># TODO(Zeke) Change this to use relations.</span></code></pre></td></tr></table></div></div></div><p>如果一个 TODO 是为了标记将来做什么，那最好把时间 (“Fix by November 2009”) 或者触发的事件 (“Remove this code when all clients can handle XML responses.”) 也加上。</p><h4 id=headline-44>3.13 Imports formatting</h4><p>一个模块一行</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes: <span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>os</span>
     <span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>sys</span>

No:  <span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>os</span><span style=color:#333>,</span> <span style=color:#0e84b5;font-weight:700>sys</span></code></pre></td></tr></table></div></div></div><p>import 都写在文件顶部，在模块的文档字符串之后，在模块的全局变量和常量之前。按照最通用到最不通用排序。</p><ol><li><p>future import 语句来打开文件</p></li></ol><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>__future__</span> <span style=color:#080;font-weight:700>import</span> absolute_import
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>__future__</span> <span style=color:#080;font-weight:700>import</span> division
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>__future__</span> <span style=color:#080;font-weight:700>import</span> print_function</code></pre></td></tr></table></div></div></div><ol><li><p>python 标准库</p></li></ol><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>sys</span></code></pre></td></tr></table></div></div></div><ol><li><p>第三方库</p></li></ol><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>tensorflow</span> <span style=color:#080;font-weight:700>as</span> <span style=color:#0e84b5;font-weight:700>tf</span></code></pre></td></tr></table></div></div></div><ol><li><p>代码库子模块</p></li></ol><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>otherproject.ai</span> <span style=color:#080;font-weight:700>import</span> mind</code></pre></td></tr></table></div></div></div><ol><li><p>程序自己的子模块(已经废弃)。新的处理方式是和 4 一样处理就行。</p></li></ol><p>使用词典序，忽略大小写，基于模块包的全称。在不同块之前增加一个空行。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>collections</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>queue</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>sys</span>

<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>absl</span> <span style=color:#080;font-weight:700>import</span> app
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>absl</span> <span style=color:#080;font-weight:700>import</span> flags
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>bs4</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>cryptography</span>
<span style=color:#080;font-weight:700>import</span> <span style=color:#0e84b5;font-weight:700>tensorflow</span> <span style=color:#080;font-weight:700>as</span> <span style=color:#0e84b5;font-weight:700>tf</span>

<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>book.genres</span> <span style=color:#080;font-weight:700>import</span> scifi
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>myproject.backend.hgwells</span> <span style=color:#080;font-weight:700>import</span> time_machine
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>myproject.backend.state_machine</span> <span style=color:#080;font-weight:700>import</span> main_loop
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>otherproject.ai</span> <span style=color:#080;font-weight:700>import</span> body
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>otherproject.ai</span> <span style=color:#080;font-weight:700>import</span> mind
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>otherproject.ai</span> <span style=color:#080;font-weight:700>import</span> soul

<span style=color:#888># Older style code may have these imports down here instead:</span>
<span style=color:#888>#from myproject.backend.hgwells import time_machine</span>
<span style=color:#888>#from myproject.backend.state_machine import main_loop</span></code></pre></td></tr></table></div></div></div><h4 id=headline-45>3.14 Statements</h4><p>通常一行一句。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:

  <span style=color:#080;font-weight:700>if</span> foo: bar(foo)

No:

  <span style=color:#080;font-weight:700>if</span> foo: bar(foo)
  <span style=color:#080;font-weight:700>else</span>:   baz(foo)

  <span style=color:#080;font-weight:700>try</span>:               bar(foo)
  <span style=color:#080;font-weight:700>except</span> <span style=color:red;font-weight:700>ValueError</span>: baz(foo)

  <span style=color:#080;font-weight:700>try</span>:
      bar(foo)
  <span style=color:#080;font-weight:700>except</span> <span style=color:red;font-weight:700>ValueError</span>: baz(foo)</code></pre></td></tr></table></div></div></div><h4 id=headline-46>3.15 Accessors</h4><p>如果比较简单，可以使用公共属性，而不用 geter/seter，毕竟没必要多一次函数调用。稍微复杂点的可以使用 @property。</p><p>对于复杂的，可以使用 get_foo() 和 set_foo() 这样的函数调用。如果以前允许通过属性访问，不要把新的函数直接绑定过去。这样依然用原来的方法的那些代码就会报错，可以让他们意识到新的逻辑的复杂程度。</p><h4 id=headline-47>3.16 Naming</h4><p>module_name, package_name, ClassName, method_name, ExceptionName, function_name, GLOBAL_CONSTANT_NAME, global_var_name, instance_var_name, function_parameter_name, local_var_name</p><p>函数名，变量名，文件名应该自说明，避免使用缩写。特别的，不用有歧义的或者项目外的人不熟悉的词，不要通过删除单词里面的字母来产生缩写。</p><p>总是使用 .py 扩展名。</p><h5 id=headline-48>3.16.1 Names to Avoid</h5><ul><li><p>单字母名字，除非是计数器或者迭代器之类。也可以在 tye/except 语句里面使用 e 表示异常。</p></li><li><p>包/模块名里面使用 -</p></li><li><p>__ 开头并且和结尾的名字，这个是 python 自己会用的。</p></li></ul><h5 id=headline-49>3.16.2 Naming Conventions</h5><ul><li><p>"internal" 的意思是模块的内部，或者类内部的被保护或者私有属性</p></li><li><p>使用 _ 保护模块变量或者函数（不会被 from module import * 导入）. 使用 __ 可以让一个实例变量或者方法可以让他们变成类的私有属性，但是不鼓励这么做，这个会带来阅读困难，也不好测试，并且还不是真的私有。</p></li><li><p>可以把其他相关的类放到一个模块的顶部，不用限制一个模块只有一个类，和 java 不一样。</p></li><li><p>类名字使用首字母大写，模块名字使用小写下划线。</p></li><li><p>测试用例里面的方法使用 test 开头。test&lt;MethodUnderTest>_&lt;state> 例如 testPop_EmptyStack，这样也行，毕竟没有什么更好的办法。</p></li></ul><h5 id=headline-50>3.16.3 File Naming</h5><p>必须是 .py 结尾，不能包含 - 。如果你想要一个文件没有扩展名，那可以建一个软连接或者写个 bash 文件包含 exec "$0.py" "$@"。</p><h5 id=headline-51>3.16.4 Guidelines derived from Guido’s Recommendations</h5><table><thead><tr><th>Type</th><th>Public</th><th>Internal</th></tr></thead><tbody><tr><td>Packages</td><td>lower_with_under</td><td></td></tr><tr><td>Modules</td><td>lower_with_under</td><td>_lower_with_under</td></tr><tr><td>Classes</td><td>CapWords</td><td>_CapWords</td></tr><tr><td>Exceptions</td><td>CapWords</td><td></td></tr><tr><td>Functions</td><td>lower_with_under()</td><td>_lower_with_under()</td></tr><tr><td>Global/Class Constants</td><td>CAPS_WITH_UNDER</td><td>_CAPS_WITH_UNDER</td></tr><tr><td>Global/Class Variables</td><td>lower_with_under</td><td>_lower_with_under</td></tr><tr><td>Instance Variables</td><td>lower_with_under</td><td>_lower_with_under (protected)</td></tr><tr><td>Method Names</td><td>lower_with_under()</td><td>_lower_with_under() (protected)</td></tr><tr><td>Function/Method Parameters</td><td>lower_with_under</td><td></td></tr><tr><td>Local Variables</td><td>lower_with_under</td><td></td></tr></tbody></table><p>不鼓励使用 __ 开头的变量。</p><h5 id=headline-52>3.17 Main</h5><p>即使一个文件是个可执行的文件，也应该允许被 import，并且 import 不能有副作用，例如直接运行。主要的功能应该在 main() 函数里面。</p><p>pydoc 和单元测试都需要文件是可以被 import 的。程序应该总是检查 <code>__name__</code> 。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>main</span>():
    <span style=color:#333>...</span>

<span style=color:#080;font-weight:700>if</span> __name__ <span style=color:#333>==</span> <span style=background-color:#fff0f0>&#39;__main__&#39;</span>:
    main()</code></pre></td></tr></table></div></div></div><p>注意要兼容 pydoc ，顶级的函数调用，创建对象以及其他操作都会在 import 的时候就执行。</p><h5 id=headline-53>3.18 Function length</h5><p>最好是短小精悍的。这里没有硬性规定，超过 40 行的，看看在不影响程序结构的情况下是不是可以拆分。</p><p>即使长的函数现在看着没啥问题，但是过几个月之后，需要修改或者增加新功能的时候会比较痛苦。</p><h4 id=headline-54>3.19 Type Annotations</h4><h5 id=headline-55>3.19.1 General Rules</h5><ul><li><p>仔细看看 PEP-484</p></li><li><p>在一个方法里面，只有在有必要定义的时候才给 self 和 cls 定义类型，例如 <code>@classmethod def create(cls: Type[T]) -> T: return cls()</code></p></li><li><p>如果一些变量或者返回类型不应该明确，使用 any</p></li><li><p>并不需要注解模块里面的所有方法</p><ul><li><p>至少注解公开 API</p></li><li><p>在安全和代码清晰和灵活间取得平衡</p></li><li><p>对出过类型引起的 bug 的地放增加类型注解</p></li><li><p>针对比较难理解的代码增加类型注解</p></li><li><p>针对比较稳定的代码增加类型注解。通常给稳定代码增加注解不会损失灵活性。</p></li></ul></li></ul><h5 id=headline-56>3.19.2 Line Breaking</h5><p>参考前面的缩进的定义。</p><p>增加了类型注解之后，很多函数的签名会变成一个参数一行。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(self,
              first_var: <span style=color:#007020>int</span>,
              second_var: Foo,
              third_var: Optional[Bar]) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>Always prefer breaking between variables, and not for example between variable names and type annotations. However, if everything fits on the same line, go for it.</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(self, first_var: <span style=color:#007020>int</span>) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>如果返回函数名参数加返回类型太长，可以另起一行空 4 个空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(
    self, first_var: <span style=color:#007020>int</span>) <span style=color:#333>-&gt;</span> Tuple[MyLongType1, MyLongType1]:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>更长的情况</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(
    self, other_arg: Optional[MyLongType]
) <span style=color:#333>-&gt;</span> Dict[OtherLongType, MyLongType]:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>pylint 允许和括号对齐，但是这样会降低可读性。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>No:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(self,
              other_arg: Optional[MyLongType]
             ) <span style=color:#333>-&gt;</span> Dict[OtherLongType, MyLongType]:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>类似上面的例子，尽量不打断类型注解。但是如果太长，也可以换行，保持子类型不被打断。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(
    self,
    first_var: Tuple[List[MyLongType1],
                     List[MyLongType2]],
    second_var: List[Dict[
        MyLongType3, MyLongType4]]) <span style=color:#333>-&gt;</span> None:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>If a single name and type is too long, consider using an alias for the type. The last resort is to break after the colon and indent by 4.</p><p>如果一个类型的名字自己本身太长了，考虑定义一个别名。实在没办法，在冒号后面换行。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_function</span>(
    long_variable_name:
        long_module_name<span style=color:#333>.</span>LongTypeName,
) <span style=color:#333>-&gt;</span> None:
  <span style=color:#333>...</span>

No:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_function</span>(
    long_variable_name: long_module_name<span style=color:#333>.</span>
        LongTypeName,
) <span style=color:#333>-&gt;</span> None:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h5 id=headline-57>3.19.3 Forward Declarations</h5><p>如果需要一个在模块里面还没有定义的类名，可以使用字符串名字。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>class</span> <span style=color:#b06;font-weight:700>MyClass</span>(<span style=color:#007020>object</span>):

  <span style=color:#080;font-weight:700>def</span> __init__(self,
               stack: List[<span style=background-color:#fff0f0>&#34;MyClass&#34;</span>]) <span style=color:#333>-&gt;</span> None:</code></pre></td></tr></table></div></div></div><h5 id=headline-58>3.19.4 Default Values</h5><p>基于 PEP-008，只有在同时有类型注解和默认值的时候 = 前后才会同时有空格。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>func</span>(a: <span style=color:#007020>int</span> <span style=color:#333>=</span> <span style=color:#00d;font-weight:700>0</span>) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
  <span style=color:#333>...</span>

No:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>func</span>(a:<span style=color:#007020>int</span><span style=color:#333>=</span><span style=color:#00d;font-weight:700>0</span>) <span style=color:#333>-&gt;</span> <span style=color:#007020>int</span>:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h5 id=headline-59>3.19.5 NoneType</h5><p>NoneType 是个 fist class 类型，None 是 NoneType 的别名。如果一个参数可以是 None，那应该声明下。你可以使用 Union，但是如果只有一种其他类型，可以使用 Optional。</p><p>使用明确的 Optional 定义，早先的 PEP-484 允许 <code>a: Text = None</code> 解释为 <code>a: Optional[Text] = None</code> ，但是现在不推荐了。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Yes:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>func</span>(a: Optional[Text], b: Optional[Text] <span style=color:#333>=</span> None) <span style=color:#333>-&gt;</span> Text:
  <span style=color:#333>...</span>
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>multiple_nullable_union</span>(a: Union[None, Text, <span style=color:#007020>int</span>]) <span style=color:#333>-&gt;</span> Text
  <span style=color:#333>...</span>

No:
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>nullable_union</span>(a: Union[None, Text]) <span style=color:#333>-&gt;</span> Text:
  <span style=color:#333>...</span>
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>implicit_optional</span>(a: Text <span style=color:#333>=</span> None) <span style=color:#333>-&gt;</span> Text:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h5 id=headline-60>3.19.6 Type Aliases</h5><p>可以给类型建别名，命名应该是大写开头的。如果只在这个模块里面使用，应该使用 _ 开头。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>_ShortName <span style=color:#333>=</span> module_with_long_name<span style=color:#333>.</span>TypeWithLongName
ComplexMap <span style=color:#333>=</span> Mapping[Text, List[Tuple[<span style=color:#007020>int</span>, <span style=color:#007020>int</span>]]]</code></pre></td></tr></table></div></div></div><p>类似的还有嵌套的类型定义，或者函数返回的多变量。</p><h5 id=headline-61>3.19.7 Ignoring Types</h5><p>可以使用 <code># type: ignore</code> 注释关闭单行的类型检查。</p><p>pytype 支持关闭特定的类型错误。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#888># pytype: disable=attribute-error</span></code></pre></td></tr></table></div></div></div><h5 id=headline-62>3.19.8 Typing Variables</h5><p>如果一个变量很难通过推导得出，那可以在注释或者冒号后面定义类型。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>a <span style=color:#333>=</span> SomeUndecoratedFunction()  <span style=color:#888># type: Foo</span>
a: Foo <span style=color:#333>=</span> SomeUndecoratedFunction()</code></pre></td></tr></table></div></div></div><h5 id=headline-63>3.19.9 Tuples vs Lists</h5><p>不像 list 只能有一个类型，tuple 可以有多个。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>a <span style=color:#333>=</span> [<span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>2</span>, <span style=color:#00d;font-weight:700>3</span>]  <span style=color:#888># type: List[int]</span>
b <span style=color:#333>=</span> (<span style=color:#00d;font-weight:700>1</span>, <span style=color:#00d;font-weight:700>2</span>, <span style=color:#00d;font-weight:700>3</span>)  <span style=color:#888># type: Tuple[int, ...]</span>
c <span style=color:#333>=</span> (<span style=color:#00d;font-weight:700>1</span>, <span style=background-color:#fff0f0>&#34;2&#34;</span>, <span style=color:#60e;font-weight:700>3.5</span>)  <span style=color:#888># type: Tuple[int, Text, float]</span></code></pre></td></tr></table></div></div></div><h5 id=headline-64>3.19.10 TypeVars</h5><p>python 的 type 支持范型。通过 TypeVar 这个工厂方法使用。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>typing</span> <span style=color:#080;font-weight:700>import</span> List, TypeVar
T <span style=color:#333>=</span> TypeVar(<span style=background-color:#fff0f0>&#34;T&#34;</span>)
<span style=color:#333>...</span>
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>next</span>(l: List[T]) <span style=color:#333>-&gt;</span> T:
  <span style=color:#080;font-weight:700>return</span> l<span style=color:#333>.</span>pop()</code></pre></td></tr></table></div></div></div><p>可以给 TypeVar 增加限制条件</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>AddableType <span style=color:#333>=</span> TypeVar(<span style=background-color:#fff0f0>&#34;AddableType&#34;</span>, <span style=color:#007020>int</span>, <span style=color:#007020>float</span>, Text)
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>add</span>(a: AddableType, b: AddableType) <span style=color:#333>-&gt;</span> AddableType:
  <span style=color:#080;font-weight:700>return</span> a <span style=color:#333>+</span> b</code></pre></td></tr></table></div></div></div><p>有个比较常用的类型是 AnyStr，用它来表示 bytes 或者 unicode 。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>typing</span> <span style=color:#080;font-weight:700>import</span> AnyStr
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>check_length</span>(x: AnyStr) <span style=color:#333>-&gt;</span> AnyStr:
  <span style=color:#080;font-weight:700>if</span> <span style=color:#007020>len</span>(x) <span style=color:#333>&lt;=</span> <span style=color:#00d;font-weight:700>42</span>:
    <span style=color:#080;font-weight:700>return</span> x
  <span style=color:#080;font-weight:700>raise</span> <span style=color:red;font-weight:700>ValueError</span>()</code></pre></td></tr></table></div></div></div><h5 id=headline-65>3.19.11 String types</h5><p>对于 python3 使用 str。其他说明都是些关于 2 和 3 兼容的。</p><h5 id=headline-66>3.19.12 Imports For Typing</h5><p>只导入需要的类型，可以一行导入多个。这些类型也应该作为关键字，不要在你的代码里面使用，如果有冲突可以通过 as 来起个别名。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>typing</span> <span style=color:#080;font-weight:700>import</span> Any, Dict, Optional
<span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>typing</span> <span style=color:#080;font-weight:700>import</span> Any <span style=color:#080;font-weight:700>as</span> AnyType</code></pre></td></tr></table></div></div></div><h5 id=headline-67>3.19.13 Conditional Imports</h5><p>只有在实验情况下才使用条件导入。</p><h5 id=headline-68>3.19.14 Circular Dependencies</h5><p>类型的循环引用一般都是有代码问题，这些代码应该被重构。</p><p>使用 Any 替换那些导致循环引用的模块。后面使用这个模块真实的类型定义（不过 Any 的属性还是 Any）。</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>from</span> <span style=color:#0e84b5;font-weight:700>typing</span> <span style=color:#080;font-weight:700>import</span> Any

some_mod <span style=color:#333>=</span> Any  <span style=color:#888># some_mod.py imports this module.</span>
<span style=color:#333>...</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>my_method</span>(self, var: some_mod<span style=color:#333>.</span>SomeType) <span style=color:#333>-&gt;</span> None:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><h5 id=headline-69>3.19.15 Generics</h5><p>When annotating, prefer to specify type parameters for generic types; otherwise, the generics’ parameters will be assumed to be Any.</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>get_names</span>(employee_ids: List[<span style=color:#007020>int</span>]) <span style=color:#333>-&gt;</span> Dict[<span style=color:#007020>int</span>, Any]:
  <span style=color:#333>...</span>

<span style=color:#888># These are both interpreted as get_names(employee_ids: List[Any]) -&gt; Dict[Any, Any]</span>
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>get_names</span>(employee_ids: <span style=color:#007020>list</span>) <span style=color:#333>-&gt;</span> Dict:
  <span style=color:#333>...</span>

<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>get_names</span>(employee_ids: List) <span style=color:#333>-&gt;</span> Dict:
  <span style=color:#333>...</span></code></pre></td></tr></table></div></div></div><p>If the best type parameter for a generic is Any, make it explicit, but remember that in many cases TypeVar might be more appropriate:</p><div class="src src-python"><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>get_names</span>(employee_ids: List[Any]) <span style=color:#333>-&gt;</span> Dict[Any, Text]:
  <span style=background-color:#fff0f0>&#34;&#34;&#34;Returns a mapping from employee ID to employee name for given IDs.&#34;&#34;&#34;</span>

T <span style=color:#333>=</span> TypeVar(<span style=background-color:#fff0f0>&#39;T&#39;</span>)
<span style=color:#080;font-weight:700>def</span> <span style=color:#06b;font-weight:700>get_names</span>(employee_ids: List[T]) <span style=color:#333>-&gt;</span> Dict[T, Text]:
  <span style=background-color:#fff0f0>&#34;&#34;&#34;Returns a mapping from employee ID to employee name for given IDs.&#34;&#34;&#34;</span></code></pre></td></tr></table></div></div></div><h3 id=headline-70>4 Parting Words</h3><p>保持一致性。</p><p>编辑代码的时候，注意看看原来的代码的风格。别破坏原来的代码风格。</p><p>代码风格指导的目的是为了让大家形成一种共同语言，这样更多的关注代码的逻辑。如果一个代码里面语言太多反而会导致阅读代码变困难，所以应该避免。</p></main><section id=comment><h2 class=title>Comments</h2><div id=disqus_thread aria-live=polite><noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></section><script type=text/javascript>var disqus_config=function(){this.page.url='';this.page.identifier='';};(function(){var d=document,s=d.createElement('script');s.src='//wdicc.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><footer style=clear:both><hr>Theme from <a href=https://github.com/wd/hugo-classic>hugo-classic</a> fork from <a href=https://github.com/goodroot/hugo-classic>Github</a></footer></body></html>