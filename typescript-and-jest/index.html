<!doctype html><html lang=en><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://wdicc.com/favicon.ico><title>Typescript and Jest | wd and cc</title><meta name=title content="Typescript and Jest"><meta name=description content='最近在折腾 typescript，把很多项目改成了 ts 的。有一个老项目，改的过程中感觉各种不踏实，打算还是先写点测试用例，就折腾了一下 jest。各种坑。。。

首先需要加一个 tsconfig.json

 1{
 2  "compilerOptions": {
 3    "target": "es2015",
 4    "module": "es2015",
 5    "lib": [
 6      "es2015"
 7    ],
 8    "outDir": "./lib",
 9    "declaration": true,
10
11    "noEmit": true,
12    "moduleResolution": "node",
13    "esModuleInterop": true,
14    "allowSyntheticDefaultImports": true,
15
16    /* Strict Type-checking */
17    "strict": true,
18    "strictNullChecks": true,
19    "noImplicitAny": true,
20    "noImplicitThis": true,
21    "alwaysStrict": true,
22
23    /* Additional Checks */
24    "noUnusedLocals": true,                /* Report errors on unused locals. */
25    "noUnusedParameters": true,            /* Report errors on unused parameters. */
26    "noImplicitReturns": true,             /* Report error when not all code paths in function return a value. */
27    "noFallthroughCasesInSwitch": true,    /* Report errors for fallthrough cases in switch statement. */
28  },
29  "include": [
30     "*.ts"
31  ],
32  "exclude": [
33    "node_modules",
34    "__tests__"
35  ]
36}


然后安装一个 typescript 就可以通过 yarn tsc 命令编译了，生成的 js 在 lib 下面。'><meta name=keywords content="typescript,jest,"><meta property="og:url" content="https://wdicc.com/typescript-and-jest/"><meta property="og:site_name" content="wd and cc"><meta property="og:title" content="Typescript and Jest"><meta property="og:description" content='最近在折腾 typescript，把很多项目改成了 ts 的。有一个老项目，改的过程中感觉各种不踏实，打算还是先写点测试用例，就折腾了一下 jest。各种坑。。。
首先需要加一个 tsconfig.json
1{ 2 "compilerOptions": { 3 "target": "es2015", 4 "module": "es2015", 5 "lib": [ 6 "es2015" 7 ], 8 "outDir": "./lib", 9 "declaration": true, 10 11 "noEmit": true, 12 "moduleResolution": "node", 13 "esModuleInterop": true, 14 "allowSyntheticDefaultImports": true, 15 16 /* Strict Type-checking */ 17 "strict": true, 18 "strictNullChecks": true, 19 "noImplicitAny": true, 20 "noImplicitThis": true, 21 "alwaysStrict": true, 22 23 /* Additional Checks */ 24 "noUnusedLocals": true, /* Report errors on unused locals. */ 25 "noUnusedParameters": true, /* Report errors on unused parameters. */ 26 "noImplicitReturns": true, /* Report error when not all code paths in function return a value. */ 27 "noFallthroughCasesInSwitch": true, /* Report errors for fallthrough cases in switch statement. */ 28 }, 29 "include": [ 30 "*.ts" 31 ], 32 "exclude": [ 33 "node_modules", 34 "__tests__" 35 ] 36} 然后安装一个 typescript 就可以通过 yarn tsc 命令编译了，生成的 js 在 lib 下面。'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-11-01T11:59:29+08:00"><meta property="article:modified_time" content="2018-11-01T11:59:29+08:00"><meta property="article:tag" content="Typescript"><meta property="article:tag" content="Jest"><meta name=twitter:card content="summary"><meta name=twitter:title content="Typescript and Jest"><meta name=twitter:description content='最近在折腾 typescript，把很多项目改成了 ts 的。有一个老项目，改的过程中感觉各种不踏实，打算还是先写点测试用例，就折腾了一下 jest。各种坑。。。
首先需要加一个 tsconfig.json
1{ 2 "compilerOptions": { 3 "target": "es2015", 4 "module": "es2015", 5 "lib": [ 6 "es2015" 7 ], 8 "outDir": "./lib", 9 "declaration": true, 10 11 "noEmit": true, 12 "moduleResolution": "node", 13 "esModuleInterop": true, 14 "allowSyntheticDefaultImports": true, 15 16 /* Strict Type-checking */ 17 "strict": true, 18 "strictNullChecks": true, 19 "noImplicitAny": true, 20 "noImplicitThis": true, 21 "alwaysStrict": true, 22 23 /* Additional Checks */ 24 "noUnusedLocals": true, /* Report errors on unused locals. */ 25 "noUnusedParameters": true, /* Report errors on unused parameters. */ 26 "noImplicitReturns": true, /* Report error when not all code paths in function return a value. */ 27 "noFallthroughCasesInSwitch": true, /* Report errors for fallthrough cases in switch statement. */ 28 }, 29 "include": [ 30 "*.ts" 31 ], 32 "exclude": [ 33 "node_modules", 34 "__tests__" 35 ] 36} 然后安装一个 typescript 就可以通过 yarn tsc 命令编译了，生成的 js 在 lib 下面。'><meta itemprop=name content="Typescript and Jest"><meta itemprop=description content='最近在折腾 typescript，把很多项目改成了 ts 的。有一个老项目，改的过程中感觉各种不踏实，打算还是先写点测试用例，就折腾了一下 jest。各种坑。。。
首先需要加一个 tsconfig.json
1{ 2 "compilerOptions": { 3 "target": "es2015", 4 "module": "es2015", 5 "lib": [ 6 "es2015" 7 ], 8 "outDir": "./lib", 9 "declaration": true, 10 11 "noEmit": true, 12 "moduleResolution": "node", 13 "esModuleInterop": true, 14 "allowSyntheticDefaultImports": true, 15 16 /* Strict Type-checking */ 17 "strict": true, 18 "strictNullChecks": true, 19 "noImplicitAny": true, 20 "noImplicitThis": true, 21 "alwaysStrict": true, 22 23 /* Additional Checks */ 24 "noUnusedLocals": true, /* Report errors on unused locals. */ 25 "noUnusedParameters": true, /* Report errors on unused parameters. */ 26 "noImplicitReturns": true, /* Report error when not all code paths in function return a value. */ 27 "noFallthroughCasesInSwitch": true, /* Report errors for fallthrough cases in switch statement. */ 28 }, 29 "include": [ 30 "*.ts" 31 ], 32 "exclude": [ 33 "node_modules", 34 "__tests__" 35 ] 36} 然后安装一个 typescript 就可以通过 yarn tsc 命令编译了，生成的 js 在 lib 下面。'><meta itemprop=datePublished content="2018-11-01T11:59:29+08:00"><meta itemprop=dateModified content="2018-11-01T11:59:29+08:00"><meta itemprop=wordCount content="917"><meta itemprop=keywords content="Typescript,Jest"><meta name=referrer content="no-referrer-when-downgrade"><style>:root{--width:720px;--font-main:Verdana, sans-serif;--font-secondary:Verdana, sans-serif;--font-scale:1em;--background-color:#fff;--heading-color:#222;--text-color:#444;--link-color:#3273dc;--visited-color:#8b6fcb;--code-background-color:#f2f2f2;--code-color:#222;--blockquote-color:#222}@media(prefers-color-scheme:dark){:root{--background-color:#01242e;--heading-color:#eee;--text-color:#ddd;--link-color:#8cc2dd;--visited-color:#8b6fcb;--code-background-color:#000;--code-color:#ddd;--blockquote-color:#ccc}}body{font-family:var(--font-secondary);font-size:var(--font-scale);margin:auto;padding:20px;max-width:var(--width);text-align:left;background-color:var(--background-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:var(--text-color)}h1,h2,h3,h4,h5,h6{font-family:var(--font-main);color:var(--heading-color)}a{color:var(--link-color);cursor:pointer;text-decoration:none}a:hover{text-decoration:underline}nav a{margin-right:8px}strong,b{color:var(--heading-color)}button{margin:0;cursor:pointer}time{font-family:monospace;font-style:normal;font-size:15px}main{line-height:1.6}table{width:100%}hr{border:0;border-top:1px dashed}img{max-width:100%}code{font-family:monospace;padding:2px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px}blockquote{border-left:1px solid #999;color:var(--code-color);padding-left:20px;font-style:italic}footer{padding:25px 0;text-align:center}.title:hover{text-decoration:none}.title h1{font-size:1.5em}.inline{width:auto!important}.highlight,.code{padding:1px 15px;background-color:var(--code-background-color);color:var(--code-color);border-radius:3px;margin-block-start:1em;margin-block-end:1em;overflow-x:auto}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:var(--visited-color)}</style></head><body><header><a href=/ class=title><h2>wd and cc</h2></a><p>-- Good good study, day day up!</p><nav><a href=/>Home</a>
<a href=/posts/>Posts</a>
<a href="https://www.google.com.hk/search?sitesearch=https%3A%2F%2Fwdicc.com%2F&amp;q=">Search</a>
<a href=/tags/>Tags</a>
<a href=/atom.xml>subscribe</a></nav></header><main><h1>Typescript and Jest</h1><p><i><time datetime=2018-11-01>01 Nov, 2018
</time></i><a href=https://wdicc.com/tags/typescript/>#Typescript</a>
<a href=https://wdicc.com/tags/jest/>#Jest</a></p><content><p>最近在折腾 typescript，把很多项目改成了 ts 的。有一个老项目，改的过程中感觉各种不踏实，打算还是先写点测试用例，就折腾了一下 jest。各种坑。。。</p><p>首先需要加一个 <code class=verbatim>tsconfig.json</code></p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#4070a0>&#34;compilerOptions&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#4070a0>&#34;target&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;es2015&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#4070a0>&#34;module&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;es2015&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#4070a0>&#34;lib&#34;</span><span style=color:#666>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>      <span style=color:#4070a0>&#34;es2015&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#4070a0>&#34;outDir&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;./lib&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#4070a0>&#34;declaration&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    <span style=color:#4070a0>&#34;noEmit&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>    <span style=color:#4070a0>&#34;moduleResolution&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;node&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#4070a0>&#34;esModuleInterop&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    <span style=color:#4070a0>&#34;allowSyntheticDefaultImports&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    <span style=color:#60a0b0;font-style:italic>/* Strict Type-checking */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>    <span style=color:#4070a0>&#34;strict&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#4070a0>&#34;strictNullChecks&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    <span style=color:#4070a0>&#34;noImplicitAny&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    <span style=color:#4070a0>&#34;noImplicitThis&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    <span style=color:#4070a0>&#34;alwaysStrict&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#60a0b0;font-style:italic>/* Additional Checks */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    <span style=color:#4070a0>&#34;noUnusedLocals&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,                <span style=color:#60a0b0;font-style:italic>/* Report errors on unused locals. */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>    <span style=color:#4070a0>&#34;noUnusedParameters&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,            <span style=color:#60a0b0;font-style:italic>/* Report errors on unused parameters. */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>    <span style=color:#4070a0>&#34;noImplicitReturns&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,             <span style=color:#60a0b0;font-style:italic>/* Report error when not all code paths in function return a value. */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>    <span style=color:#4070a0>&#34;noFallthroughCasesInSwitch&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,    <span style=color:#60a0b0;font-style:italic>/* Report errors for fallthrough cases in switch statement. */</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>  },
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>  <span style=color:#4070a0>&#34;include&#34;</span><span style=color:#666>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span>     <span style=color:#4070a0>&#34;*.ts&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span>  ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>  <span style=color:#4070a0>&#34;exclude&#34;</span><span style=color:#666>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>    <span style=color:#4070a0>&#34;node_modules&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>    <span style=color:#4070a0>&#34;__tests__&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>  ]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>}</span></span></code></pre></div></div><p>然后安装一个 <code class=verbatim>typescript</code> 就可以通过 <code class=verbatim>yarn tsc</code> 命令编译了，生成的 js 在 <code class=verbatim>lib</code> 下面。</p><p>测试如果是用 js 写，那么直接装 <code class=verbatim>jest</code> 就可以了。但是我们既然项目都改成 ts 了，那么还是希望用 ts 写。那就需要用到 <code class=verbatim>ts-jest</code> 。这货的配置可以写到 <code class=verbatim>package.json</code> 里面。</p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span> <span style=color:#4070a0>&#34;name&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#39;test-projct&#39;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span> <span style=color:#4070a0>&#34;version&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span> ........
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span> <span style=color:#4070a0>&#34;jest&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#4070a0>&#34;preset&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;ts-jest&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#4070a0>&#34;testEnvironment&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;node&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#4070a0>&#34;testMatch&#34;</span><span style=color:#666>:</span> [ <span style=color:#4070a0>&#34;**/__tests__/*-test.ts&#34;</span> ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#4070a0>&#34;globals&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>      <span style=color:#4070a0>&#34;ts-jest&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#4070a0>&#34;babelConfig&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        <span style=color:#4070a0>&#34;isolatedModules&#34;</span><span style=color:#666>:</span> <span style=color:#007020;font-weight:700>true</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>}</span></span></code></pre></div></div><p><code class=verbatim>isolatedModules</code> 表示说测试的时候先不做 type 检查。我这情况是，要改那些文件比较大一时都弄不好，可能 type 只改了部分，但是这个时候改到某个方法的时候，需要先加测试，以免改前改后不一致，所以这个时候只能忽略掉 type 检查了。</p><p>这样配置之后，就可以用 ts 写 test 了。test 文件放到 <code class=verbatim>__tests__</code> 目录里面，用 <code class=verbatim>*-test.ts</code> 命名。这样这目录也可以放一些非测试用文件了，比如测试用例用到的一些 mock 文件之类。</p><p>这样看着一切美好。直到我遇到了一个问题，我的那些需要测试的方法，有些是私有的，又不想因为这个改成 public 的，那么是不是有办法可以测试？这样就找到了 <code class=verbatim>rewire</code> ，这个可以把你的模块的内容随意替换组合，方便你做 mock。我要做的也覆盖了。这样完美了。</p><p>但是发现，rewire 不支持 typescript。在 ts 文件里面 rewire 一个模块之后，并没有多出来那些 <code class=verbatim>__get__</code> 和 <code class=verbatim>__set__</code> 方法。没仔细去研究代码，找到了 <code class=verbatim>babel-plugin-rewire</code> ，给 <code class=verbatim>package.json</code> 增加配置如下。</p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>  <span style=color:#4070a0>&#34;babel&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>    <span style=color:#4070a0>&#34;presets&#34;</span><span style=color:#666>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>      <span style=color:#4070a0>&#34;env&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    ],
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    <span style=color:#4070a0>&#34;env&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>      <span style=color:#4070a0>&#34;test&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>        <span style=color:#4070a0>&#34;plugins&#34;</span><span style=color:#666>:</span> [
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>          <span style=color:#4070a0>&#34;babel-plugin-rewire&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>        ]
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>  }</span></span></code></pre></div></div><p>发现还是不行，并没有什么效果。查了之后发现，是因为 ts-test 根本不会去调用 babel 的缘故，所以上面的那个 <code class=verbatim>babelConfig</code> 就是这个用途，让 ts-test 去使用 babel。</p><p>目前还有一个问题是怎么让这个 package 在别人安装使用的时候自动编译为 js，这样让 js 用户也可以用。尝试过在 <code class=verbatim>package.json</code> 里面增加 build 发现不行。</p><div class="src src-javascript"><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span> <span style=color:#4070a0>&#34;scripts&#34;</span><span style=color:#666>:</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>    <span style=color:#4070a0>&#34;build&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;tsc&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>    <span style=color:#4070a0>&#34;postinstall&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;[ -f ../../node_modules/.bin/tsc ] &amp;&amp; ../../node_modules/.bin/tsc || echo &#39;no typescript found, skip build&#39;&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>    <span style=color:#4070a0>&#34;test&#34;</span><span style=color:#666>:</span> <span style=color:#4070a0>&#34;jest&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>  },</span></span></code></pre></div></div><p>安装这个模块之后在 <code class=verbatim>./node_modules/test-module/</code> 下面执行 <code class=verbatim>tsc</code> 并不会产出 <code class=verbatim>lib</code> 目录的编译文件。</p></content><div><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//wdicc.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>