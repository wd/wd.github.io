<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>cookie 的一点研究 - wd and cc</title>
    <meta name="author" content="wd">
    
	<meta name="description" content="&lt;p&gt;这几天搞了一下 python 里面 cookie 相关的东西。我的目的是想要尝试用 python 登录某个网站，并且保持登录状态直到过期。因为 http 协议是无状态的，所以一般来讲，网站想要用户保持登录，那么网站在用户登录之后，必须要和用户端协商好怎么来证明这个用户已经登录过了。&lt;/p&gt;
&lt;p&gt;用户端如果使用浏览器，那么网站就可以利用浏览器对 cookie 的支持来让用户在不知情的情况下，让网站在用户登录后发的一个 token 在用户后续的请求里面都包含上。&lt;/p&gt;
&lt;p&gt;用户端如果不是浏览器，比如是个 python 程序，那么网站可以和用户协商每次请求里面都包含某个下发的 token（当然，甚至要求客户端每次请求都带着用户名密码也是可行的）。&lt;/p&gt;
&lt;p&gt;但是如果网站本身只是给浏览器用户准备的，那么通过用程序来「模拟」浏览器行为，把必要的 token 保存并在后续的请求里面都带上，也是可行的。&lt;/p&gt;
&lt;p&gt;python 里面，发送 http 请求可以简单的使用 &lt;code&gt;urllib.request.urlopen(url)&lt;/code&gt;，但是如果想要定制一下请求，比如修改一些 header 信息，那么就得使用 &lt;code&gt;urllib.request.Request&lt;/code&gt; 这个 class 先构造一个 Request 对象，然后传递给 urlopen 了。&lt;/p&gt;
&lt;p&gt;如果要处理 cookie，那就需要使用 &lt;code&gt;http.cookiejar.CookieJar&lt;/code&gt; 了，有了 Cookiejar 对象，就可以把网站下发的 cookie 保存到这个变量里面，然后在必要的时候，可以返回给服务器端了。如果想要保存到文件，那么可以使用 &lt;code&gt;http.cookiejar.LWPCookieJar&lt;/code&gt; 或者 &lt;code&gt;http.cookiejar.MozillaCookieJar&lt;/code&gt;，也可以基于 &lt;code&gt;http.cookiejar.FileCookieJar&lt;/code&gt; 自己实现一个子类，来用自己的办法保存和加载 cookie，比如保存到数据库什么的，这样就可以多台机器之间共享 cookie 了。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;urlopen&lt;/code&gt; 本身不支持自定义 cookiejar 逻辑，得使用 &lt;code&gt;opener = build_opener(HTTPCookieProcessor(cookiejar=Cookiejar对象))&lt;/code&gt; 来先构造一个自定义的 openner, 然后使用 &lt;code&gt;opener(Request对象)&lt;/code&gt; 来发送请求。&lt;/p&gt;
&lt;p&gt;如果不定义自己的 cookie policy，那么会使用默认的 &lt;code&gt;http.cookiejar.DefaultCookiePolicy&lt;/code&gt;，也可以自己基于 &lt;code&gt;http.cookiejar.CookiePolicy&lt;/code&gt; 实现自己的逻辑。只需要 override &lt;code&gt;set_ok&lt;/code&gt; 和 &lt;code&gt;return_ok&lt;/code&gt; 这两个方法就可以。&lt;/p&gt;
&lt;p&gt;http cookie 其实有很多属性，比如 domain, expire, path 等常见属性，也有 httponly, secure 等几个不常见的。这些属性都是浏览器处理的。就是说，浏览器把 cookie 返回给服务器端的时候，如果 domain 不匹配，或者已经过了 expire 时间等等一些不符合浏览器制定的 cookie 逻辑的时候，浏览器就不会把 cookie 发送给服务器端。就比如，服务器产生 cookie 的时候，声明了 domain=a.com，那么如果是来自于 b.com 的请求，浏览器是根本不会给他发送这个 cookie。再比如，服务器端产生 cookie 的时候，声明了 1 天后过期，那么 1 天之后，浏览器也不会再给服务器端发这个 cookie 了。&lt;/p&gt;
&lt;p&gt;但是如果是我们自己实现客户端模拟浏览器的时候，其实我们是可以耍流氓的，可以制定自己的 cookie 逻辑，也就是上面提到的 cookie policy。比如我可以简单的在 &lt;code&gt;return_ok&lt;/code&gt; 这个方法里面 &lt;code&gt;return True&lt;/code&gt;，在任何情况下都把所有的 cookie 返回给服务器，这样服务器端如果不提前想明白，它是一点都不知道的。&lt;/p&gt;
&lt;p&gt;所谓提前想明白就是想明白是不是需要针对这种情况做处理。如果本身我们系统也没有那么严格要求，那么不处理也可以。但是如果是某个比如金融系统，那么是必须要考虑的。否则如果完全依赖 cookie 的话，如果我通过某些手段弄到了用户的 cookie，那么我就可以骗过服务器端，让他认为我就是那个用户。&lt;/p&gt;
&lt;p&gt;我想了一下，貌似被盗窃 cookie 这种事情服务器端不太好防范，但是可以做的是防止浏览器耍流氓。比如我们把 cookie 加密，并里面增加一个发送 cookie 的时间。收到客户端发过来的 cookie 之后，我们解密看看时间有没有过期，这样就可以在服务器端让 cookie 失效了。&lt;/p&gt;
&lt;p&gt;另外，也可以考虑使用 session。session 是把一些用户的状态保存在服务器端。但是 session 实际上也是依赖 cookie 的，因为前面说了 http 协议无状态，就算可以把用户状态保存在服务器端，但是总还是得识别用户才可以。那个识别的 cookie 就是所谓的 session cookie，其实就是某个用户的唯一标识。&lt;/p&gt;
&lt;p&gt;对于 session cookie 被窃，好像也没有太好的办法，无非也是想办法比对之前用户的一些状态信息，比如 ip 和现在的信息是不是一致，不一致可以认为有被窃的怀疑，这个时候让用户再次验证用户信息，这都不能 100% 保证，但是至少会增加窃贼的成本。&lt;/p&gt;
&lt;p&gt;上面说到这些，都可以自己测试一下，测试也并不一定需要搭一个服务器端配合，以及使用复杂的抓包专鉴，其实使用 &lt;code&gt;nc&lt;/code&gt; 就可以。&lt;/p&gt;
&lt;p&gt;使用 &lt;code&gt;nc -l 9999&lt;/code&gt; 就可以启动一个监听在 9999 端口的 socket 服务器。之后使用 python 或者 curl 之类的程序请求，就能立刻看到请求发送过来的 http 信息，这个对于学习 http 协议其实也很方便。&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ nc -l &lt;span class=&quot;number&quot;&gt;9999&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;GET &lt;span class=&quot;regexp&quot;&gt;/ HTTP/&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1.1&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Accept-&lt;span class=&quot;string&quot;&gt;Encoding:&lt;/span&gt; identity&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;Connection:&lt;/span&gt; close&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;Cookie:&lt;/span&gt; QN2=test; QN1=ClbaCVfZF5lfszBALzTIAg==&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;User-&lt;span class=&quot;string&quot;&gt;Agent:&lt;/span&gt; Mozilla&lt;span class=&quot;regexp&quot;&gt;/5.0 (Macintosh; Intel Mac OS X 10_11_6)  AppleWebKit/&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;537.36&lt;/span&gt; (KHTML, like Gecko) Chrome&lt;span class=&quot;regexp&quot;&gt;/52.0.2743.116 Safari/&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;537.36&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;Host:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;localhost:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;9999&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;收到的上面这个请求，可以看到发送过来了 2 个 cookie。&lt;/p&gt;
&lt;p&gt;如果还想测试数据返回的情况，那么可以写一个 &lt;code&gt;test.resp&lt;/code&gt; 文件，内容如下&lt;/p&gt;
&lt;figure class=&quot;highlight dts&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ cat test.resp&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;HTTP/&lt;span class=&quot;number&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;200&lt;/span&gt; OK&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;Date:&lt;/span&gt; Sun, &lt;span class=&quot;number&quot;&gt;18&lt;/span&gt; Oct &lt;span class=&quot;number&quot;&gt;2009&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;08&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;56&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;53&lt;/span&gt; GMT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;Server:&lt;/span&gt; Apache/&lt;span class=&quot;number&quot;&gt;2.2&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.14&lt;/span&gt; (Win32)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Last-Modified: Sat, &lt;span class=&quot;number&quot;&gt;20&lt;/span&gt; Nov &lt;span class=&quot;number&quot;&gt;2004&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;07&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;16&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;26&lt;/span&gt; GMT&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;ETag:&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;10000000565a5-2c-3e94b66c2e680&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Set-Cookie: QN1=ClbaCVfZF5lfszBALzTIAg==; expires=Thu, &lt;span class=&quot;number&quot;&gt;31&lt;/span&gt;-Dec&lt;span class=&quot;number&quot;&gt;-37&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt; GMT; path=/&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Set-Cookie: QN2=test; expires=Thu, &lt;span class=&quot;number&quot;&gt;31&lt;/span&gt;-Dec&lt;span class=&quot;number&quot;&gt;-37&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;23&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt;:&lt;span class=&quot;number&quot;&gt;55&lt;/span&gt; GMT; path=/; secure; httponly&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Accept-Ranges: bytes&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Content-Length: &lt;span class=&quot;number&quot;&gt;44&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;Connection:&lt;/span&gt; close&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Content-Type: text/html&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;X-Pad: avoid browser bug&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;params&quot;&gt;&amp;lt;html&amp;gt;&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;&amp;lt;body&amp;gt;&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;&amp;lt;h1&amp;gt;&lt;/span&gt;It works!&lt;span class=&quot;params&quot;&gt;&amp;lt;/h1&amp;gt;&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;&amp;lt;/body&amp;gt;&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;&amp;lt;/html&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后使用 &lt;code&gt;nc -l 9999 &amp;lt; test.resp&lt;/code&gt; 命令启动服务，客户端来请求的时候，就会返回上面 &lt;code&gt;test.resp&lt;/code&gt; 里面的内容。&lt;/p&gt;
"> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>
<span class="subtitle">happy everyday</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/wd" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        <article class="post">
	<h2 class="title">cookie 的一点研究</h2>
    <div class="meta">
        <div class="date">Published on: <time datetime="2016-09-16T00:59:09.000Z" itemprop="datePublished">Sep 16, 2016</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/cookie/">cookie</a> <a href="/tags/http/">http</a>
</div>
    </div>
	<div class="entry-content"><p>这几天搞了一下 python 里面 cookie 相关的东西。我的目的是想要尝试用 python 登录某个网站，并且保持登录状态直到过期。因为 http 协议是无状态的，所以一般来讲，网站想要用户保持登录，那么网站在用户登录之后，必须要和用户端协商好怎么来证明这个用户已经登录过了。</p>
<p>用户端如果使用浏览器，那么网站就可以利用浏览器对 cookie 的支持来让用户在不知情的情况下，让网站在用户登录后发的一个 token 在用户后续的请求里面都包含上。</p>
<p>用户端如果不是浏览器，比如是个 python 程序，那么网站可以和用户协商每次请求里面都包含某个下发的 token（当然，甚至要求客户端每次请求都带着用户名密码也是可行的）。</p>
<p>但是如果网站本身只是给浏览器用户准备的，那么通过用程序来「模拟」浏览器行为，把必要的 token 保存并在后续的请求里面都带上，也是可行的。</p>
<p>python 里面，发送 http 请求可以简单的使用 <code>urllib.request.urlopen(url)</code>，但是如果想要定制一下请求，比如修改一些 header 信息，那么就得使用 <code>urllib.request.Request</code> 这个 class 先构造一个 Request 对象，然后传递给 urlopen 了。</p>
<p>如果要处理 cookie，那就需要使用 <code>http.cookiejar.CookieJar</code> 了，有了 Cookiejar 对象，就可以把网站下发的 cookie 保存到这个变量里面，然后在必要的时候，可以返回给服务器端了。如果想要保存到文件，那么可以使用 <code>http.cookiejar.LWPCookieJar</code> 或者 <code>http.cookiejar.MozillaCookieJar</code>，也可以基于 <code>http.cookiejar.FileCookieJar</code> 自己实现一个子类，来用自己的办法保存和加载 cookie，比如保存到数据库什么的，这样就可以多台机器之间共享 cookie 了。</p>
<p><code>urlopen</code> 本身不支持自定义 cookiejar 逻辑，得使用 <code>opener = build_opener(HTTPCookieProcessor(cookiejar=Cookiejar对象))</code> 来先构造一个自定义的 openner, 然后使用 <code>opener(Request对象)</code> 来发送请求。</p>
<p>如果不定义自己的 cookie policy，那么会使用默认的 <code>http.cookiejar.DefaultCookiePolicy</code>，也可以自己基于 <code>http.cookiejar.CookiePolicy</code> 实现自己的逻辑。只需要 override <code>set_ok</code> 和 <code>return_ok</code> 这两个方法就可以。</p>
<p>http cookie 其实有很多属性，比如 domain, expire, path 等常见属性，也有 httponly, secure 等几个不常见的。这些属性都是浏览器处理的。就是说，浏览器把 cookie 返回给服务器端的时候，如果 domain 不匹配，或者已经过了 expire 时间等等一些不符合浏览器制定的 cookie 逻辑的时候，浏览器就不会把 cookie 发送给服务器端。就比如，服务器产生 cookie 的时候，声明了 domain=a.com，那么如果是来自于 b.com 的请求，浏览器是根本不会给他发送这个 cookie。再比如，服务器端产生 cookie 的时候，声明了 1 天后过期，那么 1 天之后，浏览器也不会再给服务器端发这个 cookie 了。</p>
<p>但是如果是我们自己实现客户端模拟浏览器的时候，其实我们是可以耍流氓的，可以制定自己的 cookie 逻辑，也就是上面提到的 cookie policy。比如我可以简单的在 <code>return_ok</code> 这个方法里面 <code>return True</code>，在任何情况下都把所有的 cookie 返回给服务器，这样服务器端如果不提前想明白，它是一点都不知道的。</p>
<p>所谓提前想明白就是想明白是不是需要针对这种情况做处理。如果本身我们系统也没有那么严格要求，那么不处理也可以。但是如果是某个比如金融系统，那么是必须要考虑的。否则如果完全依赖 cookie 的话，如果我通过某些手段弄到了用户的 cookie，那么我就可以骗过服务器端，让他认为我就是那个用户。</p>
<p>我想了一下，貌似被盗窃 cookie 这种事情服务器端不太好防范，但是可以做的是防止浏览器耍流氓。比如我们把 cookie 加密，并里面增加一个发送 cookie 的时间。收到客户端发过来的 cookie 之后，我们解密看看时间有没有过期，这样就可以在服务器端让 cookie 失效了。</p>
<p>另外，也可以考虑使用 session。session 是把一些用户的状态保存在服务器端。但是 session 实际上也是依赖 cookie 的，因为前面说了 http 协议无状态，就算可以把用户状态保存在服务器端，但是总还是得识别用户才可以。那个识别的 cookie 就是所谓的 session cookie，其实就是某个用户的唯一标识。</p>
<p>对于 session cookie 被窃，好像也没有太好的办法，无非也是想办法比对之前用户的一些状态信息，比如 ip 和现在的信息是不是一致，不一致可以认为有被窃的怀疑，这个时候让用户再次验证用户信息，这都不能 100% 保证，但是至少会增加窃贼的成本。</p>
<p>上面说到这些，都可以自己测试一下，测试也并不一定需要搭一个服务器端配合，以及使用复杂的抓包专鉴，其实使用 <code>nc</code> 就可以。</p>
<p>使用 <code>nc -l 9999</code> 就可以启动一个监听在 9999 端口的 socket 服务器。之后使用 python 或者 curl 之类的程序请求，就能立刻看到请求发送过来的 http 信息，这个对于学习 http 协议其实也很方便。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ nc -l <span class="number">9999</span></div><div class="line">GET <span class="regexp">/ HTTP/</span><span class="number">1.1</span></div><div class="line">Accept-<span class="string">Encoding:</span> identity</div><div class="line"><span class="string">Connection:</span> close</div><div class="line"><span class="string">Cookie:</span> QN2=test; QN1=ClbaCVfZF5lfszBALzTIAg==</div><div class="line">User-<span class="string">Agent:</span> Mozilla<span class="regexp">/5.0 (Macintosh; Intel Mac OS X 10_11_6)  AppleWebKit/</span><span class="number">537.36</span> (KHTML, like Gecko) Chrome<span class="regexp">/52.0.2743.116 Safari/</span><span class="number">537.36</span></div><div class="line"><span class="string">Host:</span> <span class="string">localhost:</span><span class="number">9999</span></div></pre></td></tr></table></figure>
<p>收到的上面这个请求，可以看到发送过来了 2 个 cookie。</p>
<p>如果还想测试数据返回的情况，那么可以写一个 <code>test.resp</code> 文件，内容如下</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cat test.resp</div><div class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</div><div class="line"><span class="symbol">Date:</span> Sun, <span class="number">18</span> Oct <span class="number">2009</span> <span class="number">08</span>:<span class="number">56</span>:<span class="number">53</span> GMT</div><div class="line"><span class="symbol">Server:</span> Apache/<span class="number">2.2</span><span class="number">.14</span> (Win32)</div><div class="line">Last-Modified: Sat, <span class="number">20</span> Nov <span class="number">2004</span> <span class="number">07</span>:<span class="number">16</span>:<span class="number">26</span> GMT</div><div class="line"><span class="symbol">ETag:</span> <span class="string">"10000000565a5-2c-3e94b66c2e680"</span></div><div class="line">Set-Cookie: QN1=ClbaCVfZF5lfszBALzTIAg==; expires=Thu, <span class="number">31</span>-Dec<span class="number">-37</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">55</span> GMT; path=/</div><div class="line">Set-Cookie: QN2=test; expires=Thu, <span class="number">31</span>-Dec<span class="number">-37</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">55</span> GMT; path=/; secure; httponly</div><div class="line">Accept-Ranges: bytes</div><div class="line">Content-Length: <span class="number">44</span></div><div class="line"><span class="symbol">Connection:</span> close</div><div class="line">Content-Type: text/html</div><div class="line">X-Pad: avoid browser bug</div><div class="line"></div><div class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;h1&gt;</span>It works!<span class="params">&lt;/h1&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></div></pre></td></tr></table></figure>
<p>然后使用 <code>nc -l 9999 &lt; test.resp</code> 命令启动服务，客户端来请求的时候，就会返回上面 <code>test.resp</code> 里面的内容。</p>
</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/about-http-cookie/#disqus_thread">Comments</a></span>
	
</div>
</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=null"></script>
</div>





    
      <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = 'http://wdicc.com/about-http-cookie/';
            this.page.identifier = 'http://wdicc.com/about-http-cookie/';
        };

        (function() {
          var d = document, s = d.createElement('script');
          s.src = '//wdicc.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    


<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2016

    wd
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
