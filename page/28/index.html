<!DOCTYPE HTML>
<html>
<head>
	<meta name="generator" content="Hugo 0.19" />
	<meta charset="utf-8">
    
    
    <title>wd and cc</title>
    <meta name="author" content="wd">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://wdicc.com/index.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    

    <script type="text/javascript" src="/js/jquery-tapir.js"></script>

    

    <link rel="stylesheet" href="/css/hljs.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<body>
    <div id="wrapper">
        <header id="header" class="inner">
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>

<span class="subtitle">happy every day</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
    
    
    <li>
    <a href="https://github.com/wd" class="github" title="Github"></a>
    </li>
    
    
    
    
    
    <li>
    <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
    </li>
    
    
    
    
    
</ul>


<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://wdicc.com/" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
</ul>

</header>

<div id="toload">

    <div id="content" class="inner">
        




    
    <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    




  <article class="post">
    <h2 class="title"> 
        <a href="/gnokii_cant_get_sms/">debian下面解决gnokii读取短信的bug</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-12-06T00:00:00.000&#43;00:00' itemprop="datePublished">2006-12-06</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>


</div>
    </div>
        上一篇文章提到过gnokii读取AT模式下设备的短信的时候会有<a href="http://blog.wdicc.com/wordpress/2006/12/05/277/">问题</a>，从xh那里看到了解决方法，自己也goolgle了<a href="http://thread.gmane.org/gmane.linux.drivers.gnokii/7918/focus=7922">一下</a>，总结一下debian（sarge）下面解决这个问题的方法。<br />

故障现象如下：<br />
<pre class="prettyprint lang-text">
[...]
Message sent: 0x12 / 0x0009
41 54 2b 43 50 4d 53 3f 0d                      | AT+CPMS?
write: [AT+CPMS?]
read : [AT+CPMS?+CPMS:
"SM",2,30,"SM",2,30OK]
Message received: 0x12 / 0x002d
02 41 54 2b 43 50 4d 53 3f 0d 0d 0a 2b 43 50 4d |  AT+CPMS?   +CPM
53 3a 20 22 53 4d 22 2c 32 2c 33 30 2c 22 53 4d | S: "SM",2,30,"SM
22 2c 32 2c 33 30 0d 0a 0d 0a 4f 4b 0d          | ",2,30    OK
Received message type 12
GetSMS SM 1 failed! (Command failed.)
Serial device: closing device</pre>
还有一个smsd的问题：
<pre class="prettyprint lang-text">
解决这个问题需要给gnokii打一个补丁，debian下面就需要自己来制作一个包，参考 <a href="http://debian.linuxsir.org/doc/inthedebianway/debian_build_package.html">构建 Debian 软件包</a> 这篇文章，操作如下。

首先下载包的源代码：
<pre class="prettyprint lang-bash">
此时他会在当前目录下面下载并解压gnokii的源代码包，并且打上debian需要的patch。此时需要将下面的patch给gnokii打上，修改都是针对common/phones/atgen.c的。
<pre class="prettyprint lang-diff">
+++ atgen.c     2006-12-06 12:40:59.201314062 +0800
@@ -537,22 +537,15 @@
{
at_driver_instance *drvinst = AT_DRVINST(state);
gn_data data;
-       gn_sms_status sms_status;
char req[32];
gn_error ret = GN_ERR_NONE;

if (mt != drvinst->smsmemorytype) {
gn_data_clear(&data);
-               data.sms_status = &sms_status;
-               ret = AT_GetSMSStatus(&data, state);
+               sprintf(req, "AT+CPMS=\"%s\"r", memorynames[mt]);
+               ret = sm_message_send(13, GN_OP_Init, req, state);
if (ret != GN_ERR_NONE)
return ret;
-
-               sprintf(req, "AT+CPMS=\"%s\",\"%s\",\"%s\"r", memorynames[mt], memorynames[mt],
-                       memorynames[data.sms_status->new_message_store]);
-               ret = sm_message_send(23, GN_OP_Init, req, state);
-               if (ret != GN_ERR_NONE)
-                       return GN_ERR_NOTREADY;
ret = sm_block_no_retry(GN_OP_Init, &data, state);
if (ret == GN_ERR_NONE)
drvinst->smsmemorytype = mt;
@@ -1355,7 +1348,10 @@

if (sscanf(buf.line2, "+CPMS: \"%*c%*c\",%d,%*d,\"%*c%*c\",%*d,%*d,\"%c%c\",%*d,%*d",
&data->sms_status->number, &store[0], &store[1]) != 3)
-               return GN_ERR_FAILED;
+
+               if (sscanf(buf.line2, "+CPMS: \"%c%c\",%d,%*d,\"%*c%*c\",%*d,%*d",
+                                       &store[0], &store[1], &data->sms_status->number) != 3)
+                       return GN_ERR_FAILED;

data->sms_status->unread = 0;
data->sms_status->changed = 0;</pre>
把上面的内容保存一下，比如取名为cant_get_sms.patch，或者来<a href="http://blog.wdicc.com/wordpress/download/cant_get_sms.patch">这里</a>下载，然后执行下面的命令：
<pre class="prettyprint lang-bash">
apt-get -b source gnokii</pre>
此时会看到debian正在编译gnokii（编译之前可能需要下载编译需要的dev库，按照提示来就可以了），编译完成之后会将打包成6个deb文件，用dpkg -i命令重装一下你需要的就可以了。 此时再试试看gnokii --getsms SM 1命令，是不是没问题了？

    </div>

<div class="meta">
    
    <span class="comments"><a href="/gnokii_cant_get_sms/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/lilina-cache/">lilina里面不能正确生成前一天的cache的问题</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-12-06T00:00:00.000&#43;00:00' itemprop="datePublished">2006-12-06</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/lilina">lilina</a>

<a href="/tags/rss">rss</a>

<a href="/tags/web">web</a>


</div>
    </div>
        lilina可以生成好几天的cache，可以看到上面有每天的链接可以访问，可是这两天发现，在today里面明明看到前一天晚上23:40多有rss，结果点击到前一天生成的链接却发现，没有？见鬼了。<br />

仔细研究下，似乎是23:00之后的rss都不会做cache，咋回事哩，翻了一下源代码，发现问题所在了。<br />

index.php里面有下面一句：<br />
<pre class="prettyprint lang-php">$saven_file = realpath(".")."/".date('Ymd').".html">
这是设置cache文件的名称和位置的语句，可以看到文件名里面用的是当前的日期。单独这一点不会有问题，问题在于我的cron里面是每隔一个小时的0分钟执行一次，也就是1:00，2:00……23:00，0:00，这样，23:00之后0:00之前的rss就被吞掉了。解决方法就是将cron修改为类似下面的，让他每隔整点的58分执行更新。
<pre class="prettyprint lang-bash">

    </div>

<div class="meta">
    
    <span class="comments"><a href="/lilina-cache/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/a-joke-10/">看到一篇有意思的文章-[上帝与Google，玉帝与Baidu]</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-12-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-12-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/joke">Joke</a>


</div>
    </div>
        <a href="http://www.newsmth.net/bbscon.php?bid=951&id=28755">http://www.newsmth.net/bbscon.php?bid=951&id=28755</a><br />

最早的时候,上帝很无聊,平时只能看看电视听听广播,偶尔玩玩超级玛丽,再就是和圣母玛丽亚通通电话.时间长了,这种生活越发枯燥.上帝觉得这样的生活太乏味,于是他说:“要有网”.然后就有了互联网,计算机都可以连在一起,这是第一天.<br />

光是有互联网也不行，起码得有点东西看吧。上帝说：“要有网站”。然后就有了全世界各种各样的大小网站，上帝在网站上看新闻、看图片，顺便还到论坛上发发贴，觉得互联网有些意思，这是第二天。<br />

圣母玛丽亚看上帝这两天没怎么打电话，比较生气，威胁上帝说要把互联网毁了，上帝觉得这样不好，于是上帝说：“要有即时通讯”。然后就有了即时通讯软件，上帝和圣母玛丽亚在互联网上视频语音聊天，圣母玛丽亚也觉得互联网很好玩，这是第三天。<br />

网站的数量太多了，也不知道那个网站更好看，上帝觉得这样太杂乱，于是上帝说：“要有导航网站”，然后就有了导航网站，上帝觉得分类目录挺好的，这是第四天。<br />

没想到，网站越来越多，网页也越来越多，找分类目录都找不过来了，上帝觉得比较郁闷，心想找个东西怎么这么难呢？但这难不倒上帝，上帝说：“要有搜 索引擎”，然后就有了搜索引擎，上帝使用搜索引擎，很快的就可以找到自己想要的东西，上帝觉得非常有成就感，这是第五天。<!--more--><br />

在第一天上帝搞互联网的时候，远在天界东边的玉皇大帝就从千里眼和顺风耳那里得到了线报。玉帝有点迷惑，“这哥们搞什么东东呢？”问了所有神仙，大 家都不知道，玉帝觉得这样不行，我们得与时俱进，向西方学习。玉帝说：“要有中国互联网”。于是中国也有了互联网。<br />

第二天，玉帝上互联网，全是英文网站，除了图片以外，什么都看不懂，玉帝很头大。玉帝说：“要有中文网站”。于是中文网站雨后春笋般的出现了。<br />

第三天，玉帝不爽了，为什么？联系不方便啊，还是要叫千里眼和顺风耳，丫的，太麻烦了，可是ICQ、MSN都是英文的啊？玉帝说：“要有中文的及时通讯。”于是有了QQ。玉帝玩上了QQ，跟王母娘娘聊的很开心。<br />

第四天，中文网站也太多了，看的玉帝眼花缭乱，心情也比较烦乱，就问太白金星怎么办。太白金星这个老家伙说：“好，一得给他们分类，二得推荐些好网 站，三得经常有新东西……”玉帝觉得他很罗嗦。玉帝说，你说什么“好一二三”？然后，hao123就解决了玉帝和中国大众上网导航的问题。<br />

第五天，面对几亿的中文网页，虽然有hao123，但要找某些具体的信息实在太难了。玉帝发脾气了：“要找我去年在天庭的新闻发言稿怎么那么难呢？”太白 金星凑过来说，上帝那有个Google，挺不错的，推荐你用用。于是玉帝上Google，一眼看过去，全是英文的，玉帝直接爆炸了，回头把太白金星骂了个 狗血喷头：“你这什么馊主意？让我用他们搞的东西？没听过国货当自强吗？这个玩意我们得自己搞！”玉帝转过身问文曲星该怎么办，文曲星慢条斯里的吟开场 白：“众里寻她千百度，那人却在……”，玉帝说：“千你个头啊，百度！”这一瞬间，百度中文搜索引擎诞生了！<br />

玉帝很 满意百度。在百度，不但可以便捷的找到想要的信息，还可以在百度mp3搜索上找些小曲听听，更可以躲开王母偷偷的在百度图片搜索弄几张嫦娥的写真照片看 看，更绝的，是玉帝在百度贴吧开了个“玉皇大帝”吧来了解天下百姓对自己的歌功颂德——而这些是Google所没有的。时间长了，甚至在众神仙为某个事上 吵个不停的时候，玉帝就会说：“有问题，百度一下！”然后就没问题了。<br />

然而众神仙不明白，为什么玉帝不喜欢同样有中文版的Google，仅仅因为百度更符合中国大众使用习惯吗？后来，玉帝终于自揭谜底：这些洋网站总说用户是上帝，用户是上帝，用户真的是上帝？在中国，用户是玉帝！”大家恍然大悟。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/a-joke-10/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/nagios-sms-alert/">给nagios添加故障时短信通知</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-12-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-12-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>


</div>
    </div>
        nagios可以配置为在故障的时候发送Email，执行什么程序等。光执行程序这项可以实现的功能就太多了，没有做不到只有想不到。说说看我是怎么给nagios添加短信通知的。<br />

首先需要一个能发送短信的东东，有些专门用来发送短信的猫，插上一张sim卡就可以用了，当然也可以找一个手机来做这个事情。然后用gnokii来通过sim卡发送短信，他主要是linux下面用来管理nokia手机的一个软件，当然所有支持AT指令的都可以使用。<br />

debian上面安装好gnokii之后，/etc/gnokiirc是他的配置文件，主要修改两个地方：<br />
model = AT<br />
serial_baudrate = 9600<br />
然后还需要将nagios用户（也就是启动nagios的用户）或者其他需要操作猫的用户加入dialout组，这样才有权限操作/dev/ttyS0这个设备，也就是第一个串口设备。<br />
我的短信猫是通过串口连接到电脑的，如果你的是usb的或者其他类型的方式，比如蓝牙红外什么的，需要加载特定的模块，具体方法参考gnokii的网站。连接短信猫之后，可以用minicom测试一下是不是连接正确，他是类似于win下面的超级终端的一个程序。要注意连接的比特率，如果设备不支持可能不会有效果。设置好之后输入个AT，看是不是返回OK，如果返回那就连接正确了。<br />

然后可以试试看执行gnokii --identify，我这里输出下面的内容：<br />
<pre class="prettyprint lang-bash">
GNOKII Version 0.6.5
IMEI         : 500182395xxxxxx
Manufacturer : WAVECOM MODEM
Model        : MULTIBAND  900E  1800
Revision     : 533b09gg.2C2 1742344 061002 11:23</pre>
这样表示我的猫被正确识别了。如果有问题，可以修改gnokiirc文件，打开debug模式，看看问题所在。发个短信试试看：
<pre class="prettyprint lang-bash">#echo -e "testntest 2">
GNOKII Version 0.6.5
Send succeeded!</pre>
收到短信了么？呵呵。之后修改nagios的misccommands.cfg文件，添加你的cmd：
<pre class="prettyprint lang-bash">
command_name    host-notify-by-sms
command_line    /bin/echo -e "$HOSTADDRESS$($NOTIFICATIONNUMBER$)n$HOSTSTATE$n$OUTPUT$n$SHORTDATETIME$" | /usr/bin/gnokii --sendsms $CONTACTPAGER$ 2>>/dev/null
}

define command{
command_name    notify-by-sms
command_line    /bin/echo -e "$HOSTADDRESS$($NOTIFICATIONNUMBER$)n$SERVICEDESC$-$SERVICESTATE$n$OUTPUT$n$SHORTDATETIME$" | /usr/bin/gnokii --sendsms $CONTACTPAGER$ 2>>/dev/null
}</pre>
然后修改contacts.cfg，设置service_notification_commands、host_notification_commands，并且设置pager为电话号码。cmd里面可以通知的内容参考nagios doc里面的Using Macros In Commands。

可以试试看让一台服务器down了测试一下了。

以前用猫附带的一个软件（或许也可能是我们写的，因为听说附带软件的话比较贵）发送短信，总是会重复发送，有时一条短信会发送好多次。那个软件的原理是这样的，我将需要发送的短信按照一定的格式写入数据库，然后这个软件从数据库读取没发送的进行发送，然后将其修改为已发送。我猜可能重复发送的原因是“修改为已发送 ”这个过程中出问题了，修改了很多次才成功。

现在gnokii还有个问题可能就是读取短信的时候会提示失败，据说是个bug，xh这里有<a title="AT model使用gnokii来收取短消息" href="http://www.grisword.com/tt/Grisword/126">解决办法</a>，有兴趣可以看看，我这里暂时好像还不需要读取短信。

    </div>

<div class="meta">
    
    <span class="comments"><a href="/nagios-sms-alert/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/my-lilina/">咱也玩玩lilina</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-12-01T00:00:00.000&#43;00:00' itemprop="datePublished">2006-12-01</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/gfw">gfw</a>

<a href="/tags/lilina">lilina</a>

<a href="/tags/rss">rss</a>

<a href="/tags/web">web</a>


</div>
    </div>
        好像不知道从什么时候开始流行起了lilina，自己捣鼓捣鼓也装了一个，<a href="http://blog.wdicc.com/lilina/index.html">我的lilina</a>。其实google reader挺好的，不过就是google有时候会被GFW干掉，这样reader也不能访问了。最近这种情况好像还出现很频繁，真是头痛，其实google reader挺好用的，不过现在就试试看lilina了。<br />

今天也看到一些关于干掉GFW的文章<a href="http://yesure.blogspot.com/2006/11/ssh-tunnelfuck-gfw.html">[1]</a><a href="http://blog.cathayan.org/item/1508">[2]</a>，但是需要国外的ssh服务器，偶没有。。不过这个ssh tunnel倒是个不错的东西，比装代理服务器简单，嗯。<br />

用了lilina之后，发现sina的rss好像总是在最前面，而实际上他们更新却是以前的事情了，肯定是他们的rss输出有问题，感觉这样很无耻。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/my-lilina/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/wp-keyword-plugin/">给wp的一个关键字插件做了一下修改</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-11-30T00:00:00.000&#43;00:00' itemprop="datePublished">2006-11-30</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/web">web</a>

<a href="/tags/%E5%85%B3%E9%94%AE%E5%AD%97">关键字</a>

<a href="/tags/%E6%8F%92%E4%BB%B6">插件</a>


</div>
    </div>
        参考<a title="访问插件主页" href="http://adsense-wordpress-plugin.ayanev.com/">AdSense Earnings Reports</a>插件将wp的一个关键字插件<a title="访问插件主页" href="http://blog.tassoman.com/wordpress-plugins/tradedoubler-filter">Trade Doubler Filter</a>修改了一下，之前只能通过修改源代码来添加关键字，现在可以在后台添加了。<br />

附件是修改之后的文件。<br />

http://blog.wdicc.com/wordpress/wp-content/uploads/2006/11/keyword.jpg<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/wp-keyword-plugin/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/lunch-and-supper/">午饭和晚饭</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-11-29T00:00:00.000&#43;00:00' itemprop="datePublished">2006-11-29</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/heart">heart</a>

<a href="/tags/%E5%87%8F%E8%82%A5">减肥</a>

<a href="/tags/%E5%8D%88%E9%A4%90">午餐</a>


</div>
    </div>
        在公司吃了半年多公司饭之后，也装模作样开始带饭了，呵呵。<br />

刚开始来公司的时候，是和其他几个同事一起去附近的饭馆拼桌，要几个炒菜一起吃，然后AA。后来一个比较老的同事离职之后，我和另外一个和我差不多新的同事就没了主意，后来就开始吃大厦的食堂。后来大厦里面的有个广东餐馆竞争，也开始提供自助餐。这样，吃到现在，这些地方都吃腻了。所以开始带饭。<br />

中午吃完满满一盒饭菜，就发现撑的荒，呵呵。 等到下午3，4点的时候，好像还觉得有点饱，这样晚上就完全不用吃饭了。就像今天，估计晚上又省了。。。这样也不错，还有利于减肥。。。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/lunch-and-supper/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/chaffy-dish-weekend/">周末在家吃火锅</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-11-27T00:00:00.000&#43;00:00' itemprop="datePublished">2006-11-27</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/heart">heart</a>

<a href="/tags/%E5%91%A8%E6%9C%AB">周末</a>

<a href="/tags/%E5%91%B7%E5%93%BA">呷哺</a>

<a href="/tags/%E7%81%AB%E9%94%85">火锅</a>


</div>
    </div>
        上个周末过得比较腐败，没有了其它安排，周六下午睡到了9点，起来玩了会游戏，又继续睡，睡的头都晕了……。周日cc的同学过来，考虑到最简单的吃法，就是吃火锅了。<br />

去超市没有买到小肥羊的锅底，用了一个什么重庆的，挺辣的。想起来上次去双安吃的那个重庆火锅了，吃了半天除了辣就没有别的味道了，真是很没意思。不过我们昨天吃的除了辣还有一个味道，就是咸。刚开始吃还不觉得，后来 cc 说了咸之后，大家才醒悟，开始一直注意辣了，没想到这玩意确实挺咸的。后来想想，可能是因为我们锅比较小的缘故吧。<br />

四个人吃，锅底小料加菜总共花了得有100左右，想想看吧， cc 同学走了之后，就发现剩下的东西还够四个人吃两顿的……，真晕。这几天看样子还得吃一个火锅了。<br />

不过这次火锅比较好的结果就是， cc 对这个的味道感觉还行，当然她一如既往吃的是鸡肉，这样的话，就不用老跑去呷哺吃了，在家解决。 :)<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/chaffy-dish-weekend/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/add-some-feature-to-blog/">给blog的后台发文章添了一点功能</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-11-22T00:00:00.000&#43;00:00' itemprop="datePublished">2006-11-22</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/web">web</a>


</div>
    </div>
        给blog加了一个插件 <a href="http://trac.labnotes.org/cgi-bin/trac.cgi/wiki/WPPlugin/AdvancedWysiwyg">Advanced WYSIWYG Editor</a> ，可以打开wp使用的tinymce编辑器的一些功能。例如他网站上面列出来的那些：<br />
<ul><br />
	<li>Format selection: paragraph, formatted, headers, etc.</li><br />
	<li>Underline.</li><br />
	<li>Full justification.</li><br />
	<li>Anchor.</li><br />
	<li>Horizontal line.</li><br />
	<li>Copy, cut, paste.</li><br />
	<li>Insert table.</li><br />
	<li>Subscript, superscript.</li><br />
	<li>Foreground color, background color.</li><br />
	<li>Character map.</li><br />
	<li>Full screen editing.</li><br />
</ul><br />
<!--more-->吸引我的功能是那个insert table。按照其它插件的安装方法，激活之后，再看发表文章的编辑器，发现确实多了很多按钮。不过多了太多了，工具栏一行都显示不下啦，怎么分行呢？wp还是很牛的，好像就已经预料到这种问题了，直接修改<font color="#ff00ff">advanced-wysiwyg.php</font>就可以了。例如我的：<br />
<pre class="prettyprint lang-php">
return array(
"formatselect", "bold", "italic", "underline", "strikethrough", "separator",
"bullist", "numlist", "indent", "outdent", "separator",
"justifyleft", "justifycenter", "justifyright", "justifyfull","separator",
"link", "unlink", "anchor", "image", "hr");
}function extended_editor_mce_buttons_2($buttons) {
// Add buttons on the second toolbar line
//    return $buttons;
return array(
"cut", "copy", "paste", "undo", "redo", "separator",
"sub", "sup", "forecolor", "backcolor", "charmap", "separator",
"code", "fullscreen", "wordpress", "wphelp","separator","tablecontrols");
}</pre>
这样就分两行了，当然还可以编辑<font color="#ff00ff">extended_editor_mce_buttons_3</font>函数让他出来第三行。

好了，看着是不是挺爽的？可是发现我要的insert table功能怎么没出来？再仔细看作者的网页，有个提示”需要去tinymce的网站上面下载关于table等的plugin，默认的wp 2.0版本没有包括这些“。这样去下载了，将其中的plugin里面的东西放出来，找到table和fullscreen文件夹，放到服务器的tinymce的plugin下面，再访问一下发帖页面，是不是发现工具栏都变巨丑的按钮了？呵呵。

用Firefox的话，打开错误控制台，可以看到刚加的tinymce的plugin出错了。提示是：

tinyMCE.addPlugin is not a function

找到plugin里面的js文件看看，和其它比较一下，确实是多了这么一个函数调用。删掉之后工具栏能出来了，可是还是没有这个按钮，是啥问题呢？上作者<a href="http://blog.labnotes.org">blog</a>看了一下，原来是tinymce的版本太高了。
<blockquote>eduo Says: March 19th, 2006 at 5:08 pm

To all having issues with the rich editor disappearing:
Yes, the version of TinyMCE changed. I’ve been checking the versions and it’s possible to download the latest one that works with this plug-in (which in reality just extends the stock WP-included TinyMCE, itself a very good thing) from the “older versions” page of the TinyMCE SF site included as part of the 2.02 files:
<a href="http://sourceforge.net/project/showfiles.php?group_id=103281&package_id=11143">http://sourceforge.net/project/showfiles.php?group_id=103281&package_id=11143</a>0

The page for direct download is: <a href="http://prdownloads.sourceforge.net/tinymce/tinymce_1_45.tgz?download">http://prdownloads.sourceforge.net/tinymce/tinymce_1_45.tgz?download</a>

Using the “table” and “fullscreen” from this file is all that’s needed. Other plug-ins from this same package should work as well.</blockquote>
除了使用上面的版本，还可以使用一个<a href="http://prdownloads.sourceforge.net/tinymce/tinymce_2_0RC4.tgz">2.0 RC4</a>这个版本。
<blockquote>PS: The table controls and full screen editing rely on additional TinyMCE plugins. So if you want these two features as well, you’ll have to download TinyMCE plugins and install those separately. For WordPress 2.0.4 users, try the TinyMCE 2.0 RC4 plugins. Or check the comments to find out what works for other people.</blockquote>
这个版本的table功能更加高级一点，推荐使用这个。

    </div>

<div class="meta">
    
    <span class="comments"><a href="/add-some-feature-to-blog/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/filesystems-comparison/">Filesystems (ext3, reiser, xfs, jfs) comparison on Debian Etch（翻译）</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-11-20T00:00:00.000&#43;00:00' itemprop="datePublished">2006-11-20</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>


</div>
    </div>
        粗略翻译了一下 <a target="_blank" href="http://www.debian-administration.org/articles/388">Filesystems (ext3, reiser, xfs, jfs) comparison on Debian Etch</a> 这篇文章。<br />

有很多的关于linux文件系统比较的文章，但是他们大部分都是anecdotal的，都是基于人为的一些任务或者都是在老的内核下面完成的。这篇评论是基于11项真实存在于一台硬件比较老（奔腾 II/III ，EIDE硬盘）的文件服务器上的任务。<br />

<strong>为什么会有另外一个测试？</strong><br />

我发现两个quantitative和reproductible（可重现的？）的测试，在使用2.6.x内核的时候（参见参考文章）。Benoit（2003)在一台有512M内存的奔腾II 500的服务器上使用大文件（超过1GB）进行了12次测试。这些测试非常有用，但是结果已经太老了（2.6.0内核），并且他们都是应用于操作专有大文件的（比如多媒体、科学、数据库）。<br />

Piszcz（2006)进行了21项测试，在一台有768M内存，400G EIDE133硬盘的奔腾III 500的机器上模拟了一个变化的文件操作。到目前为止，这些测试似乎是在2.6内核上面最全面的了。然而，因为很多测试都是“人为”的（例如，复制和删除10000空的目录，创建10000文件，递归的分割文件），所以这些或许很难为现实世界带来什么结论。<br />

所以，这个测试的目标就是完成Piszcz（2006)的一些结论，通过在小型商务文件系统服务器（参考测试描述）上面的实际操作。<br />

<!--more--><strong>测试设置</strong><br />

* 处理器 : Intel Celeron 533<br />
* 内存 : 512MB RAM PC100<br />
* 主板 : ASUS P2B<br />
* 硬盘 : WD Caviar SE 160GB (EIDE 100, 7200 RPM, 8MB Cache)<br />
* 控制器 : ATA/133 PCI (Silicon Image)<br />

* 操作系统 Debian Etch (kernel 2.6.15), distribution upgraded on April 18, 2006<br />
* 其它不需要的服务都关掉了 (cron,ssh,saMBa,etc.)<br />

* 文件系统 Ext3 (e2fsprogs 1.38)<br />
* ReiserFS (reiserfsprogs 1.3.6.19)<br />
* JFS (jfsutils 1.1.8)<br />
* XFS (xfsprogs 2.7.14)<br />

<strong>对于选择的测试的描述</strong><br />

<strong><em>操作大文件（ISO文件，700M）</em></strong><br />
* 将ISO文件从第二块硬盘复制到测试硬盘上面。<br />
* 在测试硬盘上面重新复制ISO文件。<br />
* 删除两个复制的ISO。<br />

<strong><em>操作一个目录树（7500个文件，900个目录，1.9G）</em></strong><br />
* 将目录树从第二块硬盘复制到测试硬盘上面。<br />
* 在测试硬盘上面重新复制目录树。<br />
* 删除两个复制的目录树。<br />

<strong><em> 在目录树中操作</em></strong><br />
* 用递归方式列出目录树中的所有内容，并且保存到测试硬盘上面。<br />
* 在目录树中查找匹配指定通配符的文件。<br />

<em><strong>关于文件系统的操作</strong></em><br />
* 创建文件系统(mkfs)(所有文件系统都使用默认设置创建)。<br />
* 挂载文件系统。<br />
* 卸载文件系统。<br />

11项测试（从创建文件系统到卸载文件系统）的顺序是按照一个Bash脚本来运行的，总共运行三次（会报告平均时间）。每个序列大概需要7分钟。完成测试的时间，cpu占用百分比等都是通过GNU time utility（1.7版本）来计算的。<br />

<strong>测试结果</strong><br />

<strong><em>分区容量</em></strong><br />
初始的（在创建文件系统之后）和剩余的（在删除所有文件之后）分区容量是使用可使用的blocks除以整个分区的blocks计算出来的。EXT3的初始分区容量最差，其它的都几乎可以使用最大的分区容量。有趣的是，Ext3和ReiserFS剩余分区容量和初始分区容量是一样的，JFS、XFS损失了0.02%的分区容量，(建议这些文件系统可以动态增长，但是不要在删除文件之后完全恢复他们的初始状态（和大小）。)<br />
<table width="234" border="0" style="height: 118px"><br />
<tr><br />
<td>&nbsp;</td><br />
<td>初始分区容量</td><br />
<td>损失</td><br />
</tr><br />
<tr><br />
<td>Ext3</td><br />
<td>92.77%</td><br />
<td>0</td><br />
</tr><br />
<tr><br />
<td>ReiserFS</td><br />
<td>99.83%</td><br />
<td>0</td><br />
</tr><br />
<tr><br />
<td>JFS</td><br />
<td>99.82%</td><br />
<td>0.02%</td><br />
</tr><br />
<tr><br />
<td>XFS</td><br />
<td><font color="#990000">99.95%</font></td><br />
<td>0.02%</td><br />
</tr><br />
</table><br />
结论：想要使用分区的最大容量，请选择ReiserFS、JFS、XFS。<br />

<strong><em>文件系统的创建，挂载和卸载</em></strong><br />

为20G的分区创建文件系统。<br />
<table width="553" border="0" style="height: 122px"><br />
<tr><br />
<td>&nbsp;</td><br />
<td>创建时间</td><br />
<td>挂载时间</td><br />
<td>卸载时间</td><br />
<td>创建时CPU占用</td><br />
<td>挂载时CPU占用</td><br />
<td>卸载时CPU占用</td><br />
</tr><br />
<tr><br />
<td>Ext3</td><br />
<td><font color="#990000">14.7s</font></td><br />
<td>0.2s</td><br />
<td>0.2s</td><br />
<td>|</td><br />
<td>6-9%</td><br />
<td>37%</td><br />
</tr><br />
<tr><br />
<td>ReiserFS</td><br />
<td>2.2s</td><br />
<td><font color="#990000">2.3s</font></td><br />
<td>0.4s</td><br />
<td>59%(Lo)</td><br />
<td>|</td><br />
<td>14%</td><br />
</tr><br />
<tr><br />
<td>JFS</td><br />
<td>1.3s</td><br />
<td>0.2s</td><br />
<td>0.2s</td><br />
<td>74%(Hi)</td><br />
<td>|</td><br />
<td>27%</td><br />
</tr><br />
<tr><br />
<td>XFS</td><br />
<td>0.7s</td><br />
<td>0.5s</td><br />
<td><font color="#990000">0.5s</font></td><br />
<td>|</td><br />
<td>|</td><br />
<td>45%</td><br />
</tr><br />
</table><br />
结论：为了快速创建、挂载和卸载文件系统，请使用JFS或者XFS。<br />

<strong><em>操作大文件（ISO文件，700M）</em></strong><br />
<table width="599" border="0" style="height: 118px"><br />
<tr><br />
<td></td><br />
<td>第一次复制</td><br />
<td>第二次复制</td><br />
<td>删除文件</td><br />
<td>第一次复制CPU占用</td><br />
<td>第二次复制CPU占用</td><br />
<td>删除时CPU占用</td><br />
<td>minor page faults</td><br />
</tr><br />
<tr><br />
<td>Ext3</td><br />
<td>38.2s</td><br />
<td>37.3s</td><br />
<td>2.5s</td><br />
<td>46-51%</td><br />
<td>38-50%</td><br />
<td>10%</td><br />
<td>|</td><br />
</tr><br />
<tr><br />
<td>ReiserFS</td><br />
<td>41.8s</td><br />
<td>43.9s</td><br />
<td>1.5s</td><br />
<td>|</td><br />
<td>|</td><br />
<td>49%</td><br />
<td>661</td><br />
</tr><br />
<tr><br />
<td>JFS</td><br />
<td>35.1s</td><br />
<td>39.4s</td><br />
<td>0.02s</td><br />
<td>|</td><br />
<td>|</td><br />
<td>10%</td><br />
<td>|</td><br />
</tr><br />
<tr><br />
<td>XFS</td><br />
<td>34.8s</td><br />
<td>33.1s</td><br />
<td>0.02s</td><br />
<td>|</td><br />
<td>|</td><br />
<td>10%</td><br />
<td>600</td><br />
</tr><br />
</table><br />
结论：为了快速操作大文件，请使用JFS或者XFS。如果你需要最小的cpu占用，请使用JFS。<br />

<strong><em>操作目录树（7500个文件，900个目录，1.9G）</em></strong><br />
<table width="607" border="0" style="height: 124px"><br />
<tr><br />
<td></td><br />
<td>第一次复制</td><br />
<td>第二次复制</td><br />
<td>删除</td><br />
<td>第一次复制CPU占用</td><br />
<td>第二次复制CPU占用</td><br />
<td>删除时CPU占用</td><br />
<td>minor page faults</td><br />
</tr><br />
<tr><br />
<td>Ext3</td><br />
<td>158.3s</td><br />
<td>120s</td><br />
<td>22s</td><br />
<td>27-36%</td><br />
<td>|</td><br />
<td>15%</td><br />
<td>14000-1490</td><br />
</tr><br />
<tr><br />
<td>ReiserFS</td><br />
<td>172.1s</td><br />
<td>136.9s</td><br />
<td>8.2s</td><br />
<td>|</td><br />
<td>45%(Hi)</td><br />
<td>86%</td><br />
<td>5843</td><br />
</tr><br />
<tr><br />
<td>JFS</td><br />
<td>180.1s</td><br />
<td>151s</td><br />
<td>12.5s</td><br />
<td>|</td><br />
<td>29%(Lo)</td><br />
<td>15%</td><br />
<td>14000-1490</td><br />
</tr><br />
<tr><br />
<td>XFS</td><br />
<td>166.1s</td><br />
<td>135.2s</td><br />
<td>10.5s</td><br />
<td>|</td><br />
<td>|</td><br />
<td>65%</td><br />
<td>14000-1490</td><br />
</tr><br />
</table><br />
结论：为了快速操作大文件树，请选择Ext3或者XFS。其它作者的测试中显示，ReiserFS对于大量的小文件有优势。然而结果显示，操作包含上千的大小变化的文件（10K到5M）时建议使用Ext3或者XFS，他们或许更适合实际使用。JFS有最下的CPU占用，但是需要指出的是在操作大量文件的时候他也有值得注意的较高的延迟。<br />

<strong><em>在之前的目录树中列表目录和文件查找</em></strong><br />
<table width="564" border="0" style="height: 107px"><br />
<tr><br />
<td></td><br />
<td>列表目录</td><br />
<td>文件查找</td><br />
<td>列表目录CPU占用</td><br />
<td>文件查找CPU占用</td><br />
<td>minor page faults</td><br />
</tr><br />
<tr><br />
<td>Ext3</td><br />
<td>2.5s</td><br />
<td>4.6s</td><br />
<td>35%</td><br />
<td>6%</td><br />
<td>704-712</td><br />
</tr><br />
<tr><br />
<td>ReiserFS</td><br />
<td>1.4s</td><br />
<td>0.8s</td><br />
<td>71%</td><br />
<td>36%</td><br />
<td>1991</td><br />
</tr><br />
<tr><br />
<td>JFS</td><br />
<td>3.1s</td><br />
<td>5.0s</td><br />
<td>35%</td><br />
<td>6%</td><br />
<td>704-712</td><br />
</tr><br />
<tr><br />
<td>XFS</td><br />
<td>1.8s</td><br />
<td>2.8s</td><br />
<td>70%</td><br />
<td>10%</td><br />
<td>704-712</td><br />
</tr><br />
</table><br />
结论：根据这些测试，ReiserFS和XFS操作速度快，但是有比较多的CPU占用，Ext3和JFS操作速度慢，但是有较少的CPU占用。XFS似乎是最好的选择，他有相对比较快的查找速度，中等的cpu占用，以及可以接受的page faults比率。<br />

<strong>综合结论</strong><br />

这些结果重现了Piszcz(2006)关于Ext3是最少的可用分区容量的系统，ReiserFS是最长挂载时间的系统，Ext3创建时间最长的系统。此外，和这份报告中的内容一样，都发现JFS是CPU占用最少的系统。最后，这份报告是第一个显示ReiserFS在通常的文件操作中有较高的page faults。<br />

认识到各个文件系统的优缺点之后，每个 分区/磁盘 只可以安装一个文件系统。基于上面的测试，XFS似乎是最适合于家用文件服务器或者小型商务服务器使用：<br />

* 他可以最大限度的使用你的硬盘。<br />
* 他是创建、挂载、卸载速度最快的文件系统。<br />
* 他是操作大文件（>500M）速度最快的文件系统。<br />
* 他对于大量的中小文件和目录的操作是第二快的。<br />
* 在大的目录树列表和查找操作中，他在操作时间和CPU占用间找到了很好的平衡。<br />
* 他不是占用资源最少的文件系统，但是他在比较老的硬件上面的资源占用还可以接受。<br />

Piszcz(2006)没有明确的推荐XFS，他总结说“个人认为，我会因为性能和可靠性而选择XFS”。我支持他的结论。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/filesystems-comparison/#disqus_thread">Comments</a></span>
    
</div>
</article>



  <nav id="pagenavi">
    
        <a href="/page/27/" class="prev">Prev</a>
    
    
        <a href="/page/29/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2017
    
    wd
    . Powered by <a href="http://gohugo.io" target="_blank">Hugo</a> |
    Theme is <a href="https://github.com/wd/hugo-fabric">hugo-fabric</a>, fork from <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a> by <a href="https://wdicc.com">me</a>
</div>

    </footer>
    <script src="/js/fabric.js"></script>


</div>
</div>
<script src="/js/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
 
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery);
 
</script>
</body>
</html>
