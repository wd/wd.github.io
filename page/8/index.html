<!DOCTYPE HTML>
<html>
<head>
	<meta name="generator" content="Hugo 0.19" />
	<meta charset="utf-8">
    
    
    <title>wd and cc</title>
    <meta name="author" content="wd">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://wdicc.com/index.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    

    <script type="text/javascript" src="/js/jquery-tapir.js"></script>

    

    <link rel="stylesheet" href="/css/hljs.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<body>
    <div id="wrapper">
        <header id="header" class="inner">
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>

<span class="subtitle">happy every day</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
    
    
    <li>
    <a href="https://github.com/wd" class="github" title="Github"></a>
    </li>
    
    
    
    
    
    <li>
    <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
    </li>
    
    
    
    
    
</ul>


<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://wdicc.com/" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
</ul>

</header>

<div id="toload">

    <div id="content" class="inner">
        




    
    <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    




  <article class="post">
    <h2 class="title"> 
        <a href="/signal-in-perl/">perl 里面的信号处理</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2011-01-01T00:00:00.000&#43;00:00' itemprop="datePublished">2011-01-01</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/linux">linux</a>

<a href="/tags/perl">perl</a>


</div>
    </div>
        perl 里面的信号处理很简单，就是给 %SIG 这个 hash 赋值就好了。前几天遇到个问题，处理 SIG{CHLD} 的时候，我本来只起一个 child 进程，可是发现这个信号会被触发多次，开始弄不明白，后来偶然想到是不是 system，exec 之类的函数弄出来的，搜了下果然。<br />

perl 里面调用外部命令是会 fork 一个子进程的，所以也会触发那个信号，想避免可以设置局部变量，例如<br />
<pre class="prettyprint">
$SIG{CHLD} = sub {
    print "main\n";
};

.....
{
    local $SIG{CHLD} = undef; # 注意调用外部命令的时候，如果 IGNORE 就捕捉不了结果了
    `mv xxx yyy`;
    system(xxxxx);
}

.....
</pre><br />

使用 {} 来构造局部变量的方法有时候会让问题变的非常简单。<br />

另外，信号触发的时候，会把 sleep 中断，这个在 sleep 的 doc 里面说的很明白。如果还是想 sleep 到足够的时间，可以用下面的方法。<br />
<pre class="prettyprint">
my $timeLeft = 10;
while ( 1 ) {
    last if $timeLeft <= 0;
    my $actTime = sleep($timeLeft);
    $timeLeft = $timeLeft - $actTime;
}
</pre><br />

越来越感觉写 perl 还是很给力的，很多的奇技淫巧，不过我现在也是属于没弄明白多少，瞎写。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/signal-in-perl/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/oracle-install-guide/">又安装了一次 oracle</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-11-05T00:00:00.000&#43;00:00' itemprop="datePublished">2010-11-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/linux">linux</a>

<a href="/tags/oracle">oracle</a>


</div>
    </div>
        好久没有弄 oracle 了，今天有机会又折腾了一天 oracle 的安装，本来觉得是挺简单的事情，没想到也折腾了挺长时间的，我觉得可能主要是因为使用的系统比较新，而 oracle 是 10g 有比较老的缘故。<br />

1 配置 x11forward<br />
我这安装了 xauth 和 libXtst，然后使用 ssh -Y user@host 连接的。使用 -X 好像从来没成功过，也不知道怎么回事，懒得研究了。<br />

2 运行安装程序<br />
解压什么的就没什么好说的了，主要是运行的时候他会检测是不是他支持的发行版，可以使用 -ignoreSysPrereqs，跳过系统检测。<br />

然后其他正常，就是到最后运行 dbca 的时候，会 hung 卡在那，等多久都完成不了。这一步做的操作是会给你 create database，建 init 文件等，没这个的话 oracle 是不可用的。如果你知道手动操作这些后续步骤也可以不理会这个。<br />

dbca 卡住后，可以点那个取消，然后再开一个 term， ps 找到 dbca 然后 kill 掉，前面那个界面应该就会有反应了，就可以继续往下走了。到最后 exit 了事。<br />

然后就是单独启动 dbca 来完成后面的工作。执行 dbca 命令（需要你提前配置好 path），会启动一个窗口，要注意的是，在这时候能看到一个关于字体的错误，据说这个错误就是上面 huang 住的原因，如果看到了这个错误，那么 dbca 的最后一步可能是会执行不了的。。。<br />

我尝试了 n 种方法解决这个问题，发现最简单的是装一个 jdk 1.6 然后把 java 命令链接覆盖 oracle 安装的那个 jdk 1.4 的 $ORACLE_HOME/jdk/jre/bin/java 命令。等于就是说使用 1.6 的 java 来启动 dbca。如果这么做还不行，那可能需要装一些字体相关的东西，比如 xorg-x11-fonts-truetype。如果还不行那就不知道怎么弄了。<br />

dbca 启动后，还遇到了 ora-27102 out of memery 和 ora-01034 oracle not aviliable。后面这个是在遇到前面那个的时候点 ignore 出来的。主要是前面那个。前面那个是因为 kernel 参数关于内存的配置配置的有问题，最大共享内存太大导致的。如果遇到这个问题就去改那些参数吧。<br />


dbca 配置好后，oracle 应该就启动了。你可以连上去看看了。<br />

3 导入导出<br />
导出使用 exp，导入 imp，一般不需要加什么参数。据说加那个 full=y 后，导入的时候会建立用户，不用你操心。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/oracle-install-guide/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/autossh-and-auto-enter-password/">自动连接 ssh 并输入密码</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-10-13T00:00:00.000&#43;00:00' itemprop="datePublished">2010-10-13</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/expect">expect</a>

<a href="/tags/linux">linux</a>

<a href="/tags/ssh">ssh</a>


</div>
    </div>
        这年头不翻墙就看不到真像了，前几天整了个 ssh 代理，就研究了下自动登录。<br />

ssh 自动登录首选就是使用 key 了，可对方不干，那就只能使用密码了。自动输入密码可以用 expect。查这个的时候发现了一个 expect-lite，发现也挺有意思的，他把写 expect 脚本简单化了，比如想 send xxx，那就用 >xxxx 就行了，想 expect yyy 那就 <yyy 就好了，等等这些，呵呵。不过我后来没用这个，还是用的标准的 expect，代码如下。<br />

<pre class="prettyprint lang-expect">
spawn autossh -M 20000 -p SSH_PORT -N -D 7070 YOUR_NAME@YOUR_SERVER
set timeout 60
expect {
     assword: {
         stty -echo
         send "YOUR_PASS\r"
         stty echo
         #exp_continue
     }
    incorrect {
         send_user "invalid password or account\n"
         exit
     }
    timeout {
         send_user "connection to host timed out\n"
         exit
     }
    eof {
         send_user "connection to host failed\n"
         exit
     }
}
if {[fork]!=0} exit
disconnect
</pre><br />

那里面那个 autossh 能自动给你重连，没仔细研究。那个 20000 后面的参数都是给 ssh 的，具体含意可以看 ssh 的 man。<br />

最主要是最后那两行，能做到连接上之后主程序就退出了，不占用你的终端，而不影响 ssh 的连接。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/autossh-and-auto-enter-password/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/some-font-configuration-for-chrome/">chrome 的几个字体配置</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-10-01T00:00:00.000&#43;00:00' itemprop="datePublished">2010-10-01</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/chrome">chrome</a>

<a href="/tags/linux">linux</a>


</div>
    </div>
        随着各种 ext 的开发，chrome 目前的可用性已经很高了。阻碍我使用的最大一个问题，主要是字体。在 firefox 里面我喜欢自己配置中文英文字体。英文喜欢使用等宽，比如 consolas，Monaco, dejavu sans mono 之类。比较喜欢 monaco，可是目前能下载到的字体好像有点问题，有些字号没有。<br />

前几天看到 ghost 在 twitter 上说到 chrome，就又动了试试看的念头。后来总算整好了。<br />

chrome 本身自己有个字体设置的地方，在 tools -> options -> Under the Hood 里面，可以设置字体，在这里设置的字体感觉好像比平时理解的要小一点。比如我设置的 15 号才感觉好像看着舒服了点。另外，我这里设置的是英文，中文会根据 fontconfig 配置的来显示，我使用的是 WenQuanYi Zen Hei。<br />

这么设置之后，在很多页面应该已经可以了。不过可能你在 google 的页面里面，还有 extension 的页面里面，还是会看到讨厌的字体。这是因为在设置了使用 css 使用的字体后，chrome 好像会优先使用 css 的设置。google 的页面和 extension 的页面使用的是 Arial 字体。在 term 使用 fc-match arial 可以看到实际使用的字体。<br />

那么修改一下 fontconfig 的配置，设置一下字体替换，比如我这个。<br />
<pre class="prettyprint">
<match target="pattern">
     <test qual="any" name="family"><string>Liberation Sans</string></test>
     <edit name="family" mode="assign"><string>DejaVu Sans Mono</string></edit>
 </match>
 </pre>

 再启动 chrome 应该就能看到效果了。:)

 此后还有个问题，那就是 chrome 界面上面没有最小字体的设置，然后很多 n 小的文字，让人讨厌。通过 google 找到了一个<a href='http://wange.im/minimum-font-size-for-chrome-is-12px.html'>解决办法</a>，我把他贴这里。
 <pre lang='txt'>
 到chrome安装目录下的User Data\Default文件夹；
用记事本打开Preferences，找到：
"webkit": {
"webprefs": {
"default_fixed_font_size": 13,
"default_font_size": 16,
}
在｝里面加上：
"minimum_font_size": 1,
"minimum_logical_font_size": 1
 </pre>

 现在看，我的 chrome 就好多了，呵呵。效果可以看看这里 http://www.webpagescreenshot.info/img/420779-9292010114845AM .

    </div>

<div class="meta">
    
    <span class="comments"><a href="/some-font-configuration-for-chrome/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/rectangles-in-emacs/">emacs 的列编辑</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-08-29T00:00:00.000&#43;00:00' itemprop="datePublished">2010-08-29</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/emacs">emacs</a>

<a href="/tags/linux">linux</a>


</div>
    </div>
        列编辑我觉得是一个编辑器不能缺少的东西。在 vim 里面使用 C-v 就能进入列编辑，然后我通常用到的，也就是 d (删除) 和 I (插入)。在 emacs 里面一直没怎么用上这个，总感觉是操作很麻烦。最近操作了几次，发现也没那么难，呵呵。<br />

emacs manual 里面关于列编辑的<a href='http://www.gnu.org/software/emacs/manual/html_node/emacs/Rectangles.html'>页面</a>。emacs 里面那个默认的列编辑不会出来像 vim 里面那样的矩形选区（不过有别的方法好像可以做到），所以当你选择的时候，还是按行来选择的，你只需要关心选择的起始点和结束点之间的那个矩形就好了，你的操作只会在里面起作用。<br />

对应到 vim 的 d，emacs 里面的应该是 C-x r d 或 C-x r k 了吧，对应到 I，应该是 C-x r t string <RET> 了吧，不过 emacs 里面这个是替换选择的东西为 string，你要是选个空的，应该就算是插入了吧。还有个 C-x r y 复制，我觉得会这几个应该就基本可以了吧。。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/rectangles-in-emacs/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/use-org-mode-as-a-job-tracker/">使用 org-mode 来做自己的 job tracker</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-07-23T00:00:00.000&#43;00:00' itemprop="datePublished">2010-07-23</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/job">job</a>

<a href="/tags/linux">linux</a>

<a href="/tags/org-mode">org-mode</a>

<a href="/tags/todo">todo</a>


</div>
    </div>
        用 emacs 的应该都知道 org-mode 这个大杀器，一直以来都想在工作里面用上他，可总是习惯不了。<br />

这几天尝试把 org-mode 打造成了我的一个 job tracker，用来记录自己的 todo 和完成情况。<br />

<pre class="prettyprint lang-lisp">
;;
;; org-mode
;;

;; (setq org-agenda-files '("~/org"))
(setq org-agenda-files (file-expand-wildcards "~/org/*.org"))  ;; 把 ~/org/*.org 都加入到 agenda 里面，使用 C-c a a 看 agenda 的时候，会从这些文件里面读
(add-to-list 'auto-mode-alist '("\\.org$" . org-mode))
(define-key global-map "\C-cl" 'org-store-link)
(define-key global-map "\C-ca" 'org-agenda)
(setq org-log-done t) ;; 变到 done 状态的时候，记录一下时间

(add-hook 'org-mode-hook
          (lambda ()
            (org-set-local 'yas/trigger-key [tab])
            (define-key yas/keymap [tab] 'yas/next-field-group)))

(setq org-todo-keywords
      '((sequence "TODO(t)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELED(c@)")))  ;; 设置一下 todo 的关键字，| 左边的是未完成状态，右边是 done 的状态


(setq org-default-notes-file "~/org/todo.org") ;; 设置 remember 的默认文件 

;;;  Load Org Remember Stuff
(require 'remember)
(org-remember-insinuate)

;; Start clock in a remember buffer and switch back to previous clocking task on save
;; (add-hook 'remember-mode-hook 'org-clock-in 'append)
;; (add-hook 'org-remember-before-finalize-hook 'bh/clock-in-interrupted-task)

;; I use C-M-r to start org-remember
(global-set-key (kbd "C-c m r") 'org-remember)
;; (define-key global-map "\C-cr" 'org-remember)

;; Keep clocks running
(setq org-remember-clock-out-on-exit nil)

;; C-c C-c stores the note immediately
(setq org-remember-store-without-prompt t)

;; I don't use this -- but set it in case I forget to specify a location in a future template
(setq org-remember-default-headline "Tasks") ;; 设置默认 remember 添加的 headline

;; 3 remember templates for TODO tasks, Notes, and Phone calls
(setq org-remember-templates (quote (("todo" ?t "** TODO %?\nCREATED: %U" nil nil nil)
                                     ;; ("note" ?n "* %?                                                                            :NOTE:\n  %U\n  %a\n  :CLOCK:\n  :END:" nil bottom nil)
                                     ;; ("appointment" ?a "* %?\n  %U" "~/git/org/todo.org" "Appointments" nil)
                                     ;; ("org-protocol" ?w "* TODO Review %c%!\n  %U" nil bottom nil))))
                                     ))) ;;设置 todo 的模板，里面第三个参数是模板，里面的变量的意思 google 下


</pre><br />

在 todo.org 里面有两个 headline，一个是 * Tasks ，一个是 * Done。<br />

配置好后，在任意的 buffer 按 C-c m r 就可以打开个 buffer，输入 todo 信息，然后按 C-c C-c 就可以把 todo 添加到 todo.org 里面去了，会添加到 * Tasks 这个 headline 下面。<br />

完成一个任务的时候，在那上面按 C-c C-t 然后选择 done 就可以设置完成。手动（还不会自动。。。）把完成的任务挪到 Done 里面。<br />

如果想看看有完成情况的统计，可以在 agenda 里面看，C-c a a，然后按 v，选择不同的模式看。每周的工作情况在那里面一目了然，呵呵。<br />

<pre class="prettyprint">
Week-agenda (W29):
Monday     19 July 2010 W29
Tuesday    20 July 2010
Wednesday  21 July 2010
  todo:       17:33...... [ TODO 多看看 org-mode 的 agenda
Thursday   22 July 2010
  todo:       15:18...... Closed:     DONE a test
  todo:       15:18...... [ DONE a test
Friday     23 July 2010
  todo:       14:50...... [ TODO 梳理一下
  todo:       17:08...... [ TODO 了解下
  todo:       22:49...... [ TODO 申请
Saturday   24 July 2010
Sunday     25 July 2010
</pre><br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/use-org-mode-as-a-job-tracker/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/lang-settings-when-use-grep-or-sort/">使用 grep sort 等工具的时候要注意 LANG 的设置</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-07-12T00:00:00.000&#43;00:00' itemprop="datePublished">2010-07-12</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/grep">grep</a>

<a href="/tags/linux">linux</a>

<a href="/tags/sort">sort</a>


</div>
    </div>
        发现在使用 sort 或 grep 等工具的时候，LANG 会影响到速度。<br />

1.5G 的文件，grep -Ei 'keyword' file, LANG=C 的时候执行时间是 22 秒，LANG=en_US.UTF-8 的时候，执行时间是 3分53秒，最后结果是一样的。<br />

这还不是最恐怖的，恐怖的是下面的<br />
<pre class="prettyprint lang-text">
$ cat a
a
b
C
d
E

$ LANG=en_US.UTF-8 egrep '[a-z]' a
a
b
C
d
E

$ LANG=C egrep '[a-z]' a
a
b
d
</pre><br />

以后用这些工具还是小心一点吧。。。。。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/lang-settings-when-use-grep-or-sort/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/sendmail-pm/">无聊又写一个用来发邮件的 pm..</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-07-09T00:00:00.000&#43;00:00' itemprop="datePublished">2010-07-09</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/linux">linux</a>

<a href="/tags/perl">perl</a>

<a href="/tags/sendmail">sendmail</a>


</div>
    </div>
        继使用 perl 发<a href='http://wdicc.com/sendmail-use-perl/'>中文标题邮件</a>，和<a href='http://wdicc.com/sned-mail-with-attachment/'>中文附件邮件</a>后，又把他们整合了一下写了一个 pm 干这个事。<br />

其实发带附件的邮件应该是有现成的 pm 干这个事的，比如 MIME::Lite 之类，没特殊需求还是用那个吧，这个纯属无聊写的。<br />

文件前面有使用方法。。<br />

<pre class="prettyprint">
package SendMail;

use strict;
use warnings;
use Data::Dumper;
use Encode;
use MIME::Base64;

=head1 Examples
use SendMail;

my $sm = SendMail->new( {
    To => 'you@foo.com, other@bar.com',
    Subject => 'just a test 中文',
    });

-- or --

my $sm = SendMail->new( {
    From => 'me@abc.com',
    To => 'you@foo.com, other@bar.com',
    Subject => 'just a test 中文',
    } );

-- or --

my $sm = SendMail->new( {
    From => 'me@abc.com',
    To => 'you@foo.com, other@bar.com',
    Cc => 'cc@foobar.com',
    Subject => 'just a test 中文',
    } );


$sm->attach( {
    Type => "text/plain",
    Data => "只是一个测试..a test"
    });

$sm->attach( {
    Type => 'application/octet-stream',
    Filename => 'test 中文.txt',
    Data => "只是一个 test ..."
    });

$sm->test;

-- or --

$sm->send;

=cut



use vars qw($VERSION);
$VERSION = '0.01';

our $boundary = "FFFFFFFFKKKKKK";
our $from = 'no-reply@abc.com';
our $subject = "No subject";

our $to;
our $cc;
our @body;


sub new {
    my $package = shift;
    my $info = shift;

    $subject = $info->{Subject} || $subject;
    $subject = encode('MIME-B', decode('utf8', $subject));
    $from = $info->{From} || $from;
    $to = $info->{To} || die "Need to set MailTo 'To'!";
    $cc = $info->{Cc} || "";

    push @body, "MIME-Version: 1.0";
    push @body, "Content-Type: multipart/mixed; boundary=\"$boundary\"";
    push @body, "";

    return bless( {}, $package);
}

sub attach {
    my $self = shift;
    my $f_hash = shift;

    die "Need data when attach!" if ( not defined $f_hash->{Data} );

    my $type = "text/plain";
    $type = $f_hash->{Type} if defined $f_hash->{Type};

    my @t;
    push @t, "--$boundary";
    if ( $type eq "text/plain" ) {
        push @t, "Content-Type: $type; charset=utf-8";
    } else {
        my $filename = "file1.txt";
        $filename = encode('MIME-B', decode('utf8', $f_hash->{Filename})) if defined $f_hash->{Filename};
        push @t, "Content-Type: $type";
        push @t, "Content-Disposition: attachment; filename=$filename";
    }
    push @t, "Content-Transfer-Encoding: base64";
    push @t, "";
    push @t, encode_base64($f_hash->{Data});

    push @body, @t;
}

sub send {
    my $self = shift;

    open(my $fh, '|/usr/sbin/sendmail -t');
    $self->print_to($fh);
    close($fh);
}

sub print_to {
    my $self = shift;
    my $fh = shift;

    push @body, "--$boundary--";

    print $fh "From: $from\r\n";
    print $fh "To: $to\r\n";
    print $fh "Cc: $cc\r\n" if $cc;
    print $fh "Subject: $subject\r\n";

    for ( @body ) {
        print $fh "$_\r\n";
    }
}

sub test {
    my $self = shift;

    open ( my $fh, '>-');
    $self->print_to($fh);
    close($fh);
}

1;
</pre><br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/sendmail-pm/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/sned-mail-with-attachment/">使用 perl 发带附件的邮件</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-07-05T00:00:00.000&#43;00:00' itemprop="datePublished">2010-07-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/linux">linux</a>

<a href="/tags/perl">perl</a>

<a href="/tags/sendmail">sendmail</a>


</div>
    </div>
        继 <a href="http://wdicc.com/sendmail-use-perl/">上篇</a> 使用 perl 发带中文标题的邮件后，又研究了下发带附件的。<br />

基本差别不大，主要是那个 Content-type 要变一下。那个 boundary 可以自己随便写，和后面的统一就行了。<br />

<pre class="prettyprint lang-perl">
my $title = encode_base64("标题", "");
my $body = encode_base64("邮件正文");
my $attach = encode_base64("附件内容");
my $filename = encode('MIME-B', decode('utf8', "文件中文.txt"))

open(MAIL, '|/usr/sbin/sendmail -t');
 
print MAIL "From: test\@abs.com\r\n";
print MAIL "To: test\@abs.com\r\n";
print MAIL "Subject: =?UTF-8?B?$title?=\r\n";
print MAIL "MIME-Version: 1.0\r\n";
# print MAIL "Content-type: text/plain; charset=utf-8\r\n";
print MAIL <<EOF;
Content-Type: multipart/mixed; boundary=\"FFFFFFFFKKKKKK\"

--FFFFFFFFKKKKKK
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: base64

$body
--FFFFFFFFKKKKKK
Content-Type: application/octet-stream
Content-Disposition: attachment; filename=$filename.csv
Content-Transfer-Encoding: base64

$attach
--FFFFFFFFKKKKKK--
EOF
    close(MAIL); 

</pre><br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/sned-mail-with-attachment/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/sendmail-use-perl/">使用 perl 发送中文邮件标题乱码</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2010-06-30T00:00:00.000&#43;00:00' itemprop="datePublished">2010-06-30</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/linux">linux</a>

<a href="/tags/perl">perl</a>

<a href="/tags/sendmail">sendmail</a>


</div>
    </div>
        代码如下面，解决乱码的方法是使用 base64 编码。<br />

<pre class="prettyprint lang-perl">
use MIME::Base64::Perl;

open(MAIL, '|/usr/sbin/sendmail -t');

my $recver = 'wangdong@abc.com';
my $alertTitle = "中文 asdfsdf sdfsdf sdf sdf s df sd fsd f sd fsd f sdf sdf sdf";
my $alertText = "body ";

my $encoded = encode_base64($alertTitle, "");

print MAIL "From: alert\@abc.com\r\n";
print MAIL "To: $recver\r\n";
print MAIL "Subject: =?UTF-8?B?" . $encoded . "?=\r\n";
print MAIL "MIME-Version: 1.0\r\n";
print MAIL "Content-type: text/plain; charset=utf-8\r\n";
print MAIL "\n";
print MAIL "$alertText";

close(MAIL);
</pre><br />

这里面 encode_base64 可以把文本做 base64 编码，要注意的是这个方法的第二个参数，是用来把编码结果进行格式化的，会每 76 个字符插入一个这个参数，默认是换行。<br />

如果不是 utf8 的文本，那把里面的 utf8 改一下就好了。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/sendmail-use-perl/#disqus_thread">Comments</a></span>
    
</div>
</article>



  <nav id="pagenavi">
    
        <a href="/page/7/" class="prev">Prev</a>
    
    
        <a href="/page/9/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2017
    
    wd
    . Powered by <a href="http://gohugo.io" target="_blank">Hugo</a> |
    Theme is <a href="https://github.com/wd/hugo-fabric">hugo-fabric</a>, fork from <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a> by <a href="https://wdicc.com">me</a>
</div>

    </footer>
    <script src="/js/fabric.js"></script>


</div>
</div>
<script src="/js/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
 
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery);
 
</script>
</body>
</html>
