<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>wd and cc</title>
    <meta name="author" content="wd">
    
	<meta name="description" content="undefined"> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>
<span class="subtitle">happy everyday</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/wd" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        

    
        <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    



  <article class="post">
	<h2 class="title">
		<a href="diabetic-cat-maomao/">毛毛的病情</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2014-01-18T14:16:09.000Z" itemprop="datePublished">Jan 18, 2014</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/cats/">cats</a> <a href="../tags/毛毛/">毛毛</a> <a href="../tags/diabetic/">diabetic</a>
</div>
    </div>
      
        <h2 id="第一篇"><a href="#第一篇" class="headerlink" title="第一篇"></a>第一篇</h2><p>我家两只猫，一只叫妞妞，现在大概11岁多，一只叫毛毛，现在大概10多岁。两只都陪伴我们超过 10 年了，现在生病的是毛毛，毛毛是我从出满月就开始养的。</p>
<p>大概最近一个多月，发现的毛毛不太爱吃猫粮，总是蹲在水盆猫粮盆前面发呆，开始还觉得好玩，不知道他再思考什么。大概是 12.28 周六，发现毛毛好像精神头也没了，12.29 周日早上，发现好像更加严重了，就赶紧抱到了楼下的宠物医院（京东万康，发现这医院还在点评的推荐医院列表里面），医生给测了体温，说是体温低，挺危险的，建议做个检查，直接给我一个单子，650。缴费之后，开始做检查，好像是验了血，生化，x光（单子和化验结果最后也没给我们，化验结果我们拍了照片。现在想想，当时应该和他们闹一通的，太恶心了），检查结果出来后，直接拿来一个单子，就是医院那种治死了也不负责什么的让我签，我就说你们这太扯了把，啥毛病不和我说就让我签这个，那个医生赶紧就开始和我说血糖还有什么xx有点高，然后就指着x光说肝肾啥的有毛病，然后说膀胱有憋尿的情况，说可能是结石之类的，说是体温低挺危险的啥啥的，我问怎么办，说是先让他排尿，说是弄个导管，或者做个穿刺啥的，我一听就觉得不太靠谱，猫都这样了，不会起因是尿憋的吧，而且他们也没个具体的说法说到底是什么毛病。我就和我老婆说到观赏把。</p>
<p>到了观赏是项夫给看的，继续开化验，之前600 多的医生就是拿着手机看了会，最贵的生化没开，验血拍B超。我们去的时候刚好中午，毛毛精神那会已经很差了，b超的大夫去吃饭了，我老婆哭着找了半天大夫才来了一个给开始b超，所有结果出来后，基本就是尿道没问题，肝功能基本正常，有点肾衰竭的的情况，然后就是血糖高 28。就开始按照糖尿病治了，输了6个小时液，输完之后我们担心胰岛素打多了血糖变太低（是同再那看病的一个主人提醒的，说他见过先例），就找大夫又验了血糖，大概是十几，还算可以。然后就回家了。</p>
<p>昨天 12.30 周一，又去输液，在车上的时候发现这小家伙比第一次去力气大了好多，一路叫，我和老婆还挺高兴，感觉是再变好，后来到安贞那块的时候突然不叫了，吓了一跳，到了医院好多人排队，和大家说了一下，大家都说你快先看把，我们插了个队。换了个大夫，继续让验血，验完之后说血糖是 18 还是高，就继续输液到半夜。中间验了一次血糖，降到了10 以内，还验了一次尿，好像是 4++，也不知道和人的是不是一样。</p>
<p>这两天我和老婆两个人眼泪都哭干了，我一个大老爷们，昨天本来去上班的，说让我老婆带着去看，结果一个人做地铁就忍不住的掉眼泪，到了单位一想起来猫就想掉眼泪，后来请了半天假，回家了。</p>
<p>目前我们感觉毛毛每天输液什么的，应该还能持续一段时间，他现在也没胃口，只喝水不吃东西，现在就是用针管再喂那种婴儿吃的果泥（鱼味道的），他到是不吐，不过喂不多，一会就会开始反抗，所以不知道有没有糖尿病猫猫的主人有没有什么经验可以传授的，多谢了。</p>
<p>另外，各位猫猫主人，如果发现猫有食欲不振或者守着盆子发呆的情况，一定要注意，因为动物的耐受力比较强，他们什么东西都不吃的时候，病基本就已经很严重了。</p>
<h2 id="第二篇"><a href="#第二篇" class="headerlink" title="第二篇"></a>第二篇</h2><p>今天是 2013 年最后一天，继续带毛毛去看病。今天去了本来想找郑义大夫（是个女大夫），结果她进来开会，没找到，并且之前见过相夫，还有一个姓郭的大夫都没来，只好找了一个新的叫做张炎，就是这个傻逼差点把毛毛害死。</p>
<p>今天测血糖是 17，这样这三天测出来的血糖依次是 28, 18, 17。这个大夫也是想做个生化，我们因为做过了，没让做，可能他发现也没什么可以做的化验了，比较郁闷，就说给开3天的药，我想了下明天1.1 医院好像放假，就说开吧，然后给开了 6 个单位的胰岛素，注意是 6 个单位，3 个单位的长效，3 个单位的短效。而我们之前打的都是 0.6 个单位的短效，等于他一下放大了 10 倍。药是我开的，我也没注意这个单位的问题。打完之后开始输液。大概输了 2 个多小时，我老婆找到了郑义大夫询问毛毛的情况，郑大夫就过来看了一下，摸了一会肚子，说有点尿，有点粪便（其他大夫都是让去做b超啊，化验啊去测这个，只有郑大夫是上手摸的，郑大夫还给其他几个猫摸来着），给小力气挤了一下尿看是不是能出来，结果毛毛就开始撒尿了。其实之前毛毛一直想下地，估计就是想尿的。</p>
<p>然后郑大夫就随口问了一句胰岛素打了多少，我们就赶紧翻单子，说不用翻，就去问护士，护士说是 6 个，郑大夫当时估计就蒙了，确认了好几次，就和护士说拿葡萄糖来打，另外安排了赶紧测血糖。血糖结果是 6.9。郑大夫解释说短效大概 4 个小时可以排出去，长效 4 个小时之后才起作用，我们猫现在就这么低的血糖，那等到了晚上长效起作用，那就得低血糖了。所以持续打了几个小时的葡萄糖，之后又验了一下，7点几，还好。然后让我们先回来了，说今天晚上2，3点的时候是长效起作用的关键时候，说得观察看看猫是不是比较低迷。另外让我们回来也给毛毛喂些东西，补充下血糖。</p>
<p>今天毛毛回来虽然看着还是腿软，但是居然自己跳上了宜家的小凳子了，然后上了沙发，现在在我腿旁边睡着了。一会还得想办法给他喂点吃的，希望今天晚上没事。唉。看病遇上傻逼大夫真没办法，据说前几天就有只猫也是让他给搞到低血糖了，差点死了，这大夫我觉得可以上黑名单了都，还专家呢。</p>
<p>郑义大夫真是个好大夫，在另一个帖子说再伴侣被一个星期干了三次手术的猫，今天去了说是自己吃了一点点鸡肝，开始吃东西了。并且今天明显状态好了很多。</p>
<p>今天有只在那边抢救了好几天的狗走了，心脏病，我们第一天去的时候就在那抢救了，老头老太太轮番给守夜，今天没挺过去。我老婆伤心的哭了几把，唉。</p>
<h2 id="第三篇"><a href="#第三篇" class="headerlink" title="第三篇"></a>第三篇</h2><p>今天是 2014 年第一天，昨天晚上回来就加了个精华区里面糖尿病猫妈的糖猫猫群，和里面有几个病友交流了下情况，感觉毛毛真是有救了。</p>
<p>昨天一晚上回来毛毛就比较嗜睡，在床边睡了一晚上。今天早上我看毛毛还在持续睡，感觉状态有点不对，发现他自己睡的地方尿了一泡，要知道前几天可没这个情况，他虽然难受也是自己去厕所的。所以我就去搜了一下低血糖的症状，发现嗜睡，腿软毛毛身上就有，早上起来持续喂了几次饭和水，好像没多少改善，楼下买了些葡萄糖，调成 10% 的，喂了 10ml，发现好像也没多少改善，我们也不敢多喂了，观赏今天郑大夫休假，我们也不敢去了，想起来糖猫猫群里面有推荐纳吉亚，就打电话问了下，结果郭大夫刚好上班，就开车过去了。</p>
<p>纳吉亚比较小，去了后挂号也没收钱，郭大夫比较忙。毛毛的状态看着不太好，等到了我们，我老婆忍不住又开始哭了，郭大夫看了下情况，就赶紧安排吸氧，氯化钾，葡萄糖两个一起输，然后测血糖，都已经到 2.x 了，晚点估计都得挂了。持续输了一会，再验血糖到了 10 多之后就停了葡萄糖了。然后好像给吃了补钾什么的药，因为纳吉亚地方实在太小，所以后面基本是我老婆在看着猫，所以我也不是很清楚具体打了什么针，吃了什么药。总之就是下午我观察毛毛的状态感觉是好很多了，比前几天都好。6点多他们下班的时候，郭大夫过来安排晚上的治疗，因为他们不是 24h，所以晚上得我和我老婆一起弄了。教了我们怎么测血糖，怎么打胰岛素，怎么喂药什么的。还给准备了几十个胰岛素的针，0.5 和 1 个单位的各好多。另外还准备了葡萄糖注射液。让我们到家之后每个小时测试一下血糖情况，根据血糖情况，打不同量的胰岛素，或者打葡萄糖补糖。还留了电话，说要是出现呼吸急促，1 分钟超过 50 次的话，或者有什么异常情况的话，就给他打电话。总之是把晚上都安排妥了，让我们明天早上 9 点他们开门就去，继续治疗。这大概就是今天的情况了。</p>
<p>纳吉亚这边收费项目比观赏少了很多，比如观赏挂号就是30，吸氧针管输液都不少钱。在纳吉亚这边的时候，有些项目就不收钱了，比如吸氧针管，吸氧没收钱，给我们配了十几个胰岛素针，只是收了针管的钱和一大瓶的钱，等于免费给配的。旁边小猫的纸尿片也是他们免费给的，观赏是 2.5 一个买的。我昨天下单买了50片，20多块钱，和他们那个是一样的。因为下午需要一个小时测试一下血糖，郭大夫还说诊所的收费高，让我们自己买试纸用他们的仪器测。并且今天晚上因为需要持续观察血糖，还把血糖仪让我们带了回来。</p>
<p>今天下午老婆一直再骂观赏的那个张炎，毛毛真的是差点就被他害死了。现在看毛毛的状态已经非常好了，今天回来之后吃了不少郭大夫给开的 ad罐头，因为还输着液，所以要固定毛毛再一个地方待着，现在我老婆正和他再斗争呢，毛毛的性格一直就不会老实再一个地方待着的，现在看来状态真是恢复了。</p>
<p>感谢各位的祝福，新年第一天，毛毛要重生啦。</p>
<h2 id="第四篇"><a href="#第四篇" class="headerlink" title="第四篇"></a>第四篇</h2><p>今天是 2014.1.3，这两天没来更新了。今天更新下。</p>
<p>1.1 回来之后按照郭大夫要求输着液，郭大夫的意思是先调整身体状态，再调血糖。带了很多胰岛素葡萄糖啥的回来，然后基本2个小时检查一下血糖，然后根据情况考虑打胰岛素。因为毛毛总动，所以我和老婆两个人换着看，每人也就睡了3个小时，1.2 早上8点多就出门去纳吉亚继续输液，检测到一些什么值异常，怀疑心脏啥的毛病之类，所以继续输液。1.1 早上的时候看毛毛的情况明显已经好转了，活泼多了。这两天因为是工作日，把我老婆送过去之后，我就去上班了。下午提前请假下班再过去接她回家。昨天也就是 1.2 晚上。我和老婆继续换班，每人睡了 3 个小时，10点多打了长效胰岛素，持续观察了一晚上的血糖情况，每小时一记录。1.3 也就是今天早上，继续去纳吉亚输液。</p>
<p>今天晚上我和老婆总算是可以休息了，不用盯着了。这两天毛毛食欲已经都恢复了，不止吃罐头，连给另一只猫的普通猫粮都吃，不过我们没敢喂，还是继续给 ad罐头。打算明天开始喂处方猫粮。今天晚上的任务就是 10点多打一个长效，然后检测下血糖情况，早上起来继续去医院输液调整。今天晚上总算可以好好睡一觉了。</p>
<p>截止到今天，基本可以认为毛毛已经恢复了。剩下的工作就是针对糖尿病的持久战了。</p>
<h2 id="第五篇"><a href="#第五篇" class="headerlink" title="第五篇"></a>第五篇</h2><p>好久没更新了，最近毛毛的病已经基本稳定了。现在持续在给他打针，每天目前要吃的要水看着好像还行。血糖现在也是测一次不测一次的，好像有点懒散了，不过持续一段时间看看吧，先这样了。等有时间，整理一下糖尿病猫的照顾方法。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/diabetic-cat-maomao/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="campus-recruiting/">campus recruiting</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-10-07T08:38:00.000Z" itemprop="datePublished">Oct 7, 2013</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a>
</div>
    </div>
      
        <p>去年就参加了校招的笔试和面试，不过都是在北京，和其他同学的经验交流也不是很多，今年参加了外省3个地区的校招，有点心得记录一下。</p>
<h3 id="笔试题"><a href="#笔试题" class="headerlink" title="笔试题"></a>笔试题</h3><p>笔试题非常重要，因为第一轮筛选全靠他了。</p>
<p>笔试题的难度要考虑好，需要把哪些代码能力差的，思路不靠谱的都筛掉。当然通过一两道题筛人有可能漏掉好的，但是这种几率非常小，真漏掉也没办法，毕竟一般能通过的人会很多的。</p>
<p>我的经验是，第一题出一道实际中存在的问题，但是又得让只会 c/c++ 的同学做起来不是很复杂的，不能只想着用 python 一句话就做出来之类，那样阅卷会很困难。比如把一句英文中所有单词的首字母大写，这种题就很好。但是比如给两个文件找他们共存的字符串就不太好，只会 c 语言的同学做这个题会很费劲。</p>
<p>第二题稍微要有点区分度，要考察下数据结构相关的内容。比如 hash 懂不懂，排序算法会不会之类。</p>
<p>我觉得笔试时间不宜太长，一道题给 20 分钟足够，也避免了不会的人在那瞎掰一通，将来阅卷困难。</p>
<p>笔试也要注意考场纪律，不允许交头接耳，能隔开坐最好，不能的话，可以考虑让先来的都隔开，后来的往进插，这样能隔开好朋友，能最大限度避免作弊。看到作弊的要提醒一下，提醒无效的就收卷子，或者调座位。</p>
<h3 id="面试"><a href="#面试" class="headerlink" title="面试"></a>面试</h3><p>一个人一天大致能面试 15 个左右，差不多 30-40 分钟一个。</p>
<p>面试考察三个方面。</p>
<ul>
<li>搞过的项目，实验的方向，是否都弄明白了。这个一般就是一边讲，一边问，抓到点就详细问一下，看看是否确实掌握了，同时也能考察到他的学习能力。</li>
<li>学校学的东西是否都扎实。这也就是所谓的基础知识了。一般就是数据结构算法，网络等。</li>
<li>沟通交流是否顺畅。是不是能很好的理解问题，能通俗简单的讲明白学到的东西。</li>
</ul>
<p>就我面试的经验，我感觉上面三个方面就足够了，如果都觉得可以，那基本就没问题了。如果某个方面有缺陷，那还得看其他方面是否有很多的加分。</p>
<h3 id="面霸"><a href="#面霸" class="headerlink" title="面霸"></a>面霸</h3><p>对于面霸，也不要直接拒绝，最好最后一天统一给安排一次笔试，出一道题考察一下。这题一定要有区分度，类似笔试题的第二题。否则阅卷很困难。题做的好的，可以安排面试一下。不要在面试中间插入面霸，对其他同学不公平。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/campus-recruiting/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="how-to-finding-a-job-for-graduates/">how to finding a job for graduates</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-10-07T07:43:00.000Z" itemprop="datePublished">Oct 7, 2013</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a>
</div>
    </div>
      
        <p>昨天晚上胃难受起来翻了会知乎，回答了<a href="http://www.zhihu.com/question/21721705/answer/19228492?utm_source=weibo&amp;utm_medium=weibo_share&amp;utm_content=share_answer&amp;utm_campaign=share_button" target="_blank" rel="external">一个问题</a>，也算校招的一个总结了。包含了给准备找工作的毕业生的一些建议。好久没写 blog 了，粘贴到这里除除草。</p>
<p>刚好做了几天校招，或许对你有帮助。</p>
<p>非计算机相关专业的同学，一般一些算法基础会稍差（当然也有自学数据结构且弄的比较明白的人），比较偏向实际应用开发方面，但是要注意并不是说做过很多类型的开发就会有很多的加分，而是要注重深入。</p>
<p>招聘一般都会有笔试，笔试考察的是你写代码和解决问题的能力，随便用什么语言，能解决问题就可以。首先你得过笔试这关，写不了代码的，开发肯定是没办法招的。</p>
<p>然后就是面试，比如就针对你做的开发，我会提问几个 python，java，html 相关的技术问题，看你是否确实使用并且掌握了他们的基本原理。开始会是一些非常简单的问题，比如 python 如何打印一个 dict 的所有 key，如何做类继承，如何调用执行外部命令等，就这些简单问题如果能答上来，一般会继续问一些相对深入的，了解下你熟悉的程度。这一关需要你对一些基础问题能答上来，如果后续也能答上来，那这方面的得分会比较高。如果基础问题答不上来，表示经验要么是瞎掰的，要么就是兴趣不在开发没用心研究过，那我基本不会给过。</p>
<p>如果实际使用和学习过的东西都还算明白，那么后续会考察一些算法基础的东西，各种数据结构里面的东西，不过针对这种跨专业的，要求不会特别高，如果实在没了解过，那也没有办法。如果了解过且比较明白，那会有加分。不会也不会减分。</p>
<p>此外还会考察交流沟通能力，思路是否清晰，思维是否敏捷等，这些方面好的话，会有加分。要注意这块如果有严重问题的，也不会给过，因为开发工程师是需要和其他人做配合工作的，如果沟通或者需求理解有问题，那是不行的。</p>
<p>综合上面三块，看最后的结果。可以看出来，非计算机相关专业的，还是多少有点吃亏的。<br>哦对了，这是我们公司的要求，可能稍微有点高，就你贴出来的经验看，如果确实都是你做出来的，我感觉你至少找个开发的工作应该是没太大问题的，可能问题是在起点会是在哪里，是在大公司还是二流三流公司，呵呵。</p>
<p>另外对于你想做 android 开发，其实并不是说你有过类似经验就只能找那个方向的工作，主要还是看你的兴趣在哪里，一般大学的那点经验对于一个公司来说，基本没什么用，太浅了。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/how-to-finding-a-job-for-graduates/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="octopress-and-jeklly-1-dot-0-1/">octopress and jeklly 1.0.1</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-06-12T13:45:00.000Z" itemprop="datePublished">Jun 12, 2013</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux-web/">linux,web</a>
</div>
    </div>
      
        <p>自从 jeklly 1.0.x 发布之后，我的 octopress 站点就在 github，gitcafe 上面更新不了了，写了新帖子然后 push 之后，会收到个邮件，说 generate site faild。</p>
<p>等等。。这个不是静态站点吗？generate 你妹阿！！然后就找阿找阿找解决办法，尝试过下面这些</p>
<ul>
<li>touch 一个 .nojeklly 不让它 generate</li>
<li>找 octopress 支持 jeklly 1.0.1 的新版本</li>
<li>google 之，怎么可能就我遇到问题了呢</li>
<li>使用 jeklly 1.0.1 单独搭一个，不用 octopress 了</li>
<li>…其他忘记了的。。</li>
</ul>
<p>悲剧的是，以上这些方法没一个搞定了</p>
<ul>
<li>某处搜到的这个 .nojeklly 完全不管用</li>
<li>octopress 2.1 这个 branch 支持 jeklly 1.0.1，可惜没能让他运转起来。。具体 release 日期似乎还没看到。。。</li>
<li>google 不到有用的信息，唯一有用的就是有人给 octopress 提的 pull request，可惜被 merge 到 2.1 了</li>
<li>这个倒是简单，可惜的是 octopress 其实背后做了很多事情，单纯的拿弄 post 过去发现有些文件解析不了，我遇到的是 <code>``` </code> 这个标记，是 octopress 支持的，可惜我的 post 里面好多都是这个。另外还有主题阿等等这些。</li>
</ul>
<p>综上，就觉得，nnd，这破玩意怎么这么复杂？！</p>
<p>后来不知道哪天突然想到，我之前测试 hexo 的时候，它没有 jeklly 一说，不是也可以么？另外，github pages 的例子里面，也就是 echo 了一个文件呀，也没有 jeklly 阿，不是也可以么？然后就觉得豁然开朗，github 之流肯定是默认会给你处理 jeklly 的代码，然后产生一个 site，而不是直接使用你产生的 html 文件。回想之前每次 deploy github pages，都会收到一个邮件提醒说 site generate success 之类，那就应该是猜的没错了。</p>
<p>然后就开始尝试只 push html（octopress 的结果文件在 public 里面）上去，结果确实如所料，毛问题都没有了，gitcafe 和 github 都可以了。总算舒服了。。另外还写了一个使用 octopress deploy 到 gitcafe 的<a href="http://wdicc.om/octopress-and-gitcafe/" target="_blank" rel="external">帖子</a>，有需要可以参考。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/octopress-and-jeklly-1-dot-0-1/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="octopress-and-gitcafe/">octopress and gitcafe</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-06-12T13:30:00.000Z" itemprop="datePublished">Jun 12, 2013</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a>
</div>
    </div>
      
        <p>ocotpress 支持 github，不过 github 的 pages 貌似被墙了，且速度慢。gitcafe 速度还不错，也支持 pages，刚好可以切换过去。我只是简单粗暴的修改了几个文件。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">diff --git a/.gitignore b/.gitignore</div><div class="line">index 85ed25d..5858b25 100644</div><div class="line"><span class="comment">--- a/.gitignore</span></div><div class="line"><span class="comment">+++ b/.gitignore</span></div><div class="line">@@ -12,3 +12,4 @@ source/stylesheets/screen.css</div><div class="line"> vendor</div><div class="line"> node_modules</div><div class="line"> .themes/fabric/</div><div class="line"><span class="addition">+gitcafe</span></div><div class="line">diff --git a/Rakefile b/Rakefile</div><div class="line">index 53072e5..62061e0 100644</div><div class="line"><span class="comment">--- a/Rakefile</span></div><div class="line"><span class="comment">+++ b/Rakefile</span></div><div class="line">@@ -27,6 +27,9 @@ new_post_ext    = "markdown"  # default new post file extension when using the n</div><div class="line"> new_page_ext    = "markdown"  # default new page file extension when using the new_page task</div><div class="line"> server_port     = "4000"      # port for preview server eg. localhost:4000</div><div class="line"></div><div class="line"><span class="addition">+gitcafe_dir      = "gitcafe"</span></div><div class="line"><span class="addition">+gitcafe_branch   = "gitcafe-pages"</span></div><div class="line"><span class="addition">+</span></div><div class="line"></div><div class="line"> desc "Initial setup for Octopress: copies the default theme into the path of Jekyll's generator. Rake install defaults to rake install[classic] to install a different them</div><div class="line"> task :install, :theme do |t, args|</div><div class="line">@@ -219,7 +214,7 @@ end</div><div class="line"> ##############</div><div class="line"></div><div class="line"> desc "Default deploy task"</div><div class="line"><span class="deletion">-task :deploy do</span></div><div class="line"><span class="addition">+task :deploy_old do</span></div><div class="line">   # Check if preview posts exist, which should not be published</div><div class="line">   if File.exists?(".preview-mode")</div><div class="line">     puts "## Found posts in preview mode, regenerating files ..."</div><div class="line">@@ -231,6 +226,31 @@ task :deploy do</div><div class="line">   Rake::Task["#&#123;deploy_default&#125;"].execute</div><div class="line"> end</div><div class="line"></div><div class="line"><span class="addition">+desc "deploy gitcafe"</span></div><div class="line"><span class="addition">+task :deploy do</span></div><div class="line"><span class="addition">+  # Check if preview posts exist, which should not be published</span></div><div class="line"><span class="addition">+  if File.exists?(".preview-mode")</span></div><div class="line"><span class="addition">+    puts "## Found posts in preview mode, regenerating files ..."</span></div><div class="line"><span class="addition">+    File.delete(".preview-mode")</span></div><div class="line"><span class="addition">+    #Rake::Task[:generate].execute # 这个地方每次都会 generate 我一般喜欢先 generate 本地看好没问题之后再 deploy，所以就注释掉了</span></div><div class="line"><span class="addition">+  end</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  puts "## Deploying branch to Gitcafe Pages "</span></div><div class="line"><span class="addition">+  puts "\n## copying #&#123;public_dir&#125; to #&#123;gitcafe_dir&#125;"</span></div><div class="line"><span class="addition">+  cp_r "#&#123;public_dir&#125;/.", gitcafe_dir</span></div><div class="line"><span class="addition">+  cd "#&#123;gitcafe_dir&#125;" do</span></div><div class="line"><span class="addition">+    system "git add ."</span></div><div class="line"><span class="addition">+    system "git add -u"</span></div><div class="line"><span class="addition">+    puts "\n## Commiting: Site updated at #&#123;Time.now.utc&#125;"</span></div><div class="line"><span class="addition">+    message = "Site updated at #&#123;Time.now.utc&#125;"</span></div><div class="line"><span class="addition">+    system "git commit -m \"#&#123;message&#125;\""</span></div><div class="line"><span class="addition">+    puts "\n## Pushing generated #&#123;gitcafe_dir&#125; website"</span></div><div class="line"><span class="addition">+    system "git push origin #&#123;gitcafe_branch&#125; --force"</span></div><div class="line"><span class="addition">+    puts "\n## Gcafe Pages deploy complete"</span></div><div class="line"><span class="addition">+  end</span></div><div class="line"><span class="addition">+end</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+</span></div><div class="line"> desc "Generate website and deploy"</div><div class="line"> task :gen_deploy =&gt; [:integrate, :generate, :deploy] do</div><div class="line"> end</div></pre></td></tr></table></figure>
<p>然后需要在 octopus 根目录 clone 一下你的 gitcafe 项目到 gitcafe 目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> git@gitcafe.com:wd/wd gitcafe</div><div class="line">....</div></pre></td></tr></table></figure></p>
<p>然后就可以试试看 <code>rake generate</code> , <code>rake preview</code>, <code>rake deploy</code> 了。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/octopress-and-gitcafe/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="broadcom-wireless-card-on-gentoo/">broadcom BCM wireless card on gentoo</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-05-24T09:28:00.000Z" itemprop="datePublished">May 24, 2013</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a>
</div>
    </div>
      
        <p>昨天又折腾了一下我的无线，是 dell 的本子，broadcom 的卡 BCM4313，准备写一下的时候，发现之前居然折腾过 <a href="/bcm4312broadcom-stawpa_supplicantkernel2-6-33/">BCM4312</a>。。感觉真蛋疼。。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ lspci -vnn <span class="_">-d</span> 14e4:</div><div class="line">02:00.0 Network controller [0280]: Broadcom Corporation BCM4313 802.11b/g/n Wireless LAN Controller [14e4:4727] (rev 01)</div><div class="line">        Subsystem: Dell Inspiron M5010 / XPS 8300 [1028:0010]</div><div class="line">        Flags: fast devsel, IRQ 17</div><div class="line">        Memory at e5300000 (64-bit, non-prefetchable) [size=16K]</div><div class="line">        Capabilities: &lt;access denied&gt;</div><div class="line">        Kernel modules: bcma</div></pre></td></tr></table></figure>
<p>根据 <a href="http://wireless.kernel.org/en/users/Drivers/b43#bcm43xx.2C_b43legacy.2C_b43.2C_softmac.2C..._the_full_story" target="_blank" rel="external">这里</a> ， BCM 的网卡有三种可用驱动</p>
<ul>
<li>b43，kernel 自带，源自 broadcom linux 驱动的逆向工程</li>
<li>brcmsmac, kernel 自带，似乎源自 broadcom 某个开源的驱动</li>
<li>wl, broadcom 发布的 linux 驱动</li>
</ul>
<p>另外，kernel 自带的 b43 和 brcmsmac 支持标准的 802.11 栈，可以通过 iw iwconfig 之类的工具来配置，获取状态。wl 就不行了。</p>
<p>如果想使用 b43 或者 brcmsmac，需要选择下面的 kernel 选项，要注意都选择成 module，因为还需要加载 firmware，如果编译进内核那需要把 firmware 也编译到内核才可以。<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">N<span class="function"><span class="title">etworking</span> support  ---&gt;</span>  W<span class="function"><span class="title">ireless</span>  ---&gt;</span> Generic IEEE <span class="number">802.11</span> Networking Stack (mac80211)</div><div class="line">D<span class="function"><span class="title">evice</span> Drivers  ---&gt;</span> B<span class="function"><span class="title">roadcom</span> specific AMBA  ---&gt;</span>  BCMA support</div></pre></td></tr></table></figure></p>
<p>针对 b43 选择 <code>Device Drivers  ---&gt; Network device support  ---&gt;  Wireless LAN  ---&gt;  Broadcom 43xx wireless support (mac80211 stack)</code>, 还需要安装 <code>sys-firmware/b43-firmware</code>。</p>
<p>针对 brcmsmac 选择 <code>Device Drivers  ---&gt; Network device support  ---&gt;  Wireless LAN  ---&gt;  Broadcom IEEE802.11n PCIe SoftMAC WLAN driver</code>，还需要安装 <code>sys-kernel/linux-firmware</code>。</p>
<p>对于 wl，需要安装 <code>net-wireless/broadcom-sta</code>，安装的时候会自动检查必要的内核选项，按照提示选择好就可以了。主要是要注意去掉上面的 kernel 的选项，另外可能还需要一个 ipw2100 来提供某一个隐藏的 kernel 选项。此外还有个 PREEMPT_RCU 检查，需要选择下面的内核选项 <code>Processor type and features  ---&gt;  Preemption Model (Voluntary Kernel Preemption (Desktop))  ---&gt;  Voluntary Kernel Preemption (Desktop)</code>。</p>
<p>如此之后编译安装重启就可以了。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/broadcom-wireless-card-on-gentoo/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="postgresql-explain/">PostgreSQL Explain</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2013-02-03T09:40:00.000Z" itemprop="datePublished">Feb 3, 2013</time>
</div>
      <div class="tags">Tags: 


</div>
    </div>
      
        <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 notice</a></li>
<li><a href="#sec-2">2 explain basics</a></li>
<li><a href="#sec-3">3 explain analyse</a></li>
<li><a href="#sec-4">4 Caveats 注意事项</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1"><span class="section-number-3">1</span> notice</h3>
<div class="outline-text-3" id="text-1">


<p>
简单翻译了一下 <a href="http://www.postgresql.org/docs/9.2/static/using-explain.html" target="_blank" rel="external">http://www.postgresql.org/docs/9.2/static/using-explain.html</a> ，里面有些内容没翻译。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2"><span class="section-number-3">2</span> explain basics</h3>
<div class="outline-text-3" id="text-2">





<pre class="example">EXPLAIN SELECT * FROM tenk1;

                         QUERY PLAN
-------------------------------------------------------------
 Seq Scan on tenk1  (cost=0.00..458.00 rows=10000 width=244)
</pre>


<ul>
<li>第一行输出需要的消耗。
</li>
<li>最后一行输出需要的消耗。
</li>
<li>返回的行数，假定全部返回。并非扫描处理的行数。
</li>
<li>每行的平均数据量，字节
</li>
</ul>


<p>
消耗是使用设置的规划器的一些 cost常量<sup><a class="footref" name="fnr.1" href="#fn.1">1</a></sup> 来计算出来的，上一级的 node 的 消耗包括了所有子 node 的消耗，消耗不包括传输结果花的时间。
</p>



<pre class="example">SELECT relpages, reltuples FROM pg_class WHERE relname = 'tenk1';
</pre>


<p>
从上面这个语句可以看到，tenk1 有 358 磁盘页和 10000 行。这个查询的消耗计算公式如下
</p>
<pre class="example">
 (disk pages read * seq_page_cost) + (rows scanned * cpu_tuple_cost)
</pre>


<p>
默认情况下 <code>seq_page_cost = 1.0, cpu_tuple_cost = 0.01</code>, 所以最总消耗是 <code>(358 * 1.0) + (10000 * 0.01) = 458</code> 。
</p>



<pre class="example">EXPLAIN SELECT * FROM tenk1 WHERE unique1 &lt; 7000;

                         QUERY PLAN
------------------------------------------------------------
 Seq Scan on tenk1  (cost=0.00..483.00 rows=7001 width=244)
   Filter: (unique1 &lt; 7000)
</pre>


<p>
再看这个，加了一个 where 条件，多了一个 filter 操作，返回结果变少，但是消耗变多了。因为总体需要处理的数据没有变少，并且还多了
</p>
<pre class="example">
 10000 * cpu_operator_cost
</pre>


<p>
需要的消耗。
</p>
<p>
这些计算方法得到的数值可能和你系统的会稍有区别，使用 analyse 命令可能会改变计算结果，因为它会根据一些随机的样本重新收集表的状态信息。
</p>



<pre class="example">EXPLAIN SELECT * FROM tenk1 WHERE unique1 &lt; 100;

                                  QUERY PLAN
------------------------------------------------------------------------------
 Bitmap Heap Scan on tenk1  (cost=5.03..229.17 rows=101 width=244)
   Recheck Cond: (unique1 &lt; 100)
   -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.01 rows=101 width=0)
         Index Cond: (unique1 &lt; 100)
</pre>


<p>
再来看一个。子执行计划节点会先扫描索引，上一级的执行计划节点会根据索引返回的位置来获取数据。获取散列数据比获取全部数据消耗要大，不过因为毕竟是少量数据，可以看到消耗还是小于全表扫描。上级的节点会在获取散列数据之前做一个磁盘排序，好减少获取的消耗，而 Bitmap 字样表示索引返回的结果是按照存储位置排好序的，这就是使用索引的一个原因。
</p>



<pre class="example">EXPLAIN SELECT * FROM tenk1 WHERE unique1 &lt; 100 AND stringu1 = 'xxx';

                                  QUERY PLAN
------------------------------------------------------------------------------
 Bitmap Heap Scan on tenk1  (cost=5.01..229.40 rows=1 width=244)
   Recheck Cond: (unique1 &lt; 100)
   Filter: (stringu1 = 'xxx'::name)
   -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.01 rows=101 width=0)
         Index Cond: (unique1 &lt; 100)
</pre>


<p>
stringu1 = 'xxx' 减少了输出的行数，因为还需要扫描同样的行数，所以没有减少执行计划的消耗，而且还有稍微的增加，
</p>



<pre class="example">EXPLAIN SELECT * FROM tenk1 WHERE unique1 = 42;

                                 QUERY PLAN
-----------------------------------------------------------------------------
 Index Scan using tenk1_unique1 on tenk1  (cost=0.00..8.27 rows=1 width=244)
   Index Cond: (unique1 = 42)
</pre>


<p>
数据根据索引排序来获取，不需要额外的排序。
</p>



<pre class="example">EXPLAIN SELECT * FROM tenk1 WHERE unique1 &lt; 100 AND unique2 &gt; 9000;

                                     QUERY PLAN
-------------------------------------------------------------------------------------
 Bitmap Heap Scan on tenk1  (cost=25.01..60.14 rows=10 width=244)
   Recheck Cond: ((unique1 &lt; 100) AND (unique2 &gt; 9000))
   -&gt;  BitmapAnd  (cost=25.01..25.01 rows=10 width=0)
         -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.01 rows=101 width=0)
               Index Cond: (unique1 &lt; 100)
         -&gt;  Bitmap Index Scan on tenk1_unique2  (cost=0.00..19.74 rows=999 width=0)
               Index Cond: (unique2 &gt; 9000)

EXPLAIN SELECT * FROM tenk1 WHERE unique1 &lt; 100 AND unique2 &gt; 9000 LIMIT 2;

                                     QUERY PLAN
-------------------------------------------------------------------------------------
 Limit  (cost=0.00..14.25 rows=2 width=244)
   -&gt;  Index Scan using tenk1_unique2 on tenk1  (cost=0.00..71.23 rows=10 width=244)
         Index Cond: (unique2 &gt; 9000)
         Filter: (unique1 &lt; 100)
</pre>


<p>
这两个查询，第一个分别查两个索引，然后做 BitmapAnd 得到结果。第二个只查了其中一个索引，然后使用 filter 方式来做过滤，可以看到第二个查询里面的消耗 71.23 表示的是返回所有数据需要的消耗，Limit 节点在得到需要的结果厚，会终止执行，所以最终没有返回那么多，最终消耗小一点，比第一个查询小。
</p>




<pre class="example">EXPLAIN SELECT *
FROM tenk1 t1, tenk2 t2
WHERE t1.unique1 &lt; 10 AND t1.unique2 = t2.unique2;

                                      QUERY PLAN
--------------------------------------------------------------------------------------
 Nested Loop  (cost=4.33..118.25 rows=10 width=488)
   -&gt;  Bitmap Heap Scan on tenk1 t1  (cost=4.33..39.44 rows=10 width=244)
         Recheck Cond: (unique1 &lt; 10)
         -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..4.33 rows=10 width=0)
               Index Cond: (unique1 &lt; 10)
   -&gt;  Index Scan using tenk2_unique2 on tenk2 t2  (cost=0.00..7.87 rows=1 width=244)
         Index Cond: (unique2 = t1.unique2)
</pre>


<p>
这个是两表 join，最后通过嵌套循环节点来做的 join。先查询外层 <code>Bitmap heap scan</code> 这个节点，这个节点还有个子节点。这个节点的查询和 <code>select ... where unique1 &lt; 10</code> 的查询类似。然后执行内层 <code>Index scan using</code> 这个节点，外层查询获取到的数据会插入进来，这个时候 t1.unique2 的值已经有了，所以这层的查询和 <code>select ... where t2.unique2 = 常量</code> 的查询类似，消耗比前面的小是因为第一次查询有了 cache，这次就会稍微快了一点。这层查询的消耗是 <code>外层行数*内层的消耗=10 * 7.87</code> 加上一些 cpu 消耗。
</p>



<pre class="example">EXPLAIN SELECT *
FROM tenk1 t1, tenk2 t2
WHERE t1.unique1 &lt; 10 AND t1.unique2 = t2.unique2 AND t1.hundred &lt; t2.hundred;

                                      QUERY PLAN
--------------------------------------------------------------------------------------
 Nested Loop  (cost=4.33..118.28 rows=3 width=488)
   Join Filter: (t1.hundred &lt; t2.hundred)
   -&gt;  Bitmap Heap Scan on tenk1 t1  (cost=4.33..39.44 rows=10 width=244)
         Recheck Cond: (unique1 &lt; 10)
         -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..4.33 rows=10 width=0)
               Index Cond: (unique1 &lt; 10)
   -&gt;  Index Scan using tenk2_unique2 on tenk2 t2  (cost=0.00..7.87 rows=1 width=244)
         Index Cond: (unique2 = t1.unique2)
</pre>


<p>
如果有条件无法在两个子节点上面执行，那就只能在 join 节点来做 filter，类似上面这个。实际执行时间和前面那个没有 t1.hundred &lt; t2.hundred 条件的差不多。
</p>
<p>
outer join 的时候，还可能会有 Join Filter 和 Filter 同时出现的情况，join filter 出现在外表的 on 语句里面，不匹配的数据依然会返回 null。而 filter 这个时候是用来过滤 join 结果的。
</p>
<p>
对于 inner join，Join Filter 和 Filter 两个没有区别。
</p>



<pre class="example">EXPLAIN SELECT *
FROM tenk1 t1, tenk2 t2
WHERE t1.unique1 &lt; 100 AND t1.unique2 = t2.unique2;

                                        QUERY PLAN
------------------------------------------------------------------------------------------
 Hash Join  (cost=230.43..713.94 rows=101 width=488)
   Hash Cond: (t2.unique2 = t1.unique2)
   -&gt;  Seq Scan on tenk2 t2  (cost=0.00..445.00 rows=10000 width=244)
   -&gt;  Hash  (cost=229.17..229.17 rows=101 width=244)
         -&gt;  Bitmap Heap Scan on tenk1 t1  (cost=5.03..229.17 rows=101 width=244)
               Recheck Cond: (unique1 &lt; 100)
               -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.01 rows=101 width=0)
                     Index Cond: (unique1 &lt; 100)
</pre>


<p>
改变一些条件，会看到执行计划变了，选择了 hash join。一个表的结果会在内层里面记录一个 hash 表，查另一个表的时候会查这个 hash 表来查看匹配的数据。
</p>



<pre class="example">EXPLAIN SELECT *
FROM tenk1 t1, onek t2
WHERE t1.unique1 &lt; 100 AND t1.unique2 = t2.unique2;

                                        QUERY PLAN
------------------------------------------------------------------------------------------
 Merge Join  (cost=197.83..267.93 rows=10 width=488)
   Merge Cond: (t1.unique2 = t2.unique2)
   -&gt;  Index Scan using tenk1_unique2 on tenk1 t1  (cost=0.00..656.25 rows=101 width=244)
         Filter: (unique1 &lt; 100)
   -&gt;  Sort  (cost=197.83..200.33 rows=1000 width=244)
         Sort Key: t2.unique2
         -&gt;  Seq Scan on onek t2  (cost=0.00..148.00 rows=1000 width=244)
</pre>


<p>
这是一个 merge jion 操作。merge join 需要输入的表都按照 join 字段先进行排序。从 t1 直接通过索引进行了查询，得到的结果就是顺序的。因为 t2 需要返回的数据量大，从 t2 做了全表扫描，然后进行了排序。通常全表扫描+排序比走索引消耗小。
</p>
<p>
出同样的结果有很多路可以走，如果想看看其他执行计划是否更实惠，可以通过打开关闭一些标志<sup><a class="footref" name="fnr.2" href="#fn.2">2</a></sup>来做到。
</p>



<pre class="example">SET enable_sort = off;

EXPLAIN SELECT *
FROM tenk1 t1, onek t2
WHERE t1.unique1 &lt; 100 AND t1.unique2 = t2.unique2;

                                        QUERY PLAN
------------------------------------------------------------------------------------------
 Merge Join  (cost=0.00..292.36 rows=10 width=488)
   Merge Cond: (t1.unique2 = t2.unique2)
   -&gt;  Index Scan using tenk1_unique2 on tenk1 t1  (cost=0.00..656.25 rows=101 width=244)
         Filter: (unique1 &lt; 100)
   -&gt;  Index Scan using onek_unique2 on onek t2  (cost=0.00..224.76 rows=1000 width=244)
</pre>


<p>
可以看到走索引比全表扫描消耗更大。
</p>

</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3"><span class="section-number-3">3</span> explain analyse</h3>
<div class="outline-text-3" id="text-3">


<p>
explain 的 analyse 选项可以看看规划器执行 sql 所用的真实时间。
</p>



<pre class="example">EXPLAIN ANALYZE SELECT *
FROM tenk1 t1, tenk2 t2
WHERE t1.unique1 &lt; 10 AND t1.unique2 = t2.unique2;

                                                           QUERY PLAN
---------------------------------------------------------------------------------------------------------------------------------
 Nested Loop  (cost=4.33..118.25 rows=10 width=488) (actual time=0.370..1.126 rows=10 loops=1)
   -&gt;  Bitmap Heap Scan on tenk1 t1  (cost=4.33..39.44 rows=10 width=244) (actual time=0.254..0.380 rows=10 loops=1)
         Recheck Cond: (unique1 &lt; 10)
         -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..4.33 rows=10 width=0) (actual time=0.164..0.164 rows=10 loops=1)
               Index Cond: (unique1 &lt; 10)
   -&gt;  Index Scan using tenk2_unique2 on tenk2 t2  (cost=0.00..7.87 rows=1 width=244) (actual time=0.041..0.048 rows=1 loops=10)
         Index Cond: (unique2 = t1.unique2)
 Total runtime: 2.414 ms
</pre>


<p>
如上所示，会显示出来真实的执行时间（毫秒），返回的行数等其他信息。为了和 explain 里面消耗的取值能匹配上，loop 大于 1 的节点显示的是单次执行的时间，需要乘以循环次数。
</p>



<pre class="example">EXPLAIN ANALYZE SELECT *
FROM tenk1 t1, tenk2 t2
WHERE t1.unique1 &lt; 100 AND t1.unique2 = t2.unique2 ORDER BY t1.fivethous;

                                                                 QUERY PLAN
--------------------------------------------------------------------------------------------------------------------------------------------
 Sort  (cost=717.30..717.56 rows=101 width=488) (actual time=104.950..105.327 rows=100 loops=1)
   Sort Key: t1.fivethous
   Sort Method: quicksort  Memory: 68kB
   -&gt;  Hash Join  (cost=230.43..713.94 rows=101 width=488) (actual time=3.680..102.396 rows=100 loops=1)
         Hash Cond: (t2.unique2 = t1.unique2)
         -&gt;  Seq Scan on tenk2 t2  (cost=0.00..445.00 rows=10000 width=244) (actual time=0.046..46.219 rows=10000 loops=1)
         -&gt;  Hash  (cost=229.17..229.17 rows=101 width=244) (actual time=3.184..3.184 rows=100 loops=1)
               Buckets: 1024  Batches: 1  Memory Usage: 27kB
               -&gt;  Bitmap Heap Scan on tenk1 t1  (cost=5.03..229.17 rows=101 width=244) (actual time=0.612..1.959 rows=100 loops=1)
                     Recheck Cond: (unique1 &lt; 100)
                     -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.01 rows=101 width=0) (actual time=0.390..0.390 rows=100 loops=1)
                           Index Cond: (unique1 &lt; 100)
 Total runtime: 107.392 ms
</pre>


<p>
有时候还会显示更多的一些信息，比如 sort 和 hash 节点。sort 节点会显示排序的方法，内存磁盘的占用。hash 节点会显示桶（buckets）和批次（batches），如果 batches 大于 1 会使用磁盘空间。
</p>



<pre class="example">EXPLAIN ANALYZE SELECT * FROM tenk1 WHERE ten &lt; 7;

                                                QUERY PLAN
----------------------------------------------------------------------------------------------------------
 Seq Scan on tenk1  (cost=0.00..483.00 rows=7000 width=244) (actual time=0.111..59.249 rows=7000 loops=1)
   Filter: (ten &lt; 7)
   Rows Removed by Filter: 3000
 Total runtime: 85.340 ms
</pre>


<p>
上面这个执行计划显示了 filter 移除了多少行结果。
</p>
<p>
explain 还提供了一个 buffers 选项。能得到 query 的哪部分 io 最密集。
</p>



<pre class="example">EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM tenk1 WHERE unique1 &lt; 100 AND unique2 &gt; 9000;

                                                            QUERY PLAN
-----------------------------------------------------------------------------------------------------------------------------------
 Bitmap Heap Scan on tenk1  (cost=25.07..60.23 rows=10 width=244) (actual time=3.069..3.213 rows=10 loops=1)
   Recheck Cond: ((unique1 &lt; 100) AND (unique2 &gt; 9000))
   Buffers: shared hit=16
   -&gt;  BitmapAnd  (cost=25.07..25.07 rows=10 width=0) (actual time=2.967..2.967 rows=0 loops=1)
         Buffers: shared hit=7
         -&gt;  Bitmap Index Scan on tenk1_unique1  (cost=0.00..5.02 rows=102 width=0) (actual time=0.732..0.732 rows=200 loops=1)
               Index Cond: (unique1 &lt; 100)
               Buffers: shared hit=2
         -&gt;  Bitmap Index Scan on tenk1_unique2  (cost=0.00..19.80 rows=1007 width=0) (actual time=2.015..2.015 rows=1009 loops=1)
               Index Cond: (unique2 &gt; 9000)
               Buffers: shared hit=5
 Total runtime: 3.917 ms
</pre>


<p>
要注意的是，explain analyse 会真的执行 sql，所以对于 update，insert，delete 等的 sql 操作，最好在执行的时候启用事务，执行完 explain 之后 rollback。
</p>
</div>

</div>

<div id="outline-container-4" class="outline-3">
<h3 id="sec-4"><span class="section-number-3">4</span> Caveats 注意事项</h3>
<div class="outline-text-3" id="text-4">


<p>
有两个情况可能会影响 explain analyse 和实际执行的差别
1 因为没有任何输出，所以 I/O 和网络网络传输消耗没有体现。
2 因为要输出执行时间，而有些系统里面 gettimeofday() 这个系统调用很慢，所以会导致消耗增加。
</p>
<p>
在衡量 explain 执行结果的时候，最好是在情况类似的 db 上面，否则可能没有任何参考价值。比如在一个小表上面的执行计划可能和大表就会很不一样。
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn.1" href="#fnr.1">1</a></sup> : http://www.postgresql.org/docs/9.2/static/runtime-config-query.html#RUNTIME-CONFIG-QUERY-CONSTANTS
</p>


<p class="footnote"><sup><a class="footnum" name="fn.2" href="#fnr.2">2</a></sup> : http://www.postgresql.org/docs/9.2/static/runtime-config-query.html#RUNTIME-CONFIG-QUERY-ENABLE
</p></div>
</div>

</div>
</div>

<div id="postamble">
<p class="date">Date: 2013-02-03 18:27:03 CST</p>
<p class="author">Author: Wang Dong</p>
<p class="creator">Org version 7.8.11 with Emacs version 24</p>
<a href="http://validator.w3.org/check?uri=referer" target="_blank" rel="external">Validate XHTML 1.0</a>
</div>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/postgresql-explain/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="redmine-a-good-project-tracker/">redmine-a-good-project-tracker</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-12-11T06:53:00.000Z" itemprop="datePublished">Dec 11, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a>
</div>
    </div>
      
        <p>其实很早，大概2，3年前就听说了 redmine 了，不过他环境是 ruby 的，一直没有勇气去搭一个环境。现在项目人多了，bug 阿 feature 阿，就需要记录一下了，因为有些事情不记录下来总是会忘记。之前是尝试通过 wiki ＋ bugfree 来记录的，bugfree 记录在提测之后的一些问题，wiki 记录一些 feature request 什么的。bugfree 我们没权限管理，wiki 记录又不方便，然后我就又想起来 redmine 了。</p>
<p>哦对，其实公司还提供了一个 jira 给大家用，我用了几次我觉得那玩意太难用了，和那个 confluence 的 wiki 一样难用。</p>
<p>本身搭建没什么难度，编译一个 ruby，然后 gem 安装几个包，下载 redmine，使用 rake 命令操作就好了。启动他的 server 之后，就可以访问了。下面几个东西是我花了一些时间配置的。</p>
<h2 id="和-ldap-集成"><a href="#和-ldap-集成" class="headerlink" title="和 ldap 集成"></a>和 ldap 集成</h2><p>在 redmine 的设置里面，本身是有一项和 redmine 集成的功能的，设置 basedn，和下面的 attributes 内容（sAMAccountName,givenName,sN,mail)就可以了。点测试，得能通过。</p>
<p>在我这里，光设置这个还不行，还需要 hack 一段代码。注意下面的那个 <code>@xxxx.com</code>，这个对应你自己的。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">ndex: app/models/auth_source_ldap.rb</div><div class="line"><span class="comment">===================================================================</span></div><div class="line"><span class="comment">--- app/models/auth_source_ldap.rb	(版本 10947)</span></div><div class="line"><span class="comment">+++ app/models/auth_source_ldap.rb	(工作副本)</span></div><div class="line"><span class="meta">@@ -135,11 +135,12 @@</span></div><div class="line">   # Get the user's dn and any attributes for them, given their login</div><div class="line">   def get_user_dn(login, password)</div><div class="line">     ldap_con = nil</div><div class="line"><span class="deletion">-    if self.account &amp;&amp; self.account.include?("$login")</span></div><div class="line"><span class="deletion">-      ldap_con = initialize_ldap_con(self.account.sub("$login", Net::LDAP::DN.escape(login)), password)</span></div><div class="line"><span class="deletion">-    else</span></div><div class="line"><span class="deletion">-      ldap_con = initialize_ldap_con(self.account, self.account_password)</span></div><div class="line"><span class="deletion">-    end</span></div><div class="line"><span class="addition">+    ldap_con = initialize_ldap_con(login + '@xxxxx.com', password)</span></div><div class="line"><span class="addition">+    #if self.account &amp;&amp; self.account.include?("$login")</span></div><div class="line"><span class="addition">+    #  ldap_con = initialize_ldap_con(self.account.sub("$login", Net::LDAP::DN.escape(login)), password)</span></div><div class="line"><span class="addition">+    #else</span></div><div class="line"><span class="addition">+    #  ldap_con = initialize_ldap_con(self.account, self.account_password)</span></div><div class="line"><span class="addition">+    #end</span></div><div class="line">     login_filter = Net::LDAP::Filter.eq( self.attr_login, login )</div><div class="line">     object_filter = Net::LDAP::Filter.eq( "objectClass", "*" )</div><div class="line">     attrs = &#123;&#125;</div><div class="line"><span class="meta">@@ -149,6 +150,8 @@</span></div><div class="line">       search_filter = search_filter &amp; f</div><div class="line">     end</div><div class="line"> </div><div class="line"><span class="addition">+    logger.debug "------------get_user_dn #&#123;login&#125; #&#123;self.base_dn&#125; #&#123;search_filter&#125; #&#123;search_attributes&#125;" if logger &amp;&amp; logger.debug?</span></div><div class="line"><span class="addition">+</span></div><div class="line">     ldap_con.search( :base =&gt; self.base_dn,</div><div class="line">                      :filter =&gt; search_filter,</div><div class="line">                      :attributes=&gt; search_attributes) do |entry|</div></pre></td></tr></table></figure>
<p>总之登陆验证的代码关键就在这里了，可以自己做尝试，建议先写最简单的代码测试。比如</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'rubygems'</span></div><div class="line"><span class="keyword">require</span> <span class="string">'net/ldap'</span></div><div class="line"></div><div class="line">ldap = Net::LDAP.new <span class="symbol">:host</span> =&gt; <span class="string">'qunarldap.corp.qunar.com'</span>,</div><div class="line">     <span class="symbol">:port</span> =&gt; <span class="number">389</span>,</div><div class="line">     <span class="symbol">:auth</span> =&gt; &#123;</div><div class="line">           <span class="symbol">:method</span> =&gt; <span class="symbol">:simple</span>,</div><div class="line">           <span class="symbol">:username</span> =&gt; <span class="string">"wd@xxxx.com"</span>,</div><div class="line">           <span class="symbol">:password</span> =&gt; <span class="string">"pwd"</span></div><div class="line">     &#125;</div><div class="line"></div><div class="line">filter = Net::LDAP::Filter.eq(<span class="string">"sAMAccountName"</span>,<span class="string">"wd*"</span>)</div><div class="line">object_filter = Net::LDAP::Filter.eq( <span class="string">"objectClass"</span>, <span class="string">"*"</span> )</div><div class="line">search_filter = filter &amp; object_filter</div><div class="line"></div><div class="line">treebase = <span class="string">"你的 basedn"</span> <span class="comment">#</span></div><div class="line"></div><div class="line">attr = [<span class="string">"dn"</span>, <span class="string">"givenName"</span>, <span class="string">"sN"</span>, <span class="string">"mail"</span>]</div><div class="line"></div><div class="line">ldap.search(<span class="symbol">:base</span> =&gt; treebase, <span class="symbol">:filter</span> =&gt; search_filter, <span class="symbol">:attributes</span> =&gt; attr ) <span class="keyword">do</span> <span class="params">|entry|</span></div><div class="line">  puts <span class="string">"DN: <span class="subst">#&#123;entry.dn&#125;</span>"</span></div><div class="line">  entry.each <span class="keyword">do</span> <span class="params">|attribute, values|</span></div><div class="line">    puts <span class="string">"   <span class="subst">#&#123;attribute&#125;</span>:"</span></div><div class="line">    values.each <span class="keyword">do</span> <span class="params">|value|</span></div><div class="line">      puts <span class="string">"      ---&gt;<span class="subst">#&#123;value&#125;</span>"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">p ldap.get_operation_result</div></pre></td></tr></table></figure>
<p>搞定这块，就可以通过 ldap 用户直接登陆了，登陆会自动创建用户。</p>
<h2 id="通过回复邮件自动创建和更新-issue"><a href="#通过回复邮件自动创建和更新-issue" class="headerlink" title="通过回复邮件自动创建和更新 issue"></a>通过回复邮件自动创建和更新 issue</h2><p>用过 bugzilla 的都知道，可以通过邮件回复的方式来 comment issue。redmine 也提供了这个功能。我这种对 mail 服务器无权的用户，只能申请一个邮箱专门做这个事情了。公司邮箱是 exchange 的，没有打开 imap。redmine 只提供了 imap，pop 之类的方式。好在还有 davmail。先配置好一个 davmail，然后通过 imap 来做这个事情，imap 比 pop 好处多很多，比如可以指定 inbox，可以 move 到 read 之类，就不多说了。</p>
<p>crontab 指令大概如下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line">LOG=/<span class="built_in">export</span>/redmine/<span class="built_in">log</span>/mail_recieve.log</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"start <span class="variable">$(date)</span>"</span> &gt;&gt; <span class="variable">$LOG</span></div><div class="line"></div><div class="line">/usr/<span class="built_in">local</span>/ruby/bin/rake --silent <span class="_">-f</span> /<span class="built_in">export</span>/redmine/Rakefile redmine:email:receive_imap RAILS_ENV=<span class="string">"production"</span> host=localhost username=abc password=def port=1143 move_on_success=<span class="built_in">read</span> move_on_failure=failed unknown_user=accept &gt;&gt; <span class="variable">$LOG</span> 2&gt;&amp;1</div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"end <span class="variable">$(date)</span>"</span> &gt;&gt; <span class="variable">$LOG</span></div></pre></td></tr></table></figure>
<p>不过如果 redmine 就这么简单就搞定的话，那我也没必要单独拿出来掰了。关键是，通过 imap 死活就是不行。只好又看了一下代码。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">Index: lib/redmine/imap.rb</span></div><div class="line"><span class="comment">===================================================================</span></div><div class="line"><span class="comment">--- lib/redmine/imap.rb	(版本 10947)</span></div><div class="line"><span class="comment">+++ lib/redmine/imap.rb	(工作副本)</span></div><div class="line"><span class="meta">@@ -30,8 +30,9 @@</span></div><div class="line">         imap.login(imap_options[:username], imap_options[:password]) unless imap_options[:username].nil?</div><div class="line">         imap.select(folder)</div><div class="line">         imap.search(['NOT', 'SEEN']).each do |message_id|</div><div class="line"><span class="deletion">-          msg = imap.fetch(message_id,'RFC822')[0].attr['RFC822']</span></div><div class="line"><span class="deletion">-          logger.debug "Receiving message #&#123;message_id&#125;" if logger &amp;&amp; logger.debug?</span></div><div class="line"><span class="addition">+          #msg = imap.fetch(message_id,'RFC822')[0].attr['RFC822']</span></div><div class="line"><span class="addition">+          msg = imap.fetch(message_id,'BODY[]')[0].attr['BODY[]']</span></div><div class="line"><span class="addition">+          logger.debug "Receiving message #&#123;message_id&#125;, msg:\n#&#123;msg&#125;" if logger &amp;&amp; logger.debug?</span></div><div class="line">           if MailHandler.receive(msg, options)</div><div class="line">             logger.debug "Message #&#123;message_id&#125; successfully received" if logger &amp;&amp; logger.debug?</div><div class="line">             if imap_options[:move_on_success]</div></pre></td></tr></table></figure>
<p>这里把那个 RFC822 改成 BODY[] 就好了，入丝般润滑。。。</p>
<h2 id="过滤掉邮件回复的垃圾内容"><a href="#过滤掉邮件回复的垃圾内容" class="headerlink" title="过滤掉邮件回复的垃圾内容"></a>过滤掉邮件回复的垃圾内容</h2><p>邮件回复 ok 之后，紧跟着问题就是，他会把整封邮件都作为回复记录进去，这个太恶心了。还好他提供了设置，在 email notification 选项里面，配置一个 email header <code>--Reply above this line--</code>，在 incoming mail 里面配置一个 Truncate emails after one of these lines <code>--Reply above this line--</code>，他就会截取这个字符前面的内容了。</p>
<p>不过还有问题就是，一般邮件回复都开头都是个 <code>On xxxx xxx wrote:</code>，这个他不会截掉，那就再 hack 一下。。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--- app/models/mail_handler.rb	(版本 10947)</span></div><div class="line"><span class="comment">+++ app/models/mail_handler.rb	(工作副本)</span></div><div class="line"><span class="meta">@@ -463,9 +464,12 @@</span></div><div class="line"> </div><div class="line">   # Removes the email body of text after the truncation configurations.</div><div class="line">   def cleanup_body(body)</div><div class="line"><span class="deletion">-    delimiters = Setting.mail_handler_body_delimiters.to_s.split(/[\r\n]+/).reject(&amp;:blank?).map &#123;|s| Regexp.escape(s)&#125;</span></div><div class="line"><span class="addition">+    #delimiters = Setting.mail_handler_body_delimiters.to_s.split(/[\r\n]+/).reject(&amp;:blank?).map &#123;|s| Regexp.escape(s)&#125;</span></div><div class="line"><span class="addition">+    delimiters = Setting.mail_handler_body_delimiters.to_s.split(/[\r\n]+/).reject(&amp;:blank?).map &#123;|s| s&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line">     unless delimiters.empty?</div><div class="line">       regex = Regexp.new("^[&gt; ]*(#&#123; delimiters.join('|') &#125;)\s*[\r\n].*", Regexp::MULTILINE)</div><div class="line"><span class="addition">+      #regex = Regexp.new("(^[&gt; ]*(#&#123; delimiters.join('|') &#125;)\s*[\r\n].*)|(On (.*)wrote:[\r\n].*)", Regexp::MULTILINE)</span></div><div class="line">       body = body.gsub(regex, '')</div><div class="line">     end</div><div class="line">     body.strip</div></pre></td></tr></table></figure>
<p>这里搞定之后，在那个 Truncate emails after one of these lines 里面就可以写正则了，增加一行 <code>On (.*)wrote:</code>，然后就可以了。</p>
<h2 id="code-review"><a href="#code-review" class="headerlink" title="code review"></a>code review</h2><p>增加了一个 code review 插件，已有项目需要在项目的模块里面启用。并且需要 admin 在角色配置里面，给相应角色增加 code review 的权限。不过貌似这插件不太好用，只能一行一行来。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/redmine-a-good-project-tracker/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="some-tips-on-bash-scripting/">Some tips for bash scripting</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-12-02T11:43:00.000Z" itemprop="datePublished">Dec 2, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/Web/">Web</a>
</div>
    </div>
      
        <p>最近几天写了一些 bash 脚本，又有些心得，记录一下。</p>
<h2 id="获取当前路径的绝对路径"><a href="#获取当前路径的绝对路径" class="headerlink" title="获取当前路径的绝对路径"></a>获取当前路径的绝对路径</h2><p>比较常见的需求可能是获取相对路径，这样方便程序复制到其他目录也可以运行。使用 <code>$(dirname $0)</code> 就可以获取相对路径，不过这里说的是绝对路径。</p>
<p>其实也简单，相对路径加上当前目录，那不就是绝对路径么。不过是，有时候 <code>$(dirname $0)</code> 取到的也可能是绝对路径（一般期望相对路径的程序也能跑通，所以不大关心）。</p>
<p>可以用下面的做法，大意是先判断一下获取到的路径是不是 <code>/</code> 开头，如果是，那就不处理，如果不是，那就把当前的路径附加上去得到一个绝对路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">PG_DIR=<span class="string">"<span class="variable">$(dirname $0)</span>/../"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$PG_DIR</span>"</span> | grep -q ^/</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-ne</span> 0 ];<span class="keyword">then</span></div><div class="line">        PG_DIR=<span class="string">"<span class="variable">$(pwd)</span>/<span class="variable">$PG_DIR</span>"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<h2 id="使用-getopt-获取命令行参数"><a href="#使用-getopt-获取命令行参数" class="headerlink" title="使用 getopt 获取命令行参数"></a>使用 getopt 获取命令行参数</h2><p>获取参数比较常见的做法是取 <code>$1</code> <code>$2</code> 这些，不过不太专业，这里说的是类似于 <code>--prefix=/path/to/install -v</code> 这种。</p>
<p>bash 本身提供了一个内部命令 <code>getopts</code> 来做这个事情，不过那个只能支持 short_opts，就是类似 <code>-v</code> 这种，不支持长的。</p>
<p>getopt 是一个 GNU 程序，他支持 long_opts。下面是个例子。代码基本来自网上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ARGS=$(getopt <span class="_">-a</span> -o h <span class="_">-l</span> initdb::,<span class="built_in">help</span> -- <span class="string">"<span class="variable">$@</span>"</span>)</div><div class="line">[ $? <span class="_">-ne</span> 0 ] &amp;&amp; usage</div><div class="line"></div><div class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">"<span class="variable">$&#123;ARGS&#125;</span>"</span> </div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span></div><div class="line"><span class="keyword">do</span></div><div class="line">        <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">                --initdb)</div><div class="line">                        initdb <span class="variable">$2</span></div><div class="line">                        ;;</div><div class="line">                -h|--help)</div><div class="line">                        usage;</div><div class="line">                        ;;</div><div class="line">                --)</div><div class="line">                        <span class="built_in">shift</span></div><div class="line">                        <span class="built_in">break</span></div><div class="line">                        ;;</div><div class="line">        <span class="keyword">esac</span></div><div class="line">        <span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>解释一下上面的参数的含义:</p>
<ul>
<li><code>-o</code> 参数指定的就是短参数，我试过，貌似还得指定至少一个短参数。</li>
<li><code>-l</code> 参数指定的就是长参数。</li>
<li>多个参数用逗号 <code>,</code> 分隔。</li>
<li>参数后面跟一个冒号 <code>:</code> 表示这个参数(option)必须要给一个参数(argument)，类似上面的 <code>--prefix=/path/to/install</code> 这种。</li>
<li>参数后面跟2个冒号 <code>::</code> 表示这个参数后面的参数可有可无。比如例子里面的 <code>--initdb</code></li>
</ul>
<h2 id="find-exec-提示-No-such-file-or-directory"><a href="#find-exec-提示-No-such-file-or-directory" class="headerlink" title="find exec 提示 No such file or directory"></a>find exec 提示 No such file or directory</h2><p>这个是之前用来日志删除的一个程序，大概命令类似 <code>find ./ -name &#39;2012*&#39; -exec rm -r {} \;</code>，后来总发现报 <code>No such file or directory</code> 这个错误，可是去看的时候，发现那些目录也被删掉了。开始觉得可能是有其他人的程序也在删除这个目录，问了一圈结果没人删。</p>
<p>后来经过测试琢磨找到原因了，在于这个命令的执行思路大概是先去找那个名字的文件或者目录，然后挨个执行后面的命令。那么，如果找到的既有上级目录，也有下级文件的时候，如果目录先被删掉了，那删文件的时候可不就是 <code>No such file or directory</code> 么。</p>
<p>好在 find 提供了一个参数 <code>-prune</code><br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-prune True; <span class="keyword">if</span> <span class="keyword">the</span> <span class="built_in">file</span> is <span class="keyword">a</span> <span class="built_in">directory</span>, <span class="built_in">do</span> <span class="keyword">not</span> descend <span class="keyword">into</span> <span class="keyword">it</span>. If -depth is given, <span class="literal">false</span>; no effect.  Because -<span class="built_in">delete</span> implies -depth, you can-</div><div class="line">       <span class="keyword">not</span> usefully use -prune <span class="keyword">and</span> -<span class="built_in">delete</span> together.</div></pre></td></tr></table></figure></p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/some-tips-on-bash-scripting/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="hello-world/">Hello world</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-11-28T10:38:00.000Z" itemprop="datePublished">Nov 28, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a>
</div>
    </div>
      
        <p>Just a test.</p>
<p>Hello world from github :D</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/hello-world/#disqus_thread">Comments</a></span>
	
</div>
</article>


  <nav id="pagenavi">
    
        <a href="/page/2/" class="prev">Prev</a>
    
    
        <a href="/page/4/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2016

    wd
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
