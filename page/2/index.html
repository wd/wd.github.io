<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>wd and cc</title>
    <meta name="author" content="wd">
    
	<meta name="description" content="undefined"> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>
<span class="subtitle">happy everyday</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/wd" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://wdicc.com" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        

    
        <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    



  <article class="post">
	<h2 class="title">
		<a href="new-and-old/">新与旧</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-11-13T05:39:18.000Z" itemprop="datePublished">Nov 13, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/heart/">heart</a>
</div>
    </div>
      
        <p>北京有个古北水镇，运营上据说是杭州乌镇的那拨人。乌镇没去过，去过古北水镇。在一片山里面，长城下面，一群建筑。里面还开了一些模仿古代的商店，比如酒家，染坊这些可以参观。</p>
<p>这个地方离北京大概是 2 个多小时的车程（全程高速不怎么堵车的情况下）。周末过去之后会发现停车场停满了车，还有好多旅游车，水镇上面也人山人海。</p>
<p>这里面的建筑都是后期开发商人工开辟的。景区里面的酒店基本都是1k起，并且还得提前预约。据说夜景很漂亮，不过我没看过。</p>
<p>北京是个古老的城市，如果城区里面的历史建筑都留着，现在可够你转几个月的，光就绕着北京城墙走一圈，估计一天都不一定可以。曾经在西安的城墙上面走过一圈，感觉还不错，我记得还收了门票的。</p>
<p>北京有个南锣鼓巷，过去转你会发现并没有什么能让你理解回味京味的东西，卖的也是羊肉串奶茶这些，排好长的队买一串拿着边吃边走完了，其实可能也挺没意思的。</p>
<p>都说台湾是中华传统保持比较好的地方。去了台北第一印象就是，破房子挺多的。那边房子是私产，所以拆迁很难。然后个人又不一定有能力翻盖，所以就有破烂的房子。给我们开车的台湾人还说去过北京，说羡慕那边的高楼大厦，到处都很新，很时髦的样子。</p>
<p>台湾有很多夜市，去过几个，有的比较商业化的，你会发现周边也都是高楼了。有的就是普通的，真的是一条路白天行车，晚上就堵起来开始摆摊。我记得某个夜市里面有个摊位，说是开了好多年了，现在物价高，不得已只好比早年涨了几毛钱。看着都震惊了，涨几毛钱还废什么话，况且本身人家卖的也不贵，都是良心价。</p>
<p>地价涨没那么快，可能各种基础花费都会比较稳定，否则地价涨了房租涨了，那物价必定会涨。所以10年前我在北京长椿街那上班的时候，一份盖饭，大概是 7，8 块钱。到了现在，估计是翻一倍。另外这种店还越来越少，因为卫生条件，房租这些要求导致价格底了不好赚钱。</p>
<p>台湾夜市里面也经常能碰见那种几十年的老店，那真的是几十年一直在做那个生意。几十年价格也没有变化太多。想起来前门的那个面馆前段时间关门了，没有办法，涨价没法涨，收入基本不变的情况下，地价变化太大，只好关门了。</p>
<p>就目前这个房地产的情况，北京还能有多少真正的老字号，有多少真正的老街，估计基本不会有了。后面估计会有更加多人工的景区了，费用估计还不能便宜了。</p>
<p>想起来凤凰古城了，大家不愿意拆，那就某天一把火烧了，这下都同意了吧，这可是天意。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/new-and-old/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="decorator-in-python/">python 的 decorator 学习</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-10-21T10:50:59.000Z" itemprop="datePublished">Oct 21, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/python/">python</a> <a href="/tags/decorator/">decorator</a>
</div>
    </div>
      
        <p>最近学习了一下 python 的 decorator（装饰器），看的是这篇，<a href="http://coolshell.cn/articles/11265.html" target="_blank" rel="external">Python修饰器的函数式编程</a>， 觉得挺有意思的，写点东西记录一下。</p>
<p>装饰器简单讲就是返回一个函数的函数/类。看个简单的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec1</span><span class="params">(fn)</span>:</span></div><div class="line">    print(<span class="string">'inside dec1'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">()</span>:</span></div><div class="line">        print(<span class="string">'inside wrapper'</span>)</div><div class="line">        <span class="keyword">return</span> fn()</div><div class="line">    <span class="keyword">return</span> wrapper</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@dec1</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'inside f1'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    print(<span class="string">'begin exec'</span>)</div><div class="line">    f1()</div><div class="line">    print(<span class="string">'end exec'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 执行结果:</span></div><div class="line"><span class="comment"># inside dec1</span></div><div class="line"><span class="comment"># begin exec</span></div><div class="line"><span class="comment"># inside wrapper</span></div><div class="line"><span class="comment"># inside f1</span></div><div class="line"><span class="comment"># end exec</span></div></pre></td></tr></table></figure>
<p>看上面例子能看到，装饰器生效有 2 个步骤，第一个是装饰，第二个是执行。上面装饰器的效果，和下面的代码的效果是一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec1</span><span class="params">(fn)</span>:</span></div><div class="line">    print(<span class="string">'inside dec1'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">()</span>:</span></div><div class="line">        print(<span class="string">'inside wrapper'</span>)</div><div class="line">        <span class="keyword">return</span> fn()</div><div class="line">    <span class="keyword">return</span> wrapper</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># @dec1</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'inside f1'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    print(<span class="string">'begin exec'</span>)</div><div class="line">    dec1(f1)()</div><div class="line">    print(<span class="string">'end exec'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 执行结果:</span></div><div class="line"><span class="comment"># begin exec</span></div><div class="line"><span class="comment"># inside dec1</span></div><div class="line"><span class="comment"># inside wrapper</span></div><div class="line"><span class="comment"># inside f1</span></div><div class="line"><span class="comment"># end exec</span></div></pre></td></tr></table></figure>
<p>可以看到除了 「begin/end exec」，其他部分执行结果是一样的。所以理解装饰器，就把 <code>@dec1</code> 换成 <code>dec1(fn)()</code> 这么理解就可以了。</p>
<p>有时候会看到类也可以作为装饰器使用。其实理解起来也类似。举个例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">dec1</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, fn)</span>:</span></div><div class="line">        print(<span class="string">'inside dec1'</span>)</div><div class="line">        self.fn = fn</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></div><div class="line">        print(<span class="string">'inside wrapper'</span>)</div><div class="line">        <span class="keyword">return</span> self.fn()</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@dec1</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'inside f1'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    print(<span class="string">'begin exec'</span>)</div><div class="line">    f1()</div><div class="line">    print(<span class="string">'end exec'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 执行结果:</span></div><div class="line"><span class="comment"># inside dec1</span></div><div class="line"><span class="comment"># begin exec</span></div><div class="line"><span class="comment"># inside wrapper</span></div><div class="line"><span class="comment"># inside f1</span></div><div class="line"><span class="comment"># end exec</span></div></pre></td></tr></table></figure>
<p>这里和上面类似，把 <code>@dec1</code> 理解成 <code>dec1(fn)()</code>，不过是这里的 <code>dec1</code> 是个类，那么 <code>dec1(fn)</code> 其实是调用的 <code>dec1.__init__(fn)</code>，那么后续的 <code>dec1(fn)()</code> 就是调用产生的对象的 <code>dec1.__call__()</code> 了。</p>
<p>有时候还能看到加了参数的装饰器。加了参数的是怎么回事呢。再看下面的例子。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/python</span></div><div class="line"><span class="comment"># -*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec1</span><span class="params">(name)</span>:</span></div><div class="line">    print(<span class="string">'inside dec1'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">real_dec1</span><span class="params">(fn)</span>:</span></div><div class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span><span class="params">()</span>:</span></div><div class="line">            print(<span class="string">'inside wrapper'</span>)</div><div class="line">            <span class="keyword">return</span> fn()</div><div class="line">        <span class="keyword">return</span> wrapper</div><div class="line">    <span class="keyword">return</span> real_dec1</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">@dec1(name='1')</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'inside f1'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    print(<span class="string">'begin exec'</span>)</div><div class="line">    f1()</div><div class="line">    print(<span class="string">'end exec'</span>)</div><div class="line"></div><div class="line"><span class="comment"># 执行结果:</span></div><div class="line"><span class="comment"># inside dec1</span></div><div class="line"><span class="comment"># begin exec</span></div><div class="line"><span class="comment"># inside wrapper</span></div><div class="line"><span class="comment"># inside f1</span></div><div class="line"><span class="comment"># end exec</span></div></pre></td></tr></table></figure>
<p>看懂了没有，就是多了个嵌套而已。遇到加了参数的，那就是把之前的没有参数的部分返回回来就可以了。等价的例子就不贴了，这个等价于 <code>dec1(name=&#39;1&#39;)(fn)()</code>。</p>
<p>如果是类装饰器，并且有参数，那等价于 <code>dec1(name=&#39;1&#39;)(fn)()</code>，其中 <code>__init__(self, name)</code> 先处理第一层参数，然后 <code>__call__(fn)</code> 处理第二层，然后需要在 <code>__call__</code> 里面再定义一个 wrapper 返回。</p>
<p>说明白没有？呵呵。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/decorator-in-python/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="about-http-cookie/">cookie 的一点研究</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-09-16T00:59:09.000Z" itemprop="datePublished">Sep 16, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/cookie/">cookie</a> <a href="/tags/http/">http</a>
</div>
    </div>
      
        <p>这几天搞了一下 python 里面 cookie 相关的东西。我的目的是想要尝试用 python 登录某个网站，并且保持登录状态直到过期。因为 http 协议是无状态的，所以一般来讲，网站想要用户保持登录，那么网站在用户登录之后，必须要和用户端协商好怎么来证明这个用户已经登录过了。</p>
<p>用户端如果使用浏览器，那么网站就可以利用浏览器对 cookie 的支持来让用户在不知情的情况下，让网站在用户登录后发的一个 token 在用户后续的请求里面都包含上。</p>
<p>用户端如果不是浏览器，比如是个 python 程序，那么网站可以和用户协商每次请求里面都包含某个下发的 token（当然，甚至要求客户端每次请求都带着用户名密码也是可行的）。</p>
<p>但是如果网站本身只是给浏览器用户准备的，那么通过用程序来「模拟」浏览器行为，把必要的 token 保存并在后续的请求里面都带上，也是可行的。</p>
<p>python 里面，发送 http 请求可以简单的使用 <code>urllib.request.urlopen(url)</code>，但是如果想要定制一下请求，比如修改一些 header 信息，那么就得使用 <code>urllib.request.Request</code> 这个 class 先构造一个 Request 对象，然后传递给 urlopen 了。</p>
<p>如果要处理 cookie，那就需要使用 <code>http.cookiejar.CookieJar</code> 了，有了 Cookiejar 对象，就可以把网站下发的 cookie 保存到这个变量里面，然后在必要的时候，可以返回给服务器端了。如果想要保存到文件，那么可以使用 <code>http.cookiejar.LWPCookieJar</code> 或者 <code>http.cookiejar.MozillaCookieJar</code>，也可以基于 <code>http.cookiejar.FileCookieJar</code> 自己实现一个子类，来用自己的办法保存和加载 cookie，比如保存到数据库什么的，这样就可以多台机器之间共享 cookie 了。</p>
<p><code>urlopen</code> 本身不支持自定义 cookiejar 逻辑，得使用 <code>opener = build_opener(HTTPCookieProcessor(cookiejar=Cookiejar对象))</code> 来先构造一个自定义的 openner, 然后使用 <code>opener(Request对象)</code> 来发送请求。</p>
<p>如果不定义自己的 cookie policy，那么会使用默认的 <code>http.cookiejar.DefaultCookiePolicy</code>，也可以自己基于 <code>http.cookiejar.CookiePolicy</code> 实现自己的逻辑。只需要 override <code>set_ok</code> 和 <code>return_ok</code> 这两个方法就可以。</p>
<p>http cookie 其实有很多属性，比如 domain, expire, path 等常见属性，也有 httponly, secure 等几个不常见的。这些属性都是浏览器处理的。就是说，浏览器把 cookie 返回给服务器端的时候，如果 domain 不匹配，或者已经过了 expire 时间等等一些不符合浏览器制定的 cookie 逻辑的时候，浏览器就不会把 cookie 发送给服务器端。就比如，服务器产生 cookie 的时候，声明了 domain=a.com，那么如果是来自于 b.com 的请求，浏览器是根本不会给他发送这个 cookie。再比如，服务器端产生 cookie 的时候，声明了 1 天后过期，那么 1 天之后，浏览器也不会再给服务器端发这个 cookie 了。</p>
<p>但是如果是我们自己实现客户端模拟浏览器的时候，其实我们是可以耍流氓的，可以制定自己的 cookie 逻辑，也就是上面提到的 cookie policy。比如我可以简单的在 <code>return_ok</code> 这个方法里面 <code>return True</code>，在任何情况下都把所有的 cookie 返回给服务器，这样服务器端如果不提前想明白，它是一点都不知道的。</p>
<p>所谓提前想明白就是想明白是不是需要针对这种情况做处理。如果本身我们系统也没有那么严格要求，那么不处理也可以。但是如果是某个比如金融系统，那么是必须要考虑的。否则如果完全依赖 cookie 的话，如果我通过某些手段弄到了用户的 cookie，那么我就可以骗过服务器端，让他认为我就是那个用户。</p>
<p>我想了一下，貌似被盗窃 cookie 这种事情服务器端不太好防范，但是可以做的是防止浏览器耍流氓。比如我们把 cookie 加密，并里面增加一个发送 cookie 的时间。收到客户端发过来的 cookie 之后，我们解密看看时间有没有过期，这样就可以在服务器端让 cookie 失效了。</p>
<p>另外，也可以考虑使用 session。session 是把一些用户的状态保存在服务器端。但是 session 实际上也是依赖 cookie 的，因为前面说了 http 协议无状态，就算可以把用户状态保存在服务器端，但是总还是得识别用户才可以。那个识别的 cookie 就是所谓的 session cookie，其实就是某个用户的唯一标识。</p>
<p>对于 session cookie 被窃，好像也没有太好的办法，无非也是想办法比对之前用户的一些状态信息，比如 ip 和现在的信息是不是一致，不一致可以认为有被窃的怀疑，这个时候让用户再次验证用户信息，这都不能 100% 保证，但是至少会增加窃贼的成本。</p>
<p>上面说到这些，都可以自己测试一下，测试也并不一定需要搭一个服务器端配合，以及使用复杂的抓包专鉴，其实使用 <code>nc</code> 就可以。</p>
<p>使用 <code>nc -l 9999</code> 就可以启动一个监听在 9999 端口的 socket 服务器。之后使用 python 或者 curl 之类的程序请求，就能立刻看到请求发送过来的 http 信息，这个对于学习 http 协议其实也很方便。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ nc -l <span class="number">9999</span></div><div class="line">GET <span class="regexp">/ HTTP/</span><span class="number">1.1</span></div><div class="line">Accept-<span class="string">Encoding:</span> identity</div><div class="line"><span class="string">Connection:</span> close</div><div class="line"><span class="string">Cookie:</span> QN2=test; QN1=ClbaCVfZF5lfszBALzTIAg==</div><div class="line">User-<span class="string">Agent:</span> Mozilla<span class="regexp">/5.0 (Macintosh; Intel Mac OS X 10_11_6)  AppleWebKit/</span><span class="number">537.36</span> (KHTML, like Gecko) Chrome<span class="regexp">/52.0.2743.116 Safari/</span><span class="number">537.36</span></div><div class="line"><span class="string">Host:</span> <span class="string">localhost:</span><span class="number">9999</span></div></pre></td></tr></table></figure>
<p>收到的上面这个请求，可以看到发送过来了 2 个 cookie。</p>
<p>如果还想测试数据返回的情况，那么可以写一个 <code>test.resp</code> 文件，内容如下</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ cat test.resp</div><div class="line">HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</div><div class="line"><span class="symbol">Date:</span> Sun, <span class="number">18</span> Oct <span class="number">2009</span> <span class="number">08</span>:<span class="number">56</span>:<span class="number">53</span> GMT</div><div class="line"><span class="symbol">Server:</span> Apache/<span class="number">2.2</span><span class="number">.14</span> (Win32)</div><div class="line">Last-Modified: Sat, <span class="number">20</span> Nov <span class="number">2004</span> <span class="number">07</span>:<span class="number">16</span>:<span class="number">26</span> GMT</div><div class="line"><span class="symbol">ETag:</span> <span class="string">"10000000565a5-2c-3e94b66c2e680"</span></div><div class="line">Set-Cookie: QN1=ClbaCVfZF5lfszBALzTIAg==; expires=Thu, <span class="number">31</span>-Dec<span class="number">-37</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">55</span> GMT; path=/</div><div class="line">Set-Cookie: QN2=test; expires=Thu, <span class="number">31</span>-Dec<span class="number">-37</span> <span class="number">23</span>:<span class="number">55</span>:<span class="number">55</span> GMT; path=/; secure; httponly</div><div class="line">Accept-Ranges: bytes</div><div class="line">Content-Length: <span class="number">44</span></div><div class="line"><span class="symbol">Connection:</span> close</div><div class="line">Content-Type: text/html</div><div class="line">X-Pad: avoid browser bug</div><div class="line"></div><div class="line"><span class="params">&lt;html&gt;</span><span class="params">&lt;body&gt;</span><span class="params">&lt;h1&gt;</span>It works!<span class="params">&lt;/h1&gt;</span><span class="params">&lt;/body&gt;</span><span class="params">&lt;/html&gt;</span></div></pre></td></tr></table></figure>
<p>然后使用 <code>nc -l 9999 &lt; test.resp</code> 命令启动服务，客户端来请求的时候，就会返回上面 <code>test.resp</code> 里面的内容。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/about-http-cookie/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="double-pinyin/">从双拼讲输入法</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-08-20T02:00:51.000Z" itemprop="datePublished">Aug 20, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/input/">input</a>
</div>
    </div>
      
        <p>上高中的时候，就流行五笔打字，不过那会家里都没有电脑，都是去网吧（或者叫打字社）去学习的，不过那会学习这个貌似唯一的用途就是录入用。</p>
<p>当时也背过五笔的码表，王旁青头兼五一，估计很多人都很熟悉。上了大学在有更多机会接触电脑的时候，上网什么的，自然就开始使用拼音输入法，因为基本不需要练习，会盲打知道键盘按键键位就可以使用。当时用的比较多的是智能 ABC，后来 2000 年左右写书的时候，用的是紫光拼音，紫光的词库比智能 ABC 好一点，所以用起来也好用很多。此后一直使用拼音输入法。</p>
<p>直到应该是大概 2008 年左右，ssslang 在使用二笔，就开始想尝试一下码表输入法。因为本身使用了这么多年的电脑输入和拼音输入法之后，对字形其实已经失去了概念，如果学五笔的话，肯定会是很痛苦的。</p>
<p>而二笔输入法一个字 4 个码，第一个码还是拼音的第一个字母，但是大部分常用字都是 2 个码就可以出，所以这样等于每个字都至少知道了一半的编码，这个还是很赞的。</p>
<p>二笔输入法也有很多编码方案，当时选的是哲豆二笔，这个方案只用了 26 个字母键，所以也可以在手机上面使用（其他方案用了一些符号键，比如 [ ]，当时手机还都是流行硬键盘，一般都没有单独的符号键，而且貌似现在的软键盘也没有单独的符号键）。我当时用的 palm treo 650，输入还是蛮爽的。后来自己把一些词库导入了进去，用起来就更加舒服了。</p>
<p>但是后来的问题是慢慢的一些流行的智能机没有那么好的输入法自定义支持，就没法用了，慢慢切回来了拼音输入法。</p>
<p>二笔是码表输入法，就是每个字有自己的编码，联系的过程就是熟悉码表的过程，如果某个字不熟悉，那么其实你是需要轻微的思考的，想一下那个字怎么写，是哪个码。所以输入的速度取决于对这些字的熟悉程度，遇到不熟悉的会有卡顿。</p>
<p>最近看到了不少双拼的讨论，就想尝试一下双拼。因为如果反正都是用拼音输入法，那么对于 ing, eng 这些，如果可以按一个按键就输入进去，那么岂不是可以节省很多时间？并且这个还是基于拼音的，和那些需要记住字形的输入法不是一个套路，看着还不错。</p>
<p>我是这周一开始尝试的。mac 上面用的是鼠须管，ios 用的 touchpal。双拼也有很多方案，我选的方案是小鹤双拼，也没啥特别的原因，就是看用的人挺多的。</p>
<p>尝试的结果就是，输入了 4 天之后，周五我又换回了拼音输入法。。。。</p>
<p>因为我越用越发现，双拼也是个码表输入法。开始想得是节省拼音的输入时间，但是打字的时候，比如输入 hao 的时候，想到的不是输入 h 然后输入 ao 对应的字母 c，而是熟悉之后自然而然的按照 hc 来输入，下次需要输入 lao 的时候，还是需要想一下 ao 在字母 c，需要输入 lc。</p>
<p>这么看的话，和前面说的码表输入法有啥区别呢？所以我感觉双拼也是个码表输入法。既然是码表输入法，双拼的区分度那么差，何必折腾他呢，不如去用二笔呢。而且我用的时候最郁闷的是，二笔训练出来的键位记忆居然总会出来捣乱，这其实也更加说明这个就是码表输入法。。。</p>
<p>而且还有就是，普通拼音输入法里面，尤其是手机上面，容易按错键，比如 hao 输入成了 hso 的时候，手机上面会纠错，把「好」这个选项放在第一个。但是如果是双拼就没那么好搞了，如果也增加纠错，那会增加很多重码，体验不好。</p>
<p>另外还有个问题就是对于 sh, s, en, eng 这些不太清楚的人来讲，更加是个挑战，当然拼音可以用模糊音，按说双拼也可以想办法自定义模糊音。但是可能就失去了双拼的一些优势。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/double-pinyin/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="evolution/">进化论</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-08-20T01:55:17.000Z" itemprop="datePublished">Aug 20, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/tech/">tech</a>
</div>
    </div>
      
        <h2 id="回忆一些没用的"><a href="#回忆一些没用的" class="headerlink" title="回忆一些没用的"></a>回忆一些没用的</h2><p>我是 1998 年上的大学。小的时候就对各种电子产品比较感兴趣，当然其实没有什么机会的，当时主要就是游戏机，但是我家里是没有的。高中的时候曾经借同学的回家玩过，和我弟弟一起玩的挺嗨，但是对于增长知识应该是没啥用的。</p>
<p>高考完毕之后，其实最想要报的还是计算机系，记得暑假的时候在电视里面看电脑相关的讲座，讲的最多的好像就是五笔，那会 windows 用户也不多，都是用的 dos。ucdos 是最常用的。那会电脑最大的用途感觉就是打字输入，然后打印。</p>
<p>当时没有报计算机，因为闭塞的农村人认为计算机会和财经一样（当时财经类专业曾经火过一些时间，但是介于毕业的人都没啥靠谱工作，所以就认为一般了），过段时间就不行了，所以没有报这块，报的是应用物理专业（当然了，这个专业更屎）。</p>
<p>那个假期去我舅舅的办公室去玩玩电脑。我舅舅是微机专业毕业的，毕业后回我们那边做类似一个打字的工作（其实我也不知道具体做什么….）。我当时去那边就是熟悉各种 dos 命令，学习一下 foxbase。</p>
<p>当时我记得有一本 foxbase 的书，看里面东西看不懂，没有现在的论坛和方便的网络，没有人可以交流。我记得印象最深的是有一道题需要算 1+2+3+…+100 等于多少，不懂编程完全不知道怎么做这个事情，但是看了答案看不懂，因为不懂 i=i+1 是什么意思，那会不明白为什么 i 还可以在右边。现在看来，生在那个年代那个地方真的很悲哀。</p>
<p>进入大学之后，选修了一门 word 之类的课，开始接触 windows。然后宿舍同学熟悉之后，就计划一起买了一台电脑，每个人 1200，我们总共 6 个人，7200 一台电脑，包括音箱电脑桌。当时要上网只能是拨号，56k 猫，开始是用不起的，大概到了大2，3 才开始拨号。然后 6 个人轮流用。那是我们班的地一台电脑，当时辅导员要求大家写保证书，保证不玩游戏才允许买。当然，你们懂得，保证书有个卵用，所以后来某天被发现玩游戏之后，给我们把电脑格式化了。但是之后大家还是会玩。</p>
<p>上了大学之后，就有网络中心，第一次去网络中心的时候，有点懵逼，和 xh 两个人对着电脑不知道该干啥。旁边的人都在玩 mud，当时不懂，就是看着一个绿窗口觉得很神奇。当然后来我们玩 mud 到昏天黑地就不多说了。玩 mud 玩的多了，慢慢了解到了 mud 的机制，有时候自己搭一个开始研究里面的编程，不过还比较粗浅。当时学的也就是 fortrun，c 语言这些。</p>
<p>那会的搜索引擎是目录式的，就和黄页一样，除了去看一些门户，就是翻这些东西，希望发现一些有意思的东西。那会学习也基本是靠买书和看自带的文档（不如 msdn），和通过网络靠一些小论坛里面的一些交流。那会写的比较多的是 vc vb 这些，php 之类学的人不多，java 我记得好像也不多。我的毕业论文是一个 vb 的程序，现在看写的比较烂，也就是能用。</p>
<h2 id="开始讲网站开发"><a href="#开始讲网站开发" class="headerlink" title="开始讲网站开发"></a>开始讲网站开发</h2><p>前面废话太多，又不太舍得删掉，就分一下块吧，下面讲讲网站开发技术的进化。</p>
<h3 id="dreamwaver-amp-frontpage-时代"><a href="#dreamwaver-amp-frontpage-时代" class="headerlink" title="dreamwaver &amp; frontpage 时代"></a>dreamwaver &amp; frontpage 时代</h3><p>那会做网页比较多的应该是 asp，用 frontpage 写，用 iis 发布，都是图形界面的，linux 没有什么人会用。linux 下面那会各种问题，驱动输入法这些都得花费很大的精力去解决。我装的第一个 linux 应该是 xterm linux，11 张光盘，因为他把一些软件也刻录到光盘了。第一次装 linux 就把宿舍的电脑搞挂了，没选对直接重新分区了。不过也就当年折腾这些弄明白了分区表 mbr 这些东西。</p>
<p>那会还攒了一些书，有一本就是讲怎么用 dreamwaver 的，当时觉得这个东西真牛逼，抛弃了 frontpage。我还记得我用 frontpage 做的第一个自我感觉良好的网页给别人看的时候，人家的那个表情，基本就是想吐的那种。我现在想，典型的那些花背景底色，大字体，图片按钮，来回滚动的一些内容等等，都是很烂的。</p>
<p>基于对 dreamwaver 的熟悉，当时还去联想实习了一段时间，给他们解决了一些问题。</p>
<p>那会做网页一般也就是收个表单，存到数据库什么的，不会有太复杂的东西。做个论坛是最常见的了。那个年代 javascript 是忌讳的东西，一般也就是用来滚动个页面标题什么的，没人拿他做特牛逼的东西。</p>
<p>毕业之后，就进了出版社。那个时代桌面程序很流行，因为大部分电脑都不能上网的，我到了出版社凭着自己的兴趣，用 vb 做了一个库存管理的软件，其实就是入库多少，出库多少登记一下，简单的很。</p>
<p>后来也是自己的兴趣，找了一台没人用的电脑，windows 上面跑起了 java web 服务，那会还流行搞一些 java applet 跑。出版社最早的网站就是这么跑起来的。</p>
<p>在后来装了一个 linux，开始在上面跑 qmail，跑 apache，开始熟悉 linux。同时也有了 php 的网站，不是我开发的，跑在我那个 linux 机器上面。</p>
<h3 id="ajax-amp-mvc"><a href="#ajax-amp-mvc" class="headerlink" title="ajax &amp; mvc"></a>ajax &amp; mvc</h3><p>后来大概有几年没有接触这些了，大概 08 年左右接触到了 ajax，javascript 算是就那几年走上神坛。当时老何演示了一个跑在本地浏览器里面的留言本程序，服务器端不用提供任何 html 相关的服务，只需要保存数据返回数据就好，逻辑都跑在本地浏览器里面。</p>
<p>不过那个时候我写的比较多的还是那种古老的表单方式，自己没去仔细了解这种新技术。后来大概 09 年左右有机会开始写 javascript 的时候了解了一些机制，感觉这种方式很有意思，渲染逻辑跑在浏览器，这样节省了一些服务器端的压力，并不是什么操作都需要提交到服务器让服务器去判断下一步怎么办。那会用到了 jquery，感觉真的好方便，并且他还提供一些 css 的效果，让不太熟悉的人也可以很方便的搞起来。而服务器端那会用 php 比较多。</p>
<p>php 当时也接触了一些框架，名字是不记得的。我这种野路子程序员，根本不明白人家的一些设计思路，代码和模板分离，mvc 这些都不懂，不过代码看多了也能明白一些。</p>
<p>我记得 09 年写这些的时候，一个遗留的 php 网站，需要增加一点功能，发现需要我一个人在 n 个文件里面修改，楞要把一个功能分散个 n 个文件让我很不理解，不是蛋疼么。当然后来明白这么做是为了分工合作为了灵活扩展，那么如果就一个人写的时候，我们是不是也需要这么做呢？</p>
<h3 id="emberjs-amp-angular-amp-react-amp-django-amp-spring"><a href="#emberjs-amp-angular-amp-react-amp-django-amp-spring" class="headerlink" title="emberjs &amp; angular &amp; react &amp; django &amp; spring"></a>emberjs &amp; angular &amp; react &amp; django &amp; spring</h3><p>后来大概 10 年左右的时候，我写代码还是用 jquery 的方式来做，因为当时觉得很好用。再后来接触了一些 emberjs angular 的一些知识。学习到了 emberjs 里面的命名惯例，比如一个路由叫 posts 那么就有对应的 PostsController，不用你显式的去让他们产生关系。学习 angular 学到了双向绑定的概念，你在定义了一个模型之后，在模板里面用到变量的地方会自动跟着这个模型的数据变化而变化，这就比用 jquery 的时候需要你自己去替换 dom 里面的内容方便多了。然后到了现在的 react 又提出了 virtual dom 的概念，让你不需要关心 dom 结构，你只需要操作你的虚拟 view 就好了。</p>
<p>当然前端其实还有好多的进步，比如 coffee script 来解决 javascript 这个语言本身的一些问题，哪里不严谨，一些最佳实践什么的就不用你操心了，只需要写 coffee script 就好了，编译成 javascript 之后，会自动处理好。</p>
<p>还有比如 css 不能 include，import，很多方案来解决这个问题。</p>
<p>后端这块，最近接触了 django，spring 这些。程序员要分 2 类的话，那就是 java 的和非 java 的，要分三类的话，就是 java ，javascript 和其他，呵呵。看过之后感觉 spring 真是不错的东西。难怪 java 程序员不去了解其他的，入了 java 坑就不用搞其他的了，库类很方便。并且类似 spring 这种东西，好多年前就有了，可以极大的方便 web 开发（不止 web 开发可以用）。如果能很好的驾驭 java，驾驭 tomcat jvm 这些东西，那么使用 java 其实是很不错的方案。通过 java 的 oo 特性，比如继承，重载 interface abstract 这些，可以很方便的定义好一些规范，也可以很好的把大家的工作划分开，架构，定义模型定义接口的人大家协同工作。</p>
<p>以前文件路径就是网页路径，现在有了 route 的概念（这个概念在 angular, emberjs 里面也有)，做了 route mapping 之后，可以很方便的把不同的 route 映射到相同的方法上面，可以很方便复用代码逻辑。</p>
<h2 id="总结下"><a href="#总结下" class="headerlink" title="总结下"></a>总结下</h2><p>上面讲了很多，整个就是个进化史。以前弄个网站出来需要花不少时间，还很难看。现在基于 bootstrap 还有这些开发框架，做一个出来很快外观还好看。这就是进步。</p>
<p>计算机技术的颠覆是很快的，如果打算一直从事这块工作，建议还是得保持一颗持续学习的心态，也得扩展自己学习的广度，这样可以吸收到各种技术的长处。</p>
<p>现在学习的手段也多了很多，我看视频直播网站都有开始讲课的了（不一定靠谱），还有各种学习视频，更别说各种可参考的学习文档了。实在是太方便了，只要愿意花时间，进步速度绝对很快。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/evolution/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="LLD-in-zabbix/">LLD in zabbix</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-07-30T06:09:58.000Z" itemprop="datePublished">Jul 30, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/zabbix/">zabbix</a> <a href="/tags/monitor/">monitor</a>
</div>
    </div>
      
        <p>如果需要监控的内容比较多的时候，手动管理报警信息就已经不使用了，加一批机器就需要忙活一阵子。也不能体现我们充满智慧的大脑的作用。</p>
<p>zabbix 支持 LLD(low level discovery) 方式来自动产生监控项目，包括 item, trigger 这些都可以自动添加。大概讲解一下可以利用这个东西做什么事情。</p>
<h2 id="zabbix-收集数据的方式"><a href="#zabbix-收集数据的方式" class="headerlink" title="zabbix 收集数据的方式"></a>zabbix 收集数据的方式</h2><p>zabbix 有很多收集数据的方法，这里重点讲 2 个，一个是 <code>zabbix agent</code>，一个是 <code>zabbix traper</code>。这两个方式可以和 nagios 里面的 active 和 passive 方式做类比。traaper 方式对应的就是 passive，就是 client 主动发送数据给 server。</p>
<p>对于 zabbix agent 方式，我们可以自己定义一些 <code>userParameter</code> 来添加自定义监控，这些网上很多例子。如果使用 trapper 方式，那么原则上面可以不用做任何自定义，就可以通过 zabbix-sender 或者自己模拟 sender 的协议，通过比如 python，java 等发送自己的监控信息。通过 python 发送的例子网上也有。</p>
<h2 id="LLD"><a href="#LLD" class="headerlink" title="LLD"></a>LLD</h2><p>参考<a href="https://www.zabbix.com/documentation/3.2/manual/discovery/low_level_discovery" target="_blank" rel="external">这里</a>，LLD 主要的思路就是给服务器端发送一个 json 数据格式。例如下面这个。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"data"</span>:[</div><div class="line">  </div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/"</span>,                           <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"rootfs"</span>   &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/sys"</span>,                        <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"sysfs"</span>    &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/proc"</span>,                       <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"proc"</span>     &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/dev"</span>,                        <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"devtmpfs"</span> &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/dev/pts"</span>,                    <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"devpts"</span>   &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/lib/init/rw"</span>,                <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"tmpfs"</span>    &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/dev/shm"</span>,                    <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"tmpfs"</span>    &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/home"</span>,                       <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"ext3"</span>     &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/tmp"</span>,                        <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"ext3"</span>     &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/usr"</span>,                        <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"ext3"</span>     &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/var"</span>,                        <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"ext3"</span>     &#125;,</div><div class="line">  &#123; <span class="attr">"&#123;#FSNAME&#125;"</span>:<span class="string">"/sys/fs/fuse/connections"</span>,    <span class="attr">"&#123;#FSTYPE&#125;"</span>:<span class="string">"fusectl"</span>  &#125;</div><div class="line">  </div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个数据里面，data 是必须的，里面包含里面发现的可监控数据，这可以是任何数据。例子里面是发现了可以用来监控的磁盘分区。data 是个数组，每个可监控项是一个数组元素。还有类似下面这样的数据。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"&#123;#HOST&#125;"</span>: <span class="string">"Japan 1"</span>,</div><div class="line">            <span class="attr">"&#123;#COUNT&#125;"</span>: <span class="string">"5"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"&#123;#HOST&#125;"</span>: <span class="string">"Japan 2"</span>,</div><div class="line">            <span class="attr">"&#123;#COUNT&#125;"</span>: <span class="string">"12"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"&#123;#HOST&#125;"</span>: <span class="string">"Latvia"</span>,</div><div class="line">            <span class="attr">"&#123;#COUNT&#125;"</span>: <span class="string">"3"</span></div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个是发现了一些可监控的 host。</p>
<p>理解没有？发现是发现可监控的服务，并不是发现监控项。比如我们可以通过发现这机器上面有没有启动 ssh，发现有启动之后，我们就可以通过服务器端配置 discovery 自动添加一些监控规则。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"22"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"8022"</span> &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>比如上面这个，我们发现了 2 个 ssh 进程，一个是 22 端口，一个是 8022 端口。</p>
<p>所以重点是发现有什么可监控的服务，并不是发现监控项。</p>
<p>BUT，其实并不是不能发现监控项，也是可以的。不过是，这种被发现的监控项，除非对应的 trigger 也都是一样的，否则你会发现无法分别添加不同的 trigger 规则。</p>
<h2 id="发现监控项"><a href="#发现监控项" class="headerlink" title="发现监控项"></a>发现监控项</h2><p>有了发现服务之后，就肯定需要对相应的服务的一些监控项做监控了。这个给 discovery 规则配置 item prototype 就可以了，不过这个里面有点坑需要填，后面会说，这里先不讲。</p>
<p>那么比如对于 ssh 服务，可以监控</p>
<ul>
<li>当前链接人数，conn.cnt</li>
<li>配置文件的 md5，conf.md5（配合 zabbix trigger 可以用来监控文件是不是被修改了）</li>
</ul>
<p>那监控数据就如下面</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"22.conn.cnt"</span>: <span class="number">4</span>,</div><div class="line">    <span class="attr">"22.conf.md5"</span>: <span class="string">"18492113fb263c9d0a33c9fea403eea1"</span>,</div><div class="line">    <span class="attr">"8022.conn.cnt"</span>: <span class="number">9</span>,</div><div class="line">    <span class="attr">"8022.conf.md5"</span>: <span class="string">"6cab272daa07202ccb57c4064c0dcfb8"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面就是一个 discovery 项目，filter 是 {#SSH_PORT}，和 2 个 item prototype，分别是 {#SSH_PORT}.cnn.cnt 和 {#SSH_PORT}.conf.md5。</p>
<h2 id="复杂一点的-LLD"><a href="#复杂一点的-LLD" class="headerlink" title="复杂一点的 LLD"></a>复杂一点的 LLD</h2><p>一个 LLD 还可以发现多个服务。比如下面这种。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"22"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"8022"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#PG_PORT&#125;"</span>: <span class="number">5432</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#PG_PORT&#125;"</span>: <span class="number">6432</span> &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个除了我们前面讲的 ssh 服务，还发现了两个 pg 的服务。在服务器端，只需要添加两个 discovery 规则就可以了，分别使用 {#SSH_PORT} 和 {#PG_PORT} 这两个宏来过滤数据。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"22"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#SSH_PORT&#125;"</span>: <span class="string">"8022"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#PG_PORT&#125;"</span>: <span class="number">5432</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#PG_PORT&#125;"</span>: <span class="number">6432</span> &#125;</div><div class="line">        &#123; <span class="attr">"&#123;#MASTER_DB_PORT&#125;"</span>: <span class="number">5432</span>, <span class="attr">"&#123;#SLAVE_DB&#125;"</span>: <span class="string">"host1"</span> &#125;,</div><div class="line">        &#123; <span class="attr">"&#123;#MASTER_DB_PORT&#125;"</span>: <span class="number">5432</span>, <span class="attr">"&#123;#SLAVE_DB&#125;"</span>: <span class="string">"host2"</span> &#125;,</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面这个，除了有 2 个 db 之外，还有一个 db 是个 master，能看到他对应的 slave 有哪些。要注意，我们在新增加的这个发现项里面，不能再使用 {#PG_PORT} 这个宏了，因为如果使用了这个宏，就会和第3，4个项目无法区分了。所以我们改了一下名字。</p>
<p>到此为止，只是我们的构思，想要告诉 zabbix 我们想要监控什么。真正使用还需要走一些路。</p>
<h2 id="如何发送数据"><a href="#如何发送数据" class="headerlink" title="如何发送数据"></a>如何发送数据</h2><p>不管是 discovery 数据，还是 item 的监控数据，都可以通过 agent 和 trapper 方式发送。</p>
<p>对于 discovery 数据，使用 agent 发送就是上面讲的格式。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123; <span class="attr">"&#123;#PG.OTHER&#125;"</span>: <span class="string">"0"</span> &#125;,</div><div class="line">     ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果使用 trapper 方式发送，格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"host"</span>: <span class="string">"HOST1"</span>,</div><div class="line">            <span class="attr">"value"</span>: <span class="string">"&#123;\"data\": [&#123;\"&#123;#PG.OTHER&#125;\": \"0\"&#125;]&#125;"</span>,</div><div class="line">            <span class="attr">"key"</span>: <span class="string">"pg.discover"</span></div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">"request"</span>: <span class="string">"sender data"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面这个数据里面，data 和 request 是 zabbix sender 的固定格式。data 里面，包含了 host, value, key 三个字段。host 是被监控的 host，和将来服务器端的 host 对应。value 是发送的监控内容，可以看到也就是我们使用 agent 发送的内容。key 就是对应的监控项，这个监控项也就是 agent 方式发送对应的那个 userParameter。</p>
<p>使用 trapper 方式发送里面，是可以伪造被监控的 host 的，所以 trapper 方式并不要求一定要在被监控机器上面执行。</p>
<p>对于 item 监控数据，使用 agent 发送是下面这种格式。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"key1"</span>: <span class="number">2</span>,</div><div class="line">    <span class="attr">"key2"</span>: <span class="string">"ok"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用 trapper 方式发送，是下面的这种格式。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"data"</span>: [</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"host"</span>: <span class="string">"HOST1"</span>,</div><div class="line">            <span class="attr">"value"</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">"key"</span>: <span class="string">"key1"</span></div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            <span class="attr">"host"</span>: <span class="string">"HOST1"</span>,</div><div class="line">            <span class="attr">"value"</span>: <span class="string">"ok"</span>,</div><div class="line">            <span class="attr">"key"</span>: <span class="string">"key2"</span></div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    <span class="attr">"request"</span>: <span class="string">"sender data"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="zabbix-里面的限制"><a href="#zabbix-里面的限制" class="headerlink" title="zabbix 里面的限制"></a>zabbix 里面的限制</h2><p>上面的例子很完美，但实际上 zabbix 是有一些限制的。比如 item 定义。</p>
<p>假如对于发现的 pg 服务，有一个监控项是连接数，比如 {#PG_PORT}.conn.cnt，此时你会发现在 zabbix 新建 item 的 <code>Key</code> 那个设置里面，这么写无法提交。需要使用假装类似 userParameter 的方式来写，比如 pg.[{#PG.PORT}.conn.cnt]，假装那个 <code>pg.</code> 是个 userParameter 命令，[{#PG.PORT}.conn.cnt] 里面的内容是他的参数。当然，这个 pg. 可以基本可以是任何字符串，比如 abc，你自己觉得有意义就好了。</p>
<p>那么这个时候对于发现那块，我们基本不用动，需要动的是被发送的服务的监控项的命名上面。</p>
<p>比如以那个 ssh 的监控为例，原来发送的数据如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"22.conn.cnt"</span>: <span class="number">4</span>,</div><div class="line">    <span class="attr">"22.conf.md5"</span>: <span class="string">"18492113fb263c9d0a33c9fea403eea1"</span>,</div><div class="line">    <span class="attr">"8022.conn.cnt"</span>: <span class="number">9</span>,</div><div class="line">    <span class="attr">"8022.conf.md5"</span>: <span class="string">"6cab272daa07202ccb57c4064c0dcfb8"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们只需要修改成这样</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"ssh[22.conn.cnt]"</span>: <span class="number">4</span>,</div><div class="line">    <span class="attr">"ssh[22.conf.md5]"</span>: <span class="string">"18492113fb263c9d0a33c9fea403eea1"</span>,</div><div class="line">    <span class="attr">"ssh[8022.conn.cnt]"</span>: <span class="number">9</span>,</div><div class="line">    <span class="attr">"ssh[8022.conf.md5]"</span>: <span class="string">"6cab272daa07202ccb57c4064c0dcfb8"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对应的 2 个 item prototype，key 分别修改为 ssh[{#SSH_PORT}.cnn.cnt] 和 ssh[{#SSH_PORT}.conf.md5]。那个 ssh 可以随意起。并且其实并不一定就得是这种模式，比如叫做 ssh.conf.md5[{#SSH_PORT}] 应该也可以，当然需要你发送的数据也做对应修改。</p>
<h2 id="如何发送监控数据"><a href="#如何发送监控数据" class="headerlink" title="如何发送监控数据"></a>如何发送监控数据</h2><p>咦？好像说过一次了？这次和上面不一样，呵呵。</p>
<p>设计好并写好监控之后，选择什么方式发送监控数据呢。我选择的是 discovery 数据通过 agent 方式获取，也就是在各服务器上面定义相同的一个 key，然后执行这个 key 的时候发送发现的服务信息。</p>
<p>而对于监控项数据则通过 trapper 方式发送。通过 trapper 方式发送，需要定时执行，可以通过 crontab 发送。我选择的是建立了一个 agent 类型的 item，执行这个 item 的时候发送监控数据。这样一方面可以针对这个发送动作建立一个监控，另外一方面调整很方便，zabbix 界面修改就可以。并且我把这个 item 建立到了模板上面，只要修改应用模板就可以了。</p>
<p>监控数据也可以用 agent 方式发送，如果用 agent 方式发送，对于上面的 ssh 服务，就需要真的建立那个 ssh 的 userParameter 了，然后接受比如 <code>22.conf.md5</code> 这样的参数，去返回对应的监控数据。我没有用这种方式，是因为这样做等于有多少个 item 就需要在监控周期内执行多少次那个命令，给服务器增加负担（虽然没多少）。而使用 trapper 方式的话，就可以一次把所有的监控数据都发过去了，命令只需要执行一次。</p>
<h2 id="如何应对不同的部分"><a href="#如何应对不同的部分" class="headerlink" title="如何应对不同的部分"></a>如何应对不同的部分</h2><p>到此为止，应该可以很完美的发现服务，并且监控了。但是会发现其实并不是所有服务器的服务都是一样的，比如对于 pgsql，slow query 的界定对于不同的业务可能不一样。而因为 trigger 也是自动发现添加的，这样也有可能需要不同的机器上面的服务有不同的阈值，怎么解决呢？</p>
<p>先说监控项的阈值。因为我的监控数据其实是通过建立一个 agent 类型的 item 定期发送 trapper 数据来实现的，所以只需要在调用那个 item 的时候传送不同的阈值就可以了。实际上面我的 itme key 定义是这样的 <code>pg.sendtrap[{$PG.DISCOVER.SETTINGS}]</code> 。那个 pg.sendtrap 是对应到一个 userParameter 的 <code>UserParameter=pg.sendtrap[*],/etc/zabbix/bin/zabbix_pg.py --check --sendtrap --settings $1</code>，在 zabbix_pg.py 里面，会处理 settings 参数。如果有阈值，那就定义好 <code>{$PG.DISCOVER.SETTINGS}</code> 这个宏就可以了。template 上面可以定义默认的阈值，当然默认阈值在程序里面定义也可以。然后不同 host 可以定义 host 的阈值，会覆盖模板的配置。</p>
<p>其实 trigger 的阈值和这个思路类似，也是 template 里面定义一个宏，trigger 里面使用这个宏就可以了。如果 host 有不同的阈值，那就定义一个 host 的宏覆盖他就可以了。</p>
<h2 id="目前的情况"><a href="#目前的情况" class="headerlink" title="目前的情况"></a>目前的情况</h2><p>配合 zabbix 的 auto registration 这个 action，可以做到新机器只需要执行一个 saltstack state，安装好我们的 zabbix agent，就可以自动注册 host，自动添加监控报警。</p>
<p>相当完美。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/LLD-in-zabbix/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="all-about-lazy/">能不能成功取决于什么</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-07-09T06:21:10.000Z" itemprop="datePublished">Jul 9, 2016</time>
</div>
      <div class="tags">Tags: 


</div>
    </div>
      
        <p>随着年龄的增长，自己对一些事情的认识在改变，一直想总结一个给年轻同学的帖子，但是总是不能总结太好怎么讲，大概从想讲到现在，已经几个月了，我感觉不讲的话可能就讲不出来了，所以乱谈一下。</p>
<h2 id="从全栈讲起"><a href="#从全栈讲起" class="headerlink" title="从全栈讲起"></a>从全栈讲起</h2><p>什么是全栈？我感觉肯定不是普通人，我觉得全栈至少得是绝顶聪明的人才可以做到，对于他们来讲，有很扎实的 CS 功底，并且知识面非常广泛，还有很多产出，并且这些产出是各个方面的。</p>
<p><img src="https://pic2.zhimg.com/3c8fbae345f5a480ee55174852f392a1_b.png" alt="某种观点"></p>
<p>上面是李笑来老师对于全栈的看法，<a href="https://www.zhihu.com/question/47359997" target="_blank" rel="external">这里</a> 有知乎用户对这个的讨论。</p>
<p>我只是关注到了他那句话里面的「不太笨」，如果他的意思是很聪明的意思，那观点就和我一致了，呵呵。</p>
<p>不得不承认，智商和你能掌握的内容是有关系的，智商不够再怎么努力也很难达到某种顶峰。当然这并不是说，智商不够的就没戏了，换句话说，如果智商不够还不努力，你还是就想想老婆孩子热炕头就算了。</p>
<h2 id="学习别人"><a href="#学习别人" class="headerlink" title="学习别人"></a>学习别人</h2><p>学习别人的成功经验，似乎是一种很好的办法，至少人家那条路是走通了。</p>
<p>这几年流行健身，是吧。看着别人一个一个健身房也好，路边跑步也好，还有奥森跑步的，是不是看着眼红但是又觉得自己周边不具备环境？健身房贵，路边有觉得没有好环境，奥森还有点远，所以我得找一个满足条件的才能去进行这个事情。</p>
<p>还有比如看到有人拿 kindle 看书，是不是觉得我要是有个 kindle 带着方便，肯定可以看好多书，比如一直想学习的 iOS 开发，还有 Java 编程思想，哎呀呀，编程能力大幅增长啊。所以一定要买个 kindle。</p>
<p>等等类似的事情吧，别的不多讲了。就是我想要干什么事情，但是呢最好满足个什么条件，会让我干的更好更有动力。</p>
<p>最后通常的结果呢？步顶多跑几次就会觉得没意思了，kindle 在家里吃灰，然后开始有其他的想法，比如看着人家的 iphone 不错唉，我要是有个，看个 pdf 什么的，比 kindle 方便啊，手机可是一直带着的，所以。。。。</p>
<h2 id="听别人讲"><a href="#听别人讲" class="headerlink" title="听别人讲"></a>听别人讲</h2><p>欧洲人在放难民进来的时候，想的可是我们可怜你们让你们进来，你们应该很满足，不要闹事老实呆着。所以实际上呢？</p>
<p>父母亲戚常见的「我都是为了你好」这种说法，大家估计都听腻了吧。有用么？</p>
<p>微信朋友圈网上各种鸡汤文，比尔盖兹为什么成功，雷军马云的奋斗，这些文章看的时候让人激动人心，看完了貌似就忘记了，是不是？。。</p>
<h2 id="关键在哪里？"><a href="#关键在哪里？" class="headerlink" title="关键在哪里？"></a>关键在哪里？</h2><p>我感觉关键就是一个字「懒」。</p>
<p><img src="http://ww1.sinaimg.cn/mw690/69a2b902jw1f1nn2v6ld1j20go0aswgl.jpg" alt="懒"></p>
<p>2004 年左右在 irc 玩的时候，就有一个网站 <a href="http://lmgtfy.com/?q=%E6%87%92" target="_blank" rel="external">let me google that for you</a>。这个网站就是鄙视那些连 google 都懒得用的，稍微有点问题就问别人。知识都是别人的，把别人当 google 用。</p>
<p>很多人都有类似习惯。我们学习的时候，别人都是引进大门，如果自己不能养成自己知识持续更新的习惯，等到自己连年轻人都跟不上的时候，就很悲哀了。</p>
<p>这个都无关智商，所谓活到老学到老，别人都给你总结好了，懒字一上来，就混吃等死吧。</p>
<p>想要客服懒字，得自己给自己洗脑，让自己能坚持的下去。<a href="http://v.youku.com/v_show/id_XMTY5NTc2MzMy.html" target="_blank" rel="external">老罗的奋斗</a> 里面，老罗讲自己决定要去新东方当老师之前，学习英语的时候，隔段时间就会学不下去，学不下去的时候，看看成功学的书，给自己打打鸡血，就又活蹦乱跳了。</p>
<p>我大概总结几项提升的方向，遇事情想想，应该有好处</p>
<ul>
<li>主动思考解决问题的最佳思路</li>
<li>主动发现问题，改进承担</li>
<li>主动推进事情进展</li>
<li>不要限定自己的范围，不停挑战难点</li>
<li>积极参与到别人的有激情的项目里面</li>
<li>对技术保持强烈的好奇心</li>
</ul>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/all-about-lazy/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="how-to-create-a-blog-with-https-for-free/">如何不花钱建立一个支持 https 的 blog</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-04-10T02:18:28.000Z" itemprop="datePublished">Apr 10, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/blog/">blog</a>
</div>
    </div>
      
        <p>早年的时候要搞 blog 还得弄一个空间，现在，免费的东西越来越多了，感觉共产主义的实现还要靠资本家啊，不过羊毛出在羊身上。。。</p>
<p>要想弄一个免费的 blog，首先你的 blog 内容最好是纯静态网页，如果是类似 php 什么的，那就难找了。使用 jeklly, hexo 这些都可以把 markdown 文件渲染成 html。</p>
<p>然后注册一个 github 或者 gitcafe 等等支持 pages 服务的空间，搞定之后就能得到一个类似于 <a href="http://wd.github.io" target="_blank" rel="external">http://wd.github.io</a> 这样的地址。</p>
<p>然后你注册一个域名（发现标题没起好，这个还是要收费的。。），然后注册 cloudflare，把你的域名的 dns 使用 cloudflare 的，然后在 cloudflare 配置一个 cname 到 wd.github.io。然后建立一个 page rule，强制你的域名使用 ssl。</p>
<p>ok 拉，整个过程就是域名花钱了。可以访问下 <a href="http://wdicc.com">http://wdicc.com</a> 看看效果，会自动跳转到 <a href="https://wdicc.com">https://wdicc.com</a> :D</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/how-to-create-a-blog-with-https-for-free/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="Custom-Netgear-r6300v2-wireless-router/">Custom Netgear r6300v2 wireless router</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-03-27T03:50:38.000Z" itemprop="datePublished">Mar 27, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/linux/">linux</a> <a href="/tags/gfw/">gfw</a> <a href="/tags/router/">router</a>
</div>
    </div>
      
        <p>接 <a href="/Across-the-Great-Wall-we-can-reach-every-corner-in-the-world">科学上网</a>。买了群晖之后，一直通过群晖上面跑一个 haproxy 来做转发。不过心里总觉得有点不爽，毕竟一方面多转发了一次，另外群晖在不使用的时候，还会休眠，又或多或少担心影响休眠（经过测试应该是不影响的，但是..）。所以买了 r6300v2 之后，就琢磨通过路由器做这个事情。</p>
<p>路由器上面搞就有两个选择，一是从 iptables 入手，直接转发出去，另外一个是从软件层面做。</p>
<p>开始搞了几天的 iptables，发现原有系统 iptables 条目还是挺多的，加上路由器翻墙的功能也需要加一些条目，导致尝试了好几天之后总算能够转发过去链接了，但是数据包过不去，为了调试就开始打算在路由器安装 tcpdump。然后找到了 <a href="https://github.com/Entware/entware" target="_blank" rel="external">https://github.com/Entware/entware</a> ，配置好之后可以使用 opkg 来安装包。包列表可以参考这里 <a href="http://pkg.entware.net/binaries/armv7/Packages.html" target="_blank" rel="external">http://pkg.entware.net/binaries/armv7/Packages.html</a> ，这个路由器是 armv7 版本的 cpu。</p>
<p>安装 opkg 之前先得了解下，梅林固件分两部分存储，一部分是系统区，一部分是自定义区。系统区应该是你刷的固件所在的地方，是不能修改的，自定义区是可以存放一些自己定义的脚本的。每次系统启动的时候，你的一些自定义的东西都是存在自定义区加载的。自定义区就是 /jffs 分区。想要使用，得在 系统管理 -&gt; 系统设置 里面，打开 JFFS 的配置，允许执行上面的脚本。</p>
<p>因为系统自带的 /jffs 分区只有 60M 左右，而我们装包的时候很容易就超过这个限制了，我现在已经用了 8xM 空间。所以最好还是用一个 u 盘来做这个事情。每次想要自动加载 u 盘，启动 u 盘里面的程序的话，还需要一些自定义的脚本来做这个事情。</p>
<p>先把 opkg 配置好，需要先准备好 /opt 目录。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">mkdir</span> -<span class="keyword">p</span> /tmp/<span class="keyword">opt</span></div><div class="line">mount -t ext4 -<span class="keyword">o</span> rw,noatime /dev/sda1 /<span class="keyword">opt</span></div></pre></td></tr></table></figure>
<p>上面的 /dev/sda1 是 u 盘，ext4 是文件系统类型，按照自己的修改一下。一般 u 盘插上去就会自动挂载，df 看一下就知道是哪个名字了。系统配置里面有个 dlna 的配置记得关掉，否则他会读 u 盘导致你不能 umount 之类，或者 kill 掉一个叫做 minidlna 的进程也可以。</p>
<p>然后参考 <a href="https://github.com/Entware/entware" target="_blank" rel="external">https://github.com/Entware/entware</a> 操作就可以了，可以看到他会在 /opt 给你安装一陀东西。因为这个是 u 盘，所以东西重启也不会丢失。</p>
<p>然后参考<a href="https://github.com/RMerl/asuswrt-merlin/wiki/User-scripts" target="_blank" rel="external">梅林的 wiki</a>，它允许用户在 <code>/jffs/scripts</code> 自定义一些启动脚本，来支持我们自动挂载和启动 u 盘上面的程序。</p>
<p>post-mount 内容如下，前面几个注释的是调试用的。最后一个 if 里面内容是执行一些 opkg 安装的程序的启动脚本，这个后面说。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line"><span class="comment">#echo $(date) &gt; /tmp/000service-start</span></div><div class="line"><span class="comment">#echo "$1" &gt;&gt; /tmp/000service-start</span></div><div class="line"><span class="comment">#ls /dev/sda* &gt;&gt; /tmp/000service-start</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ -b /dev/sda1 ];<span class="keyword">then</span></div><div class="line">        mkdir -p /tmp/opt</div><div class="line">        mount -t ext4 -o rw,noatime /dev/sda1 /opt</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ -x /opt/bin/opkg ];<span class="keyword">then</span></div><div class="line">        /opt/etc/init.d/rc.unslung start</div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure></p>
<p>要记得 <code>sudo chmod +x post-mount</code>，然后可以重启路由器看看是不是启动之后就能看到 /opt 有了你上次安装的程序了。</p>
<p>上面一阶段搞定之后，就可以装一些软件了，比如我装了 vim, tcpdump，bind-dig, haproxy。opkg 的命令使用可以参考这里 <a href="https://wiki.openwrt.org/doc/techref/opkg" target="_blank" rel="external">https://wiki.openwrt.org/doc/techref/opkg</a> 。</p>
<p>接着上面的话题，本来打算装好 tcpdump 来调试的，然后发现可以比较方便的启动 haproxy 之后，就打算用 haproxy 弄了，路由表太多，分析比较麻烦，还是走简单的吧。。</p>
<p><code>/opt/etc/haproxy.cfg</code> 如下，把 IP 和 PORT 改成你自己的。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">global</span></div><div class="line">        ulimit-n  <span class="number">331071</span></div><div class="line"></div><div class="line">defaults</div><div class="line">        log <span class="meta">global</span></div><div class="line">        mode    tcp</div><div class="line">        <span class="meta">option</span>  dontlognull</div><div class="line">        timeout connect <span class="number">1000</span></div><div class="line">        timeout client <span class="number">150000</span></div><div class="line">        timeout server <span class="number">150000</span></div><div class="line"></div><div class="line">frontend <span class="built_in">ss</span>-<span class="keyword">in</span></div><div class="line">        bind *:本机PORT</div><div class="line">        default_backend <span class="built_in">ss</span>-<span class="keyword">out</span></div><div class="line"></div><div class="line">backend <span class="built_in">ss</span>-<span class="keyword">out</span></div><div class="line">        server server1 <span class="built_in">IP</span>:远端PORT maxconn <span class="number">20480</span></div></pre></td></tr></table></figure>
<p><code>/opt/etc/init.d/S001haproxy.sh</code> 如下，<code>sudo chmod +x /etc/init.d/S001haproxy.sh</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">haproxy_bin=/opt/sbin/haproxy</div><div class="line">haproxy_cfg=/opt/etc/haproxy.cfg</div><div class="line">pid=/opt/var/run/haproxy.pid</div><div class="line"></div><div class="line">action=<span class="variable">$1</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$action</span>"</span> ];<span class="keyword">then</span></div><div class="line">        <span class="built_in">printf</span> <span class="string">"Usage: <span class="variable">$0</span> &#123;start|stop|restart&#125;\n"</span> &gt;&amp;2</div><div class="line">        <span class="built_in">exit</span> 1</div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$action</span>"</span> <span class="keyword">in</span></div><div class="line">        start)</div><div class="line">                <span class="variable">$haproxy_bin</span> <span class="_">-f</span> <span class="variable">$haproxy_cfg</span> -p <span class="variable">$pid</span> -D</div><div class="line">                ;;</div><div class="line">        stop)</div><div class="line">                <span class="built_in">kill</span> $(cat <span class="variable">$pid</span>)</div><div class="line">                ;;</div><div class="line">        restart)</div><div class="line">                <span class="built_in">kill</span> $(cat <span class="variable">$pid</span>)</div><div class="line">                <span class="variable">$haproxy_bin</span> <span class="_">-f</span> <span class="variable">$haproxy_cfg</span> -p <span class="variable">$pid</span> -D</div><div class="line">                ;;</div><div class="line"><span class="keyword">esac</span></div></pre></td></tr></table></figure>
<p>因为前面在 post-mount 最后一个 if 里面的语句，这样启动路由器就会自动启动 haproxy 了。</p>
<p>想使用这个端口转发，还需要在路由器配置界面里面增加一个到路由器 ip 的映射，然后还需要一个 <code>/jffs/scripts/firewall-start</code> 如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line">iptables -I INPUT -i ppp0 -p tcp --destination-port PORT -j ACCEPT</div></pre></td></tr></table></figure>
<p>我使用的过程中还发现一个问题，pkg.entware.net 貌似被墙了。。虽然配置了翻墙但是不太明白为什么路由器上面时好时坏，而我局域网内的 mac 访问总是 ok 的，很奇怪。路由器上面不能访问有个办法是通过 mac 代理一下。</p>
<p>mac 上面启动一个 ngx，配置如下，使用 nginx -p ./ -c nginx.conf 启动。<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="section">events</span> &#123;</div><div class="line">  <span class="attribute">worker_connections</span> <span class="number">1024</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="section">http</span> &#123;</div><div class="line">  <span class="section">server</span> &#123;</div><div class="line">      <span class="attribute">listen</span> <span class="number">0.0.0.0:8000</span>;</div><div class="line">      <span class="attribute">location</span> / &#123;</div><div class="line">           <span class="attribute">proxy_pass</span> http://pkg.entware.net;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后修改路由器上面 /opt/etc/opkg.conf <code>src/gz packages http://MAC_IP:8000/binaries/armv7</code>，然后就可以了。</p>
<p>写完自己看发现这不是一份操作指南，只能算是一些提示，如果有人照着做能不能成功可能还是得看自己。。。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/Custom-Netgear-r6300v2-wireless-router/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="lua-metatable/">lua metatable</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2016-03-27T02:48:26.000Z" itemprop="datePublished">Mar 27, 2016</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/lua/">lua</a>
</div>
    </div>
      
        <figure class="highlight lua"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">t = <span class="built_in">setmetatable</span>(&#123; bar = <span class="number">4</span>, foo = <span class="number">7</span> &#125;, &#123; __index = &#123; foo = <span class="number">3</span> &#125; &#125;)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(t.foo)  <span class="comment">-- 7</span></div><div class="line"><span class="built_in">print</span>(t.bar)  <span class="comment">-- 4</span></div><div class="line"></div><div class="line">t = <span class="built_in">setmetatable</span>(&#123;  &#125;, &#123; __index = &#123; foo = <span class="number">3</span>&#125; &#125;)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(t.foo)  <span class="comment">-- 3</span></div><div class="line"><span class="built_in">print</span>(t.bar)  <span class="comment">-- nil</span></div><div class="line"></div><div class="line">fuc = <span class="function"><span class="keyword">function</span> <span class="params">(t,k)</span></span></div><div class="line">    <span class="keyword">if</span> k == <span class="string">'foo'</span> <span class="keyword">then</span></div><div class="line">        <span class="keyword">return</span> <span class="built_in">rawget</span>(t, <span class="string">'bar'</span>)</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">t = <span class="built_in">setmetatable</span>(&#123;   &#125;, &#123; __index = fuc &#125;)</div><div class="line"></div><div class="line"><span class="built_in">print</span>(t.foo)  <span class="comment">-- 3</span></div><div class="line"><span class="built_in">print</span>(t.bar)  <span class="comment">-- nil</span></div><div class="line"><span class="built_in">print</span>(t.ff)</div></pre></td></tr></table></figure>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="https://wdicc.com/lua-metatable/#disqus_thread">Comments</a></span>
	
</div>
</article>


  <nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
        <a href="/page/3/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2017

    wd
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
