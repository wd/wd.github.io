<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>wd and cc</title>
    <meta name="author" content="wd">
    
	<meta name="description" content="undefined"> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>
<span class="subtitle">happy everyday</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/wd" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        

    
        <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    



  <article class="post">
	<h2 class="title">
		<a href="some-tips-on-bash-scripting/">Some tips for bash scripting</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-12-02T11:43:00.000Z" itemprop="datePublished">Dec 2, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/Web/">Web</a>
</div>
    </div>
      
        <p>最近几天写了一些 bash 脚本，又有些心得，记录一下。</p>
<h2 id="获取当前路径的绝对路径"><a href="#获取当前路径的绝对路径" class="headerlink" title="获取当前路径的绝对路径"></a>获取当前路径的绝对路径</h2><p>比较常见的需求可能是获取相对路径，这样方便程序复制到其他目录也可以运行。使用 <code>$(dirname $0)</code> 就可以获取相对路径，不过这里说的是绝对路径。</p>
<p>其实也简单，相对路径加上当前目录，那不就是绝对路径么。不过是，有时候 <code>$(dirname $0)</code> 取到的也可能是绝对路径（一般期望相对路径的程序也能跑通，所以不大关心）。</p>
<p>可以用下面的做法，大意是先判断一下获取到的路径是不是 <code>/</code> 开头，如果是，那就不处理，如果不是，那就把当前的路径附加上去得到一个绝对路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">PG_DIR=<span class="string">"<span class="variable">$(dirname $0)</span>/../"</span></div><div class="line"></div><div class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$PG_DIR</span>"</span> | grep -q ^/</div><div class="line"></div><div class="line"><span class="keyword">if</span> [ $? <span class="_">-ne</span> 0 ];<span class="keyword">then</span></div><div class="line">        PG_DIR=<span class="string">"<span class="variable">$(pwd)</span>/<span class="variable">$PG_DIR</span>"</span></div><div class="line"><span class="keyword">fi</span></div></pre></td></tr></table></figure>
<h2 id="使用-getopt-获取命令行参数"><a href="#使用-getopt-获取命令行参数" class="headerlink" title="使用 getopt 获取命令行参数"></a>使用 getopt 获取命令行参数</h2><p>获取参数比较常见的做法是取 <code>$1</code> <code>$2</code> 这些，不过不太专业，这里说的是类似于 <code>--prefix=/path/to/install -v</code> 这种。</p>
<p>bash 本身提供了一个内部命令 <code>getopts</code> 来做这个事情，不过那个只能支持 short_opts，就是类似 <code>-v</code> 这种，不支持长的。</p>
<p>getopt 是一个 GNU 程序，他支持 long_opts。下面是个例子。代码基本来自网上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ARGS=$(getopt <span class="_">-a</span> -o h <span class="_">-l</span> initdb::,<span class="built_in">help</span> -- <span class="string">"<span class="variable">$@</span>"</span>)</div><div class="line">[ $? <span class="_">-ne</span> 0 ] &amp;&amp; usage</div><div class="line"></div><div class="line"><span class="built_in">eval</span> <span class="built_in">set</span> -- <span class="string">"<span class="variable">$&#123;ARGS&#125;</span>"</span> </div><div class="line"></div><div class="line"><span class="keyword">while</span> <span class="literal">true</span></div><div class="line"><span class="keyword">do</span></div><div class="line">        <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></div><div class="line">                --initdb)</div><div class="line">                        initdb <span class="variable">$2</span></div><div class="line">                        ;;</div><div class="line">                -h|--help)</div><div class="line">                        usage;</div><div class="line">                        ;;</div><div class="line">                --)</div><div class="line">                        <span class="built_in">shift</span></div><div class="line">                        <span class="built_in">break</span></div><div class="line">                        ;;</div><div class="line">        <span class="keyword">esac</span></div><div class="line">        <span class="built_in">shift</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>解释一下上面的参数的含义:</p>
<ul>
<li><code>-o</code> 参数指定的就是短参数，我试过，貌似还得指定至少一个短参数。</li>
<li><code>-l</code> 参数指定的就是长参数。</li>
<li>多个参数用逗号 <code>,</code> 分隔。</li>
<li>参数后面跟一个冒号 <code>:</code> 表示这个参数(option)必须要给一个参数(argument)，类似上面的 <code>--prefix=/path/to/install</code> 这种。</li>
<li>参数后面跟2个冒号 <code>::</code> 表示这个参数后面的参数可有可无。比如例子里面的 <code>--initdb</code></li>
</ul>
<h2 id="find-exec-提示-No-such-file-or-directory"><a href="#find-exec-提示-No-such-file-or-directory" class="headerlink" title="find exec 提示 No such file or directory"></a>find exec 提示 No such file or directory</h2><p>这个是之前用来日志删除的一个程序，大概命令类似 <code>find ./ -name &#39;2012*&#39; -exec rm -r {} \;</code>，后来总发现报 <code>No such file or directory</code> 这个错误，可是去看的时候，发现那些目录也被删掉了。开始觉得可能是有其他人的程序也在删除这个目录，问了一圈结果没人删。</p>
<p>后来经过测试琢磨找到原因了，在于这个命令的执行思路大概是先去找那个名字的文件或者目录，然后挨个执行后面的命令。那么，如果找到的既有上级目录，也有下级文件的时候，如果目录先被删掉了，那删文件的时候可不就是 <code>No such file or directory</code> 么。</p>
<p>好在 find 提供了一个参数 <code>-prune</code><br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-prune True; <span class="keyword">if</span> <span class="keyword">the</span> <span class="built_in">file</span> is <span class="keyword">a</span> <span class="built_in">directory</span>, <span class="built_in">do</span> <span class="keyword">not</span> descend <span class="keyword">into</span> <span class="keyword">it</span>. If -depth is given, <span class="literal">false</span>; no effect.  Because -<span class="built_in">delete</span> implies -depth, you can-</div><div class="line">       <span class="keyword">not</span> usefully use -prune <span class="keyword">and</span> -<span class="built_in">delete</span> together.</div></pre></td></tr></table></figure></p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/some-tips-on-bash-scripting/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="hello-world/">Hello world</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-11-28T10:38:00.000Z" itemprop="datePublished">Nov 28, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a>
</div>
    </div>
      
        <p>Just a test.</p>
<p>Hello world from github :D</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/hello-world/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="two-table-after-join/">Join 后面跟两个表</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-08-04T16:00:00.000Z" itemprop="datePublished">Aug 5, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/mysql/">mysql</a> <a href="../tags/sql/">sql</a>
</div>
    </div>
      
        <p>发现 sql 的写法真是千奇百怪，经常遇到没见过的写法。前几天就遇到了一个 sql 在 join 后写两个表，用逗号分隔。类似下面。</p>
<pre class="prettyprint lang-sql">
select a.a, b.f from t1 a left join ( b, c ) on ( b.id = c.id and b.a = a.a )
</pre>


<p>看到 sql 的这些用法我一般都是去 pgsql 的文档里面去查，因为 pg 的文档里面一般会指明一种用法是否标准 sql，多写标准 sql 可以避免知识不能转移。不过去查了发现 pg 不支持这种写法，也去 pg 里面执行了，确实不支持。</p>
<p>然后就去看 mysql 的文档，里面有对于这种写法的<a href="http://dev.mysql.com/doc/refman/5.1/en/join.html" target="_blank" rel="external">支持</a>。</p>
<pre class="prettyprint lang-text">
 The syntax of table_factor is extended in comparison with the SQL Standard. The latter accepts only table_reference, not a list of them inside a pair of parentheses.

This is a conservative extension if we consider each comma in a list of table_reference items as equivalent to an inner join. For example:

SELECT * FROM t1 LEFT JOIN (t2, t3, t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)

is equivalent to:

SELECT * FROM t1 LEFT JOIN (t2 CROSS JOIN t3 CROSS JOIN t4)
                 ON (t2.a=t1.a AND t3.b=t1.b AND t4.c=t1.c)

In MySQL, JOIN, CROSS JOIN, and INNER JOIN are syntactic equivalents (they can replace each other). In standard SQL, they are not equivalent. INNER JOIN is used with an ON clause, CROSS JOIN is used otherwise. 
</pre>


<p>可以看到，这种写法就是等于是让括号里面的 b,c 使用 inner join 的方式连接，当然如果 on 里面没有指定 join 方式，最后就是个笛卡尔集。然后<a href="http://dev.mysql.com/doc/refman/5.1/en/nested-join-optimization.html" target="_blank" rel="external">这里</a> 有更多的一些说明，还有下面这种写法。</p>
<pre class="prettyprint lang-sql">
t1 LEFT JOIN t2 ON t1.a=t2.a, t3
</pre>


<p>这些写法都有各自的含义。</p>
<p>其实这么看来，这个方式好像是比较方便的，不过是对于不明白的人如果乱用，这玩意出的错也是很诡异很难排查的。</p>
<p>另外注意上面的语句里面写了，mysql 里面的 join, inner join, cross join 是完全同样的东西。</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/two-table-after-join/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="fdw-in-postgresql/">Postgresql 里面连接其他数据库</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-05-05T16:00:00.000Z" itemprop="datePublished">May 6, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/postgresql/">postgresql</a> <a href="../tags/dbi/">dbi</a> <a href="../tags/fdw/">fdw</a>
</div>
    </div>
      
        
<p>PG 9.x 引入了 fdw，可以通过 pg 去连接其他 db，不仅限于其他 pg，还可以是 mysql，oracle，文件等。按照设计，fdw 还应该提供给查询规划器一些对方 db 的索引等信息，这样在查询过程中可以提升查询速度。
</p>

<div id="outline-container-1" class="outline-3">
<h3 id="sec-1">dbi_link</h3>
<div class="outline-text-3" id="text-1">


<p>
dbi 就是 perl 的 dbi，总的思想就是通过 plperl 写一些 function（所以也给了调试修改的便利），通过 dbi 去连接其他数据库，可以连接的 db 和 dbi 的支持一样。
</p>
<p>
测试了一下，第一次连接的时候会 cache 对方 db 的信息，对于复杂库没测试成功，只有一个表的库连接成功，并且可以查询。查询的时候就和查询本地库没有区别。
</p>
<p>
效率上面看，不是很高，每次查询都必然需要获取对方全部数据。就算是有 where 条件，也不会试用到对方 db 的索引。所以综合来看，只是提供了一个简单的方法来获取数据，最好是一次性的。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-3">
<h3 id="sec-2">db_link</h3>
<div class="outline-text-3" id="text-2">


<p>
db_link 本身是 pg 自带的，contrib 里面的。db_link 只支持 pg，建立连接之后，后续查询可以只指定使用哪个连接即可。
</p>
<p>
相对 dbi_link，使用起来稍微复杂一点，需要特定的格式。效率上面看，查全表数据比 dbi_link 快。
</p>
<p>
他有个优势是每次查询对方库的时候都需要指定一个 sql，而如果只需要少量数据的时候，可以在 sql 里面直接使用 where 来过滤数据，这样就能使用对方 db 的索引了，速度快很多。不过就是稍微有点繁琐。
</p>
</div>

</div>

<div id="outline-container-3" class="outline-3">
<h3 id="sec-3">fdw</h3>
<div class="outline-text-3" id="text-3">


<p>
<a href="http://www.postgresonline.com/journal/archives/250-File-FDW-Family-Part-1-file_fdw.html" target="_blank" rel="external">http://www.postgresonline.com/journal/archives/250-File-FDW-Family-Part-1-file\_fdw.html</a> 这里有个链接，讲了 file fdw。其他 fdw 还没有试过。我理解 fdw 是否能使用对方 db 的索引，还需要看 fdw 的实现。file fdw 提供了类似 oracle 外部表一样的东西。实际上早年间 yahoo 的兄弟写过一个外部表的 pg 扩展的，不知道是不是这个 file fdw 就是从那来的。
</p></div>
</div>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/fdw-in-postgresql/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="controlmaster-in-ssh/">有跳板机的 ssh 登陆</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-05-05T16:00:00.000Z" itemprop="datePublished">May 6, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/ssh/">ssh</a>
</div>
    </div>
      
        
<p>我厂登陆服务器需要先走一个跳板机，不能直接登陆，很是蛋疼。实际上 ssh 早就解决了这个问题。
</p>
<p>
大意是通过设置 proxycommand 来实现，我也写过一个 <a href="http://wdicc.com/cow-ssh-proxycommand/">http://wdicc.com/cow-ssh-proxycommand/</a> 。配置如下
</p>


<pre class="prettyprint lang-conf">
# gateways
Host abc
     Hostname abc.com

# servers
Host *.xxx
     ProxyCommand ssh abc exec nc %h %p 2>/dev/null
</pre>

<p>
这样所有 .xxx 结尾的机器，都会使用 abc 这个机器来跳了。要注意的是，首先需要你机器和 abc 之间的 ssh 验证，这个使用使用的是你机器的 id_rsa 和 abc.com 的 authorized_keys。然后会是 proxy 起作用，需要你的机器和 .xxx 机器的验证，使用的是你的机器的 id_rsa 和 .xxx 的 authorized_keys，注意并不是 abc.com 和 .xxx 之间。
</p>
<p>
倒霉的是，我厂有些 gateway 机器还需要使用 token，并不能使用 key 验证。虽然有了上面设置，如果从某个机器 cp 数据的时候，还得来回输入哪个 token，真他妈的 2b。
</p>
<p>
还好 ssh 还提供了一个 controlmaster，很好的解决了这个问题。
</p>


<pre class="prettyprint lang-conf">
Host *
     User dong.wang
     ServerAliveInterval 30
     ControlMaster auto
     ControlPath /tmp/ssh/master-%r@%h:%p
     ControlPersist yes
</pre>

<p>
上面这个设置是所有服务器启用 controlmaster，哪个 /tmp/ssh 目录可以自己设置，没有就创建一个。哪个 ControlPersist 可以是个时间。
</p>
<p>
这样设置之后，第一次连接的时候，会启动一个 master。后续连接都会走这个，连接速度很快不说，还完全不需要输入什么 token。并且因为只有 gateway 需要输入 token，所以一个 gateway 只需要输入一次。实在是爽大了，真是居家旅行必备啊。就冲着连接速度快这一点也值了。
</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/controlmaster-in-ssh/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="auto-archive-task-for-org-mode/">org-mode 里面自动归档任务</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-04-07T16:00:00.000Z" itemprop="datePublished">Apr 8, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/emacs/">emacs</a> <a href="../tags/org-mode/">org-mode</a>
</div>
    </div>
      
        <p>我想应该有不少人在使用 emacs 的 org-mode 来做笔记，任务管理等。我使用 org-mode 比较多的情况是使用他做一些提纲，类似思维导图一样，以及用它来管理 todo list。
</p>
<p>
org-mode 本身提供了 remember 来创建 todo list。
</p>
<p>
新建一个 org 文件 ~/org/todo.org，包含两行内容如下
</p>


<pre class="prettyprint lang-text">
* Tasks
* Done
</pre>

<p>
然后设置下面的内容
</p>


<pre class="prettyprint lang-lisp">
(define-key global-map "\C-ca" 'org-agenda)
(global-set-key (kbd "C-c m r") 'org-capture)
(setq org-capture-templates
      '(("t" "Todo" entry (file+headline "~/org/todo.org" "Tasks")
         "* TODO %?\nCREATED: %U")
        ("j" "Journal" entry (file+datetree "~/org/journal.org")
         "* %?\nEntered on %U\n  %i\n  %a")))
(defun wd-move-done-task-to-done-cats ( task-pos )
  "move done task to *DONE cats"
  (let* ((entry (org-get-entry))
        (title (org-get-heading))
        (task (format "** %s\n%s\n" title entry))
        )
    (goto-char (point-min))
    (when (search-forward-regexp "^* Tasks$latex ")
      (goto-char (point-min))
      (when (search-forward-regexp "^* Done$")
        (goto-char (match-beginning 0))
        (forward-line)      
        (insert task)
        (goto-char task-pos)
        (delete-region (org-entry-beginning-position) (org-entry-end-position))      
        )
      )
    )
  )

(defun wd-track-task-status ( changes-plist )
   "Track task status, and move it to '* Done' cats if it is stats change from to to done
1 TODO 文件至少需要包含两个标题 * Tasks 和 * Done
2 * Tasks 里面的 TODO 内容变成 DONE 的时候，会自动把这个条目移动到 * Done
3 org-todo-keywords 的设置里面不能包含自动增加时间等的设置，否则增加的内容不能正确加到这个条目
"
   ;; (interactive)
   (let ((type (plist-get change-plist :type))
          (pos (plist-get change-plist :position))
          (from (plist-get change-plist :from))
          (to (plist-get change-plist :to))
          )
     (when (and (string= from "TODO")
                (string= to "DONE"))
       ;; (let ((answer (read-char "Move this entry to *DONE ? Y/N (Y)")))
       ;;   (when (or (= answer (string-to-char "y"))
       ;;             (= answer (string-to-char "Y"))
       ;;             (= answer (string-to-char "
"))
       ;;             )
           (wd-move-done-task-to-done-cats pos)
         ;; ))
       )
     )
   )

(add-hook 'org-trigger-hook 'wd-track-task-status)

;; (setq org-todo-keywords
;;       '((sequence "TODO(t)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELED(c@)")))
(setq org-todo-keywords
      '((sequence "TODO(t)" "WAIT(w)" "|" "DONE(d)" "CANCELED(c)")))
</pre>

<p>
在任何地方按一下 C-c m r，会出来一个 window 让你选择要创建 todo 还是 journal。选 t，然后输入内容就会自动插入到 ~/org/todo.org 的 * Tasks 里面。
</p>
<p>
此后，如果任务完成的时候，打开 todo.org，然后在任务上面 C-c C-t，会提示输入状态。如果是从 TODO 变成了 DONE，那这条任务会被转移到 * Done 里面。
</p>
<p>
因为里面都有时间，所以在 agenda list 里面，可以用 L 看到任务完成时间等。也将就用了。
</p>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/auto-archive-task-for-org-mode/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="about-interview/">关于面试的一点经验</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-04-07T16:00:00.000Z" itemprop="datePublished">Apr 8, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a> <a href="../tags/interview/">interview</a>
</div>
    </div>
      
        <p>最近面试了不少，也算有点经验了，阶段总结一下。本文也基本是针对刚毕业的或者毕业没两年的，大牛就别看了，浪费时间。
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">简历</h2>
<div class="outline-text-2" id="text-1">


<p>
其实写简历的时候，为了能获得更多的面试机会，通常都会有些夸大，尤其是刚毕业没多久，经验不多的，这个情况更严重。把只看过两次的东西，说成熟悉，把用过几次的说成熟练。
</p>
<p>
对于新人来说，这么做似乎会增加面试机会。但实际上，没有目的的面试，只会浪费双方的时间。很多次看到简历觉得似乎这个是我们需要的人，叫来问两句明白水平之后，基本就只能让对方走人了。不管怎么样，这对双方都是一个损失。
</p>
<p>
与其夸大简历寻求面试机会，有时候还不如花点时间上个培训班。我见到过不少上培训班的，可能花 3 个月半年的，来了之后你问问题，答得也还算靠谱。不过上培训班能学到的水平大家也清楚，基本是比较初级的，对于高级职位没有帮助。
</p>
<p>
总之吧，简历不好夸大，提到的东西至少得是你有自己见解的，否则还不如不提。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">面试题</h2>
<div class="outline-text-2" id="text-2">


<p>
对于技术工程师，很多公司都有面试题。有些求职者可能觉得这个东西挺讨厌的，浪费时间。想知道水平直接聊聊不就完了。
</p>
<p>
其实面试通常时间都不会很长，在这么短的时间内要决定时不时要一个人，也不是个简单的事情，要了解各方面。通常找工程师的时候，动手能力也是一项。从面试题能看出来动手能力。
</p>
<p>
看你写 for 循环也能看出来你的基础扎实不扎实。我还真见过不少人使用他熟悉的语言，这些都写错的。
</p>
<p>
当然，面试题不是一切，也不是不允许有笔误，毕竟现在那么多编辑工具都有提示，真没记住还不行么？错是可以错的，可是别人指出错误的时候你一要能看出来错误在哪里，二要虚心接受错误。别牛逼哄哄的还说什么从来不手写，都在编辑器写之类，那种态度要不得，哪个公司哪个领导都不愿意找一个大爷回来养着，伺候不起的。
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">面试过程</h2>
<div class="outline-text-2" id="text-3">


<p>
面试聊天期间大可不必紧张，你的主要目的是表达出来你会的东西。大可不必管对方需要什么样子的人，你合适不合适由对方做判断就好了。
</p>
<p>
而同时其实面试官也会努力帮你，让你表达出你会的东西。
</p>
<p>
至于说不会的东西怎么办？如实说就可以了。可以类比，但是千万不要狡辩，你要明白的是对方的水平肯定不会比你差，你的任何狡辩只能让对方觉得你这个人很无知自大。
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">将来的团队</h2>
<div class="outline-text-2" id="text-4">


<p>
面试不要只关注工资。一个好的工作环境，一个靠谱的团队，带给你的隐性收入远比眼前的工资来的多。不过说实话，这些收入恐怕1，2年就挖空了，那个时候如果一个公司不能按照行情给一个靠谱的价格，那就比较难能继续留住人了。也是个博弈吧，这些事情不是很懂。
</p>
<p>
同时，找一个自己喜欢的愿意专研的工作也比较重要。
</p>
<p>
当然，如果你就是想涨工资，那就另说。
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">薪资</h2>
<div class="outline-text-2" id="text-5">


<p>
不要尝试讨价还价。
</p>
<p>
现在的 IT 公司薪资基本都是不透明的，普通员工通常都只知道自己的工资。
</p>
<p>
如果你不想让自己觉得被坑，那最好在来面试之前就通过各个渠道去获取一下这个公司的薪资水平，并且确定自己能接受的最低工资是多少，可以通过朋友你自己等对你的评价来判断，不要依赖面试官。另外你工作的前一家公司给你的工资也是一个参考，觉得自己屈才的话，大可以往上提。
</p>
<p>
综合考虑自己的能力，公司能给你带来的隐性收入，到时候直接报你能接受的最低工资就好了。如果是对方真的觉得你的水平不到那个工资，那也没办法的事情。重要的是自己能接受的最低限度是多少，就不要和对方讨价了，否则就算入职了回头也会郁闷的。
</p>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">跳槽</h2>
<div class="outline-text-2" id="text-6">


<p>
如果是跳槽过来的，一般都会问一下为什么从原单位离职。建议如实交代，就算是因为工资不高等觉得好像放不到台面上面的原因。没关系的，诚信是个基本要求。
</p>
<p>
跳槽也不建议太频繁。虽然现在通过跳槽涨工资是个普遍现象，但是也没有刚那边工作半年就来这边面试，并且要求工资涨 2k 的吧？那你再牛逼也没公司敢要，刚培养到能干活，跑了？
</p></div>
</div>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/about-interview/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="emacs-settings-in-mac/">mac 里面的 emacs 的几个设置</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-03-05T16:00:00.000Z" itemprop="datePublished">Mar 6, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/emacs/">emacs</a> <a href="../tags/macos/">macos</a>
</div>
    </div>
      
        
<p>刚开始在 mac 里面使用 emacs 简直就是自虐，因为那个反人类的 command 按键。一般 pc 上面的 alt 是在 space 旁边的，macbook 的 space 旁边是 command，对于一个需要经常在 mac 里面按的键，不是一般的郁闷。这个问题有两个方法解决。
</p>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">mac 自带的解决方法</h2>
<div class="outline-text-2" id="text-1">


<p>
就是在键盘设置里面，把修饰键里面的 command 和 alt 替换一下。这个方法会很不爽，因为 mac 里面的复制粘贴是 command + c/v，以后要按 alt + c/v 的话，距离有点远。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">KeyRemap4MacBook</h2>
<div class="outline-text-2" id="text-2">


<p>
这个是个 mac 上面的软件，地址在 <a href="http://pqrs.org/macosx/keyremap4macbook/document.html" target="_blank" rel="external">这里</a> 。里面的设置实在太多了，这里要用到的一个就是只在 emacs 里面把 command 和 alt 替换一下，这样就解决了上面提到的问题，还算完美。可是这个时候会发现，在 emacs 界面激活的情况下，command 开头的系统级别的快捷键都不好用了，比如 command + tab，这也很郁闷。
</p>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">emacs 自带的完美解决方法</h2>
<div class="outline-text-2" id="text-3">


<p>
只说 emacs23，emacs24。早期的好像有 mac-pass-command-to-system 之类的设置，可我在 emacs24 里面没看到这个变量。
</p>
<p>
具体设置参考<a href="http://www.emacswiki.org/emacs/EmacsForMacOS#toc23" target="_blank" rel="external">这里</a> ，主要是下面这些设置。
</p>


<pre class="prettyprint lang-lisp">
;; key bindings
(when (eq system-type 'darwin) ;; mac specific settings
  (setq mac-option-modifier 'alt)
  (setq mac-command-modifier 'meta)
  (global-set-key [kp-delete] 'delete-char) ;; sets fn-delete to be right-delete
  )
</pre>

<p>
现在就很爽了，按 command + x 和 alt + x 效果一样，按 command + tab 也能切换窗口。算是完美了。
</p></div>
</div>

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/emacs-settings-in-mac/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="analyse-and-vacuum-in-postgres/">postgres sql 调优一例</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-03-02T16:00:00.000Z" itemprop="datePublished">Mar 3, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/linux/">linux</a> <a href="../tags/postgres/">postgres</a> <a href="../tags/sql/">sql</a>
</div>
    </div>
      
        <p>前几天发现有个 sql 跑的超慢，第一次拿到 sql 大家简单分析了一下，觉得是写的有问题，里面有对一个大表的查询，数据量大概 800 万，结果还和好几个小表做了 join，而且还是 left join，速度可想而知了。单独对那个大表查询，其实也就是几分钟的事情。
</p>
<p>
所以建议就是先对小表做 join，然后再和大表做一次 join。不过结果并不理想，时间依然还是那么长。这个时候就得仔细看执行计划了，如下。
</p>
<p>
能看到虽然人肉对 sql 做了一些优化，但是 sql 并没有按照我们的期望去执行，执行计划里面还是首选去查 fact_tuan_rank_detail 这个大表，速度肯定慢了。
</p>


<pre class="prettyprint lang-text">
 Nested Loop Left Join  (cost=447.90..1003.43 rows=2 width=620)
   Join Filter: (team.id = team_arrive_city.team_id)
   ->  Nested Loop  (cost=77.62..85.98 rows=1 width=588)
         ->  HashAggregate  (cost=77.62..77.68 rows=1 width=71)
               ->  Index Scan using date_idx on fact_tuan_rank_detail  (cost=0.00..77.60 rows=1 width=71)
                     Index Cond: ((thedate >= '2012-02-25'::date) AND (thedate <= '2012-02-27'::date))="" filter:="" (((source)::text="" ~~="" '%team%'::text)="" and="" ((source)::text="" !~~="" '%today%'::text)="" '%ongoing%'::text)="" ((s="" ource)::text="" '%special%'::text))="" -="">  Index Scan using team_pkey on team  (cost=0.00..8.28 rows=1 width=32)
               Index Cond: (team.id = fact_tuan_rank_detail.team_id)
               Filter: ((to_timestamp((team.end_time)::double precision))::date > '2012-02-27'::date)
   ->  HashAggregate  (cost=370.29..589.15 rows=14591 width=15)
         ->  Seq Scan on team_arrive_city  (cost=0.00..288.19 rows=16419 width=15)
(12 rows)
</=></pre>

<p>
仔细研究之后，发现了 rows=1 这个信息。这就是为什么查询分析器先对这个表做查询了，因为他认为这个表最小。
</p>
<p>
此后对这个表执行了一下 <a href="http://www.postgresql.org/docs/9.1/static/sql-analyze.html" target="_blank" rel="external">analyse</a> 命令，更新了一些统计信息。然后再看执行计划如下。
</p>


<pre class="prettyprint lang-text">
 Hash Join  (cost=1210761.12..1326052.45 rows=2282704 width=620)
   Hash Cond: (fact_tuan_rank_detail.team_id = team.id)
   ->  HashAggregate  (cost=1203912.40..1265555.26 rows=1027381 width=71)
         ->  Index Scan using date_idx on fact_tuan_rank_detail  (cost=0.00..1075489.81 rows=10273807 width=71)
               Index Cond: ((thedate >= '2012-02-25'::date) AND (thedate <= '2012-02-27'::date))="" filter:="" (((source)::text="" ~~="" '%team%'::text)="" and="" ((source)::text="" !~~="" '%today%'::text)="" '%ongoing%'::text)="" ((source)="" ::text="" '%special%'::text))="" -="">  Hash  (cost=6666.33..6666.33 rows=14591 width=64)
         ->  Merge Left Join  (cost=6414.63..6666.33 rows=14591 width=64)
               Merge Cond: (team.id = b.team_id)
               ->  Sort  (cost=4670.40..4686.82 rows=6567 width=32)
                     Sort Key: team.id
                     ->  Seq Scan on team  (cost=0.00..4254.02 rows=6567 width=32)
                           Filter: ((to_timestamp((end_time)::double precision))::date > '2012-02-27'::date)
               ->  Sort  (cost=1744.23..1780.71 rows=14591 width=40)
                     Sort Key: b.team_id
                     ->  Subquery Scan on b  (cost=370.29..735.06 rows=14591 width=40)
                           ->  HashAggregate  (cost=370.29..589.15 rows=14591 width=15)
                                 ->  Seq Scan on team_arrive_city  (cost=0.00..288.19 rows=16419 width=15)
(18 rows)
</=></pre>

<p>
可以看到执行计划已经变了，先做其他表的 join，最后再和大表 join。并且提示的执行时间也大致靠谱。
</p>
<p>
从这里面引申一下，时常会听到有人说 explain 命令执行后得出的执行时间不靠谱，需要使用 explain analyse。可是为什么不靠谱呢，其实 explain analyse 需要的时间和实际执行时间一样，explain 不靠谱的原因是因为数据库对那个表的统计信息不及时导致的。
</p>
<p>
再进一步了解，postgres 里面这个统计信息为什么不靠谱呢？难道还总是需要我维护这些信息啊？
</p>
<p>
其实 postgres 里面有个 autovacuum 进程就是做这个事情的。autovacuum 进程默认是启用的。他会在数据库空闲的时候，对数据库做 vavcuum 和 analyse。具体多久执行一次，<a href="http://www.postgresql.org/docs/9.1/static/routine-vacuuming.html" target="_blank" rel="external">文档</a> 里面都有写，建议多看看这个页面里面的信息。
</p>
<p>
此外，还发现 postgres 还提供了很多 <a href="http://www.postgresql.org/docs/9.1/static/monitoring-stats.html" target="_blank" rel="external">数据库状态查询函数</a> ，使用这里面函数可以查到每个表最后一次 analyse 的时间，vacuum 的时
间，里面索引被使用的情况等等，好多信息。
</p>

ps: 使用 analyse 之后，那个 sql 好用了，可是发现过两天又不行了，查看 explain select * from t1 好像没问题，那怎么回事呢？开始没想明白，只好继续 analyse 一下，又好了。可过了两天又不行了。这次得细看了。最后发现是因为真实的 sql 是有 where 条件的，日期条件限定的那部分数据查询分析器认为很少导致了问题。没办法后面只好每次导数都 analyse 一下了。发现 pg_bulkload 导数的方式有点问题。

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/analyse-and-vacuum-in-postgres/#disqus_thread">Comments</a></span>
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="emacs-in-mac/">总算是将就同步好了 gentoo 和 mac 的 emacs</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2012-02-19T16:00:00.000Z" itemprop="datePublished">Feb 20, 2012</time>
</div>
      <div class="tags">Tags: 

<a href="../tags/heart/">heart</a>
</div>
    </div>
      
        mac 里面居然自带了一个 emacs，，版本是 22.1.1，有够老的反正是。因为 gentoo 用的是 emacs24，所以按照不知道哪里推荐的，去下载了一个 emacs24。然后就是尝试在 mac 下面配置好我的 emacs 了，配置好才好通过 org2blog 写 blog。。。

老早就随大流把 .emacs.d 放到了 github，所以这部分比较简单，只要 clone 一下就可以了。

之前没想到的是我的一部分 elisp 包是通过 gentoo 管理的，这样只有 .emacs.d 显然是不行的。然后使用了 dropbox 这个方案，把 gentoo 里面的 site-lisp 部分也同步过来。主要是 <em>usr/share/emacs/etc</em> 和 <em>usr/share/emacs/site-lisp</em> 两个目录。把 gentoo里面的这两个目录转移到 dropbox 里面，然后做个软链。mac 里面也从 dropbox 里面做好软链，要注意路径位置不能变化，变化的话 gentoo 里面的 site-gentoo.el 里面写死的路径就不能用了。不过不变化那个路径的话，其实是会影响系统自带的 emacs22.1.1 的使用的，不过不管了，爱咋匝地吧，反正我也不用那个。

接下来就是在 .emacs 里面加 load-path 就可以了。gentoo 是不需要的，所以用下面的代码
<pre class="prettyprint lang-lisp">
    (setq load-path
        (cons "/usr/share/emacs/site-lisp/" load-path)))</pre>
mac 里面用 emacs 一个郁闷的问题是，command 键挤在了 alt 和 space 中间，和普通键盘不一样，导致习惯了普通键盘的我经常按错。很郁闷，不知道能不能把那个 command 弄成 alt，反正好像 command 在 emacs 里面没用。。。

可以用上面类似的方法处理一些两个系统的特例。

顺便再吐槽下 mac 的输入法，装了个 sogou，发现这小子启动慢，经常切换过去后打了几个字母了都，他还没反应，字母就上屏了。fit的词库又不行，词频调整也有问题。‘在’我这半天输入 n 个了都，还是处在‘再’的后面，很讨厌。不知道有没有其他靠谱的。。。

      
	</div>

<div class="meta">
	
		<span class="comments"><a href="http://wdicc.com/emacs-in-mac/#disqus_thread">Comments</a></span>
	
</div>
</article>


  <nav id="pagenavi">
    
        <a href="/page/3/" class="prev">Prev</a>
    
    
        <a href="/page/5/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2016

    wd
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
