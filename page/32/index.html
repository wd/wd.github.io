<!DOCTYPE HTML>
<html>
<head>
	<meta name="generator" content="Hugo 0.19" />
	<meta charset="utf-8">
    
    
    <title>wd and cc</title>
    <meta name="author" content="wd">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://wdicc.com/index.xml" rel="alternate" title="wd and cc" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    

    <script type="text/javascript" src="/js/jquery-tapir.js"></script>

    

    <link rel="stylesheet" href="/css/hljs.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</head>


<body>
    <div id="wrapper">
        <header id="header" class="inner">
<h1 class="animated bounceInDown">
    <div id="headerbg">
        wd and cc
    </div>
</h1>

<span class="subtitle">happy every day</span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
    
    
    <li>
    <a href="https://github.com/wd" class="github" title="Github"></a>
    </li>
    
    
    
    
    
    <li>
    <a href="http://www.twitter.com/wd" class="twitter" title="Twitter"></a>
    </li>
    
    
    
    
    
</ul>


<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="https://wdicc.com/" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
</ul>

</header>

<div id="toload">

    <div id="content" class="inner">
        




    
    <script id="dsq-count-scr" src="//wdicc.disqus.com/count.js" async></script>
    




  <article class="post">
    <h2 class="title"> 
        <a href="/first-rain/">第一场秋雨？</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-13T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-13</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/heart">heart</a>

<a href="/tags/%E9%9B%A8">雨</a>


</div>
    </div>
        最近一个星期以来真是闷热的恐怖啊，还好昨天晚上下了一场雨，早上起来凉爽多了。今年的天气一直就比较怪异，按照往年的情况，6，7月份北京应该已经热的不行了，可是今年却是凉爽居多，那段时间还总是下雨，都是晚上下，早上停的，倒是不影响上班。不过北京的交通实在太差了，遇上几次下班时候下雨的，出了地铁就全是人了，平时人多的公交车反而比较空，而出租车却死活打不上。那天是站在雨里等了n久才打上车，浑身上下都湿透了。<br />

前几天立秋了，这在我们那里就表示早晚已经开始变凉了。北京这里却还没有变化，记得刚来北京上学的时候，是9月中吧，那会还是比较热的，我们那边早晚都得穿外套了。好像北京10.1都不凉快，唉。不过初步打算10.1回家，避暑去，嘿嘿。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/first-rain/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/maomao-photo/">毛毛旧照</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-08T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-08</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/cats">cats</a>

<a href="/tags/%E6%AF%9B%E6%AF%9B">毛毛</a>


</div>
    </div>
        <a class="tt-flickr" href="http://blog.wdicc.com/wordpress/Photos/photo/210049529/IMG_0027.html"><img height="375" alt="IMG_0027" src="http://static.flickr.com/76/210049529_0c706d393e.jpg" width="500" border="0" /></a> <a class="tt-flickr" href="http://blog.wdicc.com/wordpress/Photos/photo/210049445/IMG_0022.html"><img height="375" alt="IMG_0022" src="http://static.flickr.com/62/210049445_fdb84f0ae6.jpg" width="500" border="0" /></a><br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/maomao-photo/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/caps-in-usa-hk-and-china/">美国, 香港, 中国大陆三地警察</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-08T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-08</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/joke">Joke</a>

<a href="/tags/%E5%85%94%E5%AD%90">兔子</a>


</div>
    </div>
        为了测试美国, 香港, 中国大陆三地警察的实力, 联合国将三只兔子放在三个森林中, 看 三地警察谁先找出兔子.<br />

任务:找出兔子<br />
第一个森林前是美国警察, 他们先花整整半天时间开会制定作战计划, 严格分工, 然后派 特种部队快速进入森林进行地毯式搜索, 结果开会耽搁了时间, 兔子跑了, 任务失败!!!!<br />
然后轮到香港警察, 他们派了一百多号人和几十辆警车在身临其境外一字排开, 由带头人 用喇叭喊话:"兔子,兔子,你已经被包围了, 快出来投降......" 半天过去了, 没动静. 飞 虎队进入森林, 搜索一遍, 没结果, 任务失败!!!!<br />
最后是中国大陆警察, 只有四个, 先打了一天麻将, 黄昏时一人拿一警棍进入森林,没五分钟, 听到森林里传来一阵动物的惨叫, 中国警察一人抽着一根烟有说有笑的出来, 后面拖着一 只鼻青脸肿的熊,熊奄奄一息的说到:"不要再打了, 我就是兔子.....<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/caps-in-usa-hk-and-china/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/thief-in-711/">711也不保了，出现小偷</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/heart">heart</a>

<a href="/tags/%E5%85%AC%E4%BA%A4">公交</a>

<a href="/tags/%E5%B0%8F%E5%81%B7">小偷</a>


</div>
    </div>
        之前坐小九的时候，遇到过一次小偷。那家伙一上车就坐到了最后面一个坐。我站在他旁边，有两次这家伙往起一站都碰到头了。当时我没有想到是这家伙太注意目标了，所以才碰头，有人说丢手机的时候才想起来。丢手机的是个将手机跨在腰间的哥们，所以啊，一定不要用那种手机套了，太危险了，不过现在似乎很少有人用了。<br />

今天坐711的时候，又有人丢东西了。开始是一个mm冲着一个男的问他干吗呢，那个男的小声的和那个mm说了句什么，后来那个mm也没说什么了，好像给110打电话了，说有个男的怎么怎么样。那个哥们也就在打电话的时候挤着下车跑了。然后就听见一个兄弟说手机丢了，他的手机似乎是放在上衣的口袋里面的。然后大家就开始议论那个小偷，之前那个mm也说了一下为什么要冲那个小偷问话，原来是小偷掏她钱包被发现了，钱包掉地上了。大家就说那你怎么不说啊，你说了那个小偷铁定不能让他下车啊，你不说大家都不知道怎么回事呢。<br />

很挤的公交车上面很容易滋生小偷的，大家坐车的时候千万要注意。地铁上面似乎还没有遇到过小偷，可能对于小偷来说地铁逃起来太难吧。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/thief-in-711/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/oracle-em-encoding/">Oracle10g EM乱码之快速解决</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/heart">heart</a>

<a href="/tags/oracle">oracle</a>

<a href="/tags/%E4%B9%B1%E7%A0%81">乱码</a>


</div>
    </div>
        来源 <a target="_blank" href="http://www.eygle.com/archives/2006/03/oracle10g_em_font_change.html">这里</a><br />

一直没怎么用10g的EM工具,今天打开来看看,发现也有相传已久的乱码问题.网上也流传着N种解决方案,仔细看一下,其实这个问题很好解决.<br />

如果安装时,我们系统环境变量设置的是中文环境,那么就不会有这个问题.这个问题根本原因在于安装时,JDK/JRE字符集的自动选择.<br />

在 $ORACLE_HOME/jdk/jre/lib 和 $ORACLE_HOME/jre/1.4.2/lib/ 目录下都有多种字符集字体配置文件:<br />
<!--more--><br />
[oracle@danaly ~]$ cd $ORACLE_HOME/jdk/jre/lib<br />
[oracle@danaly lib]$ ls font*zh_CN*<br />
font.properties.zh_CN.Redhat  font.properties.zh_CN.Redhat2.1<br />
font.properties.zh_CN.Sun  font.properties.zh_CN_UTF8.Sun<br />

[oracle@danaly lib]$ cd $ORACLE_HOME/jre/1.4.2/lib/<br />
[oracle@danaly lib]$ ls font*zh_CN*<br />
font.properties.zh_CN.Redhat  font.properties.zh_CN.Redhat2.1<br />
font.properties.zh_CN.Sun  font.properties.zh_CN_UTF8.Sun<br />

我们只要用合适的中文字符集文件替换缺省文件即可,我选择使用font.properties.zh_CN.Redhat来替换缺省字体定义文件:<br />

[oracle@danaly lib]$ cp font.properties.zh_CN.Redhat font.properties<br />

替换之后需要清理一下Cache,重启EM即可.<br />

Cache路径通常位于:<br />

$ORACLE_HOME/oc4j/j2ee/oc4j_applications/applications/em/em/cabo/images/cache/zhs<br />

清除所有gif文件即可.然后重新启动EM:<br />

[oracle@danaly zhs]$ emctl stop dbconsole<br />
TZ set to PRC<br />
Oracle Enterprise Manager 10g Database Control Release 10.2.0.1.0<br />
Copyright (c) 1996, 2005 Oracle Corporation.  All rights reserved.<br />
http://danaly.hurrray.com.cn:1158/em/console/aboutApplication<br />
Stopping Oracle Enterprise Manager 10g Database Control ...<br />
...  Stopped.<br />
[oracle@danaly zhs]$ emctl start dbconsole<br />
TZ set to PRC<br />
Oracle Enterprise Manager 10g Database Control Release 10.2.0.1.0<br />
Copyright (c) 1996, 2005 Oracle Corporation.  All rights reserved.<br />
http://danaly.hurrray.com.cn:1158/em/console/aboutApplication<br />
Starting Oracle Enterprise Manager 10g Database Control .............. started.<br />
------------------------------------------------------------------<br />
Logs are generated in directory<br />
/opt/oracle/product/10.2.0/danaly.hurrray.com.cn_danaly/sysman/log<br />

现在登陆Web页面,EM显示就可以正常显示中文了.<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/oracle-em-encoding/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/oracle-handbook/">Oracle数据库日常维护手册</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/oracle">oracle</a>

<a href="/tags/other">other</a>

<a href="/tags/%E7%9B%91%E6%8E%A7">监控</a>


</div>
    </div>
        <h4 align="center" style="text-align: center; line-height: 13.5pt"><span lang="EN-US" style="color: black">Oracle</span><span style="color: black">数据库日常维护手册<span lang="EN-US"></span></span></h4><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">在<span lang="EN-US">Oracle</span>数据库运行期间，<span lang="EN-US">DBA</span>应该对数据库的运行日志及表空间的使用情况进行监控，及早发现数据库中存在的问题。<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">一、<span lang="EN-US">Oracle</span>警告日志文件监控 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">Oracle</span><span style="font-size: 9pt; color: black">在运行过程中，会在警告日志文件<span lang="EN-US">(alert_SID.log)</span>中记录数据库的一些运行情况<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●数据库的启动、关闭，启动时的非缺省参数<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●数据库的重做日志切换情况，记录每次切换的时间，及如果因为检查点<span lang="EN-US">(checkpoint)</span>操作没有执行完成造成不能切换，会记录不能切换的原因<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●对数据库进行的某些操作，如创建或删除表空间、增加数据文件<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●数据库发生的错误，如表空间不够、出现坏块、数据库内部错误<span lang="EN-US">(ORA-600) </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">DBA</span><span style="font-size: 9pt; color: black">应该定期检查日志文件，根据日志中发现的问题及时进行处理<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">问题处理<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">启动参数不对检查初始化参数文件<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">因为检查点操作或归档操作没有完成造成重做日志不能切换如果经常发生这样的情况，可以考虑增加重做日志文件组<span lang="EN-US">;</span>想办法提高检查点或归档操作的效率<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">有人未经授权删除了表空间检查数据库的安全问题，是否密码太简单<span lang="EN-US">;</span>如有必要，撤消某些用户的系统权限<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">出现坏块检查是否是硬件问题<span lang="EN-US">(</span>如磁盘本生有坏块<span lang="EN-US">)</span>，如果不是，检查是那个数据库对象出现了坏块，对这个对象进行重建<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">表空间不够增加数据文件到相应的表空间<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">出现<span lang="EN-US">ORA-600</span>根据日志文件的内容查看相应的<span lang="EN-US">TRC</span>文件，如果是<span lang="EN-US">Oracle</span>的<span lang="EN-US">bug</span>，要及时打上相应的补丁</span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><!--more--><br />
<strong><span style="font-size: 9pt; font-family: 宋体; color: black">    二、数据库表空间使用情况监控<span lang="EN-US">(</span>字典管理表空间<span lang="EN-US">) </span></span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">数据库运行了一段时间后，由于不断的在表空间上创建和删除对象，会在表空间上产生大量的碎片，<span lang="EN-US">DBA</span>应该及时了解表空间的碎片和可用空间情况，以决定是否要对碎片进行整理或为表空间增加数据文件。<span lang="EN-US"> </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">select tablespace_name, </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">count(*) chunks , </span></code><br />
<code><span style="font-family: 新宋体">max(bytes/1024/1024) max_chunk </span></code><br />
<code><span style="font-family: 新宋体">from dba_free_space </span></code><br />
<code><span style="font-family: 新宋体">group by tablespace_name; </span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">上面的<span lang="EN-US">SQL</span>列出了数据库中每个表空间的空闲块情况<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">其中，<span lang="EN-US">CHUNKS</span>列表示表空间中有多少可用的空闲块<span lang="EN-US">(</span>每个空闲块是由一些连续的<span lang="EN-US">Oracle</span>数据块组成<span lang="EN-US">)</span>，如果这样的空闲块过多，比如平均到每个数据文件上超过了<span lang="EN-US">100</span>个，那么该表空间的碎片状况就比较严重了，可以尝试用以下的<span lang="EN-US">SQL</span>命令进行表空间相邻碎片的接合<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">alter tablespace </span><span style="font-size: 9pt; color: black">表空间名<span lang="EN-US"> coalesce; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">对表空间的扩充对表空间的数据文件大小进行扩展，或向表空间增加数据文件，例如：<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">alter database datafile ‘filename’ resize 2g;</span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">alter tablespace add datafile ‘filename’ size 2g;</span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">三、查看数据库的连接情况 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">DBA</span><span style="font-size: 9pt; color: black">要定时对数据库的连接情况进行检查，看与数据库建立的会话数目是不是正常，如果建立了过多的连接，会消耗数据库的资源。同时，对一些<span lang="EN-US">“</span>挂死<span lang="EN-US">”</span>的连接，可能会需要<span lang="EN-US">DBA</span>手工进行清理。<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">以下的<span lang="EN-US">SQL</span>语句列出当前数据库建立的会话情况<span lang="EN-US">: </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">select sid,serial#,username,program,machine,status </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">from v$session;</span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"> </span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果<span lang="EN-US">DBA</span>要手工断开某个会话，则执行<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">alter system kill session 'SID,SERIAL#'; </span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">四、备份 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">控制文件的备份：<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">在数据库结构发生变化时，如增加了表空间，增加了数据文件或重做日志文件这些操作，都会造成<span lang="EN-US">Oracle</span>数据库控制文件的变化，<span lang="EN-US">DBA</span>应及进行控制文件的备份，备份方法是<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">执行<span lang="EN-US">SQL</span>语句<span lang="EN-US">: </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">alter database </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">backup controlfile to '/home/backup/control.bak'; </span></code><br />
</span><span style="font-size: 9pt; color: black">或<span lang="EN-US">: </span></span><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">alter database </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">backup controlfile to trace; </span></code><br />
</span><span style="font-size: 9pt; color: black">这样，会在<span lang="EN-US">USER_DUMP_DEST(</span>初始化参数文件中指定<span lang="EN-US">)</span>目录下生成创建控制文件的<span lang="EN-US">SQL</span>命令。 <span lang="EN-US"></span></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">数据逻辑备份：<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">导出：<span lang="EN-US">exp wd/******* file=***.dmp owner=wd</span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">导入：<span lang="EN-US">imp wd/******* file=***.dmp fromuser=wd touser=wd</span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span lang="EN-US" style="font-size: 9pt; font-family: 宋体; color: black"> </span></strong></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">五、检查数据库文件的状态 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">DBA</span><span style="font-size: 9pt; color: black">要及时查看数据库中数据文件的状态<span lang="EN-US">(</span>如被误删除<span lang="EN-US">)</span>，根据实际情况决定如何进行处理，检查数据文件的状态的<span lang="EN-US">SQL</span>如下<span lang="EN-US">: </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">select file_name,status </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">from dba_data_files;</span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"> </span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果数据文件的<span lang="EN-US">STATUS</span>列不是<span lang="EN-US">AVAILABLE</span>，那么就要采取相应的措施，如对该数据文件进行恢复操作，或重建该数据文件所在的表空间。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">六、检查数据库定时作业的完成情况 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果数据库使用了<span lang="EN-US">Oracle</span>的<span lang="EN-US">JOB</span>来完成一些定时作业，要对这些<span lang="EN-US">JOB</span>的运行情况进行检查<span lang="EN-US">: </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">select job,log_user,last_date,failures </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">from dba_jobs; </span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果<span lang="EN-US">FAILURES</span>列是一个大于<span lang="EN-US">0</span>的数的话，说明<span lang="EN-US">JOB</span>运行失败，要进一步的检查。<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">七、数据库坏块的处理 </span></strong><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">当<span lang="EN-US">Oracle</span>数据库出现坏块时，<span lang="EN-US">Oracle</span>会在警告日志文件<span lang="EN-US">(alert_SID.log)</span>中记录坏块的信息<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">ORA-01578: ORACLE data block corrupted (file # 7, block # ) </span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">ORA-01110: data file : '/oracle1/oradata/V920/oradata/V816/users01.dbf' </span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">其中， 代表坏块所在数据文件的绝对文件号， 代表坏块是数据文件上的第几个数据块<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">出现这种情况时，应该首先检查是否是硬件及操作系统上的故障导致<span lang="EN-US">Oracle</span>数据库出现坏块。在排除了数据库以外的原因后，再对发生坏块的数据库对象进行处理。<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">1.</span><span style="font-size: 9pt; color: black">确定发生坏块的数据库对象<span lang="EN-US"> </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">SELECT tablespace_name, </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">segment_type, </span></code><br />
<code><span style="font-family: 新宋体">owner, </span></code><br />
<code><span style="font-family: 新宋体">segment_name </span></code><br />
<code><span style="font-family: 新宋体">FROM dba_extents </span></code><br />
<code><span style="font-family: 新宋体">WHERE file_id = </span></code><br />
<code><span style="font-family: 新宋体">AND </span></code><br />
<code><span style="font-family: 新宋体">between block_id AND block_id+blocks-1; </span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">2.</span><span style="font-size: 9pt; color: black">决定修复方法<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果发生坏块的对象是一个索引，那么可以直接把索引<span lang="EN-US">DROP</span>掉后，再根据表里的记录进行重建<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果发生坏块的表的记录可以根据其它表的记录生成的话，那么可以直接把这个表<span lang="EN-US">DROP</span>掉后重建<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果有数据库的备份，则恢复数据库的方法来进行修复<span lang="EN-US">; </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">如果表里的记录没有其它办法恢复，那么坏块上的记录就丢失了，只能把表中其它数据块上的记录取出来，然后对这个表进行重建。<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">3.</span><span style="font-size: 9pt; color: black">用<span lang="EN-US">Oracle</span>提供的<span lang="EN-US">DBMS_REPAIR</span>包标记出坏块<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">exec DBMS_REPAIR.SKIP_CORRUPT_BLOCKS(' ',''); </span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">4.</span><span style="font-size: 9pt; color: black">使用<span lang="EN-US">Create table as select</span>命令将表中其它块上的记录保存到另一张表上<span lang="EN-US"> </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">create table corrupt_table_bak </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">as </span></code><br />
<code><span style="font-family: 新宋体">select * from corrupt_table; </span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">5.</span><span style="font-size: 9pt; color: black">用<span lang="EN-US">DROP TABLE</span>命令删除有坏块的表<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">drop table corrup_tatble; </span></code><span lang="EN-US" style="font-size: 9pt; color: black"></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">6.</span><span style="font-size: 9pt; color: black">用<span lang="EN-US">alter table rename</span>命令恢复原来的表<span lang="EN-US"> </span></span></p><br />

<p style="text-indent: 24pt; line-height: 13.5pt"><code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black">alter table corrupt_table_bak </span></code><span lang="EN-US" style="font-size: 10pt; font-family: 新宋体; color: black"><br />
<code><span style="font-family: 新宋体">rename to corrupt_table; </span></code></span><span lang="EN-US" style="font-size: 9pt; color: black"></span><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">7.</span><span style="font-size: 9pt; color: black">如果表上存在索引，则要重建表上的索引<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; font-family: 宋体; color: black">八、操作系统相关维护 <span lang="EN-US"></span></span></strong></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">DBA</span><span style="font-size: 9pt; color: black">要注意对操作系统的监控<span lang="EN-US">: </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●文件系统的空间使用情况<span lang="EN-US">(df -k)</span>，必要时对<span lang="EN-US">Oracle</span>的警告日志及<span lang="EN-US">TRC</span>文件进行清理<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●如果<span lang="EN-US">Oracle</span>提供网络服务，检查网络连接是否正常<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●检查操作系统的资源使用情况是否正常<span lang="EN-US"> </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">●检查数据库服务器有没有硬件故障，如磁盘、内存报错<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><strong><span style="font-size: 9pt; color: black">九、数据库背景知识<span lang="EN-US"></span></span></strong></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">配置文件<span lang="EN-US">   </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">spfile</span><span style="font-size: 9pt; color: black">，位于<span lang="EN-US">$ORACLE_HOME/dbs/spfile<ORACLE_SID>.ora,</span>是一个二进制文件，不能直接编辑，<span lang="EN-US">Oracle9i</span>之后默认使用<span lang="EN-US">spfile</span>。可以通过<span lang="EN-US">alter system set </span>×××<span lang="EN-US">=</span>×××<span lang="EN-US">;</span>来修改参数，大部分参数修改后不用重启数据库。可以通过执行<span lang="EN-US">show parameter spfile</span>来查看是否使用了<span lang="EN-US">spfile</span>，如果执行结果为空，则数据库没有使用<span lang="EN-US">spfile</span>。执行<span lang="EN-US">create spfile from pfile; </span>然后重启数据库就启用了<span lang="EN-US">spfile</span>。<span lang="EN-US">   </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">pfile</span><span style="font-size: 9pt; color: black">，位于<span lang="EN-US">$ORACLE_HOME/dbs/init<ORACLE_SID>.ora</span>，是一个<span lang="EN-US">ASCII</span>文件可以编辑，修改参数后需要重启数据库。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">tnsnames.ora, </span><span style="font-size: 9pt; color: black">位于<span lang="EN-US">$ORACLE_HOME/network/admin/tnsnames.ora, </span>记录了服务明的信息。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">listener.ora, </span><span style="font-size: 9pt; color: black">位于<span lang="EN-US">$ORACLE_HOME/network/admin/listener.ora</span>，记录了<span lang="EN-US">listener</span>的信息。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">日志文件<span lang="EN-US">   </span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">alert, </span><span style="font-size: 9pt; color: black">位于<span lang="EN-US">$ORACLE_BASE/admin/$ORACLE_SID/bdump/alert<$ORACLE_SID>.log, Oracle</span>的报警日志，如数据库出错可以在此文件中查看。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">redo, </span><span style="font-size: 9pt; color: black">位于<span lang="EN-US">$ORACLE_BASE/oradata/redo</span>××<span lang="EN-US">.log</span>，<span lang="EN-US">Orale</span>重做日志。<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">启动<span lang="EN-US">/</span>停止<span lang="EN-US">ORACLE</span>：<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">以<span lang="EN-US">sysdba</span>权限登陆<span lang="EN-US">sqlplus</span>，<span lang="EN-US"></span></span></p><br />
<p style="text-indent: 42pt; line-height: 13.5pt"><span style="font-size: 9pt; color: black">停止：<span lang="EN-US">shutdown immediate</span></span></p><br />
<p style="text-indent: 24pt; line-height: 13.5pt"><span lang="EN-US" style="font-size: 9pt; color: black">    </span><span style="font-size: 9pt; color: black">启动：<span lang="EN-US">startup</span></span></p><br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/oracle-handbook/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/usefull-sql/">Oracle维护常用SQL语句</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>


</div>
    </div>
        查看所有用户<br />
<pre class="prettyprint lang-sql">
select username,password from dba_users;
</pre><br />
1、查看表空间的名称及大小<br />
<pre class="prettyprint lang-sql">
select t.tablespace_name, round(sum(bytes/(1024*1024)),0) ts_size
from dba_tablespaces t, dba_data_files d
where t.tablespace_name = d.tablespace_name
group by t.tablespace_name;
</pre><br />
2、查看表空间物理文件的名称及大小<br />
<pre class="prettyprint lang-sql">
select tablespace_name, file_id, file_name,
round(bytes/(1024*1024),0) total_space
from dba_data_files
order by tablespace_name;
</pre><br />
<!--more--><br />
3、查看回滚段名称及大小<br />
<pre class="prettyprint lang-sql">
select segment_name, tablespace_name, r.status,
(initial_extent/1024) InitialExtent,(next_extent/1024) NextExtent,
max_extents, v.curext CurExtent
From dba_rollback_segs r, v$rollstat v
Where r.segment_id = v.usn(+)
order by segment_name ;
</pre><br />
4、查看控制文件<br />
<pre class="prettyprint lang-sql">
select name from v$controlfile;
</pre><br />
5、查看日志文件<br />
<pre class="prettyprint lang-sql">
select member from v$logfile;
</pre><br />
6、查看表空间的使用情况<br />
<pre class="prettyprint lang-sql">
select sum(bytes)/(1024*1024) as free_space,tablespace_name
from dba_free_space
group by tablespace_name;

SELECT A.TABLESPACE_NAME,A.BYTES TOTAL,B.BYTES USED, C.BYTES FREE,
(B.BYTES*100)/A.BYTES "% USED",(C.BYTES*100)/A.BYTES "% FREE"
FROM SYS.SM$TS_AVAIL A,SYS.SM$TS_USED B,SYS.SM$TS_FREE C
WHERE A.TABLESPACE_NAME=B.TABLESPACE_NAME AND A.TABLESPACE_NAME=C.TABLESPACE_NAME;
</pre><br />
7、查看数据库库对象<br />
select owner, object_type, status, count(*) count# from all_objects group by owner, object_type, status;<br />

8、查看数据库的版本<br />
Select version FROM Product_component_version<br />
Where SUBSTR(PRODUCT,1,6)='Oracle';<br />

9、查看数据库的创建日期和归档方式<br />
Select Created, Log_Mode, Log_Mode From V$Database;<br />

10、捕捉运行很久的SQL<br />
column username format a12<br />
column opname format a16<br />
column progress format a8<br />
select username,sid,opname,<br />
round(sofar*100 / totalwork,0) || '%' as progress,<br />
time_remaining,sql_text<br />
from v$session_longops , v$sql<br />
where time_remaining <> 0<br />
and sql_address = address<br />
and sql_hash_value = hash_value<br />
/<br />

11、查看数据表的参数信息<br />
SELECT partition_name, high_value, high_value_length, tablespace_name,<br />
pct_free, pct_used, ini_trans, max_trans, initial_extent,<br />
next_extent, min_extent, max_extent, pct_increase, FREELISTS,<br />
freelist_groups, LOGGING, BUFFER_POOL, num_rows, blocks,<br />
empty_blocks, avg_space, chain_cnt, avg_row_len, sample_size,<br />
last_analyzed<br />
FROM dba_tab_partitions<br />
--WHERE table_name = :tname AND table_owner = :towner<br />
ORDER BY partition_position<br />

12、查看还没提交的事务<br />
select * from v$locked_object;<br />
select * from v$transaction;<br />

13、查找object为哪些进程所用<br />
select<br />
p.spid,<br />
s.sid,<br />
s.serial# serial_num,<br />
s.username user_name,<br />
a.type object_type,<br />
s.osuser os_user_name,<br />
a.owner,<br />
a.object object_name,<br />
decode(sign(48 - command),<br />
1,<br />
to_char(command), 'Action Code #' || to_char(command) ) action,<br />
p.program oracle_process,<br />
s.terminal terminal,<br />
s.program program,<br />
s.status session_status<br />
from v$session s, v$access a, v$process p<br />
where s.paddr = p.addr and<br />
s.type = 'USER' and<br />
a.sid = s.sid and<br />
a.object='SUBSCRIBER_ATTR'<br />
order by s.username, s.osuser<br />

14、回滚段查看<br />
select rownum, sys.dba_rollback_segs.segment_name Name, v$rollstat.extents<br />
Extents, v$rollstat.rssize Size_in_Bytes, v$rollstat.xacts XActs,<br />
v$rollstat.gets Gets, v$rollstat.waits Waits, v$rollstat.writes Writes,<br />
sys.dba_rollback_segs.status status from v$rollstat, sys.dba_rollback_segs,<br />
v$rollname where v$rollname.name(+) = sys.dba_rollback_segs.segment_name and<br />
v$rollstat.usn (+) = v$rollname.usn order by rownum<br />

15、耗资源的进程(top session)<br />
select s.schemaname schema_name, decode(sign(48 - command), 1,<br />
to_char(command), 'Action Code #' || to_char(command) ) action, status<br />
session_status, s.osuser os_user_name, s.sid, p.spid , s.serial# serial_num,<br />
nvl(s.username, '[Oracle process]') user_name, s.terminal terminal,<br />
s.program program, st.value criteria_value from v$sesstat st, v$session s , v$process p<br />
where st.sid = s.sid and st.statistic# = to_number('38') and ('ALL' = 'ALL'<br />
or s.status = 'ALL') and p.addr = s.paddr order by st.value desc, p.spid asc, s.username asc, s.osuser asc<br />

16、查看锁(lock)情况<br />
select /*+ RULE */ ls.osuser os_user_name, ls.username user_name,<br />
decode(ls.type, 'RW', 'Row wait enqueue lock', 'TM', 'DML enqueue lock', 'TX',<br />
'Transaction enqueue lock', 'UL', 'User supplied lock') lock_type,<br />
o.object_name object, decode(ls.lmode, 1, null, 2, 'Row Share', 3,<br />
'Row Exclusive', 4, 'Share', 5, 'Share Row Exclusive', 6, 'Exclusive', null)<br />
lock_mode, o.owner, ls.sid, ls.serial# serial_num, ls.id1, ls.id2<br />
from sys.dba_objects o, ( select s.osuser, s.username, l.type,<br />
l.lmode, s.sid, s.serial#, l.id1, l.id2 from v$session s,<br />
v$lock l where s.sid = l.sid ) ls where o.object_id = ls.id1 and o.owner<br />
<> 'SYS' order by o.owner, o.object_name<br />

17、查看等待(wait)情况<br />
SELECT v$waitstat.class, v$waitstat.count count, SUM(v$sysstat.value) sum_value<br />
FROM v$waitstat, v$sysstat WHERE v$sysstat.name IN ('db block gets',<br />
'consistent gets') group by v$waitstat.class, v$waitstat.count<br />

18、查看sga情况<br />
SELECT NAME, BYTES FROM SYS.V_$SGASTAT ORDER BY NAME ASC<br />

19、查看catched object<br />
SELECT owner, name, db_link, namespace,<br />
type, sharable_mem, loads, executions,<br />
locks, pins, kept FROM v$db_object_cache<br />

20、查看V$SQLAREA<br />
SELECT SQL_TEXT, SHARABLE_MEM, PERSISTENT_MEM, RUNTIME_MEM, SORTS,<br />
VERSION_COUNT, LOADED_VERSIONS, OPEN_VERSIONS, USERS_OPENING, EXECUTIONS,<br />
USERS_EXECUTING, LOADS, FIRST_LOAD_TIME, INVALIDATIONS, PARSE_CALLS, DISK_READS,<br />
BUFFER_GETS, ROWS_PROCESSED FROM V$SQLAREA<br />

21、查看object分类数量<br />
select decode (o.type#,1,'INDEX' , 2,'TABLE' , 3 , 'CLUSTER' , 4, 'VIEW' , 5 ,<br />
'SYNONYM' , 6 , 'SEQUENCE' , 'OTHER' ) object_type , count(*) quantity from<br />
sys.obj$ o where o.type# > 1 group by decode (o.type#,1,'INDEX' , 2,'TABLE' , 3<br />
, 'CLUSTER' , 4, 'VIEW' , 5 , 'SYNONYM' , 6 , 'SEQUENCE' , 'OTHER' ) union select<br />
'COLUMN' , count(*) from sys.col$ union select 'DB LINK' , count(*) from<br />

22、按用户查看object种类<br />
select u.name schema, sum(decode(o.type#, 1, 1, NULL)) indexes,<br />
sum(decode(o.type#, 2, 1, NULL)) tables, sum(decode(o.type#, 3, 1, NULL))<br />
clusters, sum(decode(o.type#, 4, 1, NULL)) views, sum(decode(o.type#, 5, 1,<br />
NULL)) synonyms, sum(decode(o.type#, 6, 1, NULL)) sequences,<br />
sum(decode(o.type#, 1, NULL, 2, NULL, 3, NULL, 4, NULL, 5, NULL, 6, NULL, 1))<br />
others from sys.obj$ o, sys.user$ u where o.type# >= 1 and u.user# =<br />
o.owner# and u.name <> 'PUBLIC' group by u.name order by<br />
sys.link$ union select 'CONSTRAINT' , count(*) from sys.con$<br />

23、有关connection的相关信息<br />

1)查看有哪些用户连接<br />
select s.osuser os_user_name, decode(sign(48 - command), 1, to_char(command),<br />
'Action Code #' || to_char(command) ) action, p.program oracle_process,<br />
status session_status, s.terminal terminal, s.program program,<br />
s.username user_name, s.fixed_table_sequence activity_meter, '' query,<br />
0 memory, 0 max_memory, 0 cpu_usage, s.sid, s.serial# serial_num<br />
from v$session s, v$process p where s.paddr=p.addr and s.type = 'USER'<br />
order by s.username, s.osuser<br />

2)<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/usefull-sql/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/about-pam/">PAM入门介绍</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>

<a href="/tags/pam">pam</a>


</div>
    </div>
        来源 <a target="_blank" href="http://sinbad.zhoubin.com/read.html?board=UNIX&num=482">这里</a><br />

PAM（Pluggable Authentication Modules ）是由Sun提出的一种认证机制。它通过提供一些<br />
动态链接库和一套统一的API，将系统提供的服务 和该服务的认证方式分开，使得系统管理<br />
员可以灵活地根据需要给不同的服务配置不同的认证方式而无需更改服务程序，同时也便于<br />
向系 统中添加新的认证手段。<br />
PAM最初是集成在Solaris中，目前已移植到其它系统中，如Linux、SunOS、HP-UX 9.0等。<br />

一、PAM的结构<br />

PAM的整个框架结构如下图所示：<br />


系统管理员通过PAM配置文件来制定认证策略，即指定什么服务该采用什么样的认证方法；应<br />
用程序开发者通过在服务程序中使用PAM API而实现对认证方法的调用；而PAM服务模块（se<br />
rvice module）的开发者则利用PAM SPI（Service Module API）来编写认证模块（主 要是<br />
引出一些函数pam_sm_xxxx( )供libpam调用），将不同的认证机制（比如传统的UNIX认证方<br />
法、Kerberos等）加入到系统中；PAM核 心库（libpam）则读取配置文件，以此为根据将服<br />
务程序和相应的认证方法联系起来。<!--more--><br />
二、PAM支持的四种管理界面：<br />

1、认证管理（authentication management）<br />
主要是接受用户名和密码，进而对该用户的密码进行认证，并负责设置用户的一些秘密<br />
信息。<br />
2、帐户管理（account management）<br />
主要是检查帐户是否被允许登录系统，帐号是否已经过期，帐号的登录是否有时间段的<br />
限制等等。<br />
3、密码管理（password management）<br />
主要是用来修改用户的密码。<br />
4、会话管理（session management）<br />
主要是提供对会话的管理和记账（accounting）。<br />

三、PAM的文件：<br />

/usr/lib/libpam.so.*                  PAM核心库<br />
/etc/pam.conf或者/etc/pam.d/          PAM配置文件<br />
/usr/lib/security/pam_*.so            可动态加载的PAM service module<br />
对于RedHat，其目录不是/usr/lib，而是/lib。<br />

四、PAM的配置：<br />

PAM的配置是通过单个配置文件/etc/pam.conf。RedHat还支持另外一种配置方式，即通过配<br />
置目录/etc/pam.d/，且这种的优先级要高于单 个配置文件的方式。<br />

1、使用配置文件/etc/pam.conf<br />

该文件是由如下的行所组成的：<br />
service-name  module-type  control-flag  module-path  arguments<br />

service-name 服务的名字，比如telnet、login、ftp等，服务名字“OTHER”代表所有没有<br />
在该文件中明确配置的其它服务。<br />
module-type  模块类型有四种：auth、account、session、password，即对应PAM所支持的<br />
四种管理方式。同一个服务可以调用多个 PAM模块进行认证，这些模块构成一个stack。<br />
control-flag 用来告诉PAM库该如何处理与该服务相关的PAM模块的成功或失败情况。它有四<br />
种可能的 值：required，requisite，sufficient，optional。<br />
required 表示本模块必须返回成功才能通过认证，但是如果该模块返回失败的话，失败<br />
结果也不会立即通知用户，而是要等到同一stack 中的所有模块全部执行完毕再将失败结果<br />
返回给应用程序。可以认为是一个必要条件。<br />
requisite 与required类似，该模块必须返回成功才能通过认证，但是一旦该模块返回<br />
失败，将不再执行同一stack内的任何模块，而是直 接将控制权返回给应用程序。是一个必<br />
要条件。注：这种只有RedHat支持，Solaris不支持。<br />
sufficient 表明本模块返回成功已经足以通过身份认证的要求，不必再执行同一stack<br />
内的其它模块，但是如果本模块返回失败的话可以 忽略。可以认为是一个充分条件。<br />
optional表明本模块是可选的，它的成功与否一般不会对身份认证起关键作用，其返回<br />
值一般被忽略。<br />
对于control-flag，从Linux-PAM-0.63版本起，支持一种新的语法，具体可参看Linux<br />
PAM文档。<br />
module-path 用来指明本模块对应的程序文件的路径名，一般采用绝对路径，如果没有给出<br />
绝对路径，默认该文件在目录/usr/lib/security下 面。<br />
arguments  是用来传递给该模块的参数。一般来说每个模块的参数都不相同，可以由该模块<br />
的开发者自己定义，但是也有以下几个共同 的参数：<br />
debug          该模块应当用syslog( )将调试信息写入到系统日志文件中。<br />
no_warn        表明该模块不应把警告信息发送给应用程序。<br />
use_first_pass  表明该模块不能提示用户输入密码，而应使用前一个模块从用户那里<br />
得到的密码。<br />
try_first_pass  表明该模块首先应当使用前一个模块从用户那里得到的密码，如果该<br />
密码验证不通过，再提示用户输入新的密码。<br />
use_mapped_pass 该模块不能提示用户输入密码，而是使用映射过的密码。<br />
expose_account  允许该模块显示用户的帐号名等信息，一般只能在安全的环境下使用<br />
，因为泄漏用户名会对安全造成一定程度的威 胁。<br />

2、使用配置目录/etc/pam.d/（只适用于RedHat Linux）<br />

该目录下的每个文件的名字对应服务名，例如ftp服务对应文件/etc/pam.d/ftp。如果名为x<br />
xxx的服务所对应的配置文件/etc/pam.d/xxxx不存 在，则该服务将使用默认的配置文件/et<br />
c/pam.d/other。每个文件由如下格式的文本行所构成：<br />
module-type  control-flag  module-path  arguments<br />
每个字段的含义和/etc/pam.conf中的相同。<br />

3、配置的例子<br />

例一：用/etc/pam.conf配置默认的认证方式。<br />

下面的例子将拒绝所有没有在/etc/pam.conf中明确配置的服务。OTHER代表没有明确配置的<br />
其它所有服务，pam_deny模块的作用只是简 单地拒绝通过认证。<br />
OTHER  auth    required      /usr/lib/security/pam_deny.so<br />
OTHER  account  required      /usr/lib/security/pam_deny.so<br />
OTHER  password required      /usr/lib/security/pam_deny.so<br />
OTHER  session  required      /usr/lib/security/pam_deny.so<br />


例二：通过/etc/pam.d/rsh文件配置rsh服务的认证方式。<br />

rsh服务认证用户时，先使用/etc/hosts.equiv和.rhosts文件的认证方式，然后再根据/etc<br />
/nologin文件的存在与否来判断是否允许该用户使用 rsh，最后使用password database来认<br />
证用户。<br />

auth      required    /lib/security/pam_rhosts_auth.so<br />
auth      required    /lib/security/pam_nologin.so<br />
account    required    /lib/security/pam_pwdb.so<br />
session    required    /lib/security/pam_pwdb.so<br />


例三：通过/etc/pam.conf配置ftpd的认证方式。<br />

下面是ftpd服务利用PAM模块进行用户认证的三个步骤。首先用pam_ftp模块检查当前用户是<br />
否为匿名用户，如果是匿名用户，则 sufficient控制标志表明无需再进行后面的认证步骤，<br />
直接通过认证；否则继续使用pam_unix_auth模块来进行标准的unix认证，即用/etc/ passw<br />
d和/etc/shadow进行认证；通过了pam_unix_auth模块的认证之后，还要继续用pam_listfil<br />
e模块来检查该用户是否出现在文件/etc/ ftpusers中，如果是则该用户被deny掉。<br />
ftpd    auth    sufficient  /usr/lib/security/pam_ftp.so<br />
ftpd    auth    required    /usr/lib/security/pam_unix_auth.so use_first_pass<br />
ftpd    auth    required    /usr/lib/security/pam_listfile.so \<br />
onerr=succeed item=user sense=deny file=/etc/ftpuser<br />
s<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/about-pam/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/weblogic-turning/">Weblogic服务器性能调优</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/other">other</a>

<a href="/tags/weblogic">weblogic</a>

<a href="/tags/%E6%80%A7%E8%83%BD">性能</a>


</div>
    </div>
        来源 <a target="_blank" href="http://www.mikecat.net/BlogView.asp?logID=1489">这里</a><br />

注：在下面做的介绍都是以Weblogic8.1为例的，其它版本的Weblogic可能会有些许不同。<br />

1) 设置JAVA参数；<br />

a) 编辑Weblogic Server启动脚本文件；<br />

BEA_HOME\user_projects\domains\domain-name\startWebLogic.cmd(startWebLogic.sh on Unix)<br />

BEA_HOME\user_projects\domains\domain-name\startManagedWebLogic.cmd(startManagedWebLogic.sh on Unix)<br />

b) 编辑set JAVA_OPTIONS命令，如：set JAVA_OPTIONS=-Xms256m –Xmx256m；<br />

c) 保存，重启即可。<br />

注：在WebLogic中，为了获得更好的性能，BEA公司推荐最小Java堆等于最大Java堆。<br />
<!--more--><br />
2) 开发模式 vs. 产品模式；<br />

开发模式和产品模式的一些参数的默认值不同，可能会对性能造成影响，下面是对性能有影响的参数列表：<br />

参数<br />

开发模式默认值<br />

产品模式默认值<br />

Execute Queue: Thread Count<br />

15 threads<br />

25 threads<br />

JDBC Connection Pool: MaxCapacity<br />

15 connnections<br />

25 connections<br />

通过启动管理控制台，在域（如：mydomain）> 配置 > 常规选择产品模式。<br />

3) 尽量开启本地I/O；<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）> 配置 > 调整选择启用本地I/O。<br />

注：此值也可通过手动的修改config.xml配置文件。<br />

4) 调优执行队列线程；<br />

a) 修改默认执行线程数<br />

在这里，执行队列的线程数表示执行队列能够同时执行的操作的数量。但此值不是设的越大越好，应该恰到好处的去设置它，太小了，执行队列中将会积累很多待处理的任务，太大了，则会消耗大量的系统资源从而影响整体的性能。在产品模式下默认为25个执行线程。<br />

为了设置理想的执行队列的线程数，我们可以启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）> 监视 > 性能中监控最大负载时执行队列的吞吐量和队列中的等待请求数，据此确定理想的数值。<br />

理想的默认执行线程数是由多方面的因素决定的，比如机器CPU性能、总体体系架构、I/O、操作系统的进程调度机制、JVM的线程调度机制。随着CPU个数的增加，WebLogic可以近乎线性地提高线程数。线程数越多，花费在线程切换的时间也就越多；线程数越小，CPU可能无法得到充分的利用。为获取一个理想的线程数，需要经过反复的测试。在测试中，可以以25*CPU个数为基准进行调整。当空闲线程较少，CPU利用率较低时，可以适当增加线程数的大小（每五个递增）。对于PC Server和Windows 2000，则最好每个CPU小于50个线程，以CPU利用率为90%左右为最佳。<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）> Execute Queue > weblogic.kernel.Defalt > 配置中修改线程计数。<br />

b) 设定执行队列的溢出条件；<br />

Weblogic Server提供给默认的执行队列或用户自定义的执行队列自定义溢出条件的功能，当满足此溢出条件时，服务器改变其状态为“警告”状态，并且额外的再分配一些线程去处理在队列中的请求，而达到降低队列长度的目的。<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）> Execute Queue > weblogic.kernel.Defalt > 配置下面几项：<br />

l         队列长度：此值表示执行队列中可容纳的最大请求数，默认值是65536，最后不要手动改变此值。<br />

l         队列长度阈值百分比：此值表示溢出条件，在此服务器指出队列溢出之前可以达到的队列长度大小的百分比。<br />

l         线程数增加：当检测到溢出条件时，将增加到执行队列中的线程数量。如果CPU和内存不是足够的高，尽量不要改变默认值“0”。因为Weblogic一旦增加后不会自动缩减，虽然最终可能确实起到了降低请求的作用，但在将来的运行中将影响程序的性能。<br />

l         最大线程数：为了防止创建过多的线程数量，可以通过设定最大的线程数进行控制。<br />

在实际的应用场景中，应根据具体情况适当的调整以上参数。<br />

c) 设定执行队列监测行为<br />

Weblogic Server 能够自动监测到当一个执行线程变为“阻塞”。变为“阻塞”状态的执行线程将无法完成当前的工作，也无法再执行新请求。如果执行队列中的所有执行线程都变为 “阻塞”状态，Weblogic server可能改变状态为“警告”或“严重”状态。如果Weblogic server变为“严重”状态，可以通过 Node Manager来自动关闭此服务器并重新启动它。具体请参考：Node Manager Capabilities文档。<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）>配置 > 调整下可配置下面几项：<br />

l         阻塞线程最长时间：在此服务器将线程诊断为阻塞线程之前，线程必须连续工作的时间长度(秒)。默认情况下，WebLogic Server 认为线程在连续工作 600 秒后成为阻塞线程。<br />

l         阻塞线程计时器间隔：WebLogic Server 定期扫描线程以查看它们是否已经连续工作了 "阻塞线程最长时间" 字段中指定的时间长度的间隔时间(秒)。默认情况下，WebLogic Server 将此时间间隔设置为 600 秒。<br />

5) 调优TCP连接缓存数；<br />

WebLogic Server 用Accept Backlog参数规定服务器向操作系统请求的队列大小，默认值为50。当系统重载负荷时,这个值可能过小,日志中报 Connection Refused,导致有效连接请求遭到拒绝,此时可以提高Accept Backlog 25%直到连接拒绝错误消失。对于 Portal类型的应用,默认值往往是不够的。Login Timeout和SSL Login Timeout参数表示普通连接和SSL连接的超时时间,如果客户连接被服务器中断或者SSL容量大,可以尝试增加该值。<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）>配置 > 调整下可配置“接受预备连接”。<br />

6) 改变Java编译器；<br />

标准的Java编译器是javac，但编译JSP servlets速度太慢，为了提高编译速度，可以使用sj或jikes编译器取代javac编译器。下面说说更改Java编译器：<br />

通过启动管理控制台，在域（如：mydomain）> 服务器 > server实例（如：myserver）>配置 > 常规下改变Java 编译器，默认为javac。输入完整路径，如：c:\visualcafe31\bin\sj.exe。然后打开高级选项，在预规划到类路径填写编译 Java 代码时为 Java 编译器类路径预规划的选项，如：BEA_HOME\jdk141_02\jre\lib\rt.jar。<br />

7) 使用Webogic Server集群提高性能；<br />

具体关于如何配置Weblogic集群，我就不细说了。详情可参考：Introduction to WebLogic Server Clustering。<br />

8) Weblogic EJB调优<br />

由于EJB2.0已经很少项目在用了，EJB3.0再成熟一点，我再补充这一部分吧！<br />

9) JDBC应用调优<br />

JDBC Connection Pool 的调优受制于WebLogic Server线程数的设置和数据库进程数,游标的大小。通常我们在一个线程中使用一个连接,所以连接数并不是越多越好,为避免两边的资源消耗，建议设置连接池的最大值等于或者略小于线程数。同时为了减少新建连接的开销,将最小值和最大值设为一致。<br />

增加 Statement Cache Size对于大量使用PreparedStatement对象的应用程序很有帮助,WebLogic能够为每一个连接缓存这些对象,此值默认为10。在保证数据库游标大小足够的前提下,可以根据需要提高Statement Cache Size。比如当你设置连接数为 25,Cache Size为10时,数据库可能需要打开25*10=250个游标。不幸的是,当遇到与PreparedStatement Cache 有关的应用程序错误时,你需要将Cache Size设置为0。<br />

尽管JDBC Connection Pool提供了很多高级参数,在开发模式下比较有用,但大部分在生产环境下不需调整。这里建议最好不要设置测试表, 同时Test Reserved Connections和 Test Released Connections也无需勾上。 当然如果你的数据库不稳定,时断时续,你就可能需要上述的参数打开。<br />

最后提一下驱动程序类型的选择,以Oracle为例,Oracle提供thin驱动和oci驱动,从性能上来讲,oci驱动强于thin驱动,特别是大数据量的操作。但在简单的数据库操作中,性能相差不大,随着thin驱动的不断改进,这一弱势将得到弥补。而thin驱动的移植性明显强于oci驱动。所以在通常情况下建议使用thin驱动。而最新驱动器由于WebLogic server/bin目录下的类包可能不是最新的,请以Oracle网站为准: http://www.oracle.com/technology/software ... jdbc/htdocs/jdbc9201.html。<br />

10) JSP调优<br />

设置jsp-param pageCheckSeconds=-1；<br />

设置serlet-reload-check=-1或ServletReloadCheckSecs=-1；<br />

设置jsp-param precompile=true，关闭JSP预编译选项。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/weblogic-turning/#disqus_thread">Comments</a></span>
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="/install-mysql-2/">mysql安装</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2006-08-05T00:00:00.000&#43;00:00' itemprop="datePublished">2006-08-05</time>
</div>
        <div class="tags">Tags: 

<a href="/tags/mysql">mysql</a>

<a href="/tags/other">other</a>


</div>
    </div>
        1 download mysql5.0<br />
2<br />
shell> groupadd mysql<br />
shell> useradd -g mysql mysql<br />
shell> cd /usr/local<br />
shell> gunzip < /PATH/TO/MYSQL-VERSION-OS.tar.gz | tar xvf -<br />
shell> ln -s FULL-PATH-TO-MYSQL-VERSION-OS mysql<br />
shell> cd mysql<br />
shell> scripts/mysql_install_db --user=mysql<br />
<!--more--><br />
如下提示信息:<br />

Installing all prepared tables<br />
Fill help tables<br />

To start mysqld at boot time you have to copy support-files/mysql.server<br />
to the right place for your system<br />

PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !<br />
To do so, start the server, then issue the following commands:<br />
./bin/mysqladmin -u root password 'new-password'<br />
./bin/mysqladmin -u root -h czhand password 'new-password'<br />
See the manual for more instructions.<br />

You can start the MySQL daemon with:<br />
cd . ; ./bin/mysqld_safe &<br />

You can test the MySQL daemon with the benchmarks in the 'sql-bench' directory:<br />
cd sql-bench ; perl run-all-tests<br />

Please report any problems with the ./bin/mysqlbug script!<br />

The latest information about MySQL is available on the web at<br />
http://www.mysql.com<br />
Support MySQL by buying support/licenses at https://order.mysql.com<br />

shell> chown -R root  .<br />
shell> chown -R mysql data<br />
shell> chgrp -R mysql .<br />

/home/my.cnf<br />

basedir=/usr/local/mysql<br />
datadir=/usr/local/mysql/data<br />
socket=/usr/local/mysql/data/mysql.sock<br />
#err-log=/var/log/mysqld.log<br />
pid-file=/usr/local/mysql/data/mysqld.pid<br />

shell> bin/mysqld_safe --user=mysql &<br />

事实上，mysql.sock放到data目录是会出现问题的，因为data目录只有mysql用户可读，用php连接数据库的时候就会出现问题。所以，上面的最好修改一下。<br />

    </div>

<div class="meta">
    
    <span class="comments"><a href="/install-mysql-2/#disqus_thread">Comments</a></span>
    
</div>
</article>



  <nav id="pagenavi">
    
        <a href="/page/31/" class="prev">Prev</a>
    
    
        <a href="/page/33/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2017
    
    wd
    . Powered by <a href="http://gohugo.io" target="_blank">Hugo</a> |
    Theme is <a href="https://github.com/wd/hugo-fabric">hugo-fabric</a>, fork from <a href="https://github.com/wd/hexo-fabric">hexo-fabric</a> by <a href="https://wdicc.com">me</a>
</div>

    </footer>
    <script src="/js/fabric.js"></script>


</div>
</div>
<script src="/js/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
 
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery);
 
</script>
</body>
</html>
